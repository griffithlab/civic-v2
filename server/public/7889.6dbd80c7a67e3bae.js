"use strict";(self.webpackChunkmain=self.webpackChunkmain||[]).push([[7889],{4758:(R,M,e)=>{e.d(M,{m:()=>A});var s=e(6814),o=e(9755),g=e(6165),t=e(1218),m=e(7528),d=e(3641),u=e(5956),P=e(8706),f=e(1106),D=e(5695),z=e(551),E=e(8527),T=e(5879);let A=(()=>{class c{}return c.\u0275fac=function(l){return new(l||c)},c.\u0275mod=T.oAB({type:c}),c.\u0275inj=T.cJS({imports:[s.ez,D.X,z.PV,o.y,g.W,t.i,m.Q,d.G,u.U,P.W,f.L,E.u]}),c})()},5098:(R,M,e)=>{e.d(M,{P:()=>A});var s=e(5879),o=e(4190),g=e(6814),t=e(9382),m=e(95),d=e(551),u=e(3640);const P=["tabBarExtraContent"];function f(c,O){if(1&c&&s.GkF(0,5),2&c){const l=s.oxw();s.Q6J("ngTemplateOutlet",l.tabBarExtraContent||null)}}const D=function(c){return{transform:"scale(0.75, 0.75) translate(0, -2px)",backgroundColor:c}};function z(c,O){if(1&c&&s._UZ(0,"nz-badge",10),2&c){const l=s.oxw(2).$implicit;s.hYB("nzTitle","",l.badgeCount," ",l.tabLabel,"(s)."),s.Q6J("nzCount",l.badgeCount)("nzStyle",s.VKq(4,D,l.badgeColor||"#ff4d4f"))}}function E(c,O){if(1&c&&(s.TgZ(0,"a",7),s._UZ(1,"i",8),s._uU(2),s.YNc(3,z,1,6,"nz-badge",9),s.qZA()),2&c){const l=s.oxw().$implicit;s.Q6J("routerLink",l.routeName),s.xp6(1),s.Q6J("nzType",l.iconName),s.xp6(1),s.hij(" ",l.tabLabel," "),s.xp6(1),s.Q6J("ngIf",l.badgeCount&&l.badgeCount>0)}}function T(c,O){1&c&&(s.TgZ(0,"nz-tab"),s.YNc(1,E,4,4,"a",6),s.qZA())}let A=(()=>{class c{constructor(l){this.router=l,this.selectedTabIndex=this.getActivatedRouteIndex(this.router.url)}getActivatedRouteIndex(l){return this.tabs?.findIndex(y=>l.includes(y.routeName))}}return c.\u0275fac=function(l){return new(l||c)(s.Y36(o.F0))},c.\u0275cmp=s.Xpm({type:c,selectors:[["cvc-tab-navigation"]],contentQueries:function(l,y,B){if(1&l&&s.Suo(B,P,5),2&l){let b;s.iGM(b=s.CRH())&&(y.tabBarExtraContent=b.first)}},inputs:{entity:"entity",tabs:"tabs"},decls:6,vars:3,consts:[["id","section-tabs"],["nzSpan","24"],["nzLinkRouter","","nzType","card","nzSize","small",3,"nzSelectedIndex","nzTabBarExtraContent"],["extraTpl",""],[4,"ngFor","ngForOf"],[3,"ngTemplateOutlet"],["nz-tab-link","",3,"routerLink",4,"nzTabLink"],["nz-tab-link","",3,"routerLink"],["nz-icon","",3,"nzType"],["nzStandalone","",3,"nzCount","nzTitle","nzStyle",4,"ngIf"],["nzStandalone","",3,"nzCount","nzTitle","nzStyle"]],template:function(l,y){if(1&l&&(s.TgZ(0,"nz-row",0)(1,"nz-col",1)(2,"nz-tabset",2),s.YNc(3,f,1,1,"ng-template",null,3,s.W1O),s.YNc(5,T,2,0,"nz-tab",4),s.qZA()()()),2&l){const B=s.MAs(4);s.xp6(2),s.Q6J("nzSelectedIndex",y.selectedTabIndex)("nzTabBarExtraContent",B),s.xp6(3),s.Q6J("ngForOf",y.tabs)}},dependencies:[g.sg,g.O5,g.tP,o.rH,t.xH,t.xw,t.Ao,t.Fx,m.t3,m.SK,d.Ls,u.x7],styles:["[_nghost-%COMP%]{display:block}"]}),c})()},4059:(R,M,e)=>{e.d(M,{c:()=>P});var s=e(6814),o=e(9382),g=e(95),t=e(4190),m=e(551),d=e(3640),u=e(5879);let P=(()=>{class f{}return f.\u0275fac=function(z){return new(z||f)},f.\u0275mod=u.oAB({type:f}),f.\u0275inj=u.cJS({imports:[s.ez,t.Bz,o.we,g.Jb,m.PV,d.mS]}),f})()},3378:(R,M,e)=>{e.d(M,{w:()=>c});var s=e(6814),o=e(6223),g=e(2962),t=e(3599),m=e(3394),d=e(6294),u=e(845),P=e(2840),f=e(9560),D=e(9382),z=e(4758),E=e(2669),T=e(6513),A=e(5879);let c=(()=>{class O{}return O.\u0275fac=function(y){return new(y||O)},O.\u0275mod=A.oAB({type:O}),O.\u0275inj=A.cJS({imports:[s.ez,o.UX,P.sL,g.vh,D.we,t.U5,E.j,T.Gl,o.u5,m.B,d.A,u.R,z.m,f.K]}),O})()},3764:(R,M,e)=>{e.d(M,{Z:()=>g});var s=e(5879);const o=["*"];let g=(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(d){return new(d||t)},t.\u0275cmp=s.Xpm({type:t,selectors:[["cvc-form-buttons"]],ngContentSelectors:o,decls:2,vars:0,consts:[[1,"form-buttons"]],template:function(d,u){1&d&&(s.F$t(),s.TgZ(0,"div",0),s.Hsn(1),s.qZA())},styles:["[_nghost-%COMP%]{display:block}.form-buttons[_ngcontent-%COMP%]{text-align:right}"]}),t})()},845:(R,M,e)=>{e.d(M,{R:()=>g});var s=e(6814),o=e(5879);let g=(()=>{class t{}return t.\u0275fac=function(d){return new(d||t)},t.\u0275mod=o.oAB({type:t}),t.\u0275inj=o.cJS({imports:[s.ez]}),t})()},2257:(R,M,e)=>{e.d(M,{q:()=>N});var B,s=e(655),o=e(5879),g=e(1791),t=e(8645),m=e(5619),d=e(7398),u=e(9397),P=e(4223),f=e(5805),D=e(951),z=e(6814),E=e(2840),T=e(855),A=e(1958),c=e(6928),O=e(3460),l=e(2787),y=e(8091);function b(p,_){1&p&&o.Hsn(0)}function U(p,_){1&p&&o.GkF(0)}function Z(p,_){if(1&p&&(o.ynx(0),o.YNc(1,U,1,0,"ng-container",5),o.BQk()),2&p){o.oxw(2);const C=o.MAs(1);o.xp6(1),o.Q6J("ngTemplateOutlet",C)}}function S(p,_){1&p&&o.GkF(0)}function $(p,_){if(1&p&&(o.ynx(0),o.TgZ(1,"nz-button-group"),o.YNc(2,S,1,0,"ng-container",5),o.TgZ(3,"button",6),o.ALo(4,"ngrxPush"),o.ALo(5,"ngrxPush"),o.ALo(6,"ngrxPush"),o.TgZ(7,"span"),o._uU(8,"for"),o.qZA(),o._UZ(9,"nz-avatar",7)(10,"i",8),o.qZA()(),o.BQk()),2&p){o.oxw();const C=o.MAs(4),x=o.oxw(),L=o.MAs(1);o.xp6(2),o.Q6J("ngTemplateOutlet",L),o.xp6(1),o.Q6J("ngClass",o.lcZ(4,8,x.buttonClass$))("hidden",o.lcZ(5,10,x.isHidden$))("disabled",o.lcZ(6,12,x.isDisabled$))("nzDropdownMenu",C),o.xp6(6),o.Q6J("nzSrc",null==x.selectedOrg?null:x.selectedOrg.profileImagePath)("nzSize",10)("nzShape","square")}}function w(p,_){if(1&p){const C=o.EpF();o.TgZ(0,"li",9),o.NdJ("click",function(){const G=o.CHM(C).$implicit,J=o.oxw(2);return o.KtG(J.selectOrg(G))}),o._UZ(1,"nz-avatar",10),o._uU(2),o.qZA()}if(2&p){const C=_.$implicit,x=o.oxw(2);o.Q6J("nzSelected",(null==x.selectedOrg?null:x.selectedOrg.id)===C.id),o.xp6(1),o.Q6J("nzSrc",null==C?null:C.profileImagePath)("nzSize",10)("nzShape","square"),o.xp6(1),o.hij(" ",C.name," ")}}function K(p,_){if(1&p&&(o.ynx(0),o.YNc(1,Z,2,1,"ng-container",1),o.YNc(2,$,11,14,"ng-container",1),o.TgZ(3,"nz-dropdown-menu",null,2)(5,"ul",3),o.YNc(6,w,3,5,"li",4),o.qZA()(),o.BQk()),2&p){const C=_.ngIf;o.xp6(1),o.Q6J("ngIf",C.length<=1),o.xp6(1),o.Q6J("ngIf",C.length>1),o.xp6(4),o.Q6J("ngForOf",C)}}let N=((B=class{constructor(_){this.viewerService=_,this.selectedOrgChange=new o.vpe,this.baseButtonClass="org-dropdown-btn",this.isDisabled$=new t.x,this.isHidden$=new t.x,this.buttonClass$=new m.X("")}selectOrg(_){this.selectedOrg=_,this.selectedOrgChange.emit(_)}refreshViewer(){setTimeout(()=>{this.viewerService.refetch()},2500)}ngOnInit(){this.organizations$=this.viewerService.viewer$.pipe((0,d.U)(_=>_.organizations)),this.mostRecentOrg$=this.viewerService.viewer$.pipe((0,P.j)("mostRecentOrg"),(0,u.b)(_=>{_&&(this.selectedOrg=_,this.selectedOrgChange.emit(_))})),this.mostRecentOrg$.pipe((0,g.t)(this)).subscribe()}ngAfterViewInit(){this.button&&this.button.domChange&&this.button.domChange.pipe((0,g.t)(this)).subscribe(_=>{"class"===_.type&&"string"==typeof _.change?this.buttonClass$.next(`${this.baseButtonClass} ${_.change}`):"disabled"===_.type&&"boolean"==typeof _.change?this.isDisabled$.next(_.change):"hidden"===_.type&&"boolean"==typeof _.change&&this.isHidden$.next(_.change)})}}).\u0275fac=function(_){return new(_||B)(o.Y36(D.a))},B.\u0275cmp=o.Xpm({type:B,selectors:[["cvc-org-selector-btn-group"]],contentQueries:function(_,C,x){if(1&_&&o.Suo(x,f.m,5),2&_){let L;o.iGM(L=o.CRH())&&(C.button=L.first)}},inputs:{selectedOrg:"selectedOrg"},outputs:{selectedOrgChange:"selectedOrgChange"},ngContentSelectors:["*"],decls:4,vars:3,consts:[["submitButton",""],[4,"ngIf"],["orgMenu","nzDropdownMenu"],["nz-menu",""],["nz-menu-item","",3,"nzSelected","click",4,"ngFor","ngForOf"],[4,"ngTemplateOutlet"],["type","button","nz-button","","nz-dropdown","",3,"ngClass","hidden","disabled","nzDropdownMenu"],[3,"nzSrc","nzSize","nzShape"],["nz-icon","","nzType","down"],["nz-menu-item","",3,"nzSelected","click"],[2,"background-color","#f0f5ff",3,"nzSrc","nzSize","nzShape"]],template:function(_,C){1&_&&(o.F$t(),o.YNc(0,b,1,0,"ng-template",null,0,o.W1O),o.YNc(2,K,7,3,"ng-container",1),o.ALo(3,"async")),2&_&&(o.xp6(2),o.Q6J("ngIf",o.lcZ(3,1,C.organizations$)))},dependencies:[z.mk,z.sg,z.O5,z.tP,E.ix,E.fY,T.w,A.dQ,c.Dz,O.wO,O.r9,l.cm,l.RR,l.wA,z.Ov,y.fM],styles:["[_nghost-%COMP%]{display:inline-block}[_nghost-%COMP%]     .ant-btn-dangerous.ant-btn-primary:first-child:not(:last-child){border-right-color:#ff4d4f}[_nghost-%COMP%]     .ant-btn-dangerous.ant-btn-primary:hover, [_nghost-%COMP%]     .ant-btn-dangerous.ant-btn-primary:focus{border-right-color:#fd7978}.org-dropdown-btn[_ngcontent-%COMP%]   nz-avatar[_ngcontent-%COMP%]{margin:0 6px}.org-dropdown-btn.ant-btn-dangerous[_ngcontent-%COMP%]:last-child:not(:first-child), .org-dropdown-btn[_ngcontent-%COMP%]   .ant-btn-dangerous[_ngcontent-%COMP%] + .ant-btn-dangerous[_ngcontent-%COMP%]{border-left-color:#fd7978}"]}),B);N=(0,s.gn)([(0,g.c)()],N)},6294:(R,M,e)=>{e.d(M,{A:()=>d});var s=e(6814),o=e(2840),g=e(6928),t=e(2787),m=e(5879);let d=(()=>{class u{}return u.\u0275fac=function(f){return new(f||u)},u.\u0275mod=m.oAB({type:u}),u.\u0275inj=m.cJS({imports:[s.ez,o.sL,g.Rt,t.b1]}),u})()},5805:(R,M,e)=>{e.d(M,{m:()=>P});var u,s=e(655),o=e(5879),g=e(1791),t=e(9666),m=e(7398),d=e(6180);let P=((u=class{constructor(D){this.el=D,this.domChange=new o.vpe,this.changes=new MutationObserver(z=>{(0,t.D)(z).pipe((0,m.U)(E=>{const T=E.target;return"class"===E.attributeName?{type:"class",change:T.classList.value,key:`${E.attributeName}:${T.classList.value}`}:"disabled"===E.attributeName?{type:"disabled",change:T.disabled,key:`${E.attributeName}:${T.disabled}`}:"hidden"===E.attributeName?{type:"hidden",change:T.hidden,key:`${E.attributeName}:${T.hidden}`}:{type:E.attributeName,change:"unknown change type",key:`${E.attributeName}:unknown-change-type`}}),(0,d.g)("key"),(0,g.t)(this)).subscribe(E=>{this.domChange.emit(E)})}),this.changes.observe(this.el.nativeElement,{attributeFilter:["class","disabled","hidden"],attributes:!0,childList:!1,subtree:!1})}ngAfterViewInit(){console.log(`directive ngAfterViewInit classList.value: ${this.el.nativeElement.classList.value}`),this.initialClass=this.el.nativeElement.classList.value}ngOnDestroy(){this.changes.disconnect()}}).\u0275fac=function(D){return new(D||u)(o.Y36(o.SBq))},u.\u0275dir=o.lG2({type:u,selectors:[["button","cvcOrgSelectorBtn",""]],outputs:{domChange:"domChange"}}),u);P=(0,s.gn)([(0,g.c)()],P)},6513:(R,M,e)=>{e.d(M,{Gl:()=>et,O3:()=>j,YW:()=>X,jO:()=>H});var s=e(9388),o=e(9594),g=e(6814),t=e(5879),m=e(6223),d=e(883),u=e(804),P=e(551),f=e(8645),D=e(2438),z=e(2096),E=e(5592),T=e(3019),A=e(7394),c=e(9773),O=e(3997),l=e(2460),y=e(7398),B=e(7921),b=e(4664),U=e(9087),Z=e(655),S=e(6028),$=e(8484),w=e(5448),K=e(7754);const Q=["items"];function N(r,v){1&r&&t.GkF(0)}const p=function(r){return{$implicit:r}};function _(r,v){if(1&r&&(t.ynx(0),t.YNc(1,N,1,0,"ng-container",10),t.BQk()),2&r){const n=t.oxw().$implicit,i=t.oxw(2);t.xp6(1),t.Q6J("ngTemplateOutlet",i.suggestionTemplate)("ngTemplateOutletContext",t.VKq(2,p,n))}}function C(r,v){if(1&r&&t._uU(0),2&r){const n=t.oxw().$implicit,i=t.oxw(2);t.Oqu(i.nzValueWith(n))}}function x(r,v){if(1&r){const n=t.EpF();t.TgZ(0,"li",6,7),t.NdJ("click",function(){const h=t.CHM(n).$implicit,I=t.oxw(2);return t.KtG(I.selectSuggestion(h))}),t.YNc(2,_,2,4,"ng-container",8),t.YNc(3,C,1,1,"ng-template",null,9,t.W1O),t.qZA()}if(2&r){const n=v.index,i=t.MAs(4),a=t.oxw(2);t.ekj("ant-mentions-dropdown-menu-item-active",n===a.activeIndex)("ant-mentions-dropdown-menu-item-selected",n===a.activeIndex),t.xp6(2),t.Q6J("ngIf",a.suggestionTemplate)("ngIfElse",i)}}function L(r,v){1&r&&(t.TgZ(0,"span"),t._UZ(1,"span",13),t.qZA())}function G(r,v){if(1&r&&(t.TgZ(0,"span"),t._UZ(1,"nz-embed-empty",14),t.qZA()),2&r){const n=t.oxw(3);t.xp6(1),t.Q6J("specificContent",n.nzNotFoundContent)}}function J(r,v){if(1&r&&(t.TgZ(0,"li",11),t.YNc(1,L,2,0,"span",12),t.YNc(2,G,2,1,"span",12),t.qZA()),2&r){const n=t.oxw(2);t.xp6(1),t.Q6J("ngIf",n.nzLoading),t.xp6(1),t.Q6J("ngIf",!n.nzLoading)}}function k(r,v){if(1&r&&(t.TgZ(0,"div",2)(1,"ul",3),t.YNc(2,x,5,6,"li",4),t.YNc(3,J,3,2,"li",5),t.qZA()()),2&r){const n=t.oxw();t.xp6(2),t.Q6J("ngForOf",n.filteredSuggestions),t.xp6(1),t.Q6J("ngIf",0===n.filteredSuggestions.length)}}function q(r,v){if(1&r&&t._UZ(0,"nz-form-item-feedback-icon",15),2&r){const n=t.oxw();t.Q6J("status",n.status)}}const tt=["*"];let j=(()=>{class r{}return r.\u0275fac=function(n){return new(n||r)},r.\u0275dir=t.lG2({type:r,selectors:[["","nzMentionSuggestion",""]],exportAs:["nzMentionSuggestion"]}),r})();let V=(()=>{class r{constructor(){this.triggerChange$=new f.x}triggerChanged(){return this.triggerChange$.asObservable()}registerTrigger(n){this.trigger!==n&&(this.trigger=n,this.triggerChange$.next(n))}ngOnDestroy(){this.triggerChange$.complete()}}return r.\u0275fac=function(n){return new(n||r)},r.\u0275prov=t.Yz7({token:r,factory:r.\u0275fac}),r})();const nt={provide:m.JU,useExisting:(0,t.Gpc)(()=>H),multi:!0};let H=(()=>{class r{constructor(n,i,a,h,I){this.el=n,this.ngZone=i,this.ref=a,this.destroy$=h,this.nzMentionService=I,this.onChange=()=>{},this.onTouched=()=>{},this.onFocusin=new t.vpe,this.onBlur=new t.vpe,this.onInput=new t.vpe,this.onKeydown=new t.vpe,this.onClick=new t.vpe}completeEvents(){this.onFocusin.complete(),this.onBlur.complete(),this.onInput.complete(),this.onKeydown.complete(),this.onClick.complete()}focus(n=null){this.el.nativeElement.focus(),this.el.nativeElement.setSelectionRange(n,n)}insertMention(n){const i=this.el.nativeElement.value,a=`${n.mention} `,h=[i.slice(0,n.startPos+1),a,i.slice(n.endPos,i.length)].join("");this.el.nativeElement.value=h,this.focus(n.startPos+a.length+1),this.onChange(h),this.value=h}writeValue(n){this.value=n,this.el.nativeElement.value="string"==typeof n?n:""}registerOnChange(n){this.onChange=n}registerOnTouched(n){this.onTouched=n}ngAfterViewInit(){this.nzMentionService.registerTrigger(this),this.setupEventListener("blur",this.onBlur),this.setupEventListener("focusin",this.onFocusin),this.setupEventListener("input",this.onInput,!0),this.setupEventListener("click",this.onClick,!0),this.setupEventListener("keydown",this.onKeydown,!0)}ngOnDestroy(){this.completeEvents()}setupEventListener(n,i,a=!1){this.ngZone.runOutsideAngular(()=>{(0,D.R)(this.el.nativeElement,n).pipe((0,c.R)(this.destroy$)).subscribe(h=>{i.observers.length&&this.ngZone.run(()=>{i.emit(a?h:void 0),this.ref.markForCheck()})})})}}return r.\u0275fac=function(n){return new(n||r)(t.Y36(t.SBq),t.Y36(t.R0b),t.Y36(t.sBO),t.Y36(U.kn),t.Y36(V))},r.\u0275dir=t.lG2({type:r,selectors:[["input","nzMentionTrigger",""],["textarea","nzMentionTrigger",""]],hostAttrs:["autocomplete","off"],outputs:{onFocusin:"onFocusin",onBlur:"onBlur",onInput:"onInput",onKeydown:"onKeydown",onClick:"onClick"},exportAs:["nzMentionTrigger"],features:[t._Bn([U.kn,nt])]}),r})(),X=(()=>{class r{set suggestionChild(n){n&&(this.suggestionTemplate=n)}get triggerNativeElement(){return this.trigger.el.nativeElement}get focusItemElement(){const n=this.items?.toArray();return n&&n[this.activeIndex]?n[this.activeIndex].nativeElement:null}constructor(n,i,a,h,I,Y,F,ot,it,st,rt,at){this.ngZone=n,this.ngDocument=i,this.directionality=a,this.cdr=h,this.overlay=I,this.viewContainerRef=Y,this.elementRef=F,this.renderer=ot,this.nzMentionService=it,this.destroy$=st,this.nzFormStatusService=rt,this.nzFormNoStatusService=at,this.nzValueWith=_t=>_t,this.nzPrefix="@",this.nzLoading=!1,this.nzNotFoundContent="\u65e0\u5339\u914d\u7ed3\u679c\uff0c\u8f7b\u6572\u7a7a\u683c\u5b8c\u6210\u8f93\u5165",this.nzPlacement="bottom",this.nzSuggestions=[],this.nzStatus="",this.nzOnSelect=new t.vpe,this.nzOnSearchChange=new t.vpe,this.isOpen=!1,this.filteredSuggestions=[],this.suggestionTemplate=null,this.activeIndex=-1,this.dir="ltr",this.prefixCls="ant-mentions",this.statusCls={},this.status="",this.hasFeedback=!1,this.previousValue=null,this.cursorMention=null,this.overlayRef=null}ngOnInit(){this.nzFormStatusService?.formStatusChanges.pipe((0,O.x)((n,i)=>n.status===i.status&&n.hasFeedback===i.hasFeedback),(0,l.M)(this.nzFormNoStatusService?this.nzFormNoStatusService.noFormStatus:(0,z.of)(!1)),(0,y.U)(([{status:n,hasFeedback:i},a])=>({status:a?"":n,hasFeedback:i})),(0,c.R)(this.destroy$)).subscribe(({status:n,hasFeedback:i})=>{this.setStatusStyles(n,i)}),this.nzMentionService.triggerChanged().subscribe(n=>{this.trigger=n,this.bindTriggerEvents(),this.closeDropdown(),this.overlayRef=null}),this.dir=this.directionality.value,this.directionality.change?.pipe((0,c.R)(this.destroy$)).subscribe(n=>{this.dir=n})}ngOnChanges(n){const{nzSuggestions:i,nzStatus:a}=n;i&&this.isOpen&&(this.previousValue=null,this.activeIndex=-1,this.resetDropdown(!1)),a&&this.setStatusStyles(this.nzStatus,this.hasFeedback)}ngAfterViewInit(){this.items.changes.pipe((0,B.O)(this.items),(0,b.w)(()=>{const n=this.items.toArray();return new E.y(i=>this.ngZone.runOutsideAngular(()=>(0,T.T)(...n.map(a=>(0,D.R)(a.nativeElement,"mousedown"))).subscribe(i)))})).subscribe(n=>{n.preventDefault()})}ngOnDestroy(){this.closeDropdown()}closeDropdown(){this.overlayRef&&this.overlayRef.hasAttached()&&(this.overlayRef.detach(),this.overlayOutsideClickSubscription.unsubscribe(),this.isOpen=!1,this.cdr.markForCheck())}openDropdown(){this.attachOverlay(),this.isOpen=!0,this.cdr.markForCheck()}getMentions(){return this.trigger?(0,K.qR)(this.trigger.value,this.nzPrefix):[]}selectSuggestion(n){const i=this.nzValueWith(n);this.trigger.insertMention({mention:i,startPos:this.cursorMentionStart,endPos:this.cursorMentionEnd}),this.nzOnSelect.emit(n),this.closeDropdown(),this.activeIndex=-1}handleInput(n){const i=n.target;this.trigger.onChange(i.value),this.trigger.value=i.value,this.resetDropdown()}handleKeydown(n){const i=n.keyCode;if(this.isOpen&&i===S.K5&&-1!==this.activeIndex&&this.filteredSuggestions.length)this.selectSuggestion(this.filteredSuggestions[this.activeIndex]),n.preventDefault();else if(i===S.oh||i===S.SV)this.resetDropdown(),n.stopPropagation();else{if(this.isOpen&&(i===S.Mf||i===S.hY))return void this.closeDropdown();this.isOpen&&i===S.LH&&(this.setPreviousItemActive(),n.preventDefault(),n.stopPropagation()),this.isOpen&&i===S.JH&&(this.setNextItemActive(),n.preventDefault(),n.stopPropagation())}}handleClick(){this.resetDropdown()}bindTriggerEvents(){this.trigger.onInput.subscribe(n=>this.handleInput(n)),this.trigger.onKeydown.subscribe(n=>this.handleKeydown(n)),this.trigger.onClick.subscribe(()=>this.handleClick())}suggestionsFilter(n,i){const a=n.substring(1);if(this.previousValue===n&&n!==this.cursorMention[0])return;this.previousValue=n,i&&this.nzOnSearchChange.emit({value:this.cursorMention.substring(1),prefix:this.cursorMention[0]});const h=a.toLowerCase();this.filteredSuggestions=this.nzSuggestions.filter(I=>this.nzValueWith(I).toLowerCase().includes(h))}resetDropdown(n=!0){if(this.resetCursorMention(),"string"!=typeof this.cursorMention||!this.canOpen())return void this.closeDropdown();this.suggestionsFilter(this.cursorMention,n);const i=this.filteredSuggestions.indexOf(this.cursorMention.substring(1));this.activeIndex=i>=0?i:0,this.openDropdown()}setNextItemActive(){this.activeIndex=this.activeIndex+1<=this.filteredSuggestions.length-1?this.activeIndex+1:0,this.cdr.markForCheck(),this.scrollToFocusItem()}setPreviousItemActive(){this.activeIndex=this.activeIndex-1<0?this.filteredSuggestions.length-1:this.activeIndex-1,this.cdr.markForCheck(),this.scrollToFocusItem()}scrollToFocusItem(){this.focusItemElement&&this.focusItemElement.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})}canOpen(){const n=this.triggerNativeElement;return!n.readOnly&&!n.disabled}resetCursorMention(){const n=this.triggerNativeElement.value.replace(/[\r\n]/g," ")||"",i=this.triggerNativeElement.selectionStart,a="string"==typeof this.nzPrefix?[this.nzPrefix]:this.nzPrefix;let h=a.length;for(;h>=0;){const I=n.lastIndexOf(a[h],i),Y=n.indexOf(" ",i)>-1?n.indexOf(" ",i):n.length,F=n.substring(I,Y);if(!(I>0&&" "!==n[I-1]||I<0||F.includes(a[h],1)||F.includes(" ")))return this.cursorMention=F,this.cursorMentionStart=I,void(this.cursorMentionEnd=Y);this.cursorMention=null,this.cursorMentionStart=-1,this.cursorMentionEnd=-1,h--}}updatePositions(){const n=(0,K.Ly)(this.triggerNativeElement,this.cursorMentionStart),i=n.top-this.triggerNativeElement.getBoundingClientRect().height-this.triggerNativeElement.scrollTop+("bottom"===this.nzPlacement?n.height-6:-6);this.positionStrategy.withDefaultOffsetX(n.left-this.triggerNativeElement.scrollLeft).withDefaultOffsetY(i),"bottom"===this.nzPlacement&&this.positionStrategy.withPositions([...w.fG]),"top"===this.nzPlacement&&this.positionStrategy.withPositions([...w.A7]),this.positionStrategy.apply()}subscribeOverlayOutsideClick(){const n=a=>{const h=a.target;return this.isOpen&&h!==this.trigger.el.nativeElement&&!this.overlayRef?.overlayElement.contains(h)},i=new A.w0;return i.add(this.overlayRef.outsidePointerEvents().subscribe(a=>n(a)&&this.closeDropdown())),i.add(this.ngZone.runOutsideAngular(()=>(0,D.R)(this.ngDocument,"touchend").subscribe(a=>n(a)&&this.ngZone.run(()=>this.closeDropdown())))),i}attachOverlay(){this.overlayRef||(this.portal=new $.UE(this.suggestionsTemp,this.viewContainerRef),this.overlayRef=this.overlay.create(this.getOverlayConfig())),this.overlayRef&&!this.overlayRef.hasAttached()&&(this.overlayRef.attach(this.portal),this.overlayOutsideClickSubscription=this.subscribeOverlayOutsideClick()),this.updatePositions()}getOverlayConfig(){return new o.X_({positionStrategy:this.getOverlayPosition(),scrollStrategy:this.overlay.scrollStrategies.reposition(),disposeOnNavigation:!0})}getOverlayPosition(){const n=[new o.tR({originX:"start",originY:"bottom"},{overlayX:"start",overlayY:"top"}),new o.tR({originX:"start",originY:"top"},{overlayX:"start",overlayY:"bottom"})];return this.positionStrategy=this.overlay.position().flexibleConnectedTo(this.trigger.el).withPositions(n).withFlexibleDimensions(!1).withPush(!1),this.positionStrategy}setStatusStyles(n,i){this.status=n,this.hasFeedback=i,this.cdr.markForCheck(),this.statusCls=(0,K.Zu)(this.prefixCls,n,i),Object.keys(this.statusCls).forEach(a=>{this.statusCls[a]?this.renderer.addClass(this.elementRef.nativeElement,a):this.renderer.removeClass(this.elementRef.nativeElement,a)})}}return r.\u0275fac=function(n){return new(n||r)(t.Y36(t.R0b),t.Y36(g.K0,8),t.Y36(s.Is,8),t.Y36(t.sBO),t.Y36(o.aV),t.Y36(t.s_b),t.Y36(t.SBq),t.Y36(t.Qsj),t.Y36(V),t.Y36(U.kn),t.Y36(d.kH,8),t.Y36(d.yW,8))},r.\u0275cmp=t.Xpm({type:r,selectors:[["nz-mention"]],contentQueries:function(n,i,a){if(1&n&&t.Suo(a,j,5,t.Rgc),2&n){let h;t.iGM(h=t.CRH())&&(i.suggestionChild=h.first)}},viewQuery:function(n,i){if(1&n&&(t.Gf(t.Rgc,5),t.Gf(Q,5,t.SBq)),2&n){let a;t.iGM(a=t.CRH())&&(i.suggestionsTemp=a.first),t.iGM(a=t.CRH())&&(i.items=a)}},hostAttrs:[1,"ant-mentions"],hostVars:2,hostBindings:function(n,i){2&n&&t.ekj("ant-mentions-rtl","rtl"===i.dir)},inputs:{nzValueWith:"nzValueWith",nzPrefix:"nzPrefix",nzLoading:"nzLoading",nzNotFoundContent:"nzNotFoundContent",nzPlacement:"nzPlacement",nzSuggestions:"nzSuggestions",nzStatus:"nzStatus"},outputs:{nzOnSelect:"nzOnSelect",nzOnSearchChange:"nzOnSearchChange"},exportAs:["nzMention"],features:[t._Bn([V,U.kn]),t.TTD],ngContentSelectors:tt,decls:4,vars:1,consts:[["suggestions",""],["class","ant-mentions-suffix",3,"status",4,"ngIf"],[1,"ant-mentions-dropdown"],["role","menu","tabindex","0",1,"ant-mentions-dropdown-menu"],["class","ant-mentions-dropdown-menu-item","role","menuitem","tabindex","-1",3,"ant-mentions-dropdown-menu-item-active","ant-mentions-dropdown-menu-item-selected","click",4,"ngFor","ngForOf"],["class","ant-mentions-dropdown-menu-item ant-mentions-dropdown-menu-item-disabled",4,"ngIf"],["role","menuitem","tabindex","-1",1,"ant-mentions-dropdown-menu-item",3,"click"],["items",""],[4,"ngIf","ngIfElse"],["defaultSuggestion",""],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"ant-mentions-dropdown-menu-item","ant-mentions-dropdown-menu-item-disabled"],[4,"ngIf"],["nz-icon","","nzType","loading"],["nzComponentName","select",3,"specificContent"],[1,"ant-mentions-suffix",3,"status"]],template:function(n,i){1&n&&(t.F$t(),t.Hsn(0),t.YNc(1,k,4,2,"ng-template",null,0,t.W1O),t.YNc(3,q,1,1,"nz-form-item-feedback-icon",1)),2&n&&(t.xp6(3),t.Q6J("ngIf",i.hasFeedback&&!!i.status))},dependencies:[g.sg,g.O5,g.tP,P.Ls,u.gB,d.w_],encapsulation:2,changeDetection:0}),(0,Z.gn)([(0,K.yF)()],r.prototype,"nzLoading",void 0),r})(),et=(()=>{class r{}return r.\u0275fac=function(n){return new(n||r)},r.\u0275mod=t.oAB({type:r}),r.\u0275inj=t.cJS({imports:[s.vT,g.ez,m.u5,o.U8,P.PV,u.Xo,d.mJ]}),r})()}}]);