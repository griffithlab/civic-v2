"use strict";(self.webpackChunkmain=self.webpackChunkmain||[]).push([[4184],{8227:(P,A,r)=>{r.d(A,{q:()=>F});var o=r(5e3),_=r(8929),e=r(4850),f=r(373),y=r(2994),l=r(7625),O=r(1793),L=r(9350),C=r(9808),M=r(6042),B=r(2683),p=r(2643),z=r(3677),T=r(8144),I=r(6699),b=r(4219),E=r(6949);function Z(u,S){1&u&&o.Hsn(0)}function d(u,S){1&u&&o.GkF(0)}function x(u,S){if(1&u&&(o.ynx(0),o.YNc(1,d,1,0,"ng-container",5),o.BQk()),2&u){o.oxw(2);const s=o.MAs(1);o.xp6(1),o.Q6J("ngTemplateOutlet",s)}}function h(u,S){1&u&&o.GkF(0)}function v(u,S){if(1&u&&(o.ynx(0),o.TgZ(1,"nz-button-group",6),o.YNc(2,h,1,0,"ng-container",5),o.TgZ(3,"button",7),o.ALo(4,"ngrxPush"),o.TgZ(5,"nz-space",8),o.TgZ(6,"span"),o._uU(7,"for"),o.qZA(),o._UZ(8,"nz-avatar",9),o._UZ(9,"i",10),o.qZA(),o.qZA(),o.qZA(),o.BQk()),2&u){o.oxw();const s=o.MAs(4),m=o.oxw(),D=o.MAs(1);o.xp6(1),o.Q6J("nzSize",m.nzSize),o.xp6(1),o.Q6J("ngTemplateOutlet",D),o.xp6(1),o.Q6J("nzType",m.buttonType)("nzDanger",m.nzDanger)("disabled",o.lcZ(4,10,m.isDisabled$))("nzDropdownMenu",s),o.xp6(2),o.Q6J("nzSize",4),o.xp6(3),o.Q6J("nzSrc",null==m.selectedOrg?null:m.selectedOrg.profileImagePath)("nzSize",10)("nzShape","square")}}function w(u,S){if(1&u){const s=o.EpF();o.TgZ(0,"li",11),o.NdJ("click",function(){const U=o.CHM(s).$implicit;return o.oxw(2).selectOrg(U)}),o._UZ(1,"nz-avatar",12),o._uU(2),o.qZA()}if(2&u){const s=S.$implicit,m=o.oxw(2);o.Q6J("nzSelected",(null==m.selectedOrg?null:m.selectedOrg.id)===s.id),o.xp6(1),o.Q6J("nzSrc",null==s?null:s.profileImagePath)("nzSize",10)("nzShape","square"),o.xp6(1),o.hij(" ",s.name," ")}}function J(u,S){if(1&u&&(o.ynx(0),o.YNc(1,x,2,1,"ng-container",1),o.YNc(2,v,10,12,"ng-container",1),o.TgZ(3,"nz-dropdown-menu",null,2),o.TgZ(5,"ul",3),o.YNc(6,w,3,5,"li",4),o.qZA(),o.qZA(),o.BQk()),2&u){const s=S.ngIf;o.xp6(1),o.Q6J("ngIf",s.length<=1),o.xp6(1),o.Q6J("ngIf",s.length>1),o.xp6(4),o.Q6J("ngForOf",s)}}const Q=["*"];let F=(()=>{class u{constructor(s){this.viewerService=s,this.selectedOrgChange=new o.vpe,this.buttonType="primary",this.nzDanger=!1,this.nzSize="small",this.destroy$=new _.xQ,this.isDisabled$=new _.xQ}selectOrg(s){this.selectedOrg=s,this.selectedOrgChange.emit(s)}refreshViewer(){setTimeout(()=>{this.viewerService.refetch()},2500)}ngOnInit(){this.organizations$=this.viewerService.viewer$.pipe((0,e.U)(s=>s.organizations)),this.mostRecentOrg$=this.viewerService.viewer$.pipe((0,f.j)("mostRecentOrg"),(0,y.b)(s=>{s&&(this.selectedOrg=s,this.selectedOrgChange.emit(s))})),this.mostRecentOrg$.pipe((0,l.R)(this.destroy$)).subscribe()}ngAfterViewInit(){this.button&&this.button.domChange&&this.button.domChange.pipe((0,l.R)(this.destroy$)).subscribe(s=>{"disabled"===s.type&&"boolean"==typeof s.change&&this.isDisabled$.next(s.change)})}ngOnDestroy(){this.destroy$.next(),this.destroy$.unsubscribe()}}return u.\u0275fac=function(s){return new(s||u)(o.Y36(L.a))},u.\u0275cmp=o.Xpm({type:u,selectors:[["cvc-org-selector-btn-group"]],contentQueries:function(s,m,D){if(1&s&&o.Suo(D,O.m,5),2&s){let U;o.iGM(U=o.CRH())&&(m.button=U.first)}},inputs:{selectedOrg:"selectedOrg",buttonType:"buttonType",nzDanger:"nzDanger",nzSize:"nzSize"},outputs:{selectedOrgChange:"selectedOrgChange"},ngContentSelectors:Q,decls:4,vars:3,consts:[["submitButton",""],[4,"ngIf"],["orgMenu","nzDropdownMenu"],["nz-menu",""],["nz-menu-item","",3,"nzSelected","click",4,"ngFor","ngForOf"],[4,"ngTemplateOutlet"],[3,"nzSize"],["type","button","nz-button","","nz-dropdown","",1,"org-dropdown-btn",3,"nzType","nzDanger","disabled","nzDropdownMenu"],["nzDirection","horizontal",3,"nzSize"],[3,"nzSrc","nzSize","nzShape"],["nz-icon","","nzType","down"],["nz-menu-item","",3,"nzSelected","click"],[2,"background-color","#f0f5ff",3,"nzSrc","nzSize","nzShape"]],template:function(s,m){1&s&&(o.F$t(),o.YNc(0,Z,1,0,"ng-template",null,0,o.W1O),o.YNc(2,J,7,3,"ng-container",1),o.ALo(3,"async")),2&s&&(o.xp6(2),o.Q6J("ngIf",o.lcZ(3,1,m.organizations$)))},directives:[C.O5,C.tP,M.fY,B.w,M.ix,p.dQ,z.wA,z.cm,T.NU,I.Dz,z.RR,b.wO,C.sg,b.r9],pipes:[C.Ov,E.fM],styles:["[_nghost-%COMP%]{display:inline-block}.org-dropdown-btn[_ngcontent-%COMP%]   nz-avatar[_ngcontent-%COMP%]{margin:0 6px}"]}),u})()},8979:(P,A,r)=>{r.d(A,{N:()=>B});var o=r(9808),_=r(8776),e=r(5e3),f=r(6042),y=r(2643),l=r(2683);const L={name:"cvc-multi-field-add-btn",component:(()=>{class p extends _.fS{constructor(){super()}}return p.\u0275fac=function(T){return new(T||p)},p.\u0275cmp=e.Xpm({type:p,selectors:[["cvc-multi-field-add-btn-type"]],features:[e.qOj],decls:2,vars:2,consts:[["type","submit","nz-button","","nzType","primary","nzSize","small","nzBlock","",3,"disabled"]],template:function(T,I){1&T&&(e.TgZ(0,"button",0),e._uU(1),e.qZA()),2&T&&(e.Q6J("disabled",I.to.disabled),e.xp6(1),e.Oqu(I.to.label))},directives:[f.ix,y.dQ,l.w],styles:[""],encapsulation:2,changeDetection:0}),p})()};var C=r(9139),M=r(4546);let B=(()=>{class p{}return p.\u0275fac=function(T){return new(T||p)},p.\u0275mod=e.oAB({type:p}),p.\u0275inj=e.cJS({imports:[[o.ez,C.u,_.X0.forChild({types:[L]}),M.U5,f.sL]]}),p})()},3022:(P,A,r)=>{r.d(A,{e:()=>Z});var o=r(9808),_=r(8776),e=r(8929),f=r(5778),y=r(7625),l=r(5e3),O=r(9180),L=r(8227),C=r(6042),M=r(2643),B=r(1793),p=r(2683);const T={name:"org-submit-button",component:(()=>{class d extends _.fS{constructor(h){super(),this.cdr=h,this._selectedOrg=void 0,this.destroy$=new e.xQ,this.defaultOptions={templateOptions:{submitLabel:"Submit",submitSize:"small"}}}get selectedOrg(){return this._selectedOrg}set selectedOrg(h){this._selectedOrg=h,this.formControl.setValue(h)}ngAfterViewInit(){this.form.statusChanges.pipe((0,f.x)(),(0,y.R)(this.destroy$)).subscribe(()=>this.cdr.detectChanges())}ngOnDestroy(){this.destroy$.next(),this.destroy$.unsubscribe()}}return d.\u0275fac=function(h){return new(h||d)(l.Y36(l.sBO))},d.\u0275cmp=l.Xpm({type:d,selectors:[["cvc-org-submit-button-type"]],features:[l.qOj],decls:5,vars:4,consts:[[3,"selectedOrg","nzSize","selectedOrgChange"],["orgButton",""],["type","submit","nz-button","","cvcOrgSelectorBtn","","nzType","primary",3,"disabled","click"]],template:function(h,v){if(1&h){const w=l.EpF();l.TgZ(0,"cvc-form-buttons"),l.TgZ(1,"cvc-org-selector-btn-group",0,1),l.NdJ("selectedOrgChange",function(Q){return v.selectedOrg=Q}),l.TgZ(3,"button",2),l.NdJ("click",function(){return l.CHM(w),l.MAs(2).refreshViewer()}),l._uU(4),l.qZA(),l.qZA(),l.qZA()}2&h&&(l.xp6(1),l.Q6J("selectedOrg",v.selectedOrg)("nzSize",v.to.submitSize),l.xp6(2),l.Q6J("disabled",!v.form.valid),l.xp6(1),l.hij(" ",v.to.submitLabel," "))},directives:[O.Z,L.q,C.ix,M.dQ,B.m,p.w],styles:[""],changeDetection:0}),d})()};var I=r(4375),b=r(1825),E=r(3075);let Z=(()=>{class d{}return d.\u0275fac=function(h){return new(h||d)},d.\u0275mod=l.oAB({type:d}),d.\u0275inj=l.cJS({imports:[[o.ez,E.UX,_.X0.forChild({types:[T]}),C.sL,I.R,b.A]]}),d})()},3773:(P,A,r)=>{r.d(A,{g:()=>de});var o=r(9808),_=r(8776),e=r(5e3),f=r(3075),y=r(712),l=r(6530),O=r(444);const L={sourceType:void 0,citationId:void 0};let C=(()=>{class n{constructor(){this.sourceSelected=new e.vpe,this.model=L,this.form=new f.cw({}),this.options={},this.fields=[{key:"id"},{key:"citation",defaultValue:""},{key:"sourceType",type:"select",className:"source-type-field",defaultValue:y.yic.Pubmed,templateOptions:{required:!0,placeholder:"Select Type",options:(0,O.o6)(y.yic).map((t,c)=>({value:t,label:(0,l.c)(t)}))}},{key:"citationId",className:"citation-id-field",type:"source-selector-typeahead",templateOptions:{maxLength:10,required:!0,triggerParentSubmit:()=>{this.onSubmit()}},expressionProperties:{"templateOptions.disabled":"!model.sourceType","templateOptions.placeholder":'!model.sourceType ? "Select source type before searching" : "Search " + model.sourceType + " sources"',"templateOptions.sourceType":"model.sourceType","templateOptions.sourceTypeKey":t=>{if(t.sourceType)return(0,O.o6)(y.yic).getKeyOrThrow(t.sourceType)}}},{type:"cvc-multi-field-add-btn",className:"add-button",templateOptions:{label:"Add Source"},expressionProperties:{"templateOptions.disabled":"!model.citationId"}}]}ngOnInit(){}onSubmit(){console.log("source-select form submitted."),this.sourceSelected.emit(this.model)}ngOnDestroy(){console.log("source-selector onDestroy called.")}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=e.Xpm({type:n,selectors:[["cvc-source-selector"]],outputs:{sourceSelected:"sourceSelected"},decls:2,vars:5,consts:[["nz-form","","nzLayout","horizontal",3,"formGroup","ngSubmit"],[1,"formly-form",3,"model","fields","options","form","modelChange"]],template:function(t,c){1&t&&(e.TgZ(0,"form",0),e.NdJ("ngSubmit",function(){return c.onSubmit()}),e.TgZ(1,"formly-form",1),e.NdJ("modelChange",function(g){return c.model=g}),e.qZA(),e.qZA()),2&t&&(e.Q6J("formGroup",c.form),e.xp6(1),e.Q6J("model",c.model)("fields",c.fields)("options",c.options)("form",c.form))},directives:[f._Y,f.JL,f.sg,_.T7],styles:[":host{display:block}cvc-source-input .formly-form{width:100%}cvc-source-input .source-type-field{display:inline-block;width:10em}cvc-source-input .citation-id-field{display:inline-block;margin-left:.5em;width:calc(100% - 19em)}cvc-source-input .add-button{display:inline-block;margin-left:.5em;width:8em}\n"],encapsulation:2}),n})();var M=r(6906);function B(n,i){if(1&n){const t=e.EpF();e.ynx(0),e.TgZ(1,"cvc-source-selector",2),e.NdJ("sourceSelected",function(a){return e.CHM(t),e.oxw().onSourceSelected(a)}),e.qZA(),e.BQk()}}function p(n,i){if(1&n&&e._UZ(0,"cvc-source-tag",3),2&n){const t=e.oxw();e.Q6J("source",t.formControl.value)}}const T={name:"source-input",component:(()=>{class n extends _.fS{constructor(){super()}onSourceSelected(t){console.log(t),this.formControl.setValue(t)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=e.Xpm({type:n,selectors:[["cvc-source-input-type"]],features:[e.qOj],decls:3,vars:2,consts:[[4,"ngIf","ngIfElse"],["sourceListItem",""],[3,"sourceSelected"],[3,"source"]],template:function(t,c){if(1&t&&(e.YNc(0,B,2,0,"ng-container",0),e.YNc(1,p,1,1,"ng-template",null,1,e.W1O)),2&t){const a=e.MAs(2);e.Q6J("ngIf",!(null!=c.formControl.value&&c.formControl.value.id))("ngIfElse",a)}},directives:[o.O5,C,M.T],styles:[""],changeDetection:0}),n})()};var I=r(9139),b=r(6042),E=r(8054),Z=r(537),d=r(8144),x=r(2359),h=r(1894),v=r(4546),w=r(822),J=r(2643),Q=r(2683);function F(n,i){if(1&n&&e._UZ(0,"nz-alert",6),2&n){e.oxw();const t=e.MAs(3);e.Q6J("nzMessage",t)}}function u(n,i){if(1&n&&(e._uU(0," Found citation: "),e.TgZ(1,"em"),e._uU(2),e.qZA()),2&n){const t=e.oxw(3);e.xp6(2),e.Oqu(t.foundCitation)}}function S(n,i){1&n&&(e.ynx(0),e.YNc(1,F,1,1,"nz-alert",4),e.YNc(2,u,3,1,"ng-template",null,5,e.W1O),e.BQk())}function s(n,i){if(1&n&&e._UZ(0,"nz-alert",9),2&n){e.oxw();const t=e.MAs(3);e.Q6J("nzMessage",t)}}function m(n,i){if(1&n&&(e._uU(0," '"),e.TgZ(1,"em"),e._uU(2),e.qZA(),e._uU(3,"' created. ")),2&n){const t=e.oxw(3);e.xp6(2),e.Oqu(t.foundCitation)}}function D(n,i){1&n&&(e.ynx(0),e.YNc(1,s,1,1,"nz-alert",7),e.YNc(2,m,4,1,"ng-template",null,8,e.W1O),e.BQk())}function U(n,i){if(1&n&&(e.TgZ(0,"nz-form-item"),e._UZ(1,"cvc-form-errors-alert",10),e.qZA()),2&n){const t=e.oxw(2);e.xp6(1),e.Q6J("errors",t.createErrors)}}function N(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"button",12),e.NdJ("click",function(a){return e.CHM(t),e.oxw(3).onCreateSourceStub(a)}),e._uU(1," Create\xa0'"),e.TgZ(2,"em"),e._uU(3),e.qZA(),e._uU(4,"'\xa0 CIViC Source "),e.qZA()}if(2&n){const t=e.oxw(3);e.Q6J("nzLoading",t.isCreating),e.xp6(3),e.Oqu(t.foundCitation)}}function R(n,i){1&n&&(e.ynx(0),e.YNc(1,N,5,2,"button",11),e.BQk())}function V(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"button",14),e.NdJ("click",function(a){return e.CHM(t),e.oxw(3).onAcceptSource(a)}),e._uU(1," Add Source to List "),e.qZA()}}function K(n,i){1&n&&(e.ynx(0),e.YNc(1,V,2,0,"button",13),e.BQk())}function j(n,i){if(1&n&&(e.ynx(0),e.TgZ(1,"nz-space",2),e.YNc(2,S,4,0,"ng-container",3),e.YNc(3,D,4,0,"ng-container",3),e.YNc(4,U,2,1,"nz-form-item",3),e.YNc(5,R,2,0,"ng-container",3),e.YNc(6,K,2,0,"ng-container",3),e.qZA(),e.BQk()),2&n){const t=e.oxw();e.xp6(2),e.Q6J("ngIf",!1===t.createSuccess&&0===t.createErrors.length),e.xp6(1),e.Q6J("ngIf",!0===t.createSuccess),e.xp6(1),e.Q6J("ngIf",t.createErrors.length>0),e.xp6(1),e.Q6J("ngIf",!1===t.createSuccess),e.xp6(1),e.Q6J("ngIf",!0===t.createSuccess)}}function W(n,i){if(1&n&&(e.TgZ(0,"span",16),e._UZ(1,"i",17),e._uU(2),e.qZA()),2&n){const t=e.oxw(3);e.xp6(2),e.hij(" Source not known to CIViC, fetch citation from ",t.sourceTypeKey,"? ")}}function $(n,i){1&n&&(e.ynx(0),e.YNc(1,W,3,1,"span",15),e.BQk())}function G(n,i){if(1&n&&e._uU(0),2&n){const t=e.oxw(4);e.AsE(" Citation not found for ",t.sourceTypeKey,": ",t.citationId,". ")}}function X(n,i){if(1&n&&(e.TgZ(0,"span"),e._UZ(1,"nz-alert",19),e.YNc(2,G,1,2,"ng-template",null,20,e.W1O),e.qZA()),2&n){const t=e.MAs(3);e.xp6(1),e.Q6J("nzMessage",t)}}function H(n,i){1&n&&(e.ynx(0),e.YNc(1,X,4,1,"span",18),e.BQk())}function k(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"button",12),e.NdJ("click",function(a){return e.CHM(t),e.oxw(2).onExistenceQuery(a)}),e._uU(1," Fetch Citation for\xa0"),e.TgZ(2,"strong"),e._uU(3),e.qZA(),e.qZA()}if(2&n){const t=e.oxw(2);e.Q6J("nzLoading",t.isChecking),e.xp6(3),e.AsE("",t.sourceTypeKey," ",t.citationId,"")}}function q(n,i){if(1&n&&(e.TgZ(0,"nz-space",2),e.YNc(1,$,2,0,"ng-container",3),e.YNc(2,H,2,0,"ng-container",3),e.YNc(3,k,4,3,"button",11),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.showPrompt),e.xp6(1),e.Q6J("ngIf",t.existenceFail)}}let ee=(()=>{class n{constructor(t,c,a){this.existenceCheckQuery=t,this.createSourceStubQuery=c,this.changeDetectorRef=a,this.modelUpdate=new e.vpe,this.citationIdChange=new e.vpe,this.sourceTypeChange=new e.vpe,this.showPrompt=!0,this.isChecking=!1,this.existenceFail=!1,this.existenceError=[],this.foundCitation=void 0,this.isCreating=!1,this.createSuccess=!1,this.createErrors=[]}set sourceType(t){this._sourceType=t,this.sourceTypeKey=(0,O.o6)(y.yic).getKeyOrThrow(t)}get sourceType(){return this._sourceType}onExistenceQuery(t){t&&t.preventDefault(),this.isChecking=!0,this.foundCitation=void 0,this.existenceCheckQuery.fetch({sourceType:this.sourceType,citationId:+this.citationId}).pipe((0,Z.x)(()=>{this.isChecking=!1,this.changeDetectorRef.detectChanges()})).subscribe({next:({data:{remoteCitation:c}})=>{null!==c?this.foundCitation=c:(this.showPrompt=!1,this.existenceFail=!0)},error:c=>{this.showPrompt=!1,this.existenceError=c.graphQLErrors.map(a=>a.message)},complete:()=>{this.existenceError=[]}})}onCreateSourceStub(t){t&&t.preventDefault(),this.isCreating=!0,this.createSuccess=!1,this.createSourceStubQuery.mutate({input:{citationId:+this.citationId,sourceType:this.sourceType}}).pipe((0,Z.x)(()=>{this.isCreating=!1,this.changeDetectorRef.detectChanges()})).subscribe({next:({data:c})=>{var a;console.log(c);const g=null===(a=null==c?void 0:c.addRemoteCitation)||void 0===a?void 0:a.newSource;this.sourceStub=g,this.createSuccess=!0},error:c=>{this.showPrompt=!1,this.createSuccess=!1,this.createErrors=c.graphQLErrors.map(a=>a.message)},complete:()=>{this.createErrors=[]}})}onAcceptSource(t){t&&t.preventDefault(),console.log("source accepted");const c=Object.assign(Object.assign({},this.model),{id:this.sourceStub.id,citation:this.foundCitation,citationId:this.citationId});this.modelUpdate.emit(c)}ngAfterContentInit(){console.log("model")}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(y.fpJ),e.Y36(y.JQ3),e.Y36(e.sBO))},n.\u0275cmp=e.Xpm({type:n,selectors:[["cvc-source-loader"]],inputs:{model:"model",citationId:"citationId",sourceType:"sourceType"},outputs:{modelUpdate:"modelUpdate",citationIdChange:"citationIdChange",sourceTypeChange:"sourceTypeChange"},decls:3,vars:2,consts:[[4,"ngIf","ngIfElse"],["fetchCitation",""],["nzDirection","vertical"],[4,"ngIf"],["nzType","info","nzShowIcon","",3,"nzMessage",4,"nzSpaceItem"],["foundCitationMsg",""],["nzType","info","nzShowIcon","",3,"nzMessage"],["nzType","success","nzShowIcon","",3,"nzMessage",4,"nzSpaceItem"],["createdMsg",""],["nzType","success","nzShowIcon","",3,"nzMessage"],[3,"errors"],["type","submit","nz-button","","nzBlock","","nzType","primary","nzSize","default",3,"nzLoading","click",4,"nzSpaceItem"],["type","submit","nz-button","","nzBlock","","nzType","primary","nzSize","default",3,"nzLoading","click"],["type","submit","nz-button","","nzBlock","","nzType","primary","nzSize","default",3,"click",4,"nzSpaceItem"],["type","submit","nz-button","","nzBlock","","nzType","primary","nzSize","default",3,"click"],["nz-typography","",4,"nzSpaceItem"],["nz-typography",""],["nz-icon","","nzType","info-circle","nzTheme","twotone"],[4,"nzSpaceItem"],["nzType","warning","nzShowIcon","",3,"nzMessage"],["existenceFail",""]],template:function(t,c){if(1&t&&(e.YNc(0,j,7,5,"ng-container",0),e.YNc(1,q,4,2,"ng-template",null,1,e.W1O)),2&t){const a=e.MAs(2);e.Q6J("ngIf",c.foundCitation)("ngIfElse",a)}},directives:[o.O5,d.NU,d.$1,x.r,h.SK,v.Nx,w.V,b.ix,J.dQ,Q.w],styles:["[_nghost-%COMP%]{display:block}nz-space[_ngcontent-%COMP%]{width:100%}nz-space-item[_ngcontent-%COMP%]:last-child{margin-bottom:0}"]}),n})();function te(n,i){if(1&n&&(e.TgZ(0,"nz-option",4),e._uU(1),e.qZA()),2&n){const t=i.$implicit;e.Q6J("nzLabel",t.label)("nzValue",t.value),e.xp6(1),e.AsE(" ",t.source.citation?t.source.citation:t.source.name," (",t.source.citationId,") ")}}function ne(n,i){if(1&n&&(e.TgZ(0,"div",5),e._uU(1," Citation: "),e.TgZ(2,"span",6),e._uU(3),e.qZA(),e.qZA()),2&n){const t=e.oxw();e.xp6(3),e.hij(" ",t.model.citation," ")}}function oe(n,i){if(1&n&&(e.TgZ(0,"div",5),e._uU(1),e.qZA()),2&n){const t=e.oxw(2);e.xp6(1),e.hij(" Enter a ",t.to.sourceTypeKey," citation ID to search CIViC sources ")}}function re(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"cvc-source-loader",10),e.NdJ("modelUpdate",function(a){return e.CHM(t),e.oxw(2).onModelUpdated(a)})("sourceTypeChange",function(a){return e.CHM(t),e.oxw(2).model.sourceType=a})("citationIdChange",function(a){return e.CHM(t),e.oxw(2).to.fieldValue=a}),e.qZA()}if(2&n){const t=e.oxw(2);e.Q6J("model",t.model)("sourceType",t.model.sourceType)("citationId",t.to.fieldValue)}}function ce(n,i){if(1&n&&(e.ynx(0,7),e.YNc(1,oe,2,1,"div",8),e.YNc(2,re,1,3,"cvc-source-loader",9),e.BQk()),2&n){const t=e.oxw();e.Q6J("ngSwitch",t.to.fieldLength>0&&t.to.fieldLength>=t.to.minLengthSearch),e.xp6(1),e.Q6J("ngSwitchCase",!1),e.xp6(1),e.Q6J("ngSwitchCase",!0)}}const ie={name:"source-selector-typeahead",component:(()=>{class n extends _.fS{constructor(t,c){super(),this.sourceTypeaheadQuery=t,this.changeDetectorRef=c,this.selectedValue=null,this.nzFilterOption=()=>!0,this.defaultOptions={templateOptions:{placeholder:"Search",sourceType:void 0,showArrow:!1,onSearch:()=>{},filterOption:()=>{},modelChange:()=>{},triggerParentSubmit:()=>{},minLengthSearch:1,fieldLength:0,fieldValue:"",optionList:[]}}}ngAfterViewInit(){this.to.filterOption=()=>!0,this.to.modelChange=t=>{if(this.to.optionList.length>0){const{source:c}=this.to.optionList.find(a=>a.value===+t);c?this.form.patchValue({citation:c.citation?c.citation:c.name,id:c.id}):console.error("Could not find selected citation in list?")}},this.to.onSearch=t=>{this.to.fieldValue=t,this.to.fieldLength=t.length,!(t.length<this.to.minLengthSearch||t.length>this.to.maxLength)&&this.sourceTypeaheadQuery.fetch({sourceType:this.to.sourceType,partialCitationId:+t},{fetchPolicy:"network-only"}).subscribe(({data:{sourceTypeahead:c}})=>{this.to.optionList=c.map(a=>({value:a.citationId,label:a.citationId,source:a})),this.changeDetectorRef.detectChanges()})}}onModelUpdated(t){this.form.patchValue(t),this.changeDetectorRef.detectChanges(),this.to.triggerParentSubmit()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(y.k2T),e.Y36(e.sBO))},n.\u0275cmp=e.Xpm({type:n,selectors:[["cvc-source-selector-typeahead-type"]],features:[e.qOj],decls:5,vars:8,consts:[["nzShowSearch","","nzServerSearch","",3,"formControl","formlyAttributes","nzPlaceHolder","nzNotFoundContent","nzShowArrow","nzFilterOption","ngModelChange","nzOnSearch"],["nzCustomContent","",3,"nzLabel","nzValue",4,"ngFor","ngForOf"],["class","ant-form-item-explain",4,"ngIf"],["sourceLoader",""],["nzCustomContent","",3,"nzLabel","nzValue"],[1,"ant-form-item-explain"],[1,"source-citation"],[3,"ngSwitch"],["class","ant-form-item-explain",4,"ngSwitchCase"],[3,"model","sourceType","citationId","modelUpdate","sourceTypeChange","citationIdChange",4,"ngSwitchCase"],[3,"model","sourceType","citationId","modelUpdate","sourceTypeChange","citationIdChange"]],template:function(t,c){if(1&t&&(e.TgZ(0,"nz-select",0),e.NdJ("ngModelChange",function(g){return c.to.modelChange(g)})("nzOnSearch",function(g){return c.to.onSearch(g)}),e.YNc(1,te,2,4,"nz-option",1),e.qZA(),e.YNc(2,ne,4,1,"div",2),e.YNc(3,ce,3,3,"ng-template",null,3,e.W1O)),2&t){const a=e.MAs(4);e.Q6J("formControl",c.formControl)("formlyAttributes",c.field)("nzPlaceHolder",c.to.placeholder?c.to.placeholder:null)("nzNotFoundContent",a)("nzShowArrow",c.to.showArrow)("nzFilterOption",c.to.filterOption),e.xp6(1),e.Q6J("ngForOf",c.to.optionList),e.xp6(1),e.Q6J("ngIf",c.model.citation.length>0)}},directives:[E.Vq,f.JJ,f.oH,_.VQ,o.sg,E.Ip,o.O5,o.RF,o.n9,ee],styles:["[_nghost-%COMP%]{display:block}.loading-icon[_ngcontent-%COMP%]{margin-right:8px}.source-citation[_ngcontent-%COMP%]{font-style:oblique}"],changeDetection:0}),n})(),wrappers:["form-field"]};var se=r(7008);let Y=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[o.ez,d.zf,x.L,v.U5,se.B,b.sL]]}),n})(),ae=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[o.ez,f.UX,_.X0.forChild({types:[ie]}),E.LV,Y]]}),n})();var le=r(8979);let ue=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[o.ez,f.UX,_.X0,I.u,b.sL,Y,ae,le.N]]}),n})();var pe=r(9779);let de=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[o.ez,_.X0.forChild({types:[T]}),ue,pe.s]]}),n})()}}]);