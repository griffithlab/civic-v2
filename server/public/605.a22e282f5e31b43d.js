"use strict";(self.webpackChunkmain=self.webpackChunkmain||[]).push([[605],{605:(gt,h,r)=>{r.r(h),r.d(h,{VariantGroupsReviseModule:()=>mt});var p=r(9808),u=r(325),y=r(373),R=r(1059),S=r(4850),t=r(5e3),m=r(712),b=r(9350),T=r(8992),c=r(1945),G=r(647),l=r(1894),Z=r(8616),z=r(6949);function A(e,a){1&e&&(t.TgZ(0,"div"),t._UZ(1,"router-outlet"),t.qZA())}function F(e,a){1&e&&(t.TgZ(0,"nz-row",8),t.TgZ(1,"div",9),t._UZ(2,"cvc-login-prompt"),t.qZA(),t.qZA())}function P(e,a){if(1&e&&(t.ynx(0),t._UZ(1,"cvc-section-navigation",1),t.TgZ(2,"nz-page-header",2),t.TgZ(3,"nz-page-header-title",3),t._uU(4," REVISE "),t._UZ(5,"i",4),t._uU(6),t.qZA(),t.TgZ(7,"nz-page-header-content"),t.TgZ(8,"div",5),t.YNc(9,A,2,0,"div",6),t.ALo(10,"ngrxPush"),t.YNc(11,F,3,0,"ng-template",null,7,t.W1O),t.qZA(),t.qZA(),t.qZA(),t.BQk()),2&e){const n=a.ngIf,i=t.MAs(12),o=t.oxw();t.xp6(1),t.Q6J("displayName",n.name),t.xp6(5),t.hij(" ",n.name," "),t.xp6(3),t.Q6J("ngIf",t.lcZ(10,4,o.isSignedIn$))("ngIfElse",i)}}let J=(()=>{class e{constructor(n,i,o){this.gql=n,this.route=i,this.viewerService=o,this.routeSub=this.route.params.subscribe(s=>{let I=this.gql.watch({variantGroupId:+s.variantGroupId}).valueChanges;this.loading$=I.pipe((0,y.j)("loading"),(0,R.O)(!0)),this.variantGroup$=I.pipe((0,y.j)("data","variantGroup"))})}ngOnInit(){this.isSignedIn$=this.viewerService.viewer$.pipe((0,S.U)(n=>n.signedIn))}ngOnDestroy(){this.routeSub.unsubscribe()}}return e.\u0275fac=function(n){return new(n||e)(t.Y36(m.Qtd),t.Y36(u.gz),t.Y36(b.a))},e.\u0275cmp=t.Xpm({type:e,selectors:[["cvc-variant-groups-revise-view"]],decls:2,vars:3,consts:[[4,"ngIf"],[3,"displayName"],[1,"site-page-header"],["cvcFlaggableOptions",""],["nz-icon","","nzType","civic:variantgroup"],[1,"content"],[4,"ngIf","ngIfElse"],["notSignedIn",""],["nzSpan","24","nzJustify","center"],["nz-col","","nzSpan","6"]],template:function(n,i){1&n&&(t.YNc(0,P,13,6,"ng-container",0),t.ALo(1,"async")),2&n&&t.Q6J("ngIf",t.lcZ(1,1,i.variantGroup$))},directives:[p.O5,T.I,c.$O,c.u9,G.Ls,c.u5,u.lC,l.SK,l.t3,Z.u],pipes:[p.Ov,z.fM],styles:["[_nghost-%COMP%]{display:block}[_nghost-%COMP%]     nz-page-header:first-of-type{background-color:#fff;border-radius:8px}[_nghost-%COMP%]     nz-page-header:first-of-type .card-list nz-card{width:100%}[_nghost-%COMP%]     nz-page-header:first-of-type .card-list nz-card .card-grid-cell{width:50%}[_nghost-%COMP%]     nz-page-header:first-of-type nz-page-header-title.flagged{padding-left:.75em}[_nghost-%COMP%]     nz-page-header:first-of-type .ant-page-header-content{padding-top:0}[_nghost-%COMP%]     nz-page-header:first-of-type .ant-page-header-heading-extra nz-space-item:last-child{margin-right:0!important}[_nghost-%COMP%]     nz-page-header:first-of-type #section-tabs{margin:0 -16px 12px}[_nghost-%COMP%]     nz-page-header:first-of-type #section-tabs .ant-tabs-nav-wrap{padding-left:16px;padding-right:16px;line-height:24px}[_nghost-%COMP%]     nz-page-header:first-of-type #section-tabs .ant-tabs-nav-wrap .ant-tabs-tab{padding:1px 8px}[_nghost-%COMP%]     nz-page-header:first-of-type #section-tabs .ant-tabs-nav-wrap .ant-tabs-tab .anticon{margin-right:0}[_nghost-%COMP%]     nz-page-header:first-of-type #section-tabs .ant-tabs-extra-content{margin-right:16px}"]}),e})();var d=r(4182),g=r(8776),V=r(2359),C=r(6042),f=r(4546),Q=r(7525),N=r(5109),Y=r(7008),$=r(4623),U=r(8979),L=r(8390),j=r(3773),w=r(7075),B=r(7462),x=r(4181),E=r(5472),D=r(4889);let W=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[[p.ez,d.UX,u.Bz,g.X0,f.U5,V.L,l.Jb,C.sL,Q.j,g.X0,B.o,x.O,L.N,U.N,$.K,Y.B,E.r,j.g,x.O,w.l,D.E,N.s]]}),e})(),X=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[[p.ez,W]]}),e})();var M=r(3077),K=r(6123),H=r(8929),v=r(7625),_=r(9169),k=r(822);function q(e,a){1&e&&t.GkF(0)}function tt(e,a){if(1&e){const n=t.EpF();t.TgZ(0,"formly-form",4),t.NdJ("modelChange",function(o){return t.CHM(n),t.oxw().formModel=o}),t.qZA()}if(2&e){const n=t.oxw();t.Q6J("form",n.formGroup)("fields",n.formFields)("model",n.formModel)}}function et(e,a){if(1&e&&(t.TgZ(0,"nz-form-item"),t._UZ(1,"cvc-form-errors-alert",6),t.qZA()),2&e){const n=t.oxw(2);t.xp6(1),t.Q6J("errors",n.errorMessages)}}function nt(e,a){1&e&&(t.TgZ(0,"p"),t._uU(1,"View it on the "),t.TgZ(2,"a",10),t._uU(3,"Revisions Page"),t.qZA(),t._uU(4,"."),t.qZA())}function rt(e,a){if(1&e&&(t.ynx(0),t._UZ(1,"nz-alert",7),t.YNc(2,nt,5,0,"ng-template",8,9,t.W1O),t.BQk()),2&e){const n=t.MAs(3);t.xp6(1),t.Q6J("nzDescription",n)}}function at(e,a){if(1&e&&(t.YNc(0,et,2,1,"nz-form-item",5),t.YNc(1,rt,4,1,"ng-container",5)),2&e){const n=t.oxw();t.Q6J("ngIf",n.errorMessages.length>0),t.xp6(1),t.Q6J("ngIf",n.success)}}let it=(()=>{class e{constructor(n,i,o){this.suggestRevisionGQL=n,this.revisableFieldsGQL=i,this.networkErrorService=o,this.destroy$=new H.xQ,this.formGroup=new d.cw({}),this.formOptions={},this.success=!1,this.errorMessages=[],this.loading=!1,this.suggestRevisionMutator=new K.U(o),this.formFields=[{key:"fields",wrappers:["form-container"],templateOptions:{label:"Add Variant Group Form"},fieldGroup:[{key:"name",type:"input",wrappers:["form-field"],templateOptions:{label:"Variant Group Name",required:!0}},{key:"description",type:"cvc-textarea",templateOptions:{label:"Description",helpText:"A brief description of this new variant group.",placeholder:"No description provided",required:!0}},{key:"sources",type:"multi-field",wrappers:["form-field"],templateOptions:{label:"Source",helpText:"Add any sources upon which your description depends.",addText:"Add a Source"},fieldArray:{type:"source-input",templateOptions:{hideLabel:!0,required:!0}}},{key:"variants",type:"multi-field",wrappers:["form-field"],templateOptions:{label:"Variants",helpText:"Specify the variants that comprise this Variant Group.",addText:"Add a Variant "},fieldArray:{type:"variant-input",templateOptions:{hideLabel:!0,required:!0,allowCreate:!1}}},{key:"comment",type:"comment-textarea",templateOptions:{label:"Comment",helpText:"Please provide any additional comments you wish to make about this evidence item. This comment will appear as the first comment in this item's comment thread.",placeholder:"Please enter a comment describing your revision.",required:!0,minLength:10}},{key:"cancel",type:"cancel-button",templateOptions:{redirectPath:"../.."}},{key:"organization",type:"org-submit-button",templateOptions:{submitLabel:"Submit Variant Group Revision",submitSize:"large"}}]}]}ngAfterViewInit(){this.revisableFieldsGQL.fetch({variantGroupId:this.variantGroupId}).subscribe(({data:{variantGroup:n}})=>{n&&(this.formModel=this.toFormModel(n))},n=>{console.error("Error retrieving evidenceItem."),console.error(n)},()=>{this.formOptions.updateInitialValue&&this.formOptions.updateInitialValue(),this.formGroup.markAllAsTouched();const n=this.formGroup.get("fields.comment");n&&n.markAsUntouched()})}toFormModel(n){var i;return{fields:Object.assign(Object.assign({},n),{variants:n.variants.nodes,organization:null===(i=this.formModel)||void 0===i?void 0:i.fields.organization})}}submitVariantGroup(n){let i=this.toSubmitInput(n);if(i){let o=this.suggestRevisionMutator.mutate(this.suggestRevisionGQL,{input:i});o.submitSuccess$.pipe((0,v.R)(this.destroy$)).subscribe(s=>{s&&(this.success=!0)}),o.submitError$.pipe((0,v.R)(this.destroy$)).subscribe(s=>{s&&(this.errorMessages=s,this.success=!1)}),o.isSubmitting$.pipe((0,v.R)(this.destroy$)).subscribe(s=>{this.loading=s})}}toSubmitInput(n){var i;if(n)return{id:this.variantGroupId,organizationId:null===(i=n.fields.organization)||void 0===i?void 0:i.id,comment:n.fields.comment,fields:{description:n.fields.description,name:n.fields.name,sourceIds:n.fields.sources.map(o=>o.id).filter(M.$),variantIds:n.fields.variants.map(o=>o.id).filter(M.$)}}}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}}return e.\u0275fac=function(n){return new(n||e)(t.Y36(m.aw3),t.Y36(m.ROj),t.Y36(_.Y))},e.\u0275cmp=t.Xpm({type:e,selectors:[["cvc-variant-group-revise-form"]],inputs:{variantGroupId:"variantGroupId"},decls:5,vars:3,consts:[["nz-form","","nzLayout","vertical",3,"formGroup","ngSubmit"],[4,"ngTemplateOutlet"],[3,"form","fields","model","modelChange",4,"ngIf"],["formMessages",""],[3,"form","fields","model","modelChange"],[4,"ngIf"],[3,"errors"],["nzType","success","nzMessage","Revision(s) Submitted","nzShowIcon","",3,"nzDescription"],["nzSize","small"],["successMessage",""],["routerLink","../../revisions"]],template:function(n,i){if(1&n&&(t.TgZ(0,"form",0),t.NdJ("ngSubmit",function(){return i.submitVariantGroup(i.formModel)}),t.YNc(1,q,1,0,"ng-container",1),t.YNc(2,tt,1,3,"formly-form",2),t.qZA(),t.YNc(3,at,2,2,"ng-template",null,3,t.W1O)),2&n){const o=t.MAs(4);t.Q6J("formGroup",i.formGroup),t.xp6(1),t.Q6J("ngTemplateOutlet",o),t.xp6(1),t.Q6J("ngIf",!i.success)}},directives:[d._Y,d.JL,f.Lr,d.sg,p.tP,p.O5,g.T7,l.SK,f.Nx,k.V,V.r,u.yS],styles:[""]}),e})();function ot(e,a){if(1&e&&(t.ynx(0),t._UZ(1,"cvc-variant-group-revise-form",2),t.BQk()),2&e){const n=t.oxw();t.xp6(1),t.Q6J("variantGroupId",n.variantGroupId)}}function st(e,a){1&e&&t._uU(0,"Loading Variant Group...")}const pt=[{path:"",component:J,data:{breadcrumb:"Revise"},children:[{path:"",redirectTo:"suggest",pathMatch:"full"},{path:"suggest",component:(()=>{class e{constructor(n){this.route=n,this.routeParams$=this.route.params.subscribe(i=>{this.variantGroupId=+i.variantGroupId})}ngOnDestroy(){this.routeParams$.unsubscribe()}}return e.\u0275fac=function(n){return new(n||e)(t.Y36(u.gz))},e.\u0275cmp=t.Xpm({type:e,selectors:[["cvc-variant-groups-suggest-page"]],decls:3,vars:2,consts:[[4,"ngIf","ngIfElse"],["loadingVariantGroup",""],[3,"variantGroupId"]],template:function(n,i){if(1&n&&(t.YNc(0,ot,2,1,"ng-container",0),t.YNc(1,st,1,0,"ng-template",null,1,t.W1O)),2&n){const o=t.MAs(2);t.Q6J("ngIf",i.variantGroupId)("ngIfElse",o)}},directives:[p.O5,it],styles:[""]}),e})(),data:{breadcrumb:"Suggest Revision"}}]}];let ut=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[[u.Bz.forChild(pt),X],u.Bz]}),e})();var O=r(8144),lt=r(3618),dt=r(5630),ct=r(9386);let mt=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[[p.ez,ut,c.KJ,O.zf,G.PV,lt.ZJ,O.zf,dt.D,ct.a,z.WG,l.Jb]]}),e})()}}]);