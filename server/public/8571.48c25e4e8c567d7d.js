"use strict";(self.webpackChunkmain=self.webpackChunkmain||[]).push([[8571],{8571:(Ye,T,i)=>{i.r(T),i.d(T,{EvidenceReviseModule:()=>$e});var c=i(9808),d=i(325),v=i(373),M=i(1059),Z=i(4850),e=i(5e3),f=i(712),A=i(9350),P=i(8992),m=i(8144),I=i(3618),C=i(3193),F=i(8664),u=i(1945),R=i(647),l=i(1894),b=i(8616),h=i(6949);function J(t,o){if(1&t&&(e.TgZ(0,"span",12),e.TgZ(1,"strong"),e._uU(2),e.qZA(),e._uU(3," Parents:"),e.qZA()),2&t){const n=e.oxw(2).ngIf;e.xp6(2),e.Oqu(n.name)}}function U(t,o){if(1&t&&(e.TgZ(0,"span",13),e.TgZ(1,"a",14),e._UZ(2,"cvc-gene-tag",15),e.qZA(),e.TgZ(3,"a",14),e._UZ(4,"cvc-variant-tag",16),e.qZA(),e.qZA()),2&t){const n=e.oxw(2).ngIf;e.xp6(1),e.MGl("routerLink","/genes/",n.gene.id,""),e.xp6(1),e.Q6J("gene",n.gene),e.xp6(1),e.MGl("routerLink","/variants/",n.variant.id,""),e.xp6(1),e.Q6J("variant",n.variant)}}function Q(t,o){1&t&&(e.TgZ(0,"nz-space",9),e.YNc(1,J,4,1,"span",10),e.YNc(2,U,5,4,"span",11),e.qZA())}function $(t,o){1&t&&(e.TgZ(0,"div"),e._UZ(1,"router-outlet"),e.qZA())}function Y(t,o){1&t&&(e.TgZ(0,"nz-row",17),e.TgZ(1,"div",18),e._UZ(2,"cvc-login-prompt"),e.qZA(),e.qZA())}function L(t,o){if(1&t&&(e.ynx(0),e._UZ(1,"cvc-section-navigation",1),e.YNc(2,Q,3,0,"ng-template",null,2,e.W1O),e.TgZ(4,"nz-page-header",3),e.TgZ(5,"nz-page-header-title",4),e._uU(6," REVISE "),e._UZ(7,"i",5),e._uU(8),e.qZA(),e.TgZ(9,"nz-page-header-content"),e.TgZ(10,"div",6),e.YNc(11,$,2,0,"div",7),e.ALo(12,"ngrxPush"),e.YNc(13,Y,3,0,"ng-template",null,8,e.W1O),e.qZA(),e.qZA(),e.qZA(),e.BQk()),2&t){const n=o.ngIf,s=e.MAs(3),r=e.MAs(14),a=e.oxw();e.xp6(1),e.Q6J("displayName",n.name)("relationsTpl",s),e.xp6(7),e.hij(" ",n.name," "),e.xp6(3),e.Q6J("ngIf",e.lcZ(12,5,a.isSignedIn$))("ngIfElse",r)}}let N=(()=>{class t{constructor(n,s,r){this.gql=n,this.route=s,this.viewerService=r,this.routeSub=this.route.params.subscribe(a=>{let g=this.gql.watch({evidenceId:+a.evidenceId}).valueChanges;this.loading$=g.pipe((0,v.j)("loading"),(0,M.O)(!0)),this.evidence$=g.pipe((0,v.j)("data","evidenceItem")),this.commentsTotal$=this.evidence$.pipe((0,v.j)("comments","totalCount")),this.flagsTotal$=this.evidence$.pipe((0,v.j)("flags","totalCount")),this.revisionsTotal$=this.evidence$.pipe((0,v.j)("revisions","totalCount"))})}ngOnInit(){this.isSignedIn$=this.viewerService.viewer$.pipe((0,Z.U)(n=>n.signedIn))}ngOnDestroy(){this.routeSub.unsubscribe()}}return t.\u0275fac=function(n){return new(n||t)(e.Y36(f.pHu),e.Y36(d.gz),e.Y36(A.a))},t.\u0275cmp=e.Xpm({type:t,selectors:[["cvc-evidence-revise"]],decls:2,vars:3,consts:[[4,"ngIf"],[3,"displayName","relationsTpl"],["evidenceRelations",""],[1,"site-page-header"],["cvcFlaggableOptions",""],["nz-icon","","nzType","civic:evidence"],[1,"content"],[4,"ngIf","ngIfElse"],["notSignedIn",""],["nzDirection","horizontal"],["nz-typography","","class","label",4,"nzSpaceItem"],["class","tags",4,"nzSpaceItem"],["nz-typography","",1,"label"],[1,"tags"],[3,"routerLink"],[3,"gene"],[3,"variant"],["nzSpan","24","nzJustify","center"],["nz-col","","nzSpan","6"]],template:function(n,s){1&n&&(e.YNc(0,L,15,7,"ng-container",0),e.ALo(1,"async")),2&n&&e.Q6J("ngIf",e.lcZ(1,1,s.evidence$))},directives:[c.O5,P.I,m.NU,m.$1,I.ZU,d.yS,C.H,F.I,u.$O,u.u9,R.Ls,u.u5,d.lC,l.SK,l.t3,b.u],pipes:[c.Ov,h.fM],styles:["[_nghost-%COMP%]{display:block}[_nghost-%COMP%]     nz-page-header:first-of-type{background-color:#fff;border-radius:8px}[_nghost-%COMP%]     nz-page-header:first-of-type .card-list nz-card{width:100%}[_nghost-%COMP%]     nz-page-header:first-of-type .card-list nz-card .card-grid-cell{width:50%}[_nghost-%COMP%]     nz-page-header:first-of-type nz-page-header-title.flagged{padding-left:.75em}[_nghost-%COMP%]     nz-page-header:first-of-type .ant-page-header-content{padding-top:0}[_nghost-%COMP%]     nz-page-header:first-of-type .ant-page-header-heading-extra nz-space-item:last-child{margin-right:0!important}[_nghost-%COMP%]     nz-page-header:first-of-type #section-tabs{margin:0 -16px 12px}[_nghost-%COMP%]     nz-page-header:first-of-type #section-tabs .ant-tabs-nav-wrap{padding-left:16px;padding-right:16px;line-height:24px}[_nghost-%COMP%]     nz-page-header:first-of-type #section-tabs .ant-tabs-nav-wrap .ant-tabs-tab{padding:1px 8px}[_nghost-%COMP%]     nz-page-header:first-of-type #section-tabs .ant-tabs-nav-wrap .ant-tabs-tab .anticon{margin-right:0}[_nghost-%COMP%]     nz-page-header:first-of-type #section-tabs .ant-tabs-extra-content{margin-right:16px}"]}),t})();var V=i(7484),j=i(6559),G=i(3773),B=i(8390),D=i(4375),W=i(7008),H=i(1825),S=i(8776),X=i(6042),O=i(2359),y=i(4546),K=i(5109),p=i(4182),w=i(5743),k=i(5452),q=i(5457),_=i(8006),ee=i(7075),te=i(7695),ne=i(7462),ie=i(3594),oe=i(3643),se=i(1135),E=i(7525),ae=i(2789),re=i(5932),ce=i(3416),de=i(2480),le=i(1830),ge=i(4581),ve=i(5926),me=i(5472);let pe=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({providers:[],imports:[[c.ez,d.Bz,p.UX,K.s,y.U5,O.L,l.Jb,X.sL,E.j,S.X0,H.A,W.B,D.R,te.C,ee.l,B.N,G.g,k.C,w.W,q.$,_.I,ne.o,ie.q,oe.q,se.C,ae.o,re.A,ce.g,de.r,le.S,ge.e,ve.J,me.r]]}),t})(),ue=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[[c.ez,h.WG,l.Jb,V.vh,j.H0,m.zf,pe]]}),t})();var z=i(6738),fe=i(8929),x=i(7625),he=i(6123),ye=i(6064),ze=i(9169),xe=i(822);function Te(t,o){1&t&&e.GkF(0)}function Ie(t,o){if(1&t){const n=e.EpF();e.TgZ(0,"formly-form",5),e.NdJ("modelChange",function(r){return e.CHM(n),e.oxw().formModel=r}),e.qZA()}if(2&t){const n=e.oxw();e.Q6J("form",n.formGroup)("fields",n.formFields)("model",n.formModel)("options",n.formOptions)}}function Re(t,o){if(1&t&&(e.ynx(0),e.TgZ(1,"nz-form-item"),e._UZ(2,"cvc-form-errors-alert",7),e.qZA(),e.BQk()),2&t){const n=e.oxw(2);e.xp6(2),e.Q6J("errors",n.errorMessages)}}function Se(t,o){1&t&&(e.TgZ(0,"p"),e._uU(1,"View it on the "),e.TgZ(2,"a",11),e._uU(3,"Revisions Page"),e.qZA(),e._uU(4," or suggest another revision below."),e.qZA())}function Oe(t,o){if(1&t&&(e.ynx(0),e._UZ(1,"nz-alert",8),e.YNc(2,Se,5,0,"ng-template",9,10,e.W1O),e.BQk()),2&t){const n=e.MAs(3);e.xp6(1),e.Q6J("nzDescription",n)}}function Ee(t,o){if(1&t&&(e.YNc(0,Re,3,1,"ng-container",6),e.YNc(1,Oe,4,1,"ng-container",6)),2&t){const n=e.oxw();e.Q6J("ngIf",n.errorMessages.length>0),e.xp6(1),e.Q6J("ngIf",n.success)}}let Me=(()=>{class t{constructor(n,s,r){this.suggestRevisionGQL=n,this.networkErrorService=s,this.revisableFieldsGQL=r,this.formGroup=new p.cw({}),this.formOptions={formState:new ye._},this.success=!1,this.errorMessages=[],this.loading=!1,this.suggestRevisionMutator=new he.U(s),this.formFields=[{key:"fields",wrappers:["form-container"],templateOptions:{label:"Suggest Evidence Item Revision Form"},fieldGroup:[{key:"id",type:"input",hide:!0},{key:"variant",type:"multi-field",wrappers:["form-field"],templateOptions:{label:"Variant",addText:"Specify a Variant",maxCount:1},fieldArray:{type:"variant-input",templateOptions:{required:!0}}},{key:"description",type:"cvc-textarea",templateOptions:{label:"Evidence Statement",helpText:'Your original description of evidence from published literature detailing the association or lack of association between a variant and its predictive, prognostic, diagnostic, predisposing, functional or oncogenic value. Data constituting personal or identifying information should not be entered (e.g. <a href="https://www.hipaajournal.com/what-is-protected-health-information/" target="_blank">protected health information (PHI) as defined by HIPAA</a> in the U.S. and/or comparable laws in your jurisdiction).',placeholder:"No description provided",required:!0}},{key:"source",type:"multi-field",wrappers:["form-field"],templateOptions:{label:"Source",helpText:"CIViC accepts PubMed or ASCO Abstracts sources. Please provide the source of the support for your evidence here.",addText:"Specify a Source",maxCount:1},fieldArray:{type:"source-input",templateOptions:{required:!0}}},{key:"variantOrigin",type:"variant-origin-select",templateOptions:{required:!0}},{key:"evidenceType",type:"evidence-type-select",templateOptions:{required:!0}},{key:"clinicalSignificance",type:"clinical-significance-select",templateOptions:{required:!0}},{key:"disease",type:"disease-array",templateOptions:{maxCount:1}},{key:"evidenceLevel",type:"evidence-level-select",templateOptions:{required:!0}},{key:"evidenceDirection",type:"evidence-direction-select",templateOptions:{required:!0}},{key:"drugs",type:"drug-array"},{key:"drugInteractionType",type:"drug-interaction-select"},{key:"phenotypes",type:"phenotype-array"},{key:"evidenceRating",type:"rating-input",templateOptions:{label:"Rating",helpText:"Please rate your evidence on a scale of one to five stars. Use the star rating descriptions for guidance.",required:!0}},{key:"comment",type:"comment-textarea",templateOptions:{label:"Comment",helpText:"Please provide any additional comments you wish to make about this evidence item. This comment will appear as the first comment in this item's comment thread.",placeholder:"Please enter a comment describing your revision.",required:!0,minLength:10}},{key:"organization",type:"org-submit-button",templateOptions:{submitLabel:"Submit Evidence Item Revision",submitSize:"large"}}]}]}ngOnInit(){this.destroy$=new fe.xQ}ngAfterViewInit(){this.revisableFieldsGQL.fetch({evidenceId:this.evidenceId}).subscribe(({data:{evidenceItem:n}})=>{n&&(this.formModel=this.toFormModel(n))},n=>{console.error("Error retrieving evidenceItem."),console.error(n)},()=>{this.formOptions.updateInitialValue&&this.formOptions.updateInitialValue(),this.formGroup.markAllAsTouched();const n=this.formGroup.get("fields.comment");n&&n.markAsUntouched()})}toFormModel(n){var s,r;return{fields:Object.assign(Object.assign({},n),{variant:[n.variant],source:[n.source],drugs:n.drugs.length>0?n.drugs:[],disease:[n.disease],comment:null===(s=this.formModel)||void 0===s?void 0:s.fields.comment,drugInteractionType:n.drugInteractionType,organization:null===(r=this.formModel)||void 0===r?void 0:r.fields.organization,evidenceRating:n.evidenceRating})}}submitRevision(n){let s=this.toRevisionInput(n);if(s){let r=this.suggestRevisionMutator.mutate(this.suggestRevisionGQL,{input:s});r.submitSuccess$.pipe((0,x.R)(this.destroy$)).subscribe(a=>{a&&(this.success=!0)}),r.submitError$.pipe((0,x.R)(this.destroy$)).subscribe(a=>{a&&(this.errorMessages=a,this.success=!1)}),r.isSubmitting$.pipe((0,x.R)(this.destroy$)).subscribe(a=>{this.loading=a})}}toRevisionInput(n){var s,r;if(n){const a=n.fields;return{id:a.id,comment:a.comment,fields:{variantOrigin:a.variantOrigin,description:z.xt(a.description),variantId:a.variant[0].id,sourceId:a.source[0].id,evidenceType:a.evidenceType,evidenceDirection:a.evidenceDirection,clinicalSignificance:a.clinicalSignificance,diseaseId:z.uP(null===(s=a.disease[0])||void 0===s?void 0:s.id),evidenceLevel:a.evidenceLevel,phenotypeIds:a.phenotypes.map(g=>g.id),rating:a.evidenceRating,drugIds:a.drugs.map(g=>g.id),drugInteractionType:z.uP(a.drugInteractionType)},organizationId:null===(r=n.fields.organization)||void 0===r?void 0:r.id}}}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}}return t.\u0275fac=function(n){return new(n||t)(e.Y36(f.Vj7),e.Y36(ze.Y),e.Y36(f.Q_P))},t.\u0275cmp=e.Xpm({type:t,selectors:[["cvc-evidence-revise-form"]],inputs:{evidenceId:"evidenceId"},decls:6,vars:4,consts:[["nzTip","Submitting",3,"nzSpinning"],["nz-form","","nzLayout","vertical",3,"formGroup","ngSubmit"],[4,"ngTemplateOutlet"],[3,"form","fields","model","options","modelChange",4,"ngIf"],["formMessages",""],[3,"form","fields","model","options","modelChange"],[4,"ngIf"],[3,"errors"],["nzType","success","nzMessage","Suggested Revision Submitted","nzShowIcon","",3,"nzDescription"],["nzSize","small"],["successMessage",""],["routerLink","../../revisions"]],template:function(n,s){if(1&n&&(e.TgZ(0,"nz-spin",0),e.TgZ(1,"form",1),e.NdJ("ngSubmit",function(){return s.submitRevision(s.formModel)}),e.YNc(2,Te,1,0,"ng-container",2),e.YNc(3,Ie,1,4,"formly-form",3),e.qZA(),e.qZA(),e.YNc(4,Ee,2,2,"ng-template",null,4,e.W1O)),2&n){const r=e.MAs(5);e.Q6J("nzSpinning",s.loading),e.xp6(1),e.Q6J("formGroup",s.formGroup),e.xp6(1),e.Q6J("ngTemplateOutlet",r),e.xp6(1),e.Q6J("ngIf",!s.success)}},directives:[E.W,p._Y,p.JL,y.Lr,p.sg,c.tP,c.O5,S.T7,l.SK,y.Nx,xe.V,O.r,d.yS],styles:[""]}),t})();function Ze(t,o){if(1&t&&(e.ynx(0),e._UZ(1,"cvc-evidence-revise-form",2),e.BQk()),2&t){const n=e.oxw();e.xp6(1),e.Q6J("evidenceId",n.evidenceId)}}function Ae(t,o){1&t&&e._uU(0,"Loading Evidence...")}const Pe=[{path:"",component:N,data:{breadcrumb:"Revise"},children:[{path:"",redirectTo:"suggest",pathMatch:"full"},{path:"suggest",component:(()=>{class t{constructor(n){this.route=n,this.routeParams$=this.route.params.subscribe(s=>{this.evidenceId=+s.evidenceId})}ngOnDestroy(){this.routeParams$.unsubscribe()}}return t.\u0275fac=function(n){return new(n||t)(e.Y36(d.gz))},t.\u0275cmp=e.Xpm({type:t,selectors:[["cvc-evidence-suggest"]],decls:3,vars:2,consts:[[4,"ngIf","ngIfElse"],["loadingEvidence",""],[3,"evidenceId"]],template:function(n,s){if(1&n&&(e.YNc(0,Ze,2,1,"ng-container",0),e.YNc(1,Ae,1,0,"ng-template",null,1,e.W1O)),2&n){const r=e.MAs(2);e.Q6J("ngIf",s.evidenceId)("ngIfElse",r)}},directives:[c.O5,Me],styles:[""]}),t})(),data:{breadcrumb:"Suggest Revision"}}]}];let Ce=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[[d.Bz.forChild(Pe),ue],d.Bz]}),t})();var Fe=i(5630),be=i(3309),Je=i(4867),Ue=i(4623),Qe=i(9386);let $e=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[[c.ez,Ce,u.KJ,m.zf,R.PV,I.ZJ,m.zf,be.U,Je.Q,Fe.D,Ue.K,Qe.a,h.WG,l.Jb]]}),t})()}}]);