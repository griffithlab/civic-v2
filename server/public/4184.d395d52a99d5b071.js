"use strict";(self.webpackChunkmain=self.webpackChunkmain||[]).push([[4184],{8227:(U,I,r)=>{r.d(I,{q:()=>F});var o=r(5e3),m=r(8929),e=r(4850),g=r(373),S=r(2868),x=r(7625),O=r(1793),b=r(9350),C=r(9808),A=r(6042),L=r(2683),p=r(2643),T=r(3677),y=r(8144),M=r(6699),u=r(4219);function v(l,h){1&l&&o.Hsn(0)}function f(l,h){1&l&&o.GkF(0)}function z(l,h){if(1&l&&(o.ynx(0),o.YNc(1,f,1,0,"ng-container",5),o.BQk()),2&l){o.oxw(2);const a=o.MAs(1);o.xp6(1),o.Q6J("ngTemplateOutlet",a)}}function E(l,h){1&l&&o.GkF(0)}function w(l,h){if(1&l&&(o.ynx(0),o.TgZ(1,"nz-button-group",6),o.YNc(2,E,1,0,"ng-container",5),o.TgZ(3,"button",7),o.TgZ(4,"nz-space",8),o.TgZ(5,"span"),o._uU(6,"for"),o.qZA(),o._UZ(7,"nz-avatar",9),o._UZ(8,"i",10),o.qZA(),o.qZA(),o.qZA(),o.BQk()),2&l){o.oxw();const a=o.MAs(4),d=o.oxw(),Z=o.MAs(1);o.xp6(1),o.Q6J("nzSize",d.nzSize),o.xp6(1),o.Q6J("ngTemplateOutlet",Z),o.xp6(1),o.Q6J("nzType",d.buttonType)("nzDanger",d.nzDanger)("disabled",d.disabled)("nzDropdownMenu",a),o.xp6(1),o.Q6J("nzSize",4),o.xp6(3),o.Q6J("nzSrc",null==d.selectedOrg?null:d.selectedOrg.profileImagePath)("nzSize",10)("nzShape","square")}}function B(l,h){if(1&l){const a=o.EpF();o.TgZ(0,"li",11),o.NdJ("click",function(){const Q=o.CHM(a).$implicit;return o.oxw(2).selectOrg(Q)}),o._UZ(1,"nz-avatar",12),o._uU(2),o.qZA()}if(2&l){const a=h.$implicit,d=o.oxw(2);o.Q6J("nzSelected",(null==d.selectedOrg?null:d.selectedOrg.id)===a.id),o.xp6(1),o.Q6J("nzSrc",null==a?null:a.profileImagePath)("nzSize",10)("nzShape","square"),o.xp6(1),o.hij(" ",a.name," ")}}function J(l,h){if(1&l&&(o.ynx(0),o.YNc(1,z,2,1,"ng-container",1),o.YNc(2,w,9,10,"ng-container",1),o.TgZ(3,"nz-dropdown-menu",null,2),o.TgZ(5,"ul",3),o.YNc(6,B,3,5,"li",4),o.qZA(),o.qZA(),o.BQk()),2&l){const a=h.ngIf;o.xp6(1),o.Q6J("ngIf",a.length<=1),o.xp6(1),o.Q6J("ngIf",a.length>1),o.xp6(4),o.Q6J("ngForOf",a)}}const D=["*"];let F=(()=>{class l{constructor(a){this.viewerService=a,this.selectedOrgChange=new o.vpe,this.buttonType="primary",this.nzDanger=!1,this.nzSize="small",this.destroy$=new m.xQ}get disabled(){return this.button.disabled}selectOrg(a){this.selectedOrg=a,this.selectedOrgChange.emit(a)}refreshViewer(){setTimeout(()=>{this.viewerService.refetch()},2500)}ngOnInit(){this.organizations$=this.viewerService.viewer$.pipe((0,e.U)(a=>a.organizations)),this.mostRecentOrg$=this.viewerService.viewer$.pipe((0,g.j)("mostRecentOrg"),(0,S.b)(a=>{a&&(this.selectedOrg=a,this.selectedOrgChange.emit(a))})),this.mostRecentOrg$.pipe((0,x.R)(this.destroy$)).subscribe()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}}return l.\u0275fac=function(a){return new(a||l)(o.Y36(b.a))},l.\u0275cmp=o.Xpm({type:l,selectors:[["cvc-org-selector-btn-group"]],contentQueries:function(a,d,Z){if(1&a&&o.Suo(Z,O.m,5),2&a){let Q;o.iGM(Q=o.CRH())&&(d.button=Q.first)}},inputs:{selectedOrg:"selectedOrg",buttonType:"buttonType",nzDanger:"nzDanger",nzSize:"nzSize"},outputs:{selectedOrgChange:"selectedOrgChange"},ngContentSelectors:D,decls:4,vars:3,consts:[["submitButton",""],[4,"ngIf"],["orgMenu","nzDropdownMenu"],["nz-menu",""],["nz-menu-item","",3,"nzSelected","click",4,"ngFor","ngForOf"],[4,"ngTemplateOutlet"],[3,"nzSize"],["type","button","nz-button","","nz-dropdown","",1,"org-dropdown-btn",3,"nzType","nzDanger","disabled","nzDropdownMenu"],["nzDirection","horizontal",3,"nzSize"],[3,"nzSrc","nzSize","nzShape"],["nz-icon","","nzType","down"],["nz-menu-item","",3,"nzSelected","click"],[2,"background-color","#f0f5ff",3,"nzSrc","nzSize","nzShape"]],template:function(a,d){1&a&&(o.F$t(),o.YNc(0,v,1,0,"ng-template",null,0,o.W1O),o.YNc(2,J,7,3,"ng-container",1),o.ALo(3,"async")),2&a&&(o.xp6(2),o.Q6J("ngIf",o.lcZ(3,1,d.organizations$)))},directives:[C.O5,C.tP,A.fY,L.w,A.ix,p.dQ,T.wA,T.cm,y.NU,M.Dz,T.RR,u.wO,C.sg,u.r9],pipes:[C.Ov],styles:["[_nghost-%COMP%]{display:inline-block}.org-dropdown-btn[_ngcontent-%COMP%]   nz-avatar[_ngcontent-%COMP%]{margin:0 6px}"]}),l})()},8979:(U,I,r)=>{r.d(I,{N:()=>L});var o=r(9808),m=r(8776),e=r(5e3),g=r(6042),S=r(2643),x=r(2683);const b={name:"cvc-multi-field-add-btn",component:(()=>{class p extends m.fS{constructor(){super()}}return p.\u0275fac=function(y){return new(y||p)},p.\u0275cmp=e.Xpm({type:p,selectors:[["cvc-multi-field-add-btn-type"]],features:[e.qOj],decls:2,vars:2,consts:[["type","submit","nz-button","","nzType","primary","nzSize","small","nzBlock","",3,"disabled"]],template:function(y,M){1&y&&(e.TgZ(0,"button",0),e._uU(1),e.qZA()),2&y&&(e.Q6J("disabled",M.to.disabled),e.xp6(1),e.Oqu(M.to.label))},directives:[g.ix,S.dQ,x.w],styles:[""],encapsulation:2,changeDetection:0}),p})()};var C=r(9139),A=r(4546);let L=(()=>{class p{}return p.\u0275fac=function(y){return new(y||p)},p.\u0275mod=e.oAB({type:p}),p.\u0275inj=e.cJS({imports:[[o.ez,C.u,m.X0.forChild({types:[b]}),A.U5,g.sL]]}),p})()},3022:(U,I,r)=>{r.d(I,{e:()=>M});var o=r(9808),m=r(8776),e=r(5e3),g=r(9180),S=r(8227),x=r(6042),O=r(2643),b=r(1793),C=r(2683);const L={name:"org-submit-button",component:(()=>{class u extends m.fS{constructor(){super(),this._selectedOrg=void 0,this.defaultOptions={templateOptions:{submitLabel:"Submit",submitSize:"small"}}}get selectedOrg(){return this._selectedOrg}set selectedOrg(f){this._selectedOrg=f,this.formControl.setValue(f)}}return u.\u0275fac=function(f){return new(f||u)},u.\u0275cmp=e.Xpm({type:u,selectors:[["cvc-org-submit-button-type"]],features:[e.qOj],decls:5,vars:4,consts:[[3,"selectedOrg","nzSize","selectedOrgChange"],["orgButton",""],["type","submit","nz-button","","cvcOrgSelectorBtn","","nzType","primary",3,"disabled","click"]],template:function(f,z){if(1&f){const E=e.EpF();e.TgZ(0,"cvc-form-buttons"),e.TgZ(1,"cvc-org-selector-btn-group",0,1),e.NdJ("selectedOrgChange",function(B){return z.selectedOrg=B}),e.TgZ(3,"button",2),e.NdJ("click",function(){return e.CHM(E),e.MAs(2).refreshViewer()}),e._uU(4),e.qZA(),e.qZA(),e.qZA()}2&f&&(e.xp6(1),e.Q6J("selectedOrg",z.selectedOrg)("nzSize",z.to.submitSize),e.xp6(2),e.Q6J("disabled",!z.form.valid),e.xp6(1),e.hij(" ",z.to.submitLabel," "))},directives:[g.Z,S.q,x.ix,O.dQ,b.m,C.w],styles:[""],changeDetection:0}),u})()};var p=r(4375),T=r(1825),y=r(4182);let M=(()=>{class u{}return u.\u0275fac=function(f){return new(f||u)},u.\u0275mod=e.oAB({type:u}),u.\u0275inj=e.cJS({imports:[[o.ez,y.UX,m.X0.forChild({types:[L]}),x.sL,p.R,T.A]]}),u})()},3773:(U,I,r)=>{r.d(I,{g:()=>de});var o=r(9808),m=r(8776),e=r(5e3),g=r(4182),S=r(712),x=r(6530),O=r(444);const b={sourceType:void 0,citationId:void 0};let C=(()=>{class n{constructor(){this.sourceSelected=new e.vpe,this.model=b,this.form=new g.cw({}),this.options={},this.fields=[{key:"id"},{key:"citation",defaultValue:""},{key:"sourceType",type:"select",className:"source-type-field",defaultValue:S.yic.Pubmed,templateOptions:{required:!0,placeholder:"Select Type",options:(0,O.o6)(S.yic).map((t,c)=>({value:t,label:(0,x.c)(t)}))}},{key:"citationId",className:"citation-id-field",type:"source-selector-typeahead",templateOptions:{maxLength:10,required:!0,triggerParentSubmit:()=>{this.onSubmit()}},expressionProperties:{"templateOptions.disabled":"!model.sourceType","templateOptions.placeholder":'!model.sourceType ? "Select source type before searching" : "Search " + model.sourceType + " sources"',"templateOptions.sourceType":"model.sourceType","templateOptions.sourceTypeKey":t=>{if(t.sourceType)return(0,O.o6)(S.yic).getKeyOrThrow(t.sourceType)}}},{type:"cvc-multi-field-add-btn",className:"add-button",templateOptions:{label:"Add Source"},expressionProperties:{"templateOptions.disabled":"!model.citationId"}}]}ngOnInit(){}onSubmit(){console.log("source-select form submitted."),this.sourceSelected.emit(this.model)}ngOnDestroy(){console.log("source-selector onDestroy called.")}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=e.Xpm({type:n,selectors:[["cvc-source-selector"]],outputs:{sourceSelected:"sourceSelected"},decls:2,vars:5,consts:[["nz-form","","nzLayout","horizontal",3,"formGroup","ngSubmit"],[1,"formly-form",3,"model","fields","options","form","modelChange"]],template:function(t,c){1&t&&(e.TgZ(0,"form",0),e.NdJ("ngSubmit",function(){return c.onSubmit()}),e.TgZ(1,"formly-form",1),e.NdJ("modelChange",function(_){return c.model=_}),e.qZA(),e.qZA()),2&t&&(e.Q6J("formGroup",c.form),e.xp6(1),e.Q6J("model",c.model)("fields",c.fields)("options",c.options)("form",c.form))},directives:[g._Y,g.JL,g.sg,m.T7],styles:[":host{display:block}cvc-source-input .formly-form{width:100%}cvc-source-input .source-type-field{display:inline-block;width:10em}cvc-source-input .citation-id-field{display:inline-block;margin-left:.5em;width:calc(100% - 19em)}cvc-source-input .add-button{display:inline-block;margin-left:.5em;width:8em}\n"],encapsulation:2}),n})();var A=r(6906);function L(n,i){if(1&n){const t=e.EpF();e.ynx(0),e.TgZ(1,"cvc-source-selector",2),e.NdJ("sourceSelected",function(s){return e.CHM(t),e.oxw().onSourceSelected(s)}),e.qZA(),e.BQk()}}function p(n,i){if(1&n&&e._UZ(0,"cvc-source-tag",3),2&n){const t=e.oxw();e.Q6J("source",t.formControl.value)}}const y={name:"source-input",component:(()=>{class n extends m.fS{constructor(){super()}onSourceSelected(t){console.log(t),this.formControl.setValue(t)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=e.Xpm({type:n,selectors:[["cvc-source-input-type"]],features:[e.qOj],decls:3,vars:2,consts:[[4,"ngIf","ngIfElse"],["sourceListItem",""],[3,"sourceSelected"],[3,"source"]],template:function(t,c){if(1&t&&(e.YNc(0,L,2,0,"ng-container",0),e.YNc(1,p,1,1,"ng-template",null,1,e.W1O)),2&t){const s=e.MAs(2);e.Q6J("ngIf",!(null!=c.formControl.value&&c.formControl.value.id))("ngIfElse",s)}},directives:[o.O5,C,A.T],styles:[""],changeDetection:0}),n})()};var M=r(9139),u=r(6042),v=r(8054),f=r(537),z=r(8144),E=r(2359),w=r(1894),B=r(4546),J=r(822),D=r(2643),F=r(2683);function l(n,i){if(1&n&&e._UZ(0,"nz-alert",6),2&n){e.oxw();const t=e.MAs(3);e.Q6J("nzMessage",t)}}function h(n,i){if(1&n&&(e._uU(0," Found citation: "),e.TgZ(1,"em"),e._uU(2),e.qZA()),2&n){const t=e.oxw(3);e.xp6(2),e.Oqu(t.foundCitation)}}function a(n,i){1&n&&(e.ynx(0),e.YNc(1,l,1,1,"nz-alert",4),e.YNc(2,h,3,1,"ng-template",null,5,e.W1O),e.BQk())}function d(n,i){if(1&n&&e._UZ(0,"nz-alert",9),2&n){e.oxw();const t=e.MAs(3);e.Q6J("nzMessage",t)}}function Z(n,i){if(1&n&&(e._uU(0," '"),e.TgZ(1,"em"),e._uU(2),e.qZA(),e._uU(3,"' created. ")),2&n){const t=e.oxw(3);e.xp6(2),e.Oqu(t.foundCitation)}}function Q(n,i){1&n&&(e.ynx(0),e.YNc(1,d,1,1,"nz-alert",7),e.YNc(2,Z,4,1,"ng-template",null,8,e.W1O),e.BQk())}function P(n,i){if(1&n&&(e.TgZ(0,"nz-form-item"),e._UZ(1,"cvc-form-errors-alert",10),e.qZA()),2&n){const t=e.oxw(2);e.xp6(1),e.Q6J("errors",t.createErrors)}}function Y(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"button",12),e.NdJ("click",function(s){return e.CHM(t),e.oxw(3).onCreateSourceStub(s)}),e._uU(1," Create\xa0'"),e.TgZ(2,"em"),e._uU(3),e.qZA(),e._uU(4,"'\xa0 CIViC Source "),e.qZA()}if(2&n){const t=e.oxw(3);e.Q6J("nzLoading",t.isCreating),e.xp6(3),e.Oqu(t.foundCitation)}}function R(n,i){1&n&&(e.ynx(0),e.YNc(1,Y,5,2,"button",11),e.BQk())}function K(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"button",14),e.NdJ("click",function(s){return e.CHM(t),e.oxw(3).onAcceptSource(s)}),e._uU(1," Add Source to List "),e.qZA()}}function V(n,i){1&n&&(e.ynx(0),e.YNc(1,K,2,0,"button",13),e.BQk())}function j(n,i){if(1&n&&(e.ynx(0),e.TgZ(1,"nz-space",2),e.YNc(2,a,4,0,"ng-container",3),e.YNc(3,Q,4,0,"ng-container",3),e.YNc(4,P,2,1,"nz-form-item",3),e.YNc(5,R,2,0,"ng-container",3),e.YNc(6,V,2,0,"ng-container",3),e.qZA(),e.BQk()),2&n){const t=e.oxw();e.xp6(2),e.Q6J("ngIf",!1===t.createSuccess&&0===t.createErrors.length),e.xp6(1),e.Q6J("ngIf",!0===t.createSuccess),e.xp6(1),e.Q6J("ngIf",t.createErrors.length>0),e.xp6(1),e.Q6J("ngIf",!1===t.createSuccess),e.xp6(1),e.Q6J("ngIf",!0===t.createSuccess)}}function W(n,i){if(1&n&&(e.TgZ(0,"span",16),e._UZ(1,"i",17),e._uU(2),e.qZA()),2&n){const t=e.oxw(3);e.xp6(2),e.hij(" Source not known to CIViC, fetch citation from ",t.sourceTypeKey,"? ")}}function G(n,i){1&n&&(e.ynx(0),e.YNc(1,W,3,1,"span",15),e.BQk())}function X(n,i){if(1&n&&e._uU(0),2&n){const t=e.oxw(4);e.AsE(" Citation not found for ",t.sourceTypeKey,": ",t.citationId,". ")}}function $(n,i){if(1&n&&(e.TgZ(0,"span"),e._UZ(1,"nz-alert",19),e.YNc(2,X,1,2,"ng-template",null,20,e.W1O),e.qZA()),2&n){const t=e.MAs(3);e.xp6(1),e.Q6J("nzMessage",t)}}function H(n,i){1&n&&(e.ynx(0),e.YNc(1,$,4,1,"span",18),e.BQk())}function k(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"button",12),e.NdJ("click",function(s){return e.CHM(t),e.oxw(2).onExistenceQuery(s)}),e._uU(1," Fetch Citation for\xa0"),e.TgZ(2,"strong"),e._uU(3),e.qZA(),e.qZA()}if(2&n){const t=e.oxw(2);e.Q6J("nzLoading",t.isChecking),e.xp6(3),e.AsE("",t.sourceTypeKey," ",t.citationId,"")}}function q(n,i){if(1&n&&(e.TgZ(0,"nz-space",2),e.YNc(1,G,2,0,"ng-container",3),e.YNc(2,H,2,0,"ng-container",3),e.YNc(3,k,4,3,"button",11),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.showPrompt),e.xp6(1),e.Q6J("ngIf",t.existenceFail)}}let ee=(()=>{class n{constructor(t,c,s){this.existenceCheckQuery=t,this.createSourceStubQuery=c,this.changeDetectorRef=s,this.modelUpdate=new e.vpe,this.citationIdChange=new e.vpe,this.sourceTypeChange=new e.vpe,this.showPrompt=!0,this.isChecking=!1,this.existenceFail=!1,this.existenceError=[],this.foundCitation=void 0,this.isCreating=!1,this.createSuccess=!1,this.createErrors=[]}set sourceType(t){this._sourceType=t,this.sourceTypeKey=(0,O.o6)(S.yic).getKeyOrThrow(t)}get sourceType(){return this._sourceType}onExistenceQuery(t){t&&t.preventDefault(),this.isChecking=!0,this.foundCitation=void 0,this.existenceCheckQuery.fetch({sourceType:this.sourceType,citationId:+this.citationId}).pipe((0,f.x)(()=>{this.isChecking=!1,this.changeDetectorRef.detectChanges()})).subscribe({next:({data:{remoteCitation:c}})=>{null!==c?this.foundCitation=c:(this.showPrompt=!1,this.existenceFail=!0)},error:c=>{this.showPrompt=!1,this.existenceError=c.graphQLErrors.map(s=>s.message)},complete:()=>{this.existenceError=[]}})}onCreateSourceStub(t){t&&t.preventDefault(),this.isCreating=!0,this.createSuccess=!1,this.createSourceStubQuery.mutate({input:{citationId:+this.citationId,sourceType:this.sourceType}}).pipe((0,f.x)(()=>{this.isCreating=!1,this.changeDetectorRef.detectChanges()})).subscribe({next:({data:c})=>{var s;console.log(c);const _=null===(s=null==c?void 0:c.addRemoteCitation)||void 0===s?void 0:s.newSource;this.sourceStub=_,this.createSuccess=!0},error:c=>{this.showPrompt=!1,this.createSuccess=!1,this.createErrors=c.graphQLErrors.map(s=>s.message)},complete:()=>{this.createErrors=[]}})}onAcceptSource(t){t&&t.preventDefault(),console.log("source accepted");const c=Object.assign(Object.assign({},this.model),{id:this.sourceStub.id,citation:this.foundCitation,citationId:this.citationId});this.modelUpdate.emit(c)}ngAfterContentInit(){console.log("model")}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(S.fpJ),e.Y36(S.JQ3),e.Y36(e.sBO))},n.\u0275cmp=e.Xpm({type:n,selectors:[["cvc-source-loader"]],inputs:{model:"model",citationId:"citationId",sourceType:"sourceType"},outputs:{modelUpdate:"modelUpdate",citationIdChange:"citationIdChange",sourceTypeChange:"sourceTypeChange"},decls:3,vars:2,consts:[[4,"ngIf","ngIfElse"],["fetchCitation",""],["nzDirection","vertical"],[4,"ngIf"],["nzType","info","nzShowIcon","",3,"nzMessage",4,"nzSpaceItem"],["foundCitationMsg",""],["nzType","info","nzShowIcon","",3,"nzMessage"],["nzType","success","nzShowIcon","",3,"nzMessage",4,"nzSpaceItem"],["createdMsg",""],["nzType","success","nzShowIcon","",3,"nzMessage"],[3,"errors"],["type","submit","nz-button","","nzBlock","","nzType","primary","nzSize","default",3,"nzLoading","click",4,"nzSpaceItem"],["type","submit","nz-button","","nzBlock","","nzType","primary","nzSize","default",3,"nzLoading","click"],["type","submit","nz-button","","nzBlock","","nzType","primary","nzSize","default",3,"click",4,"nzSpaceItem"],["type","submit","nz-button","","nzBlock","","nzType","primary","nzSize","default",3,"click"],["nz-typography","",4,"nzSpaceItem"],["nz-typography",""],["nz-icon","","nzType","info-circle","nzTheme","twotone"],[4,"nzSpaceItem"],["nzType","warning","nzShowIcon","",3,"nzMessage"],["existenceFail",""]],template:function(t,c){if(1&t&&(e.YNc(0,j,7,5,"ng-container",0),e.YNc(1,q,4,2,"ng-template",null,1,e.W1O)),2&t){const s=e.MAs(2);e.Q6J("ngIf",c.foundCitation)("ngIfElse",s)}},directives:[o.O5,z.NU,z.$1,E.r,w.SK,B.Nx,J.V,u.ix,D.dQ,F.w],styles:["[_nghost-%COMP%]{display:block}nz-space[_ngcontent-%COMP%]{width:100%}nz-space-item[_ngcontent-%COMP%]:last-child{margin-bottom:0}"]}),n})();function te(n,i){if(1&n&&(e.TgZ(0,"nz-option",4),e._uU(1),e.qZA()),2&n){const t=i.$implicit;e.Q6J("nzLabel",t.label)("nzValue",t.value),e.xp6(1),e.AsE(" ",t.source.citation?t.source.citation:t.source.name," (",t.source.citationId,") ")}}function ne(n,i){if(1&n&&(e.TgZ(0,"div",5),e._uU(1," Citation: "),e.TgZ(2,"span",6),e._uU(3),e.qZA(),e.qZA()),2&n){const t=e.oxw();e.xp6(3),e.hij(" ",t.model.citation," ")}}function oe(n,i){if(1&n&&(e.TgZ(0,"div",5),e._uU(1),e.qZA()),2&n){const t=e.oxw(2);e.xp6(1),e.hij(" Enter a ",t.to.sourceTypeKey," citation ID to search CIViC sources ")}}function re(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"cvc-source-loader",10),e.NdJ("modelUpdate",function(s){return e.CHM(t),e.oxw(2).onModelUpdated(s)})("sourceTypeChange",function(s){return e.CHM(t),e.oxw(2).model.sourceType=s})("citationIdChange",function(s){return e.CHM(t),e.oxw(2).to.fieldValue=s}),e.qZA()}if(2&n){const t=e.oxw(2);e.Q6J("model",t.model)("sourceType",t.model.sourceType)("citationId",t.to.fieldValue)}}function ce(n,i){if(1&n&&(e.ynx(0,7),e.YNc(1,oe,2,1,"div",8),e.YNc(2,re,1,3,"cvc-source-loader",9),e.BQk()),2&n){const t=e.oxw();e.Q6J("ngSwitch",t.to.fieldLength>0&&t.to.fieldLength>=t.to.minLengthSearch),e.xp6(1),e.Q6J("ngSwitchCase",!1),e.xp6(1),e.Q6J("ngSwitchCase",!0)}}const ie={name:"source-selector-typeahead",component:(()=>{class n extends m.fS{constructor(t,c){super(),this.sourceTypeaheadQuery=t,this.changeDetectorRef=c,this.selectedValue=null,this.nzFilterOption=()=>!0,this.defaultOptions={templateOptions:{placeholder:"Search",sourceType:void 0,showArrow:!1,onSearch:()=>{},filterOption:()=>{},modelChange:()=>{},triggerParentSubmit:()=>{},minLengthSearch:1,fieldLength:0,fieldValue:"",optionList:[]}}}ngAfterViewInit(){this.to.filterOption=()=>!0,this.to.modelChange=t=>{if(this.to.optionList.length>0){const{source:c}=this.to.optionList.find(s=>s.value===+t);c?this.form.patchValue({citation:c.citation?c.citation:c.name,id:c.id}):console.error("Could not find selected citation in list?")}},this.to.onSearch=t=>{this.to.fieldValue=t,this.to.fieldLength=t.length,!(t.length<this.to.minLengthSearch||t.length>this.to.maxLength)&&this.sourceTypeaheadQuery.fetch({sourceType:this.to.sourceType,partialCitationId:+t},{fetchPolicy:"network-only"}).subscribe(({data:{sourceTypeahead:c}})=>{this.to.optionList=c.map(s=>({value:s.citationId,label:s.citationId,source:s})),this.changeDetectorRef.detectChanges()})}}onModelUpdated(t){this.form.patchValue(t),this.changeDetectorRef.detectChanges(),this.to.triggerParentSubmit()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(S.k2T),e.Y36(e.sBO))},n.\u0275cmp=e.Xpm({type:n,selectors:[["cvc-source-selector-typeahead-type"]],features:[e.qOj],decls:5,vars:8,consts:[["nzShowSearch","","nzServerSearch","",3,"formControl","formlyAttributes","nzPlaceHolder","nzNotFoundContent","nzShowArrow","nzFilterOption","ngModelChange","nzOnSearch"],["nzCustomContent","",3,"nzLabel","nzValue",4,"ngFor","ngForOf"],["class","ant-form-item-explain",4,"ngIf"],["sourceLoader",""],["nzCustomContent","",3,"nzLabel","nzValue"],[1,"ant-form-item-explain"],[1,"source-citation"],[3,"ngSwitch"],["class","ant-form-item-explain",4,"ngSwitchCase"],[3,"model","sourceType","citationId","modelUpdate","sourceTypeChange","citationIdChange",4,"ngSwitchCase"],[3,"model","sourceType","citationId","modelUpdate","sourceTypeChange","citationIdChange"]],template:function(t,c){if(1&t&&(e.TgZ(0,"nz-select",0),e.NdJ("ngModelChange",function(_){return c.to.modelChange(_)})("nzOnSearch",function(_){return c.to.onSearch(_)}),e.YNc(1,te,2,4,"nz-option",1),e.qZA(),e.YNc(2,ne,4,1,"div",2),e.YNc(3,ce,3,3,"ng-template",null,3,e.W1O)),2&t){const s=e.MAs(4);e.Q6J("formControl",c.formControl)("formlyAttributes",c.field)("nzPlaceHolder",c.to.placeholder?c.to.placeholder:null)("nzNotFoundContent",s)("nzShowArrow",c.to.showArrow)("nzFilterOption",c.to.filterOption),e.xp6(1),e.Q6J("ngForOf",c.to.optionList),e.xp6(1),e.Q6J("ngIf",c.model.citation.length>0)}},directives:[v.Vq,g.JJ,g.oH,m.VQ,o.sg,v.Ip,o.O5,o.RF,o.n9,ee],styles:["[_nghost-%COMP%]{display:block}.loading-icon[_ngcontent-%COMP%]{margin-right:8px}.source-citation[_ngcontent-%COMP%]{font-style:oblique}"],changeDetection:0}),n})(),wrappers:["form-field"]};var se=r(7008);let N=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[o.ez,z.zf,E.L,B.U5,se.B,u.sL]]}),n})(),ae=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[o.ez,g.UX,m.X0.forChild({types:[ie]}),v.LV,N]]}),n})();var le=r(8979);let ue=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[o.ez,g.UX,m.X0,M.u,u.sL,N,ae,le.N]]}),n})();var pe=r(9779);let de=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[o.ez,m.X0.forChild({types:[y]}),ue,pe.s]]}),n})()}}]);