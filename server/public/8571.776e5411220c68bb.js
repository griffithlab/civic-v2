"use strict";(self.webpackChunkmain=self.webpackChunkmain||[]).push([[8571],{8571:(we,I,i)=>{i.r(I),i.d(I,{EvidenceReviseModule:()=>je});var d=i(9808),P=i(9386),S=i(5630),b=i(6905),C=i(4623),h=i(6949),g=i(1894),Z=i(2467),R=i(5017),f=i(1945),m=i(8144),T=i(3618),l=i(325),v=i(373),A=i(1059),F=i(4850),e=i(5e3),p=i(7630),Q=i(9350),J=i(8992),N=i(8511),U=i(5639),Y=i(160);function L(t,o){if(1&t&&(e.TgZ(0,"span",12)(1,"strong"),e._uU(2),e.qZA(),e._uU(3," Parents:"),e.qZA()),2&t){const n=e.oxw(2).ngIf;e.xp6(2),e.Oqu(n.name)}}function $(t,o){if(1&t&&(e.TgZ(0,"span",13),e._UZ(1,"cvc-molecular-profile-tag",14),e.qZA()),2&t){const n=e.oxw(2).ngIf;e.xp6(1),e.Q6J("molecularProfile",n.molecularProfile)("enablePopover",!1)}}function G(t,o){1&t&&(e.TgZ(0,"nz-space",9),e.YNc(1,L,4,1,"span",10),e.YNc(2,$,2,2,"span",11),e.qZA())}function j(t,o){1&t&&(e.TgZ(0,"div"),e._UZ(1,"router-outlet"),e.qZA())}function V(t,o){1&t&&(e.TgZ(0,"nz-row",15)(1,"div",16),e._UZ(2,"cvc-login-prompt"),e.qZA()())}function w(t,o){if(1&t&&(e.ynx(0),e._UZ(1,"cvc-section-navigation",1),e.YNc(2,G,3,0,"ng-template",null,2,e.W1O),e.TgZ(4,"nz-page-header",3)(5,"nz-page-header-title",4),e._uU(6," REVISE "),e._UZ(7,"i",5),e.ALo(8,"entityColor"),e._uU(9),e.qZA(),e.TgZ(10,"nz-page-header-content")(11,"div",6),e.YNc(12,j,2,0,"div",7),e.ALo(13,"ngrxPush"),e.YNc(14,V,3,0,"ng-template",null,8,e.W1O),e.qZA()()(),e.BQk()),2&t){const n=o.ngIf,r=e.MAs(3),a=e.MAs(15),s=e.oxw();e.xp6(1),e.Q6J("displayName",n.name)("relationsTpl",r),e.xp6(6),e.Q6J("nzTwotoneColor",e.lcZ(8,6,"EvidenceItem")),e.xp6(2),e.hij(" ",n.name," "),e.xp6(3),e.Q6J("ngIf",e.lcZ(13,8,s.isSignedIn$))("ngIfElse",a)}}let D=(()=>{class t{constructor(n,r,a){this.gql=n,this.route=r,this.viewerService=a,this.routeSub=this.route.params.subscribe(s=>{let c=this.gql.watch({evidenceId:+s.evidenceId}).valueChanges;this.loading$=c.pipe((0,v.j)("loading"),(0,A.O)(!0)),this.evidence$=c.pipe((0,v.j)("data","evidenceItem")),this.commentsTotal$=this.evidence$.pipe((0,v.j)("comments","totalCount")),this.flagsTotal$=this.evidence$.pipe((0,v.j)("flags","totalCount")),this.revisionsTotal$=this.evidence$.pipe((0,v.j)("revisions","totalCount"))})}ngOnInit(){this.isSignedIn$=this.viewerService.viewer$.pipe((0,F.U)(n=>n.signedIn))}ngOnDestroy(){this.routeSub.unsubscribe()}}return t.\u0275fac=function(n){return new(n||t)(e.Y36(p.pHu),e.Y36(l.gz),e.Y36(Q.a))},t.\u0275cmp=e.Xpm({type:t,selectors:[["cvc-evidence-revise"]],decls:2,vars:3,consts:[[4,"ngIf"],[3,"displayName","relationsTpl"],["evidenceRelations",""],[1,"site-page-header"],["cvcFlaggableOptions",""],["nz-icon","","nzTheme","twotone","nzType","civic-evidence",3,"nzTwotoneColor"],[1,"content"],[4,"ngIf","ngIfElse"],["notSignedIn",""],["nzDirection","horizontal"],["nz-typography","","class","label",4,"nzSpaceItem"],["class","tags",4,"nzSpaceItem"],["nz-typography","",1,"label"],[1,"tags"],[3,"molecularProfile","enablePopover"],["nzSpan","24","nzJustify","center"],["nz-col","","nzSpan","6"]],template:function(n,r){1&n&&(e.YNc(0,w,16,10,"ng-container",0),e.ALo(1,"async")),2&n&&e.Q6J("ngIf",e.lcZ(1,1,r.evidence$))},directives:[d.O5,J.I,m.NU,m.$1,T.ZU,N.p,f.$O,f.u9,R.Ls,f.u5,l.lC,g.SK,g.t3,U.u],pipes:[d.Ov,Y.a,h.fM],styles:["[_nghost-%COMP%]{display:block}[_nghost-%COMP%]     nz-page-header:first-of-type{background-color:#fff;border-radius:8px}[_nghost-%COMP%]     nz-page-header:first-of-type .header-content{flex-wrap:nowrap;background-color:#f0f0f0;border-top-left-radius:8px;border-top-right-radius:8px;margin:-12px -16px 16px;border-bottom:1px solid #bfbfbf}[_nghost-%COMP%]     nz-page-header:first-of-type .header-content .header-icon{padding:12px 0 12px 12px}[_nghost-%COMP%]     nz-page-header:first-of-type .header-content .header-icon i{width:100%}[_nghost-%COMP%]     nz-page-header:first-of-type .header-content .header-icon i   svg{width:100%;height:100%}[_nghost-%COMP%]     nz-page-header:first-of-type .header-content .header-description{padding:12px}[_nghost-%COMP%]     nz-page-header:first-of-type .header-content .header-description h2{color:#262626;margin:-8px 0 0;font-weight:500}[_nghost-%COMP%]     nz-page-header:first-of-type .header-content .header-description p{color:#262626;margin:-2px 0 0;padding:0;font-size:95%;line-height:1.5em}[_nghost-%COMP%]     nz-page-header:first-of-type .header-content .header-links{text-align:right;padding:12px}[_nghost-%COMP%]     nz-page-header:first-of-type .card-list nz-card{width:100%}[_nghost-%COMP%]     nz-page-header:first-of-type .card-list nz-card .card-grid-cell{width:50%}[_nghost-%COMP%]     nz-page-header:first-of-type nz-page-header-title.flagged{padding-left:.75em}[_nghost-%COMP%]     nz-page-header:first-of-type .ant-page-header-content{padding-top:0;padding-bottom:12px}[_nghost-%COMP%]     nz-page-header:first-of-type .ant-page-header-heading-extra nz-space-item:last-child{margin-right:0!important}[_nghost-%COMP%]     nz-page-header:first-of-type #section-tabs{margin:0 -16px 12px}[_nghost-%COMP%]     nz-page-header:first-of-type #section-tabs .ant-tabs-nav-wrap{padding-left:16px;padding-right:16px;line-height:24px}[_nghost-%COMP%]     nz-page-header:first-of-type #section-tabs .ant-tabs-nav-wrap .ant-tabs-tab{padding:1px 8px}[_nghost-%COMP%]     nz-page-header:first-of-type #section-tabs .ant-tabs-nav-wrap .ant-tabs-tab .anticon{margin-right:0}[_nghost-%COMP%]     nz-page-header:first-of-type #section-tabs .ant-tabs-extra-content{margin-right:16px}"]}),t})();var B=i(7484),W=i(6559),_=i(3773),H=i(7055),X=i(4375),K=i(7008),k=i(1825),M=i(8776),q=i(6042),O=i(2359),y=i(4546),ee=i(1017),u=i(3075),te=i(4454),ne=i(9866),ie=i(5457),oe=i(8006),se=i(3022),re=i(7695),ae=i(7462),ce=i(3594),de=i(3643),le=i(7101),E=i(7525),pe=i(2789),ge=i(5932),me=i(3416),ve=i(7282),ue=i(1830),fe=i(5599),he=i(5472),ye=i(4889),xe=i(7338),ze=i(7220);let Ie=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({providers:[],imports:[[d.ez,l.Bz,u.UX,ee.s,y.U5,O.L,g.Jb,q.sL,E.j,M.X0,k.A,K.B,X.R,re.C,se.e,H.N,_.g,ne.a,te.W,ie.$,oe.I,ae.o,ce.q,de.q,le.U,pe.o,ge.A,me.g,ve.B,ue.S,fe.E,he.r,xe.z,ye.E,ze.m]]}),t})(),Re=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[[d.ez,h.WG,g.Jb,B.vh,W.H0,m.zf,Ie]]}),t})();var x=i(6738),Te=i(8929),z=i(7625),Me=i(6123),Oe=i(4024),Ee=i(9169),Pe=i(822);function Se(t,o){1&t&&e.GkF(0)}function be(t,o){if(1&t){const n=e.EpF();e.TgZ(0,"formly-form",6),e.NdJ("modelChange",function(a){return e.CHM(n),e.oxw(2).formModel=a}),e.qZA()}if(2&t){const n=e.oxw(2);e.Q6J("form",n.formGroup)("fields",n.formFields)("model",n.formModel)("options",n.formOptions)}}function Ce(t,o){if(1&t){const n=e.EpF();e.TgZ(0,"form",3),e.NdJ("ngSubmit",function(){e.CHM(n);const a=e.oxw();return a.submitRevision(a.formModel)}),e.YNc(1,Se,1,0,"ng-container",4),e.YNc(2,be,1,4,"formly-form",5),e.qZA()}if(2&t){const n=e.oxw(),r=e.MAs(3);e.Q6J("formGroup",n.formGroup),e.xp6(1),e.Q6J("ngTemplateOutlet",r),e.xp6(1),e.Q6J("ngIf",!n.success&&!n.noNewRevisions)}}function Ze(t,o){if(1&t&&(e.ynx(0),e.TgZ(1,"nz-form-item"),e._UZ(2,"cvc-form-errors-alert",8),e.qZA(),e.BQk()),2&t){const n=e.oxw(2);e.xp6(2),e.Q6J("errors",n.errorMessages)}}function Ae(t,o){1&t&&(e.TgZ(0,"p"),e._uU(1,"View it on the "),e.TgZ(2,"a",12),e._uU(3,"Revisions Page"),e.qZA(),e._uU(4,"."),e.qZA())}function Fe(t,o){if(1&t&&(e.ynx(0),e._UZ(1,"nz-alert",9),e.YNc(2,Ae,5,0,"ng-template",10,11,e.W1O),e.BQk()),2&t){const n=e.MAs(3);e.xp6(1),e.Q6J("nzDescription",n)}}function Qe(t,o){1&t&&(e.TgZ(0,"p"),e._uU(1,"Your submission succeeded but no new revisions were created. Identical ones already exist, view them on the "),e.TgZ(2,"a",12),e._uU(3,"Revisions Page"),e.qZA(),e._uU(4,"."),e.qZA())}function Je(t,o){if(1&t&&(e.ynx(0),e._UZ(1,"nz-alert",13),e.YNc(2,Qe,5,0,"ng-template",10,14,e.W1O),e.BQk()),2&t){const n=e.MAs(3);e.xp6(1),e.Q6J("nzDescription",n)}}function Ne(t,o){if(1&t&&(e.YNc(0,Ze,3,1,"ng-container",7),e.YNc(1,Fe,4,1,"ng-container",7),e.YNc(2,Je,4,1,"ng-container",7)),2&t){const n=e.oxw();e.Q6J("ngIf",n.errorMessages.length>0),e.xp6(1),e.Q6J("ngIf",n.success&&!n.noNewRevisions),e.xp6(1),e.Q6J("ngIf",n.noNewRevisions)}}let Ue=(()=>{class t{constructor(n,r,a,s,c){this.suggestRevisionGQL=n,this.networkErrorService=r,this.revisableFieldsGQL=a,this.evidenceDetailGQL=s,this.revisionsGQL=c,this.formGroup=new u.cw({}),this.formOptions={formState:new Oe._},this.success=!1,this.noNewRevisions=!1,this.errorMessages=[],this.loading=!1,this.suggestRevisionMutator=new Me.U(r),this.formFields=[{key:"fields",wrappers:["form-container"],templateOptions:{label:"Suggest Evidence Item Revision Form"},fieldGroup:[{key:"id",type:"input",hide:!0},{key:"molecularProfile",type:"molecular-profile-input",templateOptions:{label:"Molecular Profile",helpText:"A single variant (Simple Molecular Profile) or a combination of variants (Complex Molecular Profile) relevant to the curated evidence.",required:!0,nzSelectedIndex:2,allowCreate:!0}},{key:"description",type:"cvc-textarea",templateOptions:{label:"Evidence Statement",helpText:'Your original description of evidence from published literature detailing the association or lack of association between a variant and its predictive, prognostic, diagnostic, predisposing, functional or oncogenic value. Data constituting personal or identifying information should not be entered (e.g. <a href="https://www.hipaajournal.com/what-is-protected-health-information/" target="_blank">protected health information (PHI) as defined by HIPAA</a> in the U.S. and/or comparable laws in your jurisdiction).',placeholder:"No description provided",required:!0}},{key:"source",type:"multi-field",wrappers:["form-field"],templateOptions:{label:"Source",helpText:"CIViC accepts PubMed or ASCO Abstracts sources. Please provide the source of the support for your evidence here.",addText:"Specify a Source",maxCount:1,required:!0},fieldArray:{type:"source-input",templateOptions:{required:!0}}},{key:"variantOrigin",type:"variant-origin-select",templateOptions:{required:!0}},{key:"evidenceType",type:"evidence-type-select",templateOptions:{required:!0}},{key:"evidenceDirection",type:"evidence-direction-select",templateOptions:{required:!0}},{key:"significance",type:"significance-select",templateOptions:{required:!0}},{key:"disease",type:"disease-array",templateOptions:{maxCount:1}},{key:"evidenceLevel",type:"evidence-level-select",templateOptions:{required:!0}},{key:"therapies",type:"therapy-array"},{key:"therapyInteractionType",type:"therapy-interaction-select"},{key:"phenotypes",type:"phenotype-array"},{key:"evidenceRating",type:"rating-input",templateOptions:{label:"Rating",helpText:"Please rate your evidence on a scale of one to five stars. Use the star rating descriptions for guidance.",required:!0}},{key:"comment",type:"comment-textarea",templateOptions:{label:"Comment",helpText:"Please provide any additional comments you wish to make about this evidence item. This comment will appear as the first comment in this item's comment thread.",placeholder:"Please enter a comment describing your revision.",required:!0,minLength:10}},{key:"cancel",type:"cancel-button",templateOptions:{redirectPath:"../.."}},{key:"organization",type:"org-submit-button",templateOptions:{submitLabel:"Submit Evidence Item Revision",submitSize:"large"}}]}]}ngOnInit(){this.destroy$=new Te.xQ}ngAfterViewInit(){this.revisableFieldsGQL.fetch({evidenceId:this.evidenceId}).subscribe(({data:{evidenceItem:n}})=>{n&&(this.formModel=this.toFormModel(n))},n=>{console.error("Error retrieving evidenceItem."),console.error(n)},()=>{this.formOptions.updateInitialValue&&this.formOptions.updateInitialValue(),this.formGroup.markAllAsTouched();const n=this.formGroup.get("fields.comment");n&&n.markAsUntouched()})}toFormModel(n){var r,a;return{fields:Object.assign(Object.assign({},n),{molecularProfile:n.molecularProfile,source:[n.source],therapies:n.therapies.length>0?n.therapies:[],disease:[n.disease],comment:null===(r=this.formModel)||void 0===r?void 0:r.fields.comment,therapyInteractionType:n.therapyInteractionType,organization:null===(a=this.formModel)||void 0===a?void 0:a.fields.organization,evidenceRating:n.evidenceRating})}}submitRevision(n){let r=this.toRevisionInput(n);if(r){let a=this.suggestRevisionMutator.mutate(this.suggestRevisionGQL,{input:r},{refetchQueries:[{query:this.evidenceDetailGQL.document,variables:{evidenceId:this.evidenceId}},{query:this.revisionsGQL.document,variables:{subject:{id:this.evidenceId,entityType:p.oRL.EvidenceItem},status:p.FJi.New}}]},s=>{var c;(null===(c=s.suggestEvidenceItemRevision)||void 0===c?void 0:c.results.every(Ve=>0==Ve.newlyCreated))&&(this.noNewRevisions=!0,this.success=!1)});a.submitSuccess$.pipe((0,z.R)(this.destroy$)).subscribe(s=>{s&&(this.success=!0)}),a.submitError$.pipe((0,z.R)(this.destroy$)).subscribe(s=>{s&&(this.errorMessages=s,this.success=!1)}),a.isSubmitting$.pipe((0,z.R)(this.destroy$)).subscribe(s=>{this.loading=s})}}toRevisionInput(n){var r,a;if(n){const s=n.fields;return{id:s.id,comment:s.comment,fields:{variantOrigin:s.variantOrigin,description:x.xt(s.description),molecularProfileId:s.molecularProfile.id,sourceId:s.source[0].id,evidenceType:s.evidenceType,evidenceDirection:s.evidenceDirection,significance:s.significance,diseaseId:x.uP(null===(r=s.disease[0])||void 0===r?void 0:r.id),evidenceLevel:s.evidenceLevel,phenotypeIds:s.phenotypes.map(c=>c.id),rating:s.evidenceRating,therapyIds:s.therapies.map(c=>c.id),therapyInteractionType:x.uP(s.therapies.length>1?s.therapyInteractionType:void 0)},organizationId:null===(a=n.fields.organization)||void 0===a?void 0:a.id}}}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}}return t.\u0275fac=function(n){return new(n||t)(e.Y36(p.Vj7),e.Y36(Ee.Y),e.Y36(p.Q_P),e.Y36(p.pHu),e.Y36(p.L5n))},t.\u0275cmp=e.Xpm({type:t,selectors:[["cvc-evidence-revise-form"]],inputs:{evidenceId:"evidenceId"},decls:4,vars:2,consts:[["nzTip","Submitting",3,"nzSpinning"],["nz-form","","nzLayout","vertical",3,"formGroup","ngSubmit",4,"ngIf"],["formMessages",""],["nz-form","","nzLayout","vertical",3,"formGroup","ngSubmit"],[4,"ngTemplateOutlet"],[3,"form","fields","model","options","modelChange",4,"ngIf"],[3,"form","fields","model","options","modelChange"],[4,"ngIf"],[3,"errors"],["nzType","success","nzMessage","Suggested Revision Submitted","nzShowIcon","",3,"nzDescription"],["nzSize","small"],["successMessage",""],["routerLink","../../revisions"],["nzType","warning","nzMessage","No New Revisions Created","nzShowIcon","",3,"nzDescription"],["duplicateMessage",""]],template:function(n,r){1&n&&(e.TgZ(0,"nz-spin",0),e.YNc(1,Ce,3,3,"form",1),e.qZA(),e.YNc(2,Ne,3,3,"ng-template",null,2,e.W1O)),2&n&&(e.Q6J("nzSpinning",r.loading),e.xp6(1),e.Q6J("ngIf",r.formModel))},directives:[E.W,d.O5,u._Y,u.JL,y.Lr,u.sg,d.tP,M.T7,g.SK,y.Nx,Pe.V,O.r,l.yS],styles:[""]}),t})();function Ye(t,o){if(1&t&&(e.ynx(0),e._UZ(1,"cvc-evidence-revise-form",2),e.BQk()),2&t){const n=e.oxw();e.xp6(1),e.Q6J("evidenceId",n.evidenceId)}}function Le(t,o){1&t&&e._uU(0,"Loading Evidence...")}const $e=[{path:"",component:D,data:{breadcrumb:"Revise"},children:[{path:"",redirectTo:"suggest",pathMatch:"full"},{path:"suggest",component:(()=>{class t{constructor(n){this.route=n,this.routeParams$=this.route.params.subscribe(r=>{this.evidenceId=+r.evidenceId})}ngOnDestroy(){this.routeParams$.unsubscribe()}}return t.\u0275fac=function(n){return new(n||t)(e.Y36(l.gz))},t.\u0275cmp=e.Xpm({type:t,selectors:[["cvc-evidence-suggest"]],decls:3,vars:2,consts:[[4,"ngIf","ngIfElse"],["loadingEvidence",""],[3,"evidenceId"]],template:function(n,r){if(1&n&&(e.YNc(0,Ye,2,1,"ng-container",0),e.YNc(1,Le,1,0,"ng-template",null,1,e.W1O)),2&n){const a=e.MAs(2);e.Q6J("ngIf",r.evidenceId)("ngIfElse",a)}},directives:[d.O5,Ue],styles:[""]}),t})(),data:{breadcrumb:"Suggest Revision"}}]}];let Ge=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[[l.Bz.forChild($e),Re],l.Bz]}),t})(),je=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[[d.ez,h.WG,Ge,f.KJ,m.zf,g.Jb,R.PV,T.ZJ,m.zf,Z.u,b.s,S.D,C.K,P.a]]}),t})()}}]);