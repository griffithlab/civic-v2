"use strict";(self.webpackChunkmain=self.webpackChunkmain||[]).push([[262],{664:(V,N,o)=>{o.d(N,{D:()=>zt});var n=o(9145),u=o(6354),g=o(4608),t=o(3953),h=o(177),x=o(513),$=o(6389),T=o(7529),y=o(5703),E=o(2617),G=o(5103),I=o(9438),f=o(7685),S=o(1635),A=o(1226),z=o(9894),P=o(1305),L=o(4222),M=o(9417),O=o(5930),D=o(8927),j=o(2983),F=o(3617),d=o(5154),s=o(9449),r=o(1939),a=o(5566);function c(i,l){if(1&i){const e=t.RV6();t.j41(0,"nz-alert",6),t.bIt("nzOnClose",function(){t.eBV(e);const p=t.XpG();return t.Njj(p.onSuccessBannerClose())}),t.k0s()}}function _(i,l){if(1&i&&(t.j41(0,"nz-form-item"),t.nrm(1,"cvc-form-errors-alert",7),t.k0s()),2&i){const e=t.XpG();t.R7$(),t.Y8G("errors",e.errorMessages)}}let R=class Y{constructor(l,e,m){this.viewerService=l,this.addCommentGql=e,this.networkErrorService=m,this.commentAddedEvent=new t.bkB,this.success=!1,this.errorMessages=[],this.loading=!1,this.viewerService.viewer$.pipe((0,z.s)(this)).subscribe(p=>{this.mostRecentOrg=p.mostRecentOrg}),this.addCommentMutator=new A.E(this.networkErrorService)}submitComment(){if(this.commentText){this.errorMessages=[];let e=this.addCommentMutator.mutate(this.addCommentGql,{input:{body:this.commentText,subject:this.subject,organizationId:void 0===this.mostRecentOrg?void 0:this.mostRecentOrg.id}});e.submitSuccess$.pipe((0,z.s)(this)).subscribe(m=>{m&&(this.resetForm(),this.success=!0)}),e.submitError$.pipe((0,z.s)(this)).subscribe(m=>{m&&(this.errorMessages=m,this.success=!1)}),e.isSubmitting$.pipe((0,z.s)(this)).subscribe(m=>{this.loading=m})}}resetForm(){this.commentText="",this.commentAddedEvent.emit()}onSuccessBannerClose(){this.resetForm()}static#t=this.\u0275fac=function(e){return new(e||Y)(t.rXU(P.q),t.rXU(n.hj),t.rXU(L.N))};static#n=this.\u0275cmp=t.VBU({type:Y,selectors:[["cvc-comment-add-form"]],inputs:{subject:"subject"},outputs:{commentAddedEvent:"commentAddedEvent"},decls:11,vars:7,consts:[["nzBanner","","nzMessage","Comment submitted","nzType","success","nzCloseable","",3,"nzOnClose",4,"ngIf"],["nz-form","","nzLayout","vertical",3,"ngSubmit"],[4,"ngIf"],[3,"commentChange","comment"],["nzTip","Submitting",3,"nzSpinning"],["type","submit","nz-button","","cvcOrgSelectorBtn","","nzType","primary","nzSize","small","nz-tooltip","",3,"disabled","nzTooltipTrigger","nzTooltipTitle"],["nzBanner","","nzMessage","Comment submitted","nzType","success","nzCloseable","",3,"nzOnClose"],[3,"errors"]],template:function(e,m){1&e&&(t.j41(0,"nz-card"),t.DNE(1,c,1,0,"nz-alert",0),t.j41(2,"form",1),t.bIt("ngSubmit",function(){return m.submitComment()}),t.DNE(3,_,2,1,"nz-form-item",2),t.j41(4,"cvc-comment-input-form",3),t.mxI("commentChange",function(v){return t.DH7(m.commentText,v)||(m.commentText=v),v}),t.k0s(),t.j41(5,"nz-spin",4)(6,"nz-form-item")(7,"nz-form-control")(8,"cvc-form-buttons")(9,"button",5),t.EFF(10," Add Comment "),t.k0s()()()()()()()),2&e&&(t.R7$(),t.Y8G("ngIf",m.success),t.R7$(2),t.Y8G("ngIf",m.errorMessages.length>0),t.R7$(),t.R50("comment",m.commentText),t.R7$(),t.Y8G("nzSpinning",m.loading),t.R7$(4),t.Y8G("disabled",m.loading||!(void 0!==m.commentText&&m.commentText.length>=10))("nzTooltipTrigger",m.mostRecentOrg?"hover":null)("nzTooltipTitle","For "+(null==m.mostRecentOrg?null:m.mostRecentOrg.name)))},dependencies:[h.bT,M.qT,M.cb,x.aO,$.c,O.p,y.cK,T.Uq,T.e,D.CA,D.Ls,D.zS,j.a,F.Y,d.LH,M.cV,s.j,r.l,a.K],styles:[":host{display:block}nz-space{width:100%}nz-form-item:last-of-type{margin-bottom:0}\n"],encapsulation:2})};R=(0,S.Cg)([(0,z.d)()],R);var C=o(9365),X=o(6864),b=o(7391),B=o(4126),W=o(8139);function K(i,l){if(1&i&&t.nrm(0,"nz-avatar",5),2&i){const e=t.XpG();t.Y8G("nzSrc",e.comment.commenter.profileImagePath)}}function Q(i,l){1&i&&t.nrm(0,"nz-avatar",6)}function J(i,l){1&i&&(t.j41(0,"span",3)(1,"i"),t.EFF(2,"No Comment Provided"),t.k0s()())}function H(i,l){if(1&i&&t.nrm(0,"cvc-comment-body",4),2&i){const e=t.XpG();t.Y8G("commentBodySegments",e.comment.parsedComment)}}let Z=(()=>{class i{ngOnInit(){if(void 0===this.comment)throw new Error("Must pass a comment into comment display component.")}static#t=this.\u0275fac=function(m){return new(m||i)};static#n=this.\u0275cmp=t.VBU({type:i,selectors:[["cvc-comment-display"]],inputs:{comment:"comment"},decls:8,vars:7,consts:[["noAvatar",""],[3,"nzAuthor","nzDatetime"],["nz-comment-avatar","",3,"nzSrc",4,"ngIf","ngIfElse"],["nz-typography","","nzType","secondary"],[3,"commentBodySegments"],["nz-comment-avatar","",3,"nzSrc"],["nz-comment-avatar","","nzIcon","civic:curator"]],template:function(m,p){if(1&m&&(t.j41(0,"nz-comment",1),t.nI1(1,"timeAgo"),t.DNE(2,K,1,1,"nz-avatar",2)(3,Q,1,0,"ng-template",null,0,t.C5r),t.j41(5,"nz-comment-content"),t.DNE(6,J,3,0,"span",3)(7,H,1,1,"cvc-comment-body",4),t.k0s()()),2&m){const v=t.sdS(4);t.Y8G("nzAuthor",p.comment.commenter.displayName)("nzDatetime",t.bMT(1,5,p.comment.createdAt)),t.R7$(2),t.Y8G("ngIf",p.comment.commenter.profileImagePath)("ngIfElse",v),t.R7$(4),t.vxM(0==p.comment.parsedComment.length?6:7)}},dependencies:[h.bT,X.fL,X.sf,X.OW,I.PM,b.Di,B.p,W.N],encapsulation:2})}return i})();var w=o(1774),k=o(4493);const U=()=>[];function q(i,l){if(1&i&&(t.j41(0,"nz-card",10),t.nrm(1,"cvc-comment-display",11),t.k0s()),2&i){const e=t.XpG(2);t.R7$(),t.Y8G("comment",e.creationComment)}}function tt(i,l){1&i&&(t.qex(0),t.j41(1,"nz-row",6)(2,"nz-col",7)(3,"nz-space",8),t.DNE(4,q,2,1,"nz-card",9),t.k0s()()(),t.bVm()),2&i&&(t.R7$(),t.Y8G("nzGutter",16))}function nt(i,l){if(1&i){const e=t.RV6();t.j41(0,"div",24)(1,"button",25),t.bIt("click",function(){t.eBV(e);const p=t.XpG().ngIf,v=t.XpG(3);return t.Njj(v.onLoadMore(p.startCursor))}),t.EFF(2," Load older comments "),t.k0s()()}}function et(i,l){if(1&i&&(t.j41(0,"nz-list-header"),t.DNE(1,nt,3,0,"div",23),t.k0s()),2&i){const e=l.ngIf;t.R7$(),t.Y8G("ngIf",e.hasPreviousPage)}}function ot(i,l){if(1&i&&(t.j41(0,"nz-list-item"),t.nrm(1,"cvc-comment-display",11),t.k0s()),2&i){const e=l.$implicit;t.R7$(),t.Y8G("comment",e)}}function it(i,l){if(1&i&&(t.j41(0,"nz-card",21)(1,"nz-list",22),t.nI1(2,"ngrxPush"),t.nI1(3,"ngrxPush"),t.DNE(4,et,2,1,"nz-list-header",4),t.nI1(5,"ngrxPush"),t.DNE(6,ot,2,1,"ng-template",null,1,t.C5r),t.k0s()()),2&i){const e=t.sdS(7),m=t.XpG(2);t.R7$(),t.Y8G("nzDataSource",t.bMT(2,4,m.comments$))("nzLoading",t.bMT(3,6,m.loading$))("nzRenderItem",e),t.R7$(3),t.Y8G("ngIf",t.bMT(5,8,m.pageInfo$))}}function at(i,l){if(1&i){const e=t.RV6();t.j41(0,"cvc-comment-add-form",26),t.bIt("commentAddedEvent",function(){t.eBV(e);const p=t.XpG(2);return t.Njj(p.refreshList())}),t.k0s()}if(2&i){const e=t.XpG(2);t.Y8G("subject",e.commentable)}}function mt(i,l){if(1&i&&t.nrm(0,"nz-avatar",29),2&i){const e=t.XpG().$implicit;t.Y8G("nzSrc",e.profileImagePath)}}function st(i,l){if(1&i&&(t.nrm(0,"nz-avatar",30),t.nI1(1,"uppercase")),2&i){const e=t.XpG().$implicit;t.Y8G("nzText",t.bMT(1,1,e.displayName.charAt(0)))}}function ct(i,l){if(1&i&&(t.DNE(0,mt,1,1,"nz-avatar",28)(1,st,2,3,"ng-template",null,3,t.C5r),t.j41(3,"span"),t.EFF(4),t.k0s()),2&i){const e=l.$implicit,m=t.sdS(2);t.Y8G("ngIf",e.profileImagePath)("ngIfElse",m),t.R7$(4),t.JRh(e.displayName)}}function rt(i,l){if(1&i){const e=t.RV6();t.j41(0,"cvc-participant-list",27),t.nI1(1,"ngrxPush"),t.bIt("participantSelectedEvent",function(p){t.eBV(e);const v=t.XpG(2);return t.Njj(v.onCommenterSelected(p))}),t.DNE(2,ct,5,3,"ng-template",null,2,t.C5r),t.k0s()}if(2&i){const e=t.XpG(2);t.Y8G("participantList",t.bMT(1,1,e.commenters$)||t.lJ4(3,U))}}function lt(i,l){if(1&i&&t.nrm(0,"nz-avatar",29),2&i){const e=t.XpG().$implicit;t.Y8G("nzSrc",e.profileImagePath)}}function pt(i,l){if(1&i&&(t.nrm(0,"nz-avatar",30),t.nI1(1,"uppercase")),2&i){const e=t.XpG().$implicit;t.Y8G("nzText",t.bMT(1,1,e.displayName.charAt(0)))}}function _t(i,l){if(1&i&&(t.DNE(0,lt,1,1,"nz-avatar",28)(1,pt,2,3,"ng-template",null,3,t.C5r),t.j41(3,"span"),t.EFF(4),t.k0s()),2&i){const e=l.$implicit,m=t.sdS(2);t.Y8G("ngIf",e.profileImagePath)("ngIfElse",m),t.R7$(4),t.JRh(e.displayName)}}function dt(i,l){if(1&i){const e=t.RV6();t.j41(0,"cvc-participant-list",31),t.nI1(1,"ngrxPush"),t.bIt("participantSelectedEvent",function(p){t.eBV(e);const v=t.XpG(2);return t.Njj(v.onMentionedUserSelected(p))}),t.DNE(2,_t,5,3,"ng-template",null,2,t.C5r),t.k0s()}if(2&i){const e=t.XpG(2);t.Y8G("participantList",t.bMT(1,1,e.mentionedUsers$)||t.lJ4(3,U))}}function gt(i,l){if(1&i&&(t.nrm(0,"nz-avatar",33),t.j41(1,"span"),t.EFF(2),t.k0s()),2&i){const e=l.$implicit;t.Mz_("nzIcon","civic-",e.tag.displayName,""),t.R7$(2),t.SpI("",e.tag.displayName,"s")}}function Ct(i,l){if(1&i){const e=t.RV6();t.j41(0,"cvc-participant-list",32),t.nI1(1,"ngrxPush"),t.bIt("participantSelectedEvent",function(p){t.eBV(e);const v=t.XpG(2);return t.Njj(v.onMentionedRoleSelected(p))}),t.DNE(2,gt,3,3,"ng-template",null,2,t.C5r),t.k0s()}if(2&i){const e=t.XpG(2);t.Y8G("participantList",t.bMT(1,1,e.mentionedRoles$)||t.lJ4(3,U))}}function vt(i,l){if(1&i&&(t.nrm(0,"i",35),t.nI1(1,"iconNameForSubscribableEntity"),t.j41(2,"span"),t.EFF(3),t.k0s()),2&i){const e=l.$implicit;t.Y8G("nzType",t.bMT(1,2,e.tag.tagType)),t.R7$(3),t.JRh(e.tag.displayName)}}function ut(i,l){if(1&i){const e=t.RV6();t.j41(0,"cvc-participant-list",34),t.nI1(1,"ngrxPush"),t.bIt("participantSelectedEvent",function(p){t.eBV(e);const v=t.XpG(2);return t.Njj(v.onMentionedEntitySelected(p))}),t.DNE(2,vt,4,4,"ng-template",null,2,t.C5r),t.k0s()}if(2&i){const e=t.XpG(2);t.Y8G("participantList",t.bMT(1,1,e.mentionedEntities$)||t.lJ4(3,U))}}function ft(i,l){1&i&&(t.qex(0),t.j41(1,"nz-row",6)(2,"nz-col",12)(3,"nz-space",8),t.DNE(4,it,8,10,"nz-card",13)(5,at,1,1,"cvc-comment-add-form",14),t.k0s()(),t.j41(6,"nz-col",15)(7,"nz-space",16),t.DNE(8,rt,4,4,"cvc-participant-list",17)(9,dt,4,4,"cvc-participant-list",18)(10,Ct,4,4,"cvc-participant-list",19)(11,ut,4,4,"cvc-participant-list",20),t.k0s()()(),t.bVm()),2&i&&(t.R7$(),t.Y8G("nzGutter",16))}function ht(i,l){if(1&i){const e=t.RV6();t.j41(0,"cvc-comment-add-form",26),t.bIt("commentAddedEvent",function(){t.eBV(e);const p=t.XpG();return t.Njj(p.refreshList())}),t.k0s()}if(2&i){const e=t.XpG();t.Y8G("subject",e.commentable)}}let zt=(()=>{class i{constructor(e){this.gql=e,this.pageSize=5}ngOnInit(){this.queryRef$=this.gql.watch({subject:this.commentable,last:this.pageSize,sortBy:{column:n.G_G.Created,direction:n.UEL.Asc}});let e=this.queryRef$.valueChanges;this.pageInfo$=e.pipe((0,u.T)(({data:m})=>m.comments.pageInfo)),this.loading$=e.pipe((0,u.T)(({loading:m})=>m)),this.comments$=e.pipe((0,u.T)(({data:m})=>m.comments.edges.map(p=>p.node))),this.commenters$=e.pipe((0,u.T)(({data:m})=>m.comments.uniqueCommenters)),this.mentionedUsers$=e.pipe((0,u.T)(({data:m})=>m.comments.mentionedUsers)),this.mentionedRoles$=e.pipe((0,u.T)(({data:m})=>m.comments.mentionedRoles.map(p=>({id:`${p.entityId}-${p.tagType}`,tag:p})))),this.mentionedEntities$=e.pipe((0,u.T)(({data:m})=>m.comments.mentionedEntities.map(p=>({id:`${p.entityId}-${p.tagType}`,tag:p})))),this.unfilteredCount$=e.pipe((0,g.E)("data","comments","unfilteredCountForSubject"))}onLoadMore(e){this.queryRef$.fetchMore({variables:{last:this.pageSize,before:e}})}onCommenterSelected(e){this.queryRef$.refetch({originatingUserId:e?.id})}onMentionedUserSelected(e){this.queryRef$.refetch({mentionedUserId:e?.id})}onMentionedRoleSelected(e){if(e){let m=n.gG1[e.tag.displayName[0].toUpperCase()+e.tag.displayName.slice(1)];this.queryRef$.refetch({mentionedRole:m})}else this.queryRef$.refetch({mentionedRole:void 0})}onMentionedEntitySelected(e){this.queryRef$.refetch(e?{mentionedEntity:{entityType:e.tag.tagType,id:e.tag.entityId}}:{mentionedEntity:void 0})}refreshList(){this.queryRef$.refetch()}static#t=this.\u0275fac=function(m){return new(m||i)(t.rXU(n.y5X))};static#n=this.\u0275cmp=t.VBU({type:i,selectors:[["cvc-comment-list"]],inputs:{commentable:"commentable",creationComment:"creationComment"},decls:5,vars:5,consts:[["noComments",""],["comment",""],["itemTemplate",""],["noAvatar",""],[4,"ngIf"],[4,"ngIf","ngIfElse"],[3,"nzGutter"],["nzSpan","24"],["nzDirection","vertical",2,"width","100%"],["nzTitle","Submission Comment",4,"nzSpaceItem"],["nzTitle","Submission Comment"],[3,"comment"],["nzSpan","18"],["nzTitle","Comments",4,"nzSpaceItem"],["id","addComment",3,"subject","commentAddedEvent",4,"nzSpaceItem"],["nzSpan","6"],["nzDirection","vertical"],["listTitle","Commenters",3,"participantList","participantSelectedEvent",4,"nzSpaceItem"],["listTitle","Mentioned Users",3,"participantList","participantSelectedEvent",4,"nzSpaceItem"],["listTitle","Mentioned Roles",3,"participantList","participantSelectedEvent",4,"nzSpaceItem"],["listTitle","Mentioned Entities",3,"participantList","participantSelectedEvent",4,"nzSpaceItem"],["nzTitle","Comments"],["nzSize","small","nzItemLayout","horizontal",3,"nzDataSource","nzLoading","nzRenderItem"],["nz-list-load-more","",4,"ngIf"],["nz-list-load-more",""],["nz-button","","nzType","link","nzSize","small","nzBlock","",3,"click"],["id","addComment",3,"commentAddedEvent","subject"],["listTitle","Commenters",3,"participantSelectedEvent","participantList"],["nz-comment-avatar","",3,"nzSrc",4,"ngIf","ngIfElse"],["nz-comment-avatar","",3,"nzSrc"],["nz-comment-avatar","",3,"nzText"],["listTitle","Mentioned Users",3,"participantSelectedEvent","participantList"],["listTitle","Mentioned Roles",3,"participantSelectedEvent","participantList"],[3,"nzIcon"],["listTitle","Mentioned Entities",3,"participantSelectedEvent","participantList"],["nz-icon","",3,"nzType"]],template:function(m,p){if(1&m&&(t.DNE(0,tt,5,1,"ng-container",4)(1,ft,12,1,"ng-container",5),t.nI1(2,"ngrxPush"),t.DNE(3,ht,1,1,"ng-template",null,0,t.C5r)),2&m){const v=t.sdS(4);t.Y8G("ngIf",p.creationComment),t.R7$(),t.Y8G("ngIf",t.bMT(2,3,p.unfilteredCount$))("ngIfElse",v)}},dependencies:[h.bT,x.aO,$.c,T.Uq,T.e,y.cK,E.eE,E.Xo,E.lQ,G.Dn,I.PM,f.U5,f.Dq,R,C.T,Z,h.Pc,w.L9,k.g],styles:["[_nghost-%COMP%]{display:block}nz-list-header[_ngcontent-%COMP%]{padding:0;margin:0}nz-list-header[_ngcontent-%COMP%]   [nz-list-load-more][_ngcontent-%COMP%]{margin-top:-.5em;padding-bottom:.5em}"]})}return i})()},4873:(V,N,o)=>{o.d(N,{A:()=>R});var n=o(177),u=o(7529),g=o(5703),t=o(2617),h=o(9438),x=o(7685),$=o(1912),T=o(2968),y=o(6864),E=o(7169),G=o(4917),I=o(7391),f=o(3953);let S=(()=>{class C{static#t=this.\u0275fac=function(B){return new(B||C)};static#n=this.\u0275mod=f.$C({type:C});static#e=this.\u0275inj=f.G2t({imports:[n.MD,y.sC,h.Yb,I.kT,E.W,G.i]})}return C})();var A=o(9417),z=o(8524),P=o(8927),L=o(4308),M=o(3842),O=o(8492),D=o(5128),j=o(3617),F=o(513),d=o(3069),s=o(2983),r=o(9541),a=o(5154);let c=(()=>{class C{static#t=this.\u0275fac=function(B){return new(B||C)};static#n=this.\u0275mod=f.$C({type:C});static#e=this.\u0275inj=f.G2t({imports:[n.MD,A.X1,F.Zw,g.Ti,r.hM,P.PQ,s.V,d.$f,j.$,a.Qt,A.YN,z.qy,O.M,M.k,E.W,D.K,L.I]})}return C})();var _=o(5103);let R=(()=>{class C{static#t=this.\u0275fac=function(B){return new(B||C)};static#n=this.\u0275mod=f.$C({type:C});static#e=this.\u0275inj=f.G2t({imports:[n.MD,F.Zw,u.f3,g.Ti,t.rD,_.Y3,G.i,h.Yb,x.pc,$.i3,c,T.K,S]})}return C})()},5566:(V,N,o)=>{o.d(N,{K:()=>F});var n=o(3953),u=o(1413),g=o(9145),t=o(5964),h=o(6977),x=o(6354),$=o(9172),T=o(4608),y=o(9199),E=o(1305),G=o(177),I=o(9417),f=o(1774),S=o(9541),A=o(2983),z=o(3069),P=o(4126);const L=()=>["#","@","$"];function M(d,s){if(1&d&&(n.qex(0),n.j41(1,"span"),n.EFF(2),n.k0s(),n.bVm()),2&d){const r=s.$implicit;n.R7$(2),n.JRh(r.displayName)}}function O(d,s){1&d&&(n.qex(0),n.nrm(1,"nz-spin",8),n.bVm())}function D(d,s){if(1&d&&(n.qex(0),n.nrm(1,"cvc-comment-body",9),n.bVm()),2&d){const r=s.ngIf;n.R7$(),n.Y8G("commentBodySegments",r)}}function j(d,s){if(1&d){const r=n.RV6();n.qex(0),n.j41(1,"nz-tabset",1)(2,"nz-tab",2)(3,"nz-mention",3),n.bIt("nzOnSearchChange",function(c){n.eBV(r);const _=n.XpG();return n.Njj(_.onSearchChange(c))})("nzOnSelect",function(){n.eBV(r);const c=n.XpG();return n.Njj(c.suggestions=[])}),n.j41(4,"textarea",4),n.mxI("ngModelChange",function(c){n.eBV(r);const _=n.XpG();return n.DH7(_.commentText,c)||(_.commentText=c),n.Njj(c)}),n.bIt("ngModelChange",function(c){n.eBV(r);const _=n.XpG();return n.Njj(_.onCommentChanged(c))}),n.k0s(),n.DNE(5,M,3,1,"ng-container",5),n.k0s()(),n.j41(6,"nz-tab",6),n.bIt("nzClick",function(){n.eBV(r);const c=n.XpG();return n.Njj(c.onPreviewButtonClicked())}),n.DNE(7,O,2,0,"ng-container",7),n.nI1(8,"ngrxPush"),n.DNE(9,D,2,1,"ng-container",7),n.nI1(10,"ngrxPush"),n.k0s()(),n.bVm()}if(2&d){const r=s.ngrxLet,a=n.XpG();n.R7$(),n.Y8G("nzAnimated",!1),n.R7$(2),n.Y8G("nzSuggestions",a.suggestions)("nzPrefix",n.lJ4(13,L))("nzValueWith",a.autoCompleteValueFor),n.R7$(),n.Y8G("placeholder",r&&r.canCurate?"Enter comment (minimum length 10. Use @ to mention users; # to link entities)":"Please sign in"),n.R50("ngModel",a.commentText),n.BMQ("disabled",!r||!r.canCurate||null),n.R7$(3),n.Y8G("ngIf",n.bMT(8,9,a.previewLoading$)),n.R7$(2),n.Y8G("ngIf",n.bMT(10,11,a.previewComment$))}}let F=(()=>{class d{constructor(r,a,c,_){this.previewCommentGql=r,this.userTypeaheadGql=a,this.entityTypeaheadGql=c,this.viewerService=_,this.commentChange=new n.bkB,this.destroy$=new u.B,this.suggestions=[],this.roleSuggestions=[{displayName:"admins",value:"admins"},{displayName:"editors",value:"editors"}]}ngOnInit(){this.viewer$=this.viewerService.viewer$,this.commentText=this.comment,this.userTypeaheadQueryRef$=this.userTypeaheadGql.watch({queryTerm:""}),this.userTypeaheadQueryRef$.valueChanges.pipe((0,T.E)("data","userTypeahead"),(0,t.p)(y.kP),(0,h.Q)(this.destroy$)).subscribe(r=>this.suggestions=r.map(a=>({displayName:a.username,value:a.username}))),this.entityTypeaheadQueryRef$=this.entityTypeaheadGql.watch({queryTerm:""}),this.entityTypeaheadQueryRef$.valueChanges.pipe((0,T.E)("data","entityTypeahead"),(0,t.p)(y.kP),(0,h.Q)(this.destroy$)).subscribe(r=>this.suggestions=r.map(a=>({displayName:a.displayName,value:this.tagForEntityTypeAndId(a.tagType,a.entityId)})))}ngOnChanges(){this.commentText=this.comment}autoCompleteValueFor(r){return r.value}tagForEntityTypeAndId(r,a){switch(r){case g.lBA.Feature:return`FID${a}`;case g.lBA.Variant:return`VID${a}`;case g.lBA.VariantGroup:return`VGID${a}`;case g.lBA.EvidenceItem:return`EID${a}`;case g.lBA.Assertion:return`AID${a}`;case g.lBA.Revision:return`RID${a}`;case g.lBA.MolecularProfile:return`MPID${a}`;case g.lBA.Role:return Object.keys(g.gG1)[a]}}resetForm(){this.commentText=""}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}onPreviewButtonClicked(){this.commentText&&(this.previewComment$=this.previewCommentGql.watch({commentText:this.commentText}).valueChanges.pipe((0,T.E)("data","previewCommentText"),(0,t.p)(y.kP)),this.previewLoading$=this.previewCommentGql.watch({commentText:this.commentText}).valueChanges.pipe((0,x.T)(({loading:r})=>r),(0,$.Z)(!0)))}onSearchChange({value:r,prefix:a}){"@"===a?this.userTypeaheadQueryRef$.refetch({queryTerm:r}):"$"==a?this.suggestions=this.roleSuggestions.filter(c=>c.value.startsWith(r)):this.entityTypeaheadQueryRef$.refetch({queryTerm:r})}onCommentChanged(r){this.commentChange.emit(r)}static#t=this.\u0275fac=function(a){return new(a||d)(n.rXU(g.WGp),n.rXU(g.bPL),n.rXU(g.paL),n.rXU(E.q))};static#n=this.\u0275cmp=n.VBU({type:d,selectors:[["cvc-comment-input-form"]],inputs:{comment:"comment"},outputs:{commentChange:"commentChange"},features:[n.OA$],decls:1,vars:1,consts:[[4,"ngrxLet"],[3,"nzAnimated"],["nzTitle","Write"],["nzNotFoundContent","No matches...",3,"nzOnSearchChange","nzOnSelect","nzSuggestions","nzPrefix","nzValueWith"],["nzMentionTrigger","","nz-input","","rows","4",2,"width","100%",3,"ngModelChange","placeholder","ngModel"],[4,"nzMentionSuggestion"],["nzTitle","Preview",3,"nzClick"],[4,"ngIf"],["nzTip","Loading..."],[3,"commentBodySegments"]],template:function(a,c){1&a&&n.DNE(0,j,11,14,"ng-container",0),2&a&&n.Y8G("ngrxLet",c.viewer$)},dependencies:[G.bT,I.me,I.BC,f.Nj,S.JZ,S.rE,A.a,z.O2,z.sJ,z.yZ,I.vS,P.p,f.L9],styles:[":host{display:block}nz-space{width:100%}nz-form-item:last-of-type{margin-bottom:0}\n"],encapsulation:2})}return d})()},6864:(V,N,o)=>{o.d(N,{OW:()=>M,fL:()=>j,sC:()=>d,sf:()=>L});var n=o(3953),u=o(6939),g=o(1413),t=o(6977),h=o(7806),x=o(8203);const $=["*"];function T(s,r){1&s&&n.SdG(0)}const y=[[["nz-avatar","nz-comment-avatar",""]],[["nz-comment-content"]],"*"],E=["nz-avatar[nz-comment-avatar]","nz-comment-content","*"];function G(s,r){if(1&s&&(n.qex(0),n.EFF(1),n.bVm()),2&s){const a=n.XpG(2);n.R7$(),n.JRh(a.nzAuthor)}}function I(s,r){if(1&s&&(n.j41(0,"span",4),n.DNE(1,G,2,1,"ng-container",8),n.k0s()),2&s){const a=n.XpG();n.R7$(),n.Y8G("nzStringTemplateOutlet",a.nzAuthor)}}function f(s,r){if(1&s&&(n.qex(0),n.EFF(1),n.bVm()),2&s){const a=n.XpG(2);n.R7$(),n.JRh(a.nzDatetime)}}function S(s,r){if(1&s&&(n.j41(0,"span",5),n.DNE(1,f,2,1,"ng-container",8),n.k0s()),2&s){const a=n.XpG();n.R7$(),n.Y8G("nzStringTemplateOutlet",a.nzDatetime)}}function A(s,r){}function z(s,r){if(1&s&&(n.j41(0,"li")(1,"span"),n.DNE(2,A,0,0,"ng-template",9),n.k0s()()),2&s){const a=r.$implicit;n.R7$(2),n.Y8G("nzCommentActionHost",a.content)}}function P(s,r){if(1&s&&(n.j41(0,"ul",6),n.Z7z(1,z,3,1,"li",null,n.fX1),n.k0s()),2&s){const a=n.XpG();n.R7$(),n.Dyx(a.actions)}}let L=(()=>{class s{static#t=this.\u0275fac=function(c){return new(c||s)};static#n=this.\u0275dir=n.FsC({type:s,selectors:[["nz-avatar","nz-comment-avatar",""]],exportAs:["nzCommentAvatar"],standalone:!0})}return s})(),M=(()=>{class s{static#t=this.\u0275fac=function(c){return new(c||s)};static#n=this.\u0275dir=n.FsC({type:s,selectors:[["nz-comment-content"],["","nz-comment-content",""]],hostAttrs:[1,"ant-comment-content-detail"],exportAs:["nzCommentContent"],standalone:!0})}return s})(),O=(()=>{class s extends u.I3{constructor(a,c){super(a,c)}ngOnInit(){super.ngOnInit()}ngOnDestroy(){super.ngOnDestroy()}ngAfterViewInit(){this.attach(this.nzCommentActionHost)}static#t=this.\u0275fac=function(c){return new(c||s)(n.rXU(n.OM3),n.rXU(n.c1b))};static#n=this.\u0275dir=n.FsC({type:s,selectors:[["","nzCommentActionHost",""]],inputs:{nzCommentActionHost:"nzCommentActionHost"},exportAs:["nzCommentActionHost"],standalone:!0,features:[n.Vt3]})}return s})(),D=(()=>{class s{get content(){return this.contentPortal}constructor(a){this.viewContainerRef=a,this.contentPortal=null}ngOnInit(){this.contentPortal=new u.VA(this.implicitContent,this.viewContainerRef)}static#t=this.\u0275fac=function(c){return new(c||s)(n.rXU(n.c1b))};static#n=this.\u0275cmp=n.VBU({type:s,selectors:[["nz-comment-action"]],viewQuery:function(c,_){if(1&c&&n.GBs(n.C4Q,7),2&c){let R;n.mGM(R=n.lsd())&&(_.implicitContent=R.first)}},exportAs:["nzCommentAction"],standalone:!0,features:[n.aNF],ngContentSelectors:$,decls:1,vars:0,template:function(c,_){1&c&&(n.NAR(),n.DNE(0,T,1,0,"ng-template"))},encapsulation:2,changeDetection:0})}return s})(),j=(()=>{class s{constructor(a,c){this.cdr=a,this.directionality=c,this.dir="ltr",this.destroy$=new g.B}ngOnInit(){this.directionality.change?.pipe((0,t.Q)(this.destroy$)).subscribe(a=>{this.dir=a,this.cdr.detectChanges()}),this.dir=this.directionality.value}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static#t=this.\u0275fac=function(c){return new(c||s)(n.rXU(n.gRc),n.rXU(x.dS,8))};static#n=this.\u0275cmp=n.VBU({type:s,selectors:[["nz-comment"]],contentQueries:function(c,_,R){if(1&c&&n.wni(R,D,4),2&c){let C;n.mGM(C=n.lsd())&&(_.actions=C)}},hostVars:4,hostBindings:function(c,_){2&c&&n.AVh("ant-comment",!0)("ant-comment-rtl","rtl"===_.dir)},inputs:{nzAuthor:"nzAuthor",nzDatetime:"nzDatetime"},exportAs:["nzComment"],standalone:!0,features:[n.aNF],ngContentSelectors:E,decls:11,vars:3,consts:[[1,"ant-comment-inner"],[1,"ant-comment-avatar"],[1,"ant-comment-content"],[1,"ant-comment-content-author"],[1,"ant-comment-content-author-name"],[1,"ant-comment-content-author-time"],[1,"ant-comment-actions"],[1,"ant-comment-nested"],[4,"nzStringTemplateOutlet"],[3,"nzCommentActionHost"]],template:function(c,_){1&c&&(n.NAR(y),n.j41(0,"div",0)(1,"div",1),n.SdG(2),n.k0s(),n.j41(3,"div",2)(4,"div",3),n.DNE(5,I,2,1,"span",4)(6,S,2,1,"span",5),n.k0s(),n.SdG(7,1),n.DNE(8,P,3,0,"ul",6),n.k0s()(),n.j41(9,"div",7),n.SdG(10,2),n.k0s()),2&c&&(n.R7$(5),n.vxM(_.nzAuthor?5:-1),n.R7$(),n.vxM(_.nzDatetime?6:-1),n.R7$(2),n.vxM(null!=_.actions&&_.actions.length?8:-1))},dependencies:[h.C,h.m,O],encapsulation:2,changeDetection:0})}return s})(),d=(()=>{class s{static#t=this.\u0275fac=function(c){return new(c||s)};static#n=this.\u0275mod=n.$C({type:s});static#e=this.\u0275inj=n.G2t({imports:[j]})}return s})()}}]);