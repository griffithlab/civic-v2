"use strict";(self.webpackChunkmain=self.webpackChunkmain||[]).push([[7559],{7559:(It,w,r)=>{r.r(w),r.d(w,{EvidenceAddModule:()=>bt});var s=r(9808),u=r(325),L=r(4850),e=r(5e3),Y=r(9350),$=r(8992),_=r(1945),Q=r(647),g=r(1894),B=r(8616),v=r(6949);function V(n,o){1&n&&(e.TgZ(0,"div"),e._UZ(1,"router-outlet"),e.qZA())}function G(n,o){1&n&&(e.TgZ(0,"nz-row",7),e.TgZ(1,"div",8),e._UZ(2,"cvc-login-prompt"),e.qZA(),e.qZA())}let D=(()=>{class n{constructor(t){this.viewerService=t}ngOnInit(){this.isSignedIn$=this.viewerService.viewer$.pipe((0,L.U)(t=>t.signedIn))}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(Y.a))},n.\u0275cmp=e.Xpm({type:n,selectors:[["evidence-add"]],decls:13,vars:4,consts:[["displayName","New"],[1,"site-page-header"],["cvcFlaggableOptions",""],["nz-icon","","nzType","civic:evidence"],[1,"content"],[4,"ngIf","ngIfElse"],["notSignedIn",""],["nzSpan","24","nzJustify","center"],["nz-col","","nzSpan","6"]],template:function(t,i){if(1&t&&(e._UZ(0,"cvc-section-navigation",0),e.TgZ(1,"nz-page-header",1),e.TgZ(2,"nz-page-header-title",2),e._UZ(3,"i",3),e._uU(4," Add New Evidence "),e.qZA(),e.TgZ(5,"nz-page-header-subtitle"),e._uU(6," Submit and review new evidence items "),e.qZA(),e.TgZ(7,"nz-page-header-content"),e.TgZ(8,"div",4),e.YNc(9,V,2,0,"div",5),e.ALo(10,"ngrxPush"),e.YNc(11,G,3,0,"ng-template",null,6,e.W1O),e.qZA(),e.qZA(),e.qZA()),2&t){const a=e.MAs(12);e.xp6(9),e.Q6J("ngIf",e.lcZ(10,2,i.isSignedIn$))("ngIfElse",a)}},directives:[$.I,_.$O,_.u9,Q.Ls,_.yG,_.u5,s.O5,u.lC,g.SK,g.t3,B.u],pipes:[v.fM],styles:["[_nghost-%COMP%]{display:block}[_nghost-%COMP%]     nz-page-header:first-of-type{background-color:#fff;border-radius:8px}[_nghost-%COMP%]     nz-page-header:first-of-type .header-content{background-color:#f0f0f0;border-top-left-radius:8px;border-top-right-radius:8px;margin:-12px -16px 16px;border-bottom:1px solid #bfbfbf}[_nghost-%COMP%]     nz-page-header:first-of-type .header-content .header-icon{padding:12px 0 12px 12px}[_nghost-%COMP%]     nz-page-header:first-of-type .header-content .header-icon i{width:100%}[_nghost-%COMP%]     nz-page-header:first-of-type .header-content .header-icon i   svg{width:100%;height:100%}[_nghost-%COMP%]     nz-page-header:first-of-type .header-content .header-description{padding:12px}[_nghost-%COMP%]     nz-page-header:first-of-type .header-content .header-description h2{color:#262626;margin:-8px 0 0;font-weight:500}[_nghost-%COMP%]     nz-page-header:first-of-type .header-content .header-description p{color:#262626;margin:-2px 0 0;padding:0;font-size:95%;line-height:1.5em}[_nghost-%COMP%]     nz-page-header:first-of-type .header-content .header-links{text-align:right;padding:12px}[_nghost-%COMP%]     nz-page-header:first-of-type .card-list nz-card{width:100%}[_nghost-%COMP%]     nz-page-header:first-of-type .card-list nz-card .card-grid-cell{width:50%}[_nghost-%COMP%]     nz-page-header:first-of-type nz-page-header-title.flagged{padding-left:.75em}[_nghost-%COMP%]     nz-page-header:first-of-type .ant-page-header-content{padding-top:0;padding-bottom:12px}[_nghost-%COMP%]     nz-page-header:first-of-type .ant-page-header-heading-extra nz-space-item:last-child{margin-right:0!important}[_nghost-%COMP%]     nz-page-header:first-of-type #section-tabs{margin:0 -16px 12px}[_nghost-%COMP%]     nz-page-header:first-of-type #section-tabs .ant-tabs-nav-wrap{padding-left:16px;padding-right:16px;line-height:24px}[_nghost-%COMP%]     nz-page-header:first-of-type #section-tabs .ant-tabs-nav-wrap .ant-tabs-tab{padding:1px 8px}[_nghost-%COMP%]     nz-page-header:first-of-type #section-tabs .ant-tabs-nav-wrap .ant-tabs-tab .anticon{margin-right:0}[_nghost-%COMP%]     nz-page-header:first-of-type #section-tabs .ant-tabs-extra-content{margin-right:16px}"]}),n})();var p=r(8144),k=r(6559),S=r(7484),R=r(1135),j=r(4623),X=r(8006),H=r(5452),W=r(3643),K=r(4375),F=r(7008),q=r(7695),ee=r(8390),te=r(1825),ne=r(5457),ie=r(5743),oe=r(3773),re=r(7075),ae=r(7462),ce=r(3594),J=r(8929),T=r(591),x=r(7625),b=r(537),d=r(712),P=r(9169);let se=(()=>{class n{constructor(t,i){this.submitEvidenceItemGQL=t,this.networkErrorService=i,this.destroy$=new J.xQ,this.isSubmitting$=new T.X(!1),this.submitSuccess$=new T.X(!1),this.submitError$=new T.X([])}submit(t){this.isSubmitting$.next(!0),this.submitEvidenceItemGQL.mutate({input:t}).pipe((0,x.R)(this.destroy$),(0,b.x)(()=>{this.isSubmitting$.next(!1)})).subscribe({error:i=>{i.graphQLErrors.length>0?this.submitError$.next(i.graphQLErrors.map(a=>a.message)):i.networkError&&this.networkErrorService.networkError$.next(i.networkError)},complete:()=>{this.submitError$.next([]),this.submitSuccess$.next(!0),this.networkErrorService.networkError$.next(void 0)}})}cleanup(){this.submitError$.next([]),this.submitSuccess$.next(!1),this.isSubmitting$.next(!1),this.networkErrorService.networkError$.next(void 0)}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(d.WFw),e.LFG(P.Y))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac}),n})();var m=r(8776),I=r(5109),C=r(2359),E=r(6042),y=r(4546),l=r(4182),de=r(2789),le=r(5932),ue=r(3416),pe=r(2480),me=r(1830),ge=r(4581),fe=r(1605),he=r(5926),_e=r(1270),U=r(7525),ve=r(6530),O=r(444),ye=r(6906);function xe(n,o){if(1&n&&(e.ynx(0),e._UZ(1,"formly-field",2),e.BQk()),2&n){const t=o.$implicit;e.xp6(1),e.Q6J("field",t)}}function Ce(n,o){if(1&n&&e._UZ(0,"cvc-source-tag",3),2&n){const t=e.oxw();e.Q6J("source",t.model.source)}}let ze=(()=>{class n extends m.fS{constructor(){super(),this.defaultOptions={templateOptions:{label:"Source",entityType:"Source",entityFragment:d.iXf},defaultValue:{sourceType:d.yic.Pubmed,source:void 0},fieldGroupClassName:"select-group",fieldGroup:[{key:"sourceType",type:"select",className:"type-field",templateOptions:{required:!1,placeholder:"Select Type",options:(0,O.o6)(d.yic).map((t,i)=>({value:t,label:(0,ve.c)(t)}))},hideExpression:(t,i,a)=>(console.log(t),null!=t.source)},{key:"source",type:"citation-select",className:"citation-field",templateOptions:{required:!1},hideExpression:(t,i,a)=>(console.log(t),null!=t.source)}]}}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=e.Xpm({type:n,selectors:[["cvc-source-select"]],features:[e.qOj],decls:2,vars:2,consts:[[4,"ngFor","ngForOf"],[3,"source",4,"ngIf"],[3,"field"],[3,"source"]],template:function(t,i){1&t&&(e.YNc(0,xe,2,1,"ng-container",0),e.YNc(1,Ce,1,1,"cvc-source-tag",1)),2&t&&(e.Q6J("ngForOf",i.field.fieldGroup),e.xp6(1),e.Q6J("ngIf",null!=i.model.source))},directives:[s.sg,m.cw,s.O5,ye.T],styles:["[_nghost-%COMP%]{display:block}.type-field[_ngcontent-%COMP%]{display:inline-block;width:10em}.citation-field[_ngcontent-%COMP%]{display:inline-block;margin-left:.5em;width:calc(100% - 10.5em)}.hidden[_ngcontent-%COMP%]{display:none}"]}),n})();var z=r(8054),M=r(3618),Se=r(8481),Te=r(373),N=r(822),be=r(2643),Ie=r(2683);function Ee(n,o){if(1&n&&e._UZ(0,"nz-alert",6),2&n){e.oxw();const t=e.MAs(3);e.Q6J("nzMessage",t)}}function Oe(n,o){if(1&n&&(e._uU(0," Found citation: "),e.TgZ(1,"em"),e._uU(2),e.qZA(),e._uU(3,", would you like to add it? ")),2&n){const t=e.oxw(3);e.xp6(2),e.Oqu(t.foundCitation)}}function Me(n,o){1&n&&(e.ynx(0),e.YNc(1,Ee,1,1,"nz-alert",4),e.YNc(2,Oe,4,1,"ng-template",null,5,e.W1O),e.BQk())}function Ae(n,o){if(1&n&&e._UZ(0,"nz-alert",9),2&n){e.oxw();const t=e.MAs(3);e.Q6J("nzMessage",t)}}function Ze(n,o){if(1&n&&(e._uU(0," '"),e.TgZ(1,"em"),e._uU(2),e.qZA(),e._uU(3,"' created. ")),2&n){const t=e.oxw(3);e.xp6(2),e.Oqu(t.foundCitation)}}function we(n,o){1&n&&(e.ynx(0),e.YNc(1,Ae,1,1,"nz-alert",7),e.YNc(2,Ze,4,1,"ng-template",null,8,e.W1O),e.BQk())}function Le(n,o){if(1&n&&(e.TgZ(0,"nz-form-item"),e._UZ(1,"cvc-form-errors-alert",10),e.qZA()),2&n){const t=e.oxw(2);e.xp6(1),e.Q6J("errors",t.createErrors)}}function Qe(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"button",12),e.NdJ("click",function(a){return e.CHM(t),e.oxw(3).onAddRemoteCitation(a)}),e._uU(1," Add\xa0'"),e.TgZ(2,"em"),e._uU(3),e.qZA(),e._uU(4,"'\xa0 to CIViC Sources "),e.qZA()}if(2&n){const t=e.oxw(3);e.Q6J("nzLoading",t.isCreating),e.xp6(3),e.Oqu(t.foundCitation)}}function Fe(n,o){1&n&&(e.ynx(0),e.YNc(1,Qe,5,2,"button",11),e.BQk())}function Je(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"button",14),e.NdJ("click",function(a){return e.CHM(t),e.oxw(3).onAcceptSource(a)}),e._uU(1," Specify this Source "),e.qZA()}}function Pe(n,o){1&n&&(e.ynx(0),e.YNc(1,Je,2,0,"button",13),e.BQk())}function Ue(n,o){if(1&n&&(e.ynx(0),e.TgZ(1,"nz-space",2),e.YNc(2,Me,4,0,"ng-container",3),e.YNc(3,we,4,0,"ng-container",3),e.YNc(4,Le,2,1,"nz-form-item",3),e.YNc(5,Fe,2,0,"ng-container",3),e.YNc(6,Pe,2,0,"ng-container",3),e.qZA(),e.BQk()),2&n){const t=e.oxw();e.xp6(2),e.Q6J("ngIf",!1===t.createSuccess&&0===t.createErrors.length),e.xp6(1),e.Q6J("ngIf",!0===t.createSuccess),e.xp6(1),e.Q6J("ngIf",t.createErrors.length>0),e.xp6(1),e.Q6J("ngIf",!1===t.createSuccess),e.xp6(1),e.Q6J("ngIf",!0===t.createSuccess)}}function Ne(n,o){if(1&n&&(e.TgZ(0,"span",16),e._UZ(1,"i",17),e._uU(2),e.qZA()),2&n){const t=e.oxw(3);e.xp6(2),e.hij(" Source not known to CIViC, fetch citation from ",t.sourceTypeKey,"? ")}}function Ye(n,o){1&n&&(e.ynx(0),e.YNc(1,Ne,3,1,"span",15),e.BQk())}function $e(n,o){if(1&n&&(e.TgZ(0,"nz-form-item"),e._UZ(1,"cvc-form-errors-alert",10),e.qZA()),2&n){const t=e.oxw(2);e.xp6(1),e.Q6J("errors",t.existenceErrors)}}function Be(n,o){if(1&n&&e._uU(0),2&n){const t=e.oxw(4);e.AsE(" Citation not found for ",t.sourceTypeKey,": ",t.citationId,". ")}}function Ve(n,o){if(1&n&&(e.TgZ(0,"span"),e._UZ(1,"nz-alert",19),e.YNc(2,Be,1,2,"ng-template",null,20,e.W1O),e.qZA()),2&n){const t=e.MAs(3);e.xp6(1),e.Q6J("nzMessage",t)}}function Ge(n,o){1&n&&(e.ynx(0),e.YNc(1,Ve,4,1,"span",18),e.BQk())}function De(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"button",12),e.NdJ("click",function(a){return e.CHM(t),e.oxw(2).onExistenceQuery(a)}),e._uU(1," Fetch Citation for\xa0"),e.TgZ(2,"strong"),e._uU(3),e.qZA(),e.qZA()}if(2&n){const t=e.oxw(2);e.Q6J("nzLoading",t.isChecking),e.xp6(3),e.AsE("",t.sourceTypeKey," ",t.citationId,"")}}function ke(n,o){if(1&n&&(e.TgZ(0,"nz-space",2),e.YNc(1,Ye,2,0,"ng-container",3),e.YNc(2,$e,2,1,"nz-form-item",3),e.YNc(3,Ge,2,0,"ng-container",3),e.YNc(4,De,4,3,"button",11),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.showPrompt),e.xp6(1),e.Q6J("ngIf",t.existenceErrors.length>0),e.xp6(1),e.Q6J("ngIf",t.existenceFail)}}let Re=(()=>{class n{constructor(t,i,a){this.existenceCheckQuery=t,this.createSourceStubQuery=i,this.changeDetectorRef=a,this.addCitation=new e.vpe,this.citationIdChange=new e.vpe,this.sourceTypeChange=new e.vpe,this.showPrompt=!0,this.isChecking=!1,this.existenceFail=!1,this.existenceErrors=[],this.foundCitation=void 0,this.isCreating=!1,this.createSuccess=!1,this.createErrors=[]}set sourceType(t){this._sourceType=t,this.sourceTypeKey=(0,O.o6)(d.yic).getKeyOrThrow(t)}get sourceType(){return this._sourceType}onExistenceQuery(t){t&&t.preventDefault(),this.isChecking=!0,this.foundCitation=void 0,this.existenceCheckQuery.fetch({sourceType:this.sourceType,citationId:+this.citationId}).pipe((0,b.x)(()=>{this.isChecking=!1,this.changeDetectorRef.detectChanges()})).subscribe({next:({data:{remoteCitation:i}})=>{null!==i?this.foundCitation=i:(this.showPrompt=!1,this.existenceFail=!0)},error:i=>{this.showPrompt=!1,this.existenceErrors=i.graphQLErrors.map(a=>a.message)},complete:()=>{this.existenceErrors=[]}})}onAddRemoteCitation(t){t&&t.preventDefault(),this.isCreating=!0,this.createSuccess=!1,this.createSourceStubQuery.mutate({input:{citationId:+this.citationId,sourceType:this.sourceType}}).pipe((0,b.x)(()=>{this.isCreating=!1,this.changeDetectorRef.detectChanges()})).subscribe({next:({data:i})=>{var a;console.log(i);const c=null===(a=null==i?void 0:i.addRemoteCitation)||void 0===a?void 0:a.newSource;this.sourceStub=c,this.createSuccess=!0},error:i=>{this.showPrompt=!1,this.createSuccess=!1,this.createErrors=i.graphQLErrors.map(a=>a.message)},complete:()=>{this.createErrors=[]}})}onAcceptSource(t){t&&t.preventDefault(),this.addCitation.emit({id:this.sourceStub.id,entityFragment:d.SJD})}ngAfterContentInit(){console.log("model")}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(d.gtM),e.Y36(d.RMv),e.Y36(e.sBO))},n.\u0275cmp=e.Xpm({type:n,selectors:[["cvc-citation-loader"]],inputs:{model:"model",citationId:"citationId",sourceType:"sourceType"},outputs:{addCitation:"addCitation",citationIdChange:"citationIdChange",sourceTypeChange:"sourceTypeChange"},decls:3,vars:2,consts:[[4,"ngIf","ngIfElse"],["fetchCitation",""],["nzDirection","vertical"],[4,"ngIf"],["nzType","info","nzShowIcon","",3,"nzMessage",4,"nzSpaceItem"],["foundCitationMsg",""],["nzType","info","nzShowIcon","",3,"nzMessage"],["nzType","success","nzShowIcon","",3,"nzMessage",4,"nzSpaceItem"],["createdMsg",""],["nzType","success","nzShowIcon","",3,"nzMessage"],[3,"errors"],["type","submit","nz-button","","nzBlock","","nzType","primary","nzSize","default",3,"nzLoading","click",4,"nzSpaceItem"],["type","submit","nz-button","","nzBlock","","nzType","primary","nzSize","default",3,"nzLoading","click"],["type","submit","nz-button","","nzBlock","","nzType","primary","nzSize","default",3,"click",4,"nzSpaceItem"],["type","submit","nz-button","","nzBlock","","nzType","primary","nzSize","default",3,"click"],["nz-typography","",4,"nzSpaceItem"],["nz-typography",""],["nz-icon","","nzType","info-circle","nzTheme","twotone"],[4,"nzSpaceItem"],["nzType","warning","nzShowIcon","",3,"nzMessage"],["existenceFail",""]],template:function(t,i){if(1&t&&(e.YNc(0,Ue,7,5,"ng-container",0),e.YNc(1,ke,5,3,"ng-template",null,1,e.W1O)),2&t){const a=e.MAs(2);e.Q6J("ngIf",i.foundCitation)("ngIfElse",a)}},directives:[s.O5,p.NU,p.$1,C.r,g.SK,y.Nx,N.V,E.ix,be.dQ,Ie.w],styles:["[_nghost-%COMP%]{display:block}nz-space[_ngcontent-%COMP%]{width:100%}nz-space-item[_ngcontent-%COMP%]:last-child{margin-bottom:0}"]}),n})();function je(n,o){if(1&n&&(e.TgZ(0,"nz-option",4),e._uU(1),e.qZA()),2&n){const t=o.$implicit;e.Q6J("nzLabel",t.label)("nzValue",t.source),e.xp6(1),e.AsE(" ",t.source.citation," (",t.source.citationId,") ")}}function Xe(n,o){if(1&n&&(e.ynx(0),e.YNc(1,je,2,4,"nz-option",3),e.BQk()),2&n){const t=o.ngrxLet;e.xp6(1),e.Q6J("ngForOf",t)}}function He(n,o){if(1&n&&(e.TgZ(0,"div",8),e._uU(1),e.qZA()),2&n){const t=e.oxw(2);e.xp6(1),e.hij(" ",t.to.prompt," ")}}function We(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"cvc-citation-loader",9),e.NdJ("addCitation",function(a){return e.CHM(t),e.oxw(2).onAddCitation(a)})("sourceTypeChange",function(a){return e.CHM(t),e.oxw(2).model.sourceType=a})("citationIdChange",function(a){return e.CHM(t),e.oxw(2).to.searchValue=a}),e.qZA()}if(2&n){const t=e.oxw(2);e.Q6J("model",t.model)("sourceType",t.model.sourceType)("citationId",t.to.searchValue)}}function Ke(n,o){if(1&n&&(e.ynx(0,5),e.YNc(1,He,2,1,"div",6),e.YNc(2,We,1,3,"cvc-citation-loader",7),e.BQk()),2&n){const t=e.oxw();e.Q6J("ngSwitch",t.to.searchLength>0&&t.to.searchLength>=t.to.minSearchLength),e.xp6(1),e.Q6J("ngSwitchCase",!1),e.xp6(1),e.Q6J("ngSwitchCase",!0)}}let qe=(()=>{class n extends m.fS{constructor(t){super(),this.sourceTypeaheadQuery=t,this.defaultOptions={templateOptions:{placeholder:"Search Sources",onSearch:()=>{},minSearchLength:1,maxSearchLength:15,searchLength:0,searchValue:""},expressionProperties:{"templateOptions.prompt":i=>`Search for ${(0,O.o6)(d.yic).getKeyOrThrow(i.sourceType)} sources known to CIViC.`}},this.onAddCitation=i=>{const a=this.field.parent.templateOptions;a.entityType="SourceStub",a.entityFragment=i.entityFragment,this.field.formControl.setValue(i.id)}}ngOnInit(){this.queryRef=this.sourceTypeaheadQuery.watch({sourceType:this.model.sourceType,partialCitationId:9999999}),this.sources$=this.queryRef.valueChanges.pipe((0,Te.j)("data","sourceTypeahead"),(0,L.U)(t=>t.map(i=>({value:i.id,label:i.citation?i.citation:i.name,source:i}))))}ngAfterViewInit(){this.to.onSearch=t=>{this.to.searchLength=t.length,this.to.searchValue=t,!(t.length<this.to.minLengthSearch||t.length>this.to.maxLength)&&this.queryRef.refetch({sourceType:d.yic.Pubmed,partialCitationId:+t})}}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(d.NbY))},n.\u0275cmp=e.Xpm({type:n,selectors:[["cvc-citation-select-type"]],features:[e.qOj],decls:4,vars:7,consts:[["nzShowSearch","","nzServerSearch","",3,"formControl","formlyAttributes","nzPlaceHolder","nzNotFoundContent","nzShowArrow","nzFilterOption","nzOnSearch"],[4,"ngrxLet"],["notFound",""],["nzCustomContent","",3,"nzLabel","nzValue",4,"ngFor","ngForOf"],["nzCustomContent","",3,"nzLabel","nzValue"],[3,"ngSwitch"],["class","ant-form-item-explain",4,"ngSwitchCase"],[3,"model","sourceType","citationId","addCitation","sourceTypeChange","citationIdChange",4,"ngSwitchCase"],[1,"ant-form-item-explain"],[3,"model","sourceType","citationId","addCitation","sourceTypeChange","citationIdChange"]],template:function(t,i){if(1&t&&(e.TgZ(0,"nz-select",0),e.NdJ("nzOnSearch",function(c){return i.to.onSearch(c)}),e.YNc(1,Xe,2,1,"ng-container",1),e.qZA(),e.YNc(2,Ke,3,3,"ng-template",null,2,e.W1O)),2&t){const a=e.MAs(3);e.Q6J("formControl",i.formControl)("formlyAttributes",i.field)("nzPlaceHolder",i.to.placeholder?i.to.placeholder:null)("nzNotFoundContent",a)("nzShowArrow",!1)("nzFilterOption",i.to.filterOption),e.xp6(1),e.Q6J("ngrxLet",i.sources$)}},directives:[z.Vq,l.JJ,l.oH,m.VQ,v.eJ,s.sg,z.Ip,s.RF,s.n9,Re],styles:["[_nghost-%COMP%]{display:block}.loading-icon[_ngcontent-%COMP%]{margin-right:8px}.source-citation[_ngcontent-%COMP%]{font-style:oblique}"],changeDetection:0}),n})(),et=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[s.ez,p.zf,C.L,y.U5,F.B,E.sL]]}),n})();const tt={types:[{name:"citation-select",component:qe}]};let nt=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[s.ez,l.UX,v.WG,z.LV,et,m.X0.forChild(tt),I.s]]}),n})();var it=r(9779);const ot={types:[{name:"source-select",component:ze,wrappers:["form-field"]}]};let rt=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[s.ez,l.UX,v.WG,m.X0.forChild(ot),z.LV,p.zf,M.ZJ,Se.X,nt,it.s]]}),n})();var at=r(5472),ct=r(4889);let st=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({providers:[se],imports:[[s.ez,u.Bz,l.UX,I.s,y.U5,C.L,g.Jb,E.sL,U.j,m.X0,te.A,F.B,K.R,q.C,re.l,ee.N,oe.g,H.C,ie.W,ne.$,X.I,ae.o,j.K,ce.q,W.q,R.C,de.o,le.A,ue.g,pe.r,me.S,ge.e,fe.e,he.J,_e.i,rt,at.r,ct.E,S.vh,p.zf,M.ZJ,u.Bz,I.s]]}),n})(),dt=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[s.ez,g.Jb,p.zf,S.vh,k.H0,st]]}),n})();var A=r(6738),lt=r(6064),ut=r(6123);function pt(n,o){1&n&&(e.TgZ(0,"nz-card"),e.TgZ(1,"nz-typography"),e._uU(2," To add an evidence item, please complete the following form, provide a short statement supporting its inclusion into the CIViC database, then click the 'Submit Evidence for Inclusion' button. If you are having difficulty filling in all of the required fields please use the "),e.TgZ(3,"a",3),e._uU(4,"Suggest Source form"),e.qZA(),e._uU(5," to suggest a publication for curators to review. "),e._UZ(6,"br"),e._UZ(7,"br"),e.TgZ(8,"strong"),e._uU(9,"Please ensure that your submission contains no "),e.TgZ(10,"a",4),e._uU(11,"Protected Health Information"),e.qZA(),e._uU(12,", and is your own original work. By contributing to CIViC you agree to release your contributions to the public domain as described by the "),e.TgZ(13,"a",5),e._uU(14,"Creative Commons Public Domain Dedication (CC0 1.0 Universal)"),e.qZA(),e._uU(15,"."),e.qZA(),e.qZA(),e.qZA())}function mt(n,o){1&n&&e.GkF(0)}function gt(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"formly-form",11),e.NdJ("modelChange",function(a){return e.CHM(t),e.oxw(2).formModel=a}),e.qZA()}if(2&n){const t=e.oxw(2);e.Q6J("form",t.formGroup)("fields",t.formFields)("model",t.formModel)("options",t.formOptions)}}function ft(n,o){if(1&n&&(e.TgZ(0,"nz-form-item"),e._UZ(1,"cvc-form-errors-alert",13),e.qZA()),2&n){const t=e.oxw(3);e.xp6(1),e.Q6J("errors",t.errorMessages)}}function ht(n,o){if(1&n&&(e.TgZ(0,"p"),e._uU(1,"View "),e.TgZ(2,"a",17),e._uU(3,"its details"),e.qZA(),e._uU(4,"."),e.qZA()),2&n){const t=e.oxw(4);e.xp6(2),e.MGl("routerLink","/evidence/",t.newId,"/summary")}}function _t(n,o){if(1&n&&(e.ynx(0),e._UZ(1,"nz-alert",14),e.YNc(2,ht,5,1,"ng-template",15,16,e.W1O),e.BQk()),2&n){const t=e.MAs(3);e.xp6(1),e.Q6J("nzDescription",t)}}function vt(n,o){if(1&n&&(e.YNc(0,ft,2,1,"nz-form-item",12),e.YNc(1,_t,4,1,"ng-container",12)),2&n){const t=e.oxw(2);e.Q6J("ngIf",t.errorMessages.length>0),e.xp6(1),e.Q6J("ngIf",t.success)}}function yt(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"nz-spin",6),e.TgZ(1,"form",7),e.NdJ("ngSubmit",function(){e.CHM(t);const a=e.oxw();return a.submitEvidence(a.formModel)}),e.YNc(2,mt,1,0,"ng-container",8),e.YNc(3,gt,1,4,"formly-form",9),e.qZA(),e.YNc(4,vt,2,2,"ng-template",null,10,e.W1O),e.qZA()}if(2&n){const t=e.MAs(5),i=e.oxw();e.Q6J("nzSpinning",i.loading),e.xp6(1),e.Q6J("formGroup",i.formGroup),e.xp6(1),e.Q6J("ngTemplateOutlet",t),e.xp6(1),e.Q6J("ngIf",!i.success)}}let xt=(()=>{class n{constructor(t,i,a,c){this.submitEvidenceGQL=t,this.sourceSuggestionGQL=i,this.networkErrorService=a,this.route=c,this.destroy$=new J.xQ,this.formGroup=new l.cw({}),this.formOptions={formState:new lt._},this.success=!1,this.errorMessages=[],this.loading=!1,this.submitEvidenceMutator=new ut.U(a),this.formFields=[{key:"fields",wrappers:["form-container"],templateOptions:{label:"Add Evidence Item Form"},fieldGroup:[{key:"gene",type:"gene-array",templateOptions:{maxCount:1,required:!0}},{key:"variant",type:"variant-array",templateOptions:{required:!0,maxCount:1,helpText:"The most specific description of the variant that the underlying source allows."}},{key:"description",type:"cvc-textarea",templateOptions:{label:"Evidence Statement",helpText:'Your original description of evidence from published literature detailing the association or lack of association between a variant and its predictive, prognostic, diagnostic, predisposing, functional or oncogenic value. Data constituting personal or identifying information should not be entered (e.g. <a href="https://www.hipaajournal.com/what-is-protected-health-information/" target="_blank">protected health information (PHI) as defined by HIPAA</a> in the U.S. and/or comparable laws in your jurisdiction).',placeholder:"No description provided",required:!0}},{key:"source",type:"multi-field",wrappers:["form-field"],templateOptions:{label:"Source",helpText:"CIViC accepts PubMed or ASCO Abstracts sources. Please provide the source of the support for your evidence here.",addText:"Specify a Source",maxCount:1},fieldArray:{type:"source-input",templateOptions:{hideLabel:!0,required:!0}}},{key:"variantOrigin",type:"variant-origin-select",templateOptions:{required:!0}},{key:"evidenceType",type:"evidence-type-select",templateOptions:{required:!0}},{key:"clinicalSignificance",type:"clinical-significance-select",templateOptions:{required:!0}},{key:"disease",type:"disease-array",templateOptions:{maxCount:1}},{key:"evidenceLevel",type:"evidence-level-select",templateOptions:{required:!0}},{key:"evidenceDirection",type:"evidence-direction-select",templateOptions:{required:!0}},{key:"drugs",type:"drug-array"},{key:"drugInteractionType",type:"drug-interaction-select"},{key:"phenotypes",type:"phenotype-array"},{key:"evidenceRating",type:"rating-input",templateOptions:{required:!0,label:"Rating",helpText:"Please rate your evidence on a scale of one to five stars. Use the star rating descriptions for guidance."}},{key:"comment",type:"comment-textarea",templateOptions:{label:"Comment",helpText:"Please provide any additional comments you wish to make about this evidence item. This comment will appear as the first comment in this item's comment thread.",placeholder:"Please enter a comment describing your revision.",required:!1,minLength:10}},{key:"cancel",type:"cancel-button"},{key:"organization",type:"org-submit-button",templateOptions:{submitLabel:"Submit Evidence Item",submitSize:"large"}}]}]}ngAfterViewInit(){this.route.queryParams.subscribe(t=>{let i=!1;t.geneId&&(i=!0,this.submittedGeneId=+t.geneId),t.variantId&&(i=!0,this.submittedVariantId=+t.variantId),t.sourceId&&(i=!0,this.submittedSourceId=+t.sourceId),t.diseaseId&&(i=!0,this.submittedDiseaseId=+t.diseaseId),i&&this.sourceSuggestionGQL.fetch({geneId:this.submittedGeneId,diseaseId:this.submittedDiseaseId,sourceId:this.submittedSourceId,variantId:this.submittedVariantId}).subscribe(({data:{sourceSuggestionValues:a},loading:c})=>{var f,Z;this.loading=c;let h={fields:{}};a.gene&&(h.fields.gene=[a.gene]),a.disease&&(h.fields.disease=[a.disease]),a.variant&&(h.fields.variant=[a.variant]),a.source&&(h.fields.source=[a.source]),(null===(f=this.formModel.fields)||void 0===f?void 0:f.organization)&&(h.fields.organization=null===(Z=this.formModel.fields)||void 0===Z?void 0:Z.organization),this.formModel=h},a=>{console.error("Error retrieving source suggestion data."),console.error(a)},()=>{this.formOptions.updateInitialValue&&this.formOptions.updateInitialValue(),this.formGroup.markAllAsTouched()})})}submitEvidence(t){let i=this.toSubmitInput(t);if(i){let a=this.submitEvidenceMutator.mutate(this.submitEvidenceGQL,{input:i},{},c=>{this.newId=c.submitEvidence.evidenceItem.id});a.submitSuccess$.pipe((0,x.R)(this.destroy$)).subscribe(c=>{c&&(this.success=!0)}),a.submitError$.pipe((0,x.R)(this.destroy$)).subscribe(c=>{c&&(this.errorMessages=c,this.success=!1)}),a.isSubmitting$.pipe((0,x.R)(this.destroy$)).subscribe(c=>{this.loading=c})}}toSubmitInput(t){var i,a;if(t){const c=t.fields;return{fields:{variantOrigin:c.variantOrigin,description:A.xt(c.description),variantId:c.variant[0].id,sourceId:c.source[0].id,evidenceType:c.evidenceType,evidenceDirection:c.evidenceDirection,clinicalSignificance:c.clinicalSignificance,diseaseId:A.uP(null===(i=c.disease[0])||void 0===i?void 0:i.id),evidenceLevel:c.evidenceLevel,phenotypeIds:c.phenotypes.map(f=>f.id),rating:+c.evidenceRating,drugIds:c.drugs.map(f=>f.id),drugInteractionType:A.uP(c.drugInteractionType)},comment:c.comment&&c.comment.length>0?c.comment:void 0,organizationId:null===(a=null==t?void 0:t.fields.organization)||void 0===a?void 0:a.id}}}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(d.WFw),e.Y36(d.FId),e.Y36(P.Y),e.Y36(u.gz))},n.\u0275cmp=e.Xpm({type:n,selectors:[["cvc-evidence-submit-form"]],decls:3,vars:0,consts:[["nzDirection","vertical"],[4,"nzSpaceItem"],["nzTip","Submitting",3,"nzSpinning",4,"nzSpaceItem"],["routerLink","/sources/add"],["href","http://www.hipaa.com/hipaa-protected-health-information-what-does-phi-include/","target","_blank"],["href","https://creativecommons.org/publicdomain/zero/1.0/","target","_blank"],["nzTip","Submitting",3,"nzSpinning"],["nz-form","","nzLayout","vertical",3,"formGroup","ngSubmit"],[4,"ngTemplateOutlet"],[3,"form","fields","model","options","modelChange",4,"ngIf"],["formMessages",""],[3,"form","fields","model","options","modelChange"],[4,"ngIf"],[3,"errors"],["nzType","success","nzMessage","Evidence Submitted","nzShowIcon","",3,"nzDescription"],["nzSize","small"],["successMessage",""],[3,"routerLink"]],template:function(t,i){1&t&&(e.TgZ(0,"nz-space",0),e.YNc(1,pt,16,0,"nz-card",1),e.YNc(2,yt,6,4,"nz-spin",2),e.qZA())},directives:[p.NU,p.$1,S.bd,M.ZU,u.yS,U.W,l._Y,l.JL,y.Lr,l.sg,s.tP,s.O5,m.T7,g.SK,y.Nx,N.V,C.r],styles:[""]}),n})();const Ct=[{path:"",component:D,children:[{path:"",redirectTo:"submit",pathMatch:"full"},{path:"submit",component:(()=>{class n{constructor(t){this.route=t,this.routeParams$=this.route.params.subscribe(i=>{this.evidenceId=+i.evidenceId})}ngOnDestroy(){this.routeParams$.unsubscribe()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(u.gz))},n.\u0275cmp=e.Xpm({type:n,selectors:[["cvc-evidence-submit"]],decls:1,vars:0,template:function(t,i){1&t&&e._UZ(0,"cvc-evidence-submit-form")},directives:[xt],styles:[""]}),n})(),data:{breadcrumb:"Submit New Evidence"}}]}];let zt=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[u.Bz.forChild(Ct),dt],u.Bz]}),n})();var St=r(5630),Tt=r(9386);let bt=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[s.ez,zt,_.KJ,Q.PV,St.D,Tt.a,g.Jb,v.WG]]}),n})()}}]);