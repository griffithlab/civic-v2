"use strict";(self.webpackChunkmain=self.webpackChunkmain||[]).push([[262],{9365:(U,G,i)=>{i.d(G,{T:()=>f});var n=i(54438),h=i(60177),g=i(25703),t=i(12617),E=i(41951),M=i(50513),x=i(16389),T=i(25930);const R=["itemTemplate"],D=_=>({$implicit:_});function L(_,I){if(1&_){const l=n.RV6();n.j41(0,"nz-list-item",5),n.bIt("click",function(){n.eBV(l);const z=n.XpG().$implicit,j=n.XpG(2);return n.Njj(j.onParticipantSelected(z))}),n.eu8(1,6),n.k0s()}if(2&_){const l=n.XpG().$implicit,d=n.XpG(2);n.AVh("selected-participant",l.id==(null==d.selectedItem?null:d.selectedItem.id)),n.R7$(),n.Y8G("ngTemplateOutlet",d.itemTemplateRef||null)("ngTemplateOutletContext",n.eq3(4,D,l))}}function P(_,I){if(1&_&&(n.qex(0),n.DNE(1,L,2,6,"nz-list-item",4),n.bVm()),2&_){const l=I.index,d=n.XpG(2);n.R7$(),n.Y8G("ngIf",l+1<=d.defaultListSize)}}function S(_,I){if(1&_){const l=n.RV6();n.j41(0,"button",7),n.bIt("click",function(){n.eBV(l);const z=n.XpG(2);return n.Njj(z.onExpandClicked())}),n.nrm(1,"i",8),n.EFF(2," Expand "),n.k0s()}}function $(_,I){if(1&_){const l=n.RV6();n.j41(0,"button",7),n.bIt("click",function(){n.eBV(l);const z=n.XpG(2);return n.Njj(z.onCollapseClicked())}),n.nrm(1,"i",9),n.EFF(2," Collapse "),n.k0s()}}function B(_,I){if(1&_&&(n.qex(0),n.j41(1,"nz-card",1)(2,"nz-list"),n.DNE(3,P,2,1,"ng-container",2),n.k0s(),n.DNE(4,S,3,0,"button",3)(5,$,3,0,"button",3),n.k0s(),n.bVm()),2&_){const l=n.XpG();n.R7$(),n.Y8G("nzTitle",l.listTitle),n.R7$(2),n.Y8G("ngForOf",l.participantList),n.R7$(),n.Y8G("ngIf",l.participantList.length>l.defaultListSize),n.R7$(),n.Y8G("ngIf",l.isExpanded)}}let f=(()=>{class _{constructor(){this.defaultListSize=5,this.participantSelectedEvent=new n.bkB,this.isExpanded=!1}ngOnInit(){this.preselectedOption&&(this.selectedItem=this.preselectedOption)}onParticipantSelected(l){this.selectedItem=l.id==this.selectedItem?.id?void 0:l,this.participantSelectedEvent.emit(this.selectedItem)}onExpandClicked(){this.originalDefaultListSize=this.defaultListSize,this.defaultListSize=this.participantList.length,this.isExpanded=!0}onCollapseClicked(){this.originalDefaultListSize&&(this.defaultListSize=this.originalDefaultListSize,this.isExpanded=!1)}static{this.\u0275fac=function(d){return new(d||_)}}static{this.\u0275cmp=n.VBU({type:_,selectors:[["cvc-participant-list"]],contentQueries:function(d,z,j){if(1&d&&n.wni(j,R,5),2&d){let N;n.mGM(N=n.lsd())&&(z.itemTemplateRef=N.first)}},inputs:{participantList:"participantList",listTitle:"listTitle",defaultListSize:"defaultListSize",preselectedOption:"preselectedOption"},outputs:{participantSelectedEvent:"participantSelectedEvent"},standalone:!1,decls:1,vars:1,consts:[[4,"ngIf"],["nz-type","inner",2,"margin-bottom","1em",3,"nzTitle"],[4,"ngFor","ngForOf"],["nz-button","","nzType","default","nzSize","small",3,"click",4,"ngIf"],["nzSize","small","class","participant-list-item",3,"selected-participant","click",4,"ngIf"],["nzSize","small",1,"participant-list-item",3,"click"],[3,"ngTemplateOutlet","ngTemplateOutletContext"],["nz-button","","nzType","default","nzSize","small",3,"click"],["nz-icon","","nzType","vertical-align-bottom"],["nz-icon","","nzType","vertical-align-top"]],template:function(d,z){1&d&&n.DNE(0,B,6,4,"ng-container",0),2&d&&n.Y8G("ngIf",z.participantList&&z.participantList.length>0)},dependencies:[h.Sq,h.bT,h.T3,g.cK,t.eE,t.lQ,E.Dn,M.aO,x.c,T.p],styles:[".participant-list-item[_ngcontent-%COMP%]:hover{border:1px solid #40a9ff;cursor:pointer}.participant-list-item[_ngcontent-%COMP%]{padding:2px;margin:2px}.selected-participant[_ngcontent-%COMP%]{background:#40a9ff;color:#fff}"]})}}return _})()},14873:(U,G,i)=>{i.d(G,{A:()=>y});var n=i(60177),h=i(97529),g=i(25703),t=i(12617),E=i(29438),M=i(97685),x=i(61912),T=i(72968),R=i(86864),D=i(77169),L=i(64917),P=i(7391),S=i(41951),$=i(35154),B=i(72874),f=i(54438);let _=(()=>{class v{static{this.\u0275fac=function(A){return new(A||v)}}static{this.\u0275mod=f.$C({type:v})}static{this.\u0275inj=f.G2t({imports:[n.MD,R.sC,E.Yb,P.kT,S.Y3,$.Qt,B.g9,D.W,L.i]})}}return v})();var I=i(89417),l=i(8524),d=i(38927),z=i(34308),j=i(23842),N=i(68492),F=i(25128),b=i(23617),C=i(50513),O=i(3069),r=i(82983),m=i(9541);let p=(()=>{class v{static{this.\u0275fac=function(A){return new(A||v)}}static{this.\u0275mod=f.$C({type:v})}static{this.\u0275inj=f.G2t({imports:[n.MD,I.X1,C.Zw,g.Ti,m.hM,d.PQ,r.V,O.$f,b.$,$.Qt,I.YN,l.qy,N.M,j.k,D.W,F.K,z.I]})}}return v})(),y=(()=>{class v{static{this.\u0275fac=function(A){return new(A||v)}}static{this.\u0275mod=f.$C({type:v})}static{this.\u0275inj=f.G2t({imports:[n.MD,C.Zw,h.f3,g.Ti,t.rD,S.Y3,L.i,E.Yb,M.pc,x.i3,p,T.K,_]})}}return v})()},20664:(U,G,i)=>{i.d(G,{D:()=>Dt});var n=i(69145),h=i(96354),g=i(24608),t=i(54438),E=i(60177),M=i(50513),x=i(16389),T=i(97529),R=i(25703),D=i(12617),L=i(41951),P=i(29438),S=i(97685),$=i(31635),B=i(71226),f=i(49894),_=i(41305),I=i(74222),l=i(89417),d=i(25930),z=i(38927),j=i(82983),N=i(23617),F=i(35154),b=i(19449),C=i(41939),O=i(65566);function r(o,s){if(1&o){const e=t.RV6();t.j41(0,"nz-alert",6),t.bIt("nzOnClose",function(){t.eBV(e);const c=t.XpG();return t.Njj(c.onSuccessBannerClose())}),t.k0s()}}function m(o,s){if(1&o&&(t.j41(0,"nz-form-item"),t.nrm(1,"cvc-form-errors-alert",7),t.k0s()),2&o){const e=t.XpG();t.R7$(),t.Y8G("errors",e.errorMessages)}}let p=class Y{constructor(s,e,a){this.viewerService=s,this.addCommentGql=e,this.networkErrorService=a,this.commentAddedEvent=new t.bkB,this.success=!1,this.errorMessages=[],this.loading=!1,this.viewerService.viewer$.pipe((0,f.s)(this)).subscribe(c=>{this.mostRecentOrg=c.mostRecentOrg}),this.addCommentMutator=new B.E(this.networkErrorService)}submitComment(){if(this.commentText){this.errorMessages=[];let e=this.addCommentMutator.mutate(this.addCommentGql,{input:{body:this.commentText,subject:this.subject,organizationId:void 0===this.mostRecentOrg?void 0:this.mostRecentOrg.id}});e.submitSuccess$.pipe((0,f.s)(this)).subscribe(a=>{a&&(this.resetForm(),this.success=!0)}),e.submitError$.pipe((0,f.s)(this)).subscribe(a=>{a&&(this.errorMessages=a,this.success=!1)}),e.isSubmitting$.pipe((0,f.s)(this)).subscribe(a=>{this.loading=a})}}resetForm(){this.commentText="",this.commentAddedEvent.emit()}onSuccessBannerClose(){this.resetForm()}static{this.\u0275fac=function(e){return new(e||Y)(t.rXU(_.q),t.rXU(n.hj),t.rXU(I.N))}}static{this.\u0275cmp=t.VBU({type:Y,selectors:[["cvc-comment-add-form"]],inputs:{subject:"subject"},outputs:{commentAddedEvent:"commentAddedEvent"},standalone:!1,decls:11,vars:7,consts:[["nzBanner","","nzMessage","Comment submitted","nzType","success","nzCloseable","",3,"nzOnClose",4,"ngIf"],["nz-form","","nzLayout","vertical",3,"ngSubmit"],[4,"ngIf"],[3,"commentChange","comment"],["nzTip","Submitting",3,"nzSpinning"],["type","submit","nz-button","","cvcOrgSelectorBtn","","nzType","primary","nzSize","small","nz-tooltip","",3,"disabled","nzTooltipTrigger","nzTooltipTitle"],["nzBanner","","nzMessage","Comment submitted","nzType","success","nzCloseable","",3,"nzOnClose"],[3,"errors"]],template:function(e,a){1&e&&(t.j41(0,"nz-card"),t.DNE(1,r,1,0,"nz-alert",0),t.j41(2,"form",1),t.bIt("ngSubmit",function(){return a.submitComment()}),t.DNE(3,m,2,1,"nz-form-item",2),t.j41(4,"cvc-comment-input-form",3),t.mxI("commentChange",function(u){return t.DH7(a.commentText,u)||(a.commentText=u),u}),t.k0s(),t.j41(5,"nz-spin",4)(6,"nz-form-item")(7,"nz-form-control")(8,"cvc-form-buttons")(9,"button",5),t.EFF(10," Add Comment "),t.k0s()()()()()()()),2&e&&(t.R7$(),t.Y8G("ngIf",a.success),t.R7$(2),t.Y8G("ngIf",a.errorMessages.length>0),t.R7$(),t.R50("comment",a.commentText),t.R7$(),t.Y8G("nzSpinning",a.loading),t.R7$(4),t.Y8G("disabled",a.loading||!(void 0!==a.commentText&&a.commentText.length>=10))("nzTooltipTrigger",a.mostRecentOrg?"hover":null)("nzTooltipTitle","For "+(null==a.mostRecentOrg?null:a.mostRecentOrg.name)))},dependencies:[E.bT,l.qT,l.cb,M.aO,x.c,d.p,R.cK,T.Uq,T.e,z.CA,z.Ls,z.zS,j.a,N.Y,F.LH,l.cV,b.j,C.l,O.K],styles:[":host{display:block}nz-space{width:100%}nz-form-item:last-of-type{margin-bottom:0}\n"],encapsulation:2})}};p=(0,$.Cg)([(0,f.d)()],p);var y=i(9365),v=i(86864),W=i(7391),V=i(72874),A=i(61774),Q=i(4126),J=i(8139);function Z(o,s){if(1&o&&t.nrm(0,"nz-avatar",5),2&o){const e=t.XpG().ngrxLet;t.Y8G("nzSrc",e.commenter.profileImagePath)}}function H(o,s){1&o&&t.nrm(0,"nz-avatar",6)}function k(o,s){if(1&o){const e=t.RV6();t.j41(0,"nz-comment-action")(1,"span",7),t.bIt("nzOnConfirm",function(){t.eBV(e);const c=t.XpG().ngrxLet,u=t.XpG(),K=t.r8f(0);return t.Njj(u.deleteComment(c.id,null==K.mostRecentOrg?null:K.mostRecentOrg.id))}),t.k0s()()}}function w(o,s){1&o&&(t.j41(0,"span",4)(1,"i"),t.EFF(2," This comment has been deleted. "),t.k0s()())}function q(o,s){1&o&&(t.j41(0,"span",4)(1,"i"),t.EFF(2,"No Comment Provided"),t.k0s()())}function tt(o,s){if(1&o&&t.nrm(0,"cvc-comment-body",8),2&o){const e=t.XpG(2).ngrxLet;t.Y8G("commentBodySegments",e.parsedComment)}}function nt(o,s){if(1&o&&t.DNE(0,q,3,0,"span",4)(1,tt,1,1,"cvc-comment-body",8),2&o){const e=t.XpG().ngrxLet;t.vxM(0==e.parsedComment.length?0:1)}}function et(o,s){if(1&o&&(t.j41(0,"nz-comment",2),t.nI1(1,"timeAgo"),t.DNE(2,Z,1,1,"nz-avatar",3)(3,H,1,0,"ng-template",null,0,t.C5r)(5,k,2,0,"nz-comment-action"),t.j41(6,"nz-comment-content"),t.DNE(7,w,3,0,"span",4)(8,nt,2,1),t.k0s()()),2&o){const e=s.ngrxLet,a=t.sdS(4);t.XpG();const c=t.r8f(0);t.Y8G("nzAuthor",e.commenter.displayName)("nzDatetime",t.bMT(1,6,e.createdAt)),t.R7$(2),t.Y8G("ngIf",e.commenter.profileImagePath)("ngIfElse",a),t.R7$(3),t.vxM(c&&c.signedIn&&(null==c.user?null:c.user.id)==e.commenter.id&&e.id&&!e.deleted?5:-1),t.R7$(2),t.vxM(e.deleted?7:8)}}let it=(()=>{class o{constructor(e,a,c){this.viewerService=e,this.networkErrorService=a,this.deleteCommentGql=c,this.comment=t.hFB.required(),this.viewer$=this.viewerService.viewer$}ngOnInit(){if(void 0===this.comment)throw new Error("Must pass a comment into comment display component.")}deleteComment(e,a){new B.E(this.networkErrorService).mutate(this.deleteCommentGql,{input:{commentId:e,organizationId:a}})}static{this.\u0275fac=function(a){return new(a||o)(t.rXU(_.q),t.rXU(I.N),t.rXU(n.hGs))}}static{this.\u0275cmp=t.VBU({type:o,selectors:[["cvc-comment-display"]],inputs:{comment:[1,"comment"]},standalone:!1,decls:3,vars:4,consts:[["noAvatar",""],[3,"nzAuthor","nzDatetime",4,"ngrxLet"],[3,"nzAuthor","nzDatetime"],["nz-comment-avatar","",3,"nzSrc",4,"ngIf","ngIfElse"],["nz-typography","","nzType","secondary"],["nz-comment-avatar","",3,"nzSrc"],["nz-comment-avatar","","nzIcon","civic:curator"],["nz-tooltip","","nz-popconfirm","","nzPopconfirmPlacement","right","nzPopconfirmTitle","Delete This Comment?","nzTooltipTitle","Delete","nz-icon","","nzType","delete",3,"nzOnConfirm"],[3,"commentBodySegments"]],template:function(a,c){1&a&&(t.SS7(0),t.nI1(1,"ngrxPush"),t.DNE(2,et,9,8,"nz-comment",1)),2&a&&(t.bH3(t.bMT(1,1,c.viewer$)),t.R7$(2),t.Y8G("ngrxLet",c.comment()))},dependencies:[E.bT,v.fL,v.sf,v.OW,v.fS,P.PM,W.Di,L.Dn,F.LH,V.PV,A.Nj,Q.p,A.L9,J.N],encapsulation:2})}}return o})();var ot=i(14493);const X=()=>[];function at(o,s){if(1&o&&(t.j41(0,"nz-card",10),t.nrm(1,"cvc-comment-display",11),t.k0s()),2&o){const e=t.XpG(2);t.R7$(),t.Y8G("comment",e.creationComment)}}function ct(o,s){1&o&&(t.qex(0),t.j41(1,"nz-row",6)(2,"nz-col",7)(3,"nz-space",8),t.DNE(4,at,2,1,"nz-card",9),t.k0s()()(),t.bVm()),2&o&&(t.R7$(),t.Y8G("nzGutter",16))}function st(o,s){if(1&o){const e=t.RV6();t.j41(0,"div",24)(1,"button",25),t.bIt("click",function(){t.eBV(e);const c=t.XpG().ngIf,u=t.XpG(3);return t.Njj(u.onLoadMore(c.startCursor))}),t.EFF(2," Load older comments "),t.k0s()()}}function mt(o,s){if(1&o&&(t.j41(0,"nz-list-header"),t.DNE(1,st,3,0,"div",23),t.k0s()),2&o){const e=s.ngIf;t.R7$(),t.Y8G("ngIf",e.hasPreviousPage)}}function rt(o,s){if(1&o&&(t.j41(0,"nz-list-item"),t.nrm(1,"cvc-comment-display",11),t.k0s()),2&o){const e=s.$implicit;t.R7$(),t.Y8G("comment",e)}}function lt(o,s){if(1&o&&(t.j41(0,"nz-card",21)(1,"nz-list",22),t.nI1(2,"ngrxPush"),t.nI1(3,"ngrxPush"),t.DNE(4,mt,2,1,"nz-list-header",4),t.nI1(5,"ngrxPush"),t.DNE(6,rt,2,1,"ng-template",null,1,t.C5r),t.k0s()()),2&o){const e=t.sdS(7),a=t.XpG(2);t.R7$(),t.Y8G("nzDataSource",t.bMT(2,4,a.comments$))("nzLoading",t.bMT(3,6,a.loading$))("nzRenderItem",e),t.R7$(3),t.Y8G("ngIf",t.bMT(5,8,a.pageInfo$))}}function _t(o,s){if(1&o){const e=t.RV6();t.j41(0,"cvc-comment-add-form",26),t.bIt("commentAddedEvent",function(){t.eBV(e);const c=t.XpG(2);return t.Njj(c.refreshList())}),t.k0s()}if(2&o){const e=t.XpG(2);t.Y8G("subject",e.commentable)}}function pt(o,s){if(1&o&&t.nrm(0,"nz-avatar",29),2&o){const e=t.XpG().$implicit;t.Y8G("nzSrc",e.profileImagePath)}}function dt(o,s){if(1&o&&(t.nrm(0,"nz-avatar",30),t.nI1(1,"uppercase")),2&o){const e=t.XpG().$implicit;t.Y8G("nzText",t.bMT(1,1,e.displayName.charAt(0)))}}function gt(o,s){if(1&o&&(t.DNE(0,pt,1,1,"nz-avatar",28)(1,dt,2,3,"ng-template",null,3,t.C5r),t.j41(3,"span"),t.EFF(4),t.k0s()),2&o){const e=s.$implicit,a=t.sdS(2);t.Y8G("ngIf",e.profileImagePath)("ngIfElse",a),t.R7$(4),t.JRh(e.displayName)}}function Ct(o,s){if(1&o){const e=t.RV6();t.j41(0,"cvc-participant-list",27),t.nI1(1,"ngrxPush"),t.bIt("participantSelectedEvent",function(c){t.eBV(e);const u=t.XpG(2);return t.Njj(u.onCommenterSelected(c))}),t.DNE(2,gt,5,3,"ng-template",null,2,t.C5r),t.k0s()}if(2&o){const e=t.XpG(2);t.Y8G("participantList",t.bMT(1,1,e.commenters$)||t.lJ4(3,X))}}function vt(o,s){if(1&o&&t.nrm(0,"nz-avatar",29),2&o){const e=t.XpG().$implicit;t.Y8G("nzSrc",e.profileImagePath)}}function ut(o,s){if(1&o&&(t.nrm(0,"nz-avatar",30),t.nI1(1,"uppercase")),2&o){const e=t.XpG().$implicit;t.Y8G("nzText",t.bMT(1,1,e.displayName.charAt(0)))}}function ft(o,s){if(1&o&&(t.DNE(0,vt,1,1,"nz-avatar",28)(1,ut,2,3,"ng-template",null,3,t.C5r),t.j41(3,"span"),t.EFF(4),t.k0s()),2&o){const e=s.$implicit,a=t.sdS(2);t.Y8G("ngIf",e.profileImagePath)("ngIfElse",a),t.R7$(4),t.JRh(e.displayName)}}function zt(o,s){if(1&o){const e=t.RV6();t.j41(0,"cvc-participant-list",31),t.nI1(1,"ngrxPush"),t.bIt("participantSelectedEvent",function(c){t.eBV(e);const u=t.XpG(2);return t.Njj(u.onMentionedUserSelected(c))}),t.DNE(2,ft,5,3,"ng-template",null,2,t.C5r),t.k0s()}if(2&o){const e=t.XpG(2);t.Y8G("participantList",t.bMT(1,1,e.mentionedUsers$)||t.lJ4(3,X))}}function ht(o,s){if(1&o&&(t.nrm(0,"nz-avatar",33),t.j41(1,"span"),t.EFF(2),t.k0s()),2&o){const e=s.$implicit;t.Mz_("nzIcon","civic-",e.tag.displayName,""),t.R7$(2),t.SpI("",e.tag.displayName,"s")}}function Tt(o,s){if(1&o){const e=t.RV6();t.j41(0,"cvc-participant-list",32),t.nI1(1,"ngrxPush"),t.bIt("participantSelectedEvent",function(c){t.eBV(e);const u=t.XpG(2);return t.Njj(u.onMentionedRoleSelected(c))}),t.DNE(2,ht,3,3,"ng-template",null,2,t.C5r),t.k0s()}if(2&o){const e=t.XpG(2);t.Y8G("participantList",t.bMT(1,1,e.mentionedRoles$)||t.lJ4(3,X))}}function Et(o,s){if(1&o&&(t.nrm(0,"i",35),t.nI1(1,"iconNameForSubscribableEntity"),t.j41(2,"span"),t.EFF(3),t.k0s()),2&o){const e=s.$implicit;t.Y8G("nzType",t.bMT(1,2,e.tag.tagType)),t.R7$(3),t.JRh(e.tag.displayName)}}function It(o,s){if(1&o){const e=t.RV6();t.j41(0,"cvc-participant-list",34),t.nI1(1,"ngrxPush"),t.bIt("participantSelectedEvent",function(c){t.eBV(e);const u=t.XpG(2);return t.Njj(u.onMentionedEntitySelected(c))}),t.DNE(2,Et,4,4,"ng-template",null,2,t.C5r),t.k0s()}if(2&o){const e=t.XpG(2);t.Y8G("participantList",t.bMT(1,1,e.mentionedEntities$)||t.lJ4(3,X))}}function yt(o,s){1&o&&(t.qex(0),t.j41(1,"nz-row",6)(2,"nz-col",12)(3,"nz-space",8),t.DNE(4,lt,8,10,"nz-card",13)(5,_t,1,1,"cvc-comment-add-form",14),t.k0s()(),t.j41(6,"nz-col",15)(7,"nz-space",16),t.DNE(8,Ct,4,4,"cvc-participant-list",17)(9,zt,4,4,"cvc-participant-list",18)(10,Tt,4,4,"cvc-participant-list",19)(11,It,4,4,"cvc-participant-list",20),t.k0s()()(),t.bVm()),2&o&&(t.R7$(),t.Y8G("nzGutter",16))}function Mt(o,s){if(1&o){const e=t.RV6();t.j41(0,"cvc-comment-add-form",26),t.bIt("commentAddedEvent",function(){t.eBV(e);const c=t.XpG();return t.Njj(c.refreshList())}),t.k0s()}if(2&o){const e=t.XpG();t.Y8G("subject",e.commentable)}}let Dt=(()=>{class o{constructor(e){this.gql=e,this.pageSize=5}ngOnInit(){this.queryRef$=this.gql.watch({subject:this.commentable,last:this.pageSize,sortBy:{column:n.G_G.Created,direction:n.UEL.Asc}});let e=this.queryRef$.valueChanges;this.pageInfo$=e.pipe((0,h.T)(({data:a})=>a.comments.pageInfo)),this.loading$=e.pipe((0,h.T)(({loading:a})=>a)),this.comments$=e.pipe((0,h.T)(({data:a})=>a.comments.edges.map(c=>c.node))),this.commenters$=e.pipe((0,h.T)(({data:a})=>a.comments.uniqueCommenters)),this.mentionedUsers$=e.pipe((0,h.T)(({data:a})=>a.comments.mentionedUsers)),this.mentionedRoles$=e.pipe((0,h.T)(({data:a})=>a.comments.mentionedRoles.map(c=>({id:`${c.entityId}-${c.tagType}`,tag:c})))),this.mentionedEntities$=e.pipe((0,h.T)(({data:a})=>a.comments.mentionedEntities.map(c=>({id:`${c.entityId}-${c.tagType}`,tag:c})))),this.unfilteredCount$=e.pipe((0,g.E)("data","comments","unfilteredCountForSubject"))}onLoadMore(e){this.queryRef$.fetchMore({variables:{last:this.pageSize,before:e}})}onCommenterSelected(e){this.queryRef$.refetch({originatingUserId:e?.id})}onMentionedUserSelected(e){this.queryRef$.refetch({mentionedUserId:e?.id})}onMentionedRoleSelected(e){if(e){let a=n.gG1[e.tag.displayName[0].toUpperCase()+e.tag.displayName.slice(1)];this.queryRef$.refetch({mentionedRole:a})}else this.queryRef$.refetch({mentionedRole:void 0})}onMentionedEntitySelected(e){this.queryRef$.refetch(e?{mentionedEntity:{entityType:e.tag.tagType,id:e.tag.entityId}}:{mentionedEntity:void 0})}refreshList(){this.queryRef$.refetch()}static{this.\u0275fac=function(a){return new(a||o)(t.rXU(n.y5X))}}static{this.\u0275cmp=t.VBU({type:o,selectors:[["cvc-comment-list"]],inputs:{commentable:"commentable",creationComment:"creationComment"},standalone:!1,decls:5,vars:5,consts:[["noComments",""],["comment",""],["itemTemplate",""],["noAvatar",""],[4,"ngIf"],[4,"ngIf","ngIfElse"],[3,"nzGutter"],["nzSpan","24"],["nzDirection","vertical",2,"width","100%"],["nzTitle","Submission Comment",4,"nzSpaceItem"],["nzTitle","Submission Comment"],[3,"comment"],["nzSpan","18"],["nzTitle","Comments",4,"nzSpaceItem"],["id","addComment",3,"subject","commentAddedEvent",4,"nzSpaceItem"],["nzSpan","6"],["nzDirection","vertical"],["listTitle","Commenters",3,"participantList","participantSelectedEvent",4,"nzSpaceItem"],["listTitle","Mentioned Users",3,"participantList","participantSelectedEvent",4,"nzSpaceItem"],["listTitle","Mentioned Roles",3,"participantList","participantSelectedEvent",4,"nzSpaceItem"],["listTitle","Mentioned Entities",3,"participantList","participantSelectedEvent",4,"nzSpaceItem"],["nzTitle","Comments"],["nzSize","small","nzItemLayout","horizontal",3,"nzDataSource","nzLoading","nzRenderItem"],["nz-list-load-more","",4,"ngIf"],["nz-list-load-more",""],["nz-button","","nzType","link","nzSize","small","nzBlock","",3,"click"],["id","addComment",3,"commentAddedEvent","subject"],["listTitle","Commenters",3,"participantSelectedEvent","participantList"],["nz-comment-avatar","",3,"nzSrc",4,"ngIf","ngIfElse"],["nz-comment-avatar","",3,"nzSrc"],["nz-comment-avatar","",3,"nzText"],["listTitle","Mentioned Users",3,"participantSelectedEvent","participantList"],["listTitle","Mentioned Roles",3,"participantSelectedEvent","participantList"],[3,"nzIcon"],["listTitle","Mentioned Entities",3,"participantSelectedEvent","participantList"],["nz-icon","",3,"nzType"]],template:function(a,c){if(1&a&&(t.DNE(0,ct,5,1,"ng-container",4)(1,yt,12,1,"ng-container",5),t.nI1(2,"ngrxPush"),t.DNE(3,Mt,1,1,"ng-template",null,0,t.C5r)),2&a){const u=t.sdS(4);t.Y8G("ngIf",c.creationComment),t.R7$(),t.Y8G("ngIf",t.bMT(2,3,c.unfilteredCount$))("ngIfElse",u)}},dependencies:[E.bT,M.aO,x.c,T.Uq,T.e,R.cK,D.eE,D.Xo,D.lQ,L.Dn,P.PM,S.U5,S.Dq,p,y.T,it,E.Pc,A.L9,ot.g],styles:["[_nghost-%COMP%]{display:block}nz-list-header[_ngcontent-%COMP%]{padding:0;margin:0}nz-list-header[_ngcontent-%COMP%]   [nz-list-load-more][_ngcontent-%COMP%]{margin-top:-.5em;padding-bottom:.5em}"]})}}return o})()},65566:(U,G,i)=>{i.d(G,{K:()=>b});var n=i(54438),h=i(21413),g=i(69145),t=i(5964),E=i(56977),M=i(96354),x=i(99172),T=i(24608),R=i(69199),D=i(41305),L=i(60177),P=i(89417),S=i(61774),$=i(9541),B=i(82983),f=i(3069),_=i(21011),I=i(4126);const l=()=>["#","@","$"],d=()=>({minRows:4,maxRows:100});function z(C,O){if(1&C&&(n.qex(0),n.j41(1,"span"),n.EFF(2),n.k0s(),n.bVm()),2&C){const r=O.$implicit;n.R7$(2),n.JRh(r.displayName)}}function j(C,O){1&C&&(n.qex(0),n.nrm(1,"nz-spin",8),n.bVm())}function N(C,O){if(1&C&&(n.qex(0),n.nrm(1,"cvc-comment-body",9),n.bVm()),2&C){const r=O.ngIf;n.R7$(),n.Y8G("commentBodySegments",r)}}function F(C,O){if(1&C){const r=n.RV6();n.qex(0),n.j41(1,"nz-tabset",1)(2,"nz-tab",2)(3,"nz-mention",3),n.bIt("nzOnSearchChange",function(p){n.eBV(r);const y=n.XpG();return n.Njj(y.onSearchChange(p))})("nzOnSelect",function(){n.eBV(r);const p=n.XpG();return n.Njj(p.suggestions=[])}),n.j41(4,"textarea",4),n.mxI("ngModelChange",function(p){n.eBV(r);const y=n.XpG();return n.DH7(y.commentText,p)||(y.commentText=p),n.Njj(p)}),n.bIt("ngModelChange",function(p){n.eBV(r);const y=n.XpG();return n.Njj(y.onCommentChanged(p))}),n.k0s(),n.DNE(5,z,3,1,"ng-container",5),n.k0s()(),n.j41(6,"nz-tab",6),n.bIt("nzClick",function(){n.eBV(r);const p=n.XpG();return n.Njj(p.onPreviewButtonClicked())}),n.DNE(7,j,2,0,"ng-container",7),n.nI1(8,"ngrxPush"),n.DNE(9,N,2,1,"ng-container",7),n.nI1(10,"ngrxPush"),n.k0s()(),n.bVm()}if(2&C){const r=O.ngrxLet,m=n.XpG();n.R7$(),n.Y8G("nzAnimated",!1),n.R7$(2),n.Y8G("nzSuggestions",m.suggestions)("nzPrefix",n.lJ4(14,l))("nzValueWith",m.autoCompleteValueFor),n.R7$(),n.Y8G("placeholder",r&&r.canCurate?"Enter comment (minimum length 10. Use @ to mention users; # to link entities)":"Please sign in")("nzAutosize",n.lJ4(15,d)),n.R50("ngModel",m.commentText),n.BMQ("disabled",!r||!r.canCurate||null),n.R7$(3),n.Y8G("ngIf",n.bMT(8,10,m.previewLoading$)),n.R7$(2),n.Y8G("ngIf",n.bMT(10,12,m.previewComment$))}}let b=(()=>{class C{constructor(r,m,p,y){this.previewCommentGql=r,this.userTypeaheadGql=m,this.entityTypeaheadGql=p,this.viewerService=y,this.commentChange=new n.bkB,this.destroy$=new h.B,this.suggestions=[],this.roleSuggestions=[{displayName:"admins",value:"admins"},{displayName:"editors",value:"editors"}]}ngOnInit(){this.viewer$=this.viewerService.viewer$,this.commentText=this.comment,this.userTypeaheadQueryRef$=this.userTypeaheadGql.watch({queryTerm:""}),this.userTypeaheadQueryRef$.valueChanges.pipe((0,T.E)("data","userTypeahead"),(0,t.p)(R.kP),(0,E.Q)(this.destroy$)).subscribe(r=>this.suggestions=r.map(m=>({displayName:m.username,value:m.username}))),this.entityTypeaheadQueryRef$=this.entityTypeaheadGql.watch({queryTerm:""}),this.entityTypeaheadQueryRef$.valueChanges.pipe((0,T.E)("data","entityTypeahead"),(0,t.p)(R.kP),(0,E.Q)(this.destroy$)).subscribe(r=>this.suggestions=r.map(m=>({displayName:m.displayName,value:this.tagForEntityTypeAndId(m.tagType,m.entityId)})))}ngOnChanges(){this.commentText=this.comment}autoCompleteValueFor(r){return r.value}tagForEntityTypeAndId(r,m){switch(r){case g.lBA.Feature:return`FID${m}`;case g.lBA.Variant:return`VID${m}`;case g.lBA.VariantGroup:return`VGID${m}`;case g.lBA.EvidenceItem:return`EID${m}`;case g.lBA.Assertion:return`AID${m}`;case g.lBA.Revision:return`RID${m}`;case g.lBA.MolecularProfile:return`MPID${m}`;case g.lBA.Role:return Object.keys(g.gG1)[m]}}resetForm(){this.commentText=""}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}onPreviewButtonClicked(){this.commentText&&(this.previewComment$=this.previewCommentGql.watch({commentText:this.commentText}).valueChanges.pipe((0,T.E)("data","previewCommentText"),(0,t.p)(R.kP)),this.previewLoading$=this.previewCommentGql.watch({commentText:this.commentText}).valueChanges.pipe((0,M.T)(({loading:r})=>r),(0,x.Z)(!0)))}onSearchChange({value:r,prefix:m}){"@"===m?this.userTypeaheadQueryRef$.refetch({queryTerm:r}):"$"==m?this.suggestions=this.roleSuggestions.filter(p=>p.value.startsWith(r)):this.entityTypeaheadQueryRef$.refetch({queryTerm:r})}onCommentChanged(r){this.commentChange.emit(r)}static{this.\u0275fac=function(m){return new(m||C)(n.rXU(g.WGp),n.rXU(g.bPL),n.rXU(g.paL),n.rXU(D.q))}}static{this.\u0275cmp=n.VBU({type:C,selectors:[["cvc-comment-input-form"]],inputs:{comment:"comment"},outputs:{commentChange:"commentChange"},standalone:!1,features:[n.OA$],decls:1,vars:1,consts:[[4,"ngrxLet"],[3,"nzAnimated"],["nzTitle","Write"],["nzNotFoundContent","No matches...",3,"nzOnSearchChange","nzOnSelect","nzSuggestions","nzPrefix","nzValueWith"],["nzMentionTrigger","","nz-input","",2,"width","100%",3,"ngModelChange","placeholder","nzAutosize","ngModel"],[4,"nzMentionSuggestion"],["nzTitle","Preview",3,"nzClick"],[4,"ngIf"],["nzTip","Loading..."],[3,"commentBodySegments"]],template:function(m,p){1&m&&n.DNE(0,F,11,16,"ng-container",0),2&m&&n.Y8G("ngrxLet",p.viewer$)},dependencies:[L.bT,P.me,P.BC,S.Nj,$.JZ,$.rE,B.a,f.O2,f.sJ,f.yZ,_.Sy,_.c9,P.vS,I.p,S.L9],styles:[":host{display:block}nz-space{width:100%}nz-form-item:last-of-type{margin-bottom:0}\n"],encapsulation:2})}}return C})()},72968:(U,G,i)=>{i.d(G,{K:()=>x});var n=i(60177),h=i(25703),g=i(12617),t=i(41951),E=i(50513),M=i(54438);let x=(()=>{class T{static{this.\u0275fac=function(L){return new(L||T)}}static{this.\u0275mod=M.$C({type:T})}static{this.\u0275inj=M.G2t({imports:[n.MD,h.Ti,g.rD,t.Y3,E.Zw]})}}return T})()}}]);