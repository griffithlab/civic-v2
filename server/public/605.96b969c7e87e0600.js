"use strict";(self.webpackChunkmain=self.webpackChunkmain||[]).push([[605],{605:(mt,v,r)=>{r.r(v),r.d(v,{VariantGroupsReviseModule:()=>ct});var p=r(9808),d=r(325),y=r(373),I=r(1059),R=r(4850),t=r(5e3),c=r(712),S=r(9350),T=r(8992),g=r(1945),G=r(647),l=r(1894),P=r(8616),x=r(6949);function Z(e,o){1&e&&(t.TgZ(0,"div"),t._UZ(1,"router-outlet"),t.qZA())}function A(e,o){1&e&&(t.TgZ(0,"nz-row",8),t.TgZ(1,"div",9),t._UZ(2,"cvc-login-prompt"),t.qZA(),t.qZA())}function C(e,o){if(1&e&&(t.ynx(0),t._UZ(1,"cvc-section-navigation",1),t.TgZ(2,"nz-page-header",2),t.TgZ(3,"nz-page-header-title",3),t._uU(4," REVISE "),t._UZ(5,"i",4),t._uU(6),t.qZA(),t.TgZ(7,"nz-page-header-content"),t.TgZ(8,"div",5),t.YNc(9,Z,2,0,"div",6),t.ALo(10,"ngrxPush"),t.YNc(11,A,3,0,"ng-template",null,7,t.W1O),t.qZA(),t.qZA(),t.qZA(),t.BQk()),2&e){const n=o.ngIf,a=t.MAs(12),i=t.oxw();t.xp6(1),t.Q6J("displayName",n.name),t.xp6(5),t.hij(" ",n.name," "),t.xp6(3),t.Q6J("ngIf",t.lcZ(10,4,i.isSignedIn$))("ngIfElse",a)}}let F=(()=>{class e{constructor(n,a,i){this.gql=n,this.route=a,this.viewerService=i,this.routeSub=this.route.params.subscribe(s=>{let b=this.gql.watch({variantGroupId:+s.variantGroupId}).valueChanges;this.loading$=b.pipe((0,y.j)("loading"),(0,I.O)(!0)),this.variantGroup$=b.pipe((0,y.j)("data","variantGroup"))})}ngOnInit(){this.isSignedIn$=this.viewerService.viewer$.pipe((0,R.U)(n=>n.signedIn))}ngOnDestroy(){this.routeSub.unsubscribe()}}return e.\u0275fac=function(n){return new(n||e)(t.Y36(c.Qtd),t.Y36(d.gz),t.Y36(S.a))},e.\u0275cmp=t.Xpm({type:e,selectors:[["cvc-variant-groups-revise-view"]],decls:2,vars:3,consts:[[4,"ngIf"],[3,"displayName"],[1,"site-page-header"],["cvcFlaggableOptions",""],["nz-icon","","nzType","civic:variantgroup"],[1,"content"],[4,"ngIf","ngIfElse"],["notSignedIn",""],["nzSpan","24","nzJustify","center"],["nz-col","","nzSpan","6"]],template:function(n,a){1&n&&(t.YNc(0,C,13,6,"ng-container",0),t.ALo(1,"async")),2&n&&t.Q6J("ngIf",t.lcZ(1,1,a.variantGroup$))},directives:[p.O5,T.I,g.$O,g.u9,G.Ls,g.u5,d.lC,l.SK,l.t3,P.u],pipes:[p.Ov,x.fM],styles:["[_nghost-%COMP%]{display:block}[_nghost-%COMP%]     nz-page-header:first-of-type{background-color:#fff;border-radius:8px}[_nghost-%COMP%]     nz-page-header:first-of-type .header-content{background-color:#f0f0f0;border-top-left-radius:8px;border-top-right-radius:8px;margin:-12px -16px 16px;border-bottom:1px solid #bfbfbf}[_nghost-%COMP%]     nz-page-header:first-of-type .header-content .header-icon{padding:12px 0 12px 12px}[_nghost-%COMP%]     nz-page-header:first-of-type .header-content .header-icon i{width:100%}[_nghost-%COMP%]     nz-page-header:first-of-type .header-content .header-icon i   svg{width:100%;height:100%}[_nghost-%COMP%]     nz-page-header:first-of-type .header-content .header-description{padding:12px}[_nghost-%COMP%]     nz-page-header:first-of-type .header-content .header-description h2{color:#262626;margin:-8px 0 0;font-weight:500}[_nghost-%COMP%]     nz-page-header:first-of-type .header-content .header-description p{color:#262626;margin:-2px 0 0;padding:0;font-size:95%;line-height:1.5em}[_nghost-%COMP%]     nz-page-header:first-of-type .header-content .header-links{text-align:right;padding:12px}[_nghost-%COMP%]     nz-page-header:first-of-type .card-list nz-card{width:100%}[_nghost-%COMP%]     nz-page-header:first-of-type .card-list nz-card .card-grid-cell{width:50%}[_nghost-%COMP%]     nz-page-header:first-of-type nz-page-header-title.flagged{padding-left:.75em}[_nghost-%COMP%]     nz-page-header:first-of-type .ant-page-header-content{padding-top:0;padding-bottom:12px}[_nghost-%COMP%]     nz-page-header:first-of-type .ant-page-header-heading-extra nz-space-item:last-child{margin-right:0!important}[_nghost-%COMP%]     nz-page-header:first-of-type #section-tabs{margin:0 -16px 12px}[_nghost-%COMP%]     nz-page-header:first-of-type #section-tabs .ant-tabs-nav-wrap{padding-left:16px;padding-right:16px;line-height:24px}[_nghost-%COMP%]     nz-page-header:first-of-type #section-tabs .ant-tabs-nav-wrap .ant-tabs-tab{padding:1px 8px}[_nghost-%COMP%]     nz-page-header:first-of-type #section-tabs .ant-tabs-nav-wrap .ant-tabs-tab .anticon{margin-right:0}[_nghost-%COMP%]     nz-page-header:first-of-type #section-tabs .ant-tabs-extra-content{margin-right:16px}"]}),e})();var u=r(4182),m=r(8776),z=r(2359),J=r(6042),f=r(4546),Q=r(7525),N=r(5109),Y=r(7008),$=r(4623),U=r(8979),L=r(8390),w=r(3773),j=r(7075),B=r(7462),V=r(4181),E=r(5472),D=r(4889);let W=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[[p.ez,u.UX,d.Bz,m.X0,f.U5,z.L,l.Jb,J.sL,Q.j,m.X0,B.o,V.O,L.N,U.N,$.K,Y.B,E.r,w.g,V.O,j.l,D.E,N.s]]}),e})(),X=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[[p.ez,W]]}),e})();var M=r(3077),K=r(6123),H=r(8929),h=r(7625),_=r(9169),k=r(822);function q(e,o){1&e&&t.GkF(0)}function tt(e,o){if(1&e){const n=t.EpF();t.TgZ(0,"formly-form",4),t.NdJ("modelChange",function(i){return t.CHM(n),t.oxw().formModel=i}),t.qZA()}if(2&e){const n=t.oxw();t.Q6J("form",n.formGroup)("fields",n.formFields)("model",n.formModel)}}function et(e,o){if(1&e&&(t.TgZ(0,"nz-form-item"),t._UZ(1,"cvc-form-errors-alert",6),t.qZA()),2&e){const n=t.oxw(2);t.xp6(1),t.Q6J("errors",n.errorMessages)}}function nt(e,o){1&e&&(t.TgZ(0,"p"),t._uU(1,"View it on the "),t.TgZ(2,"a",10),t._uU(3,"Revisions Page"),t.qZA(),t._uU(4,"."),t.qZA())}function rt(e,o){if(1&e&&(t.ynx(0),t._UZ(1,"nz-alert",7),t.YNc(2,nt,5,0,"ng-template",8,9,t.W1O),t.BQk()),2&e){const n=t.MAs(3);t.xp6(1),t.Q6J("nzDescription",n)}}function ot(e,o){if(1&e&&(t.YNc(0,et,2,1,"nz-form-item",5),t.YNc(1,rt,4,1,"ng-container",5)),2&e){const n=t.oxw();t.Q6J("ngIf",n.errorMessages.length>0),t.xp6(1),t.Q6J("ngIf",n.success)}}let at=(()=>{class e{constructor(n,a,i){this.suggestRevisionGQL=n,this.revisableFieldsGQL=a,this.networkErrorService=i,this.destroy$=new H.xQ,this.formGroup=new u.cw({}),this.formOptions={},this.success=!1,this.errorMessages=[],this.loading=!1,this.suggestRevisionMutator=new K.U(i),this.formFields=[{key:"fields",wrappers:["form-container"],templateOptions:{label:"Add Variant Group Form"},fieldGroup:[{key:"name",type:"input",wrappers:["form-field"],templateOptions:{label:"Variant Group Name",required:!0}},{key:"description",type:"cvc-textarea",templateOptions:{label:"Description",helpText:"A brief description of this new variant group.",placeholder:"No description provided",required:!0}},{key:"sources",type:"multi-field",wrappers:["form-field"],templateOptions:{label:"Source",helpText:"Add any sources upon which your description depends.",addText:"Add a Source"},fieldArray:{type:"source-input",templateOptions:{hideLabel:!0,required:!0}}},{key:"variants",type:"multi-field",wrappers:["form-field"],templateOptions:{label:"Variants",helpText:"Specify the variants that comprise this Variant Group.",addText:"Add a Variant "},fieldArray:{type:"variant-input",templateOptions:{hideLabel:!0,required:!0,allowCreate:!1}}},{key:"comment",type:"comment-textarea",templateOptions:{label:"Comment",helpText:"Please provide any additional comments you wish to make about this evidence item. This comment will appear as the first comment in this item's comment thread.",placeholder:"Please enter a comment describing your revision.",required:!0,minLength:10}},{key:"cancel",type:"cancel-button",templateOptions:{redirectPath:"../.."}},{key:"organization",type:"org-submit-button",templateOptions:{submitLabel:"Submit Variant Group Revision",submitSize:"large"}}]}]}ngAfterViewInit(){this.revisableFieldsGQL.fetch({variantGroupId:this.variantGroupId}).subscribe(({data:{variantGroup:n}})=>{n&&(this.formModel=this.toFormModel(n))},n=>{console.error("Error retrieving evidenceItem."),console.error(n)},()=>{this.formOptions.updateInitialValue&&this.formOptions.updateInitialValue(),this.formGroup.markAllAsTouched();const n=this.formGroup.get("fields.comment");n&&n.markAsUntouched()})}toFormModel(n){var a;return{fields:Object.assign(Object.assign({},n),{variants:n.variants.nodes,organization:null===(a=this.formModel)||void 0===a?void 0:a.fields.organization})}}submitVariantGroup(n){let a=this.toSubmitInput(n);if(a){let i=this.suggestRevisionMutator.mutate(this.suggestRevisionGQL,{input:a});i.submitSuccess$.pipe((0,h.R)(this.destroy$)).subscribe(s=>{s&&(this.success=!0)}),i.submitError$.pipe((0,h.R)(this.destroy$)).subscribe(s=>{s&&(this.errorMessages=s,this.success=!1)}),i.isSubmitting$.pipe((0,h.R)(this.destroy$)).subscribe(s=>{this.loading=s})}}toSubmitInput(n){var a;if(n)return{id:this.variantGroupId,organizationId:null===(a=n.fields.organization)||void 0===a?void 0:a.id,comment:n.fields.comment,fields:{description:n.fields.description,name:n.fields.name,sourceIds:n.fields.sources.map(i=>i.id).filter(M.$),variantIds:n.fields.variants.map(i=>i.id).filter(M.$)}}}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}}return e.\u0275fac=function(n){return new(n||e)(t.Y36(c.aw3),t.Y36(c.ROj),t.Y36(_.Y))},e.\u0275cmp=t.Xpm({type:e,selectors:[["cvc-variant-group-revise-form"]],inputs:{variantGroupId:"variantGroupId"},decls:5,vars:3,consts:[["nz-form","","nzLayout","vertical",3,"formGroup","ngSubmit"],[4,"ngTemplateOutlet"],[3,"form","fields","model","modelChange",4,"ngIf"],["formMessages",""],[3,"form","fields","model","modelChange"],[4,"ngIf"],[3,"errors"],["nzType","success","nzMessage","Revision(s) Submitted","nzShowIcon","",3,"nzDescription"],["nzSize","small"],["successMessage",""],["routerLink","../../revisions"]],template:function(n,a){if(1&n&&(t.TgZ(0,"form",0),t.NdJ("ngSubmit",function(){return a.submitVariantGroup(a.formModel)}),t.YNc(1,q,1,0,"ng-container",1),t.YNc(2,tt,1,3,"formly-form",2),t.qZA(),t.YNc(3,ot,2,2,"ng-template",null,3,t.W1O)),2&n){const i=t.MAs(4);t.Q6J("formGroup",a.formGroup),t.xp6(1),t.Q6J("ngTemplateOutlet",i),t.xp6(1),t.Q6J("ngIf",!a.success)}},directives:[u._Y,u.JL,f.Lr,u.sg,p.tP,p.O5,m.T7,l.SK,f.Nx,k.V,z.r,d.yS],styles:[""]}),e})();function it(e,o){if(1&e&&(t.ynx(0),t._UZ(1,"cvc-variant-group-revise-form",2),t.BQk()),2&e){const n=t.oxw();t.xp6(1),t.Q6J("variantGroupId",n.variantGroupId)}}function st(e,o){1&e&&t._uU(0,"Loading Variant Group...")}const pt=[{path:"",component:F,data:{breadcrumb:"Revise"},children:[{path:"",redirectTo:"suggest",pathMatch:"full"},{path:"suggest",component:(()=>{class e{constructor(n){this.route=n,this.routeParams$=this.route.params.subscribe(a=>{this.variantGroupId=+a.variantGroupId})}ngOnDestroy(){this.routeParams$.unsubscribe()}}return e.\u0275fac=function(n){return new(n||e)(t.Y36(d.gz))},e.\u0275cmp=t.Xpm({type:e,selectors:[["cvc-variant-groups-suggest-page"]],decls:3,vars:2,consts:[[4,"ngIf","ngIfElse"],["loadingVariantGroup",""],[3,"variantGroupId"]],template:function(n,a){if(1&n&&(t.YNc(0,it,2,1,"ng-container",0),t.YNc(1,st,1,0,"ng-template",null,1,t.W1O)),2&n){const i=t.MAs(2);t.Q6J("ngIf",a.variantGroupId)("ngIfElse",i)}},directives:[p.O5,at],styles:[""]}),e})(),data:{breadcrumb:"Suggest Revision"}}]}];let dt=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[[d.Bz.forChild(pt),X],d.Bz]}),e})();var O=r(8144),lt=r(3618),ut=r(5630),gt=r(9386);let ct=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[[p.ez,dt,g.KJ,O.zf,G.PV,lt.ZJ,O.zf,ut.D,gt.a,x.WG,l.Jb]]}),e})()}}]);