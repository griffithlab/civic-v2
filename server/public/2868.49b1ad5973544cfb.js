"use strict";(self.webpackChunkmain=self.webpackChunkmain||[]).push([[2868],{2868:(Dt,F,i)=>{i.r(F),i.d(F,{EvidenceAddModule:()=>Yt});var l=i(9808),B=i(9386),V=i(5630),W=i(6905),v=i(6949),g=i(1894),I=i(5017),C=i(1945),f=i(325),J=i(4850),e=i(5e3),$=i(9350),G=i(8992),j=i(5639),R=i(160);function X(t,o){1&t&&(e.TgZ(0,"div"),e._UZ(1,"router-outlet"),e.qZA())}function H(t,o){1&t&&(e.TgZ(0,"nz-row",7)(1,"div",8),e._UZ(2,"cvc-login-prompt"),e.qZA()())}let K=(()=>{class t{constructor(n){this.viewerService=n}ngOnInit(){this.isSignedIn$=this.viewerService.viewer$.pipe((0,J.U)(n=>n.signedIn))}}return t.\u0275fac=function(n){return new(n||t)(e.Y36($.a))},t.\u0275cmp=e.Xpm({type:t,selectors:[["evidence-add"]],decls:14,vars:7,consts:[["displayName","New"],[1,"site-page-header"],["cvcFlaggableOptions",""],["nz-icon","","nzTheme","twotone","nzType","civic-evidence",3,"nzTwotoneColor"],[1,"content"],[4,"ngIf","ngIfElse"],["notSignedIn",""],["nzSpan","24","nzJustify","center"],["nz-col","","nzSpan","6"]],template:function(n,r){if(1&n&&(e._UZ(0,"cvc-section-navigation",0),e.TgZ(1,"nz-page-header",1)(2,"nz-page-header-title",2),e._UZ(3,"i",3),e.ALo(4,"entityColor"),e._uU(5," Add New Evidence "),e.qZA(),e.TgZ(6,"nz-page-header-subtitle"),e._uU(7," Submit and review new evidence items "),e.qZA(),e.TgZ(8,"nz-page-header-content")(9,"div",4),e.YNc(10,X,2,0,"div",5),e.ALo(11,"ngrxPush"),e.YNc(12,H,3,0,"ng-template",null,6,e.W1O),e.qZA()()()),2&n){const a=e.MAs(13);e.xp6(3),e.Q6J("nzTwotoneColor",e.lcZ(4,3,"EvidenceItem")),e.xp6(7),e.Q6J("ngIf",e.lcZ(11,5,r.isSignedIn$))("ngIfElse",a)}},directives:[G.I,C.$O,C.u9,I.Ls,C.yG,C.u5,l.O5,f.lC,g.SK,g.t3,j.u],pipes:[R.a,v.fM],styles:["[_nghost-%COMP%]{display:block}[_nghost-%COMP%]     nz-page-header:first-of-type{background-color:#fff;border-radius:8px}[_nghost-%COMP%]     nz-page-header:first-of-type .header-content{flex-wrap:nowrap;background-color:#f0f0f0;border-top-left-radius:8px;border-top-right-radius:8px;margin:-12px -16px 16px;border-bottom:1px solid #bfbfbf}[_nghost-%COMP%]     nz-page-header:first-of-type .header-content .header-icon{padding:12px 0 12px 12px}[_nghost-%COMP%]     nz-page-header:first-of-type .header-content .header-icon i{width:100%}[_nghost-%COMP%]     nz-page-header:first-of-type .header-content .header-icon i   svg{width:100%;height:100%}[_nghost-%COMP%]     nz-page-header:first-of-type .header-content .header-description{padding:12px}[_nghost-%COMP%]     nz-page-header:first-of-type .header-content .header-description h2{color:#262626;margin:-8px 0 0;font-weight:500}[_nghost-%COMP%]     nz-page-header:first-of-type .header-content .header-description p{color:#262626;margin:-2px 0 0;padding:0;font-size:95%;line-height:1.5em}[_nghost-%COMP%]     nz-page-header:first-of-type .header-content .header-links{text-align:right;padding:12px}[_nghost-%COMP%]     nz-page-header:first-of-type .card-list nz-card{width:100%}[_nghost-%COMP%]     nz-page-header:first-of-type .card-list nz-card .card-grid-cell{width:50%}[_nghost-%COMP%]     nz-page-header:first-of-type nz-page-header-title.flagged{padding-left:.75em}[_nghost-%COMP%]     nz-page-header:first-of-type .ant-page-header-content{padding-top:0;padding-bottom:12px}[_nghost-%COMP%]     nz-page-header:first-of-type .ant-page-header-heading-extra nz-space-item:last-child{margin-right:0!important}[_nghost-%COMP%]     nz-page-header:first-of-type #section-tabs{margin:0 -16px 12px}[_nghost-%COMP%]     nz-page-header:first-of-type #section-tabs .ant-tabs-nav-wrap{padding-left:16px;padding-right:16px;line-height:24px}[_nghost-%COMP%]     nz-page-header:first-of-type #section-tabs .ant-tabs-nav-wrap .ant-tabs-tab{padding:1px 8px}[_nghost-%COMP%]     nz-page-header:first-of-type #section-tabs .ant-tabs-nav-wrap .ant-tabs-tab .anticon{margin-right:0}[_nghost-%COMP%]     nz-page-header:first-of-type #section-tabs .ant-tabs-extra-content{margin-right:16px}"]}),t})();var h=i(8144),k=i(6559),M=i(7484),q=i(7101),ee=i(4623),te=i(8006),ne=i(9866),oe=i(3643),ie=i(4375),Q=i(7008),re=i(7695),ae=i(8390),U=i(1825),ce=i(5457),se=i(4454),le=i(3773),de=i(3594),u=i(8776),E=i(1017),y=i(2359),S=i(6042),x=i(4546),d=i(3075),pe=i(2789),ue=i(5932),me=i(3416),ge=i(7282),fe=i(1830),he=i(5599),ve=i(1270),N=i(7525),_e=i(6530),p=i(7630),O=i(444),ye=i(6906);function Ce(t,o){if(1&t&&(e.ynx(0),e._UZ(1,"formly-field",2),e.BQk()),2&t){const n=o.$implicit;e.xp6(1),e.Q6J("field",n)}}function xe(t,o){if(1&t&&e._UZ(0,"cvc-source-tag",3),2&t){const n=e.oxw();e.Q6J("source",n.model.source)}}let ze=(()=>{class t extends u.fS{constructor(){super(),this.defaultOptions={templateOptions:{label:"Source",entityType:"Source",entityFragment:p.iXf},defaultValue:{sourceType:p.yic.Pubmed,source:void 0},fieldGroupClassName:"select-group",fieldGroup:[{key:"sourceType",type:"select",className:"type-field",templateOptions:{required:!1,placeholder:"Select Type",options:(0,O.o6)(p.yic).map((n,r)=>({value:n,label:(0,_e.c)(n)}))},hideExpression:(n,r,a)=>(console.log(n),null!=n.source)},{key:"source",type:"citation-select",className:"citation-field",templateOptions:{required:!1},hideExpression:(n,r,a)=>(console.log(n),null!=n.source)}]}}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=e.Xpm({type:t,selectors:[["cvc-source-select"]],features:[e.qOj],decls:2,vars:2,consts:[[4,"ngFor","ngForOf"],[3,"source",4,"ngIf"],[3,"field"],[3,"source"]],template:function(n,r){1&n&&(e.YNc(0,Ce,2,1,"ng-container",0),e.YNc(1,xe,1,1,"cvc-source-tag",1)),2&n&&(e.Q6J("ngForOf",r.field.fieldGroup),e.xp6(1),e.Q6J("ngIf",null!=r.model.source))},directives:[l.sg,u.cw,l.O5,ye.T],styles:["[_nghost-%COMP%]{display:block}.type-field[_ngcontent-%COMP%]{display:inline-block;width:10em}.citation-field[_ngcontent-%COMP%]{display:inline-block;margin-left:.5em;width:calc(100% - 10.5em)}.hidden[_ngcontent-%COMP%]{display:none}"]}),t})();var b=i(8054),z=i(3618),Te=i(8481),Se=i(373),be=i(655),A=i(4987),Y=i(537),D=i(822),Ie=i(2643),Me=i(2683);function Ee(t,o){if(1&t&&e._UZ(0,"nz-alert",6),2&t){e.oxw();const n=e.MAs(3);e.Q6J("nzMessage",n)}}function Oe(t,o){if(1&t&&(e._uU(0," Found citation: "),e.TgZ(1,"em"),e._uU(2),e.qZA(),e._uU(3,", would you like to add it? ")),2&t){const n=e.oxw(3);e.xp6(2),e.Oqu(n.foundCitation)}}function Ae(t,o){1&t&&(e.ynx(0),e.YNc(1,Ee,1,1,"nz-alert",4),e.YNc(2,Oe,4,1,"ng-template",null,5,e.W1O),e.BQk())}function Ze(t,o){if(1&t&&e._UZ(0,"nz-alert",9),2&t){e.oxw();const n=e.MAs(3);e.Q6J("nzMessage",n)}}function we(t,o){if(1&t&&(e._uU(0," '"),e.TgZ(1,"em"),e._uU(2),e.qZA(),e._uU(3,"' created. ")),2&t){const n=e.oxw(3);e.xp6(2),e.Oqu(n.foundCitation)}}function Pe(t,o){1&t&&(e.ynx(0),e.YNc(1,Ze,1,1,"nz-alert",7),e.YNc(2,we,4,1,"ng-template",null,8,e.W1O),e.BQk())}function Le(t,o){if(1&t&&(e.TgZ(0,"nz-form-item"),e._UZ(1,"cvc-form-errors-alert",10),e.qZA()),2&t){const n=e.oxw(2);e.xp6(1),e.Q6J("errors",n.createErrors)}}function Fe(t,o){if(1&t){const n=e.EpF();e.TgZ(0,"button",12),e.NdJ("click",function(a){return e.CHM(n),e.oxw(3).onAddRemoteCitation(a)}),e._uU(1," Add\xa0'"),e.TgZ(2,"em"),e._uU(3),e.qZA(),e._uU(4,"'\xa0 to CIViC Sources "),e.qZA()}if(2&t){const n=e.oxw(3);e.Q6J("nzLoading",n.isCreating),e.xp6(3),e.Oqu(n.foundCitation)}}function Je(t,o){1&t&&(e.ynx(0),e.YNc(1,Fe,5,2,"button",11),e.BQk())}function Qe(t,o){if(1&t){const n=e.EpF();e.TgZ(0,"button",14),e.NdJ("click",function(a){return e.CHM(n),e.oxw(3).onAcceptSource(a)}),e._uU(1," Specify this Source "),e.qZA()}}function Ue(t,o){1&t&&(e.ynx(0),e.YNc(1,Qe,2,0,"button",13),e.BQk())}function Ne(t,o){if(1&t&&(e.ynx(0),e.TgZ(1,"nz-space",2),e.YNc(2,Ae,4,0,"ng-container",3),e.YNc(3,Pe,4,0,"ng-container",3),e.YNc(4,Le,2,1,"nz-form-item",3),e.YNc(5,Je,2,0,"ng-container",3),e.YNc(6,Ue,2,0,"ng-container",3),e.qZA(),e.BQk()),2&t){const n=e.oxw();e.xp6(2),e.Q6J("ngIf",!1===n.createSuccess&&0===n.createErrors.length),e.xp6(1),e.Q6J("ngIf",!0===n.createSuccess),e.xp6(1),e.Q6J("ngIf",n.createErrors.length>0),e.xp6(1),e.Q6J("ngIf",!1===n.createSuccess),e.xp6(1),e.Q6J("ngIf",!0===n.createSuccess)}}function Ye(t,o){if(1&t&&(e.TgZ(0,"span",16),e._UZ(1,"i",17),e._uU(2),e.qZA()),2&t){const n=e.oxw(3);e.xp6(2),e.hij(" Source not known to CIViC, fetch citation from ",n.sourceTypeKey,"? ")}}function De(t,o){1&t&&(e.ynx(0),e.YNc(1,Ye,3,1,"span",15),e.BQk())}function Be(t,o){if(1&t&&(e.TgZ(0,"nz-form-item"),e._UZ(1,"cvc-form-errors-alert",10),e.qZA()),2&t){const n=e.oxw(2);e.xp6(1),e.Q6J("errors",n.existenceErrors)}}function Ve(t,o){if(1&t&&e._uU(0),2&t){const n=e.oxw(4);e.AsE(" Citation not found for ",n.sourceTypeKey,": ",n.citationId,". ")}}function We(t,o){if(1&t&&(e.TgZ(0,"span"),e._UZ(1,"nz-alert",19),e.YNc(2,Ve,1,2,"ng-template",null,20,e.W1O),e.qZA()),2&t){const n=e.MAs(3);e.xp6(1),e.Q6J("nzMessage",n)}}function $e(t,o){1&t&&(e.ynx(0),e.YNc(1,We,4,1,"span",18),e.BQk())}function Ge(t,o){if(1&t){const n=e.EpF();e.TgZ(0,"button",12),e.NdJ("click",function(a){return e.CHM(n),e.oxw(2).onExistenceQuery(a)}),e._uU(1," Fetch Citation for\xa0"),e.TgZ(2,"strong"),e._uU(3),e.qZA()()}if(2&t){const n=e.oxw(2);e.Q6J("nzLoading",n.isChecking),e.xp6(3),e.AsE("",n.sourceTypeKey," ",n.citationId,"")}}function je(t,o){if(1&t&&(e.TgZ(0,"nz-space",2),e.YNc(1,De,2,0,"ng-container",3),e.YNc(2,Be,2,1,"nz-form-item",3),e.YNc(3,$e,2,0,"ng-container",3),e.YNc(4,Ge,4,3,"button",11),e.qZA()),2&t){const n=e.oxw();e.xp6(1),e.Q6J("ngIf",n.showPrompt),e.xp6(1),e.Q6J("ngIf",n.existenceErrors.length>0),e.xp6(1),e.Q6J("ngIf",n.existenceFail)}}let _=class{constructor(o,n,r){this.existenceCheckQuery=o,this.createSourceStubQuery=n,this.changeDetectorRef=r,this.addCitation=new e.vpe,this.citationIdChange=new e.vpe,this.sourceTypeChange=new e.vpe,this.showPrompt=!0,this.isChecking=!1,this.existenceFail=!1,this.existenceErrors=[],this.foundCitation=void 0,this.isCreating=!1,this.createSuccess=!1,this.createErrors=[]}set sourceType(o){this._sourceType=o,this.sourceTypeKey=(0,O.o6)(p.yic).getKeyOrThrow(o)}get sourceType(){return this._sourceType}onExistenceQuery(o){o&&o.preventDefault(),this.isChecking=!0,this.foundCitation=void 0,this.existenceCheckQuery.fetch({sourceType:this.sourceType,citationId:this.citationId}).pipe((0,Y.x)(()=>{this.isChecking=!1,this.changeDetectorRef.detectChanges()}),(0,A.t)(this)).subscribe({next:({data:{remoteCitation:n}})=>{null!==n?this.foundCitation=n:(this.showPrompt=!1,this.existenceFail=!0)},error:n=>{this.showPrompt=!1,this.existenceErrors=n.graphQLErrors.map(r=>r.message)},complete:()=>{this.existenceErrors=[]}})}onAddRemoteCitation(o){o&&o.preventDefault(),this.isCreating=!0,this.createSuccess=!1,this.createSourceStubQuery.mutate({input:{citationId:this.citationId,sourceType:this.sourceType}}).pipe((0,Y.x)(()=>{this.isCreating=!1,this.changeDetectorRef.detectChanges()}),(0,A.t)(this)).subscribe({next:({data:n})=>{var r;console.log(n);const a=null===(r=null==n?void 0:n.addRemoteCitation)||void 0===r?void 0:r.newSource;this.sourceStub=a,this.createSuccess=!0},error:n=>{this.showPrompt=!1,this.createSuccess=!1,this.createErrors=n.graphQLErrors.map(r=>r.message)},complete:()=>{this.createErrors=[]}})}onAcceptSource(o){o&&o.preventDefault(),this.addCitation.emit({id:this.sourceStub.id,entityFragment:p.SJD})}};function Re(t,o){if(1&t&&(e.TgZ(0,"nz-option",4),e._uU(1),e.qZA()),2&t){const n=o.$implicit;e.Q6J("nzLabel",n.label)("nzValue",n.source),e.xp6(1),e.AsE(" ",n.source.citation," (",n.source.citationId,") ")}}function Xe(t,o){if(1&t&&(e.ynx(0),e.YNc(1,Re,2,4,"nz-option",3),e.BQk()),2&t){const n=o.ngrxLet;e.xp6(1),e.Q6J("ngForOf",n)}}function He(t,o){if(1&t&&(e.TgZ(0,"div",8),e._uU(1),e.qZA()),2&t){const n=e.oxw(2);e.xp6(1),e.hij(" ",n.to.prompt," ")}}function Ke(t,o){if(1&t){const n=e.EpF();e.TgZ(0,"cvc-citation-loader",9),e.NdJ("addCitation",function(a){return e.CHM(n),e.oxw(2).onAddCitation(a)})("sourceTypeChange",function(a){return e.CHM(n),e.oxw(2).model.sourceType=a})("citationIdChange",function(a){return e.CHM(n),e.oxw(2).to.searchValue=a}),e.qZA()}if(2&t){const n=e.oxw(2);e.Q6J("model",n.model)("sourceType",n.model.sourceType)("citationId",n.to.searchValue)}}function ke(t,o){if(1&t&&(e.ynx(0,5),e.YNc(1,He,2,1,"div",6),e.YNc(2,Ke,1,3,"cvc-citation-loader",7),e.BQk()),2&t){const n=e.oxw();e.Q6J("ngSwitch",n.to.searchLength>0&&n.to.searchLength>=n.to.minSearchLength),e.xp6(1),e.Q6J("ngSwitchCase",!1),e.xp6(1),e.Q6J("ngSwitchCase",!0)}}_.\u0275fac=function(o){return new(o||_)(e.Y36(p.gtM),e.Y36(p.RMv),e.Y36(e.sBO))},_.\u0275cmp=e.Xpm({type:_,selectors:[["cvc-citation-loader"]],inputs:{model:"model",citationId:"citationId",sourceType:"sourceType"},outputs:{addCitation:"addCitation",citationIdChange:"citationIdChange",sourceTypeChange:"sourceTypeChange"},decls:3,vars:2,consts:[[4,"ngIf","ngIfElse"],["fetchCitation",""],["nzDirection","vertical"],[4,"ngIf"],["nzType","info","nzShowIcon","",3,"nzMessage",4,"nzSpaceItem"],["foundCitationMsg",""],["nzType","info","nzShowIcon","",3,"nzMessage"],["nzType","success","nzShowIcon","",3,"nzMessage",4,"nzSpaceItem"],["createdMsg",""],["nzType","success","nzShowIcon","",3,"nzMessage"],[3,"errors"],["type","submit","nz-button","","nzBlock","","nzType","primary","nzSize","default",3,"nzLoading","click",4,"nzSpaceItem"],["type","submit","nz-button","","nzBlock","","nzType","primary","nzSize","default",3,"nzLoading","click"],["type","submit","nz-button","","nzBlock","","nzType","primary","nzSize","default",3,"click",4,"nzSpaceItem"],["type","submit","nz-button","","nzBlock","","nzType","primary","nzSize","default",3,"click"],["nz-typography","",4,"nzSpaceItem"],["nz-typography",""],["nz-icon","","nzType","info-circle","nzTheme","twotone"],[4,"nzSpaceItem"],["nzType","warning","nzShowIcon","",3,"nzMessage"],["existenceFail",""]],template:function(o,n){if(1&o&&(e.YNc(0,Ne,7,5,"ng-container",0),e.YNc(1,je,5,3,"ng-template",null,1,e.W1O)),2&o){const r=e.MAs(2);e.Q6J("ngIf",n.foundCitation)("ngIfElse",r)}},directives:[l.O5,h.NU,h.$1,y.r,g.SK,x.Nx,D.V,S.ix,Ie.dQ,Me.w],styles:["[_nghost-%COMP%]{display:block}nz-space[_ngcontent-%COMP%]{width:100%}nz-space-item[_ngcontent-%COMP%]:last-child{margin-bottom:0}"]}),_=(0,be.gn)([(0,A.c)()],_);let qe=(()=>{class t extends u.fS{constructor(n){super(),this.sourceTypeaheadQuery=n,this.defaultOptions={templateOptions:{placeholder:"Search Sources",onSearch:()=>{},minSearchLength:1,maxSearchLength:15,searchLength:0,searchValue:""},expressionProperties:{"templateOptions.prompt":r=>`Search for ${(0,O.o6)(p.yic).getKeyOrThrow(r.sourceType)} sources known to CIViC.`}},this.onAddCitation=r=>{const a=this.field.parent.templateOptions;a.entityType="SourceStub",a.entityFragment=r.entityFragment,this.field.formControl.setValue(r.id)}}ngOnInit(){this.queryRef=this.sourceTypeaheadQuery.watch({sourceType:this.model.sourceType,partialCitationId:"9999999"}),this.sources$=this.queryRef.valueChanges.pipe((0,Se.j)("data","sourceTypeahead"),(0,J.U)(n=>n.map(r=>({value:r.id,label:r.citation?r.citation:r.name,source:r}))))}ngAfterViewInit(){this.to.onSearch=n=>{this.to.searchLength=n.length,this.to.searchValue=n,!(n.length<this.to.minLengthSearch||n.length>this.to.maxLength)&&this.queryRef.refetch({sourceType:p.yic.Pubmed,partialCitationId:n})}}}return t.\u0275fac=function(n){return new(n||t)(e.Y36(p.NbY))},t.\u0275cmp=e.Xpm({type:t,selectors:[["cvc-citation-select-type"]],features:[e.qOj],decls:4,vars:7,consts:[["nzShowSearch","","nzServerSearch","",3,"formControl","formlyAttributes","nzPlaceHolder","nzNotFoundContent","nzShowArrow","nzFilterOption","nzOnSearch"],[4,"ngrxLet"],["notFound",""],["nzCustomContent","",3,"nzLabel","nzValue",4,"ngFor","ngForOf"],["nzCustomContent","",3,"nzLabel","nzValue"],[3,"ngSwitch"],["class","ant-form-item-explain",4,"ngSwitchCase"],[3,"model","sourceType","citationId","addCitation","sourceTypeChange","citationIdChange",4,"ngSwitchCase"],[1,"ant-form-item-explain"],[3,"model","sourceType","citationId","addCitation","sourceTypeChange","citationIdChange"]],template:function(n,r){if(1&n&&(e.TgZ(0,"nz-select",0),e.NdJ("nzOnSearch",function(c){return r.to.onSearch(c)}),e.YNc(1,Xe,2,1,"ng-container",1),e.qZA(),e.YNc(2,ke,3,3,"ng-template",null,2,e.W1O)),2&n){const a=e.MAs(3);e.Q6J("formControl",r.formControl)("formlyAttributes",r.field)("nzPlaceHolder",r.to.placeholder?r.to.placeholder:null)("nzNotFoundContent",a)("nzShowArrow",!1)("nzFilterOption",r.to.filterOption),e.xp6(1),e.Q6J("ngrxLet",r.sources$)}},directives:[b.Vq,d.JJ,d.oH,u.VQ,v.eJ,l.sg,b.Ip,l.RF,l.n9,_],styles:["[_nghost-%COMP%]{display:block}.loading-icon[_ngcontent-%COMP%]{margin-right:8px}.source-citation[_ngcontent-%COMP%]{font-style:oblique}"],changeDetection:0}),t})(),et=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[[l.ez,h.zf,y.L,x.U5,Q.B,S.sL]]}),t})();const tt={types:[{name:"citation-select",component:qe}]};let nt=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[[l.ez,d.UX,v.WG,b.LV,et,u.X0.forChild(tt),E.s]]}),t})();var ot=i(9779);const it={types:[{name:"source-select",component:ze,wrappers:["form-field"]}]};let rt=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[[l.ez,d.UX,v.WG,u.X0.forChild(it),b.LV,h.zf,z.ZJ,Te.X,nt,ot.s]]}),t})();var at=i(5472),ct=i(4889),st=i(767),lt=i(304),dt=i(591),pt=i(3392);function ut(t,o){if(1&t){const n=e.EpF();e.TgZ(0,"div",3)(1,"h4",4),e._uU(2,"Evidence matching this Gene/Variant/Source combination already exists."),e.qZA(),e.TgZ(3,"p",4)(4,"strong"),e._uU(5,"Please review the EIDs below to make sure your proposed Evidence is not already present in CIViC."),e.qZA()()(),e.TgZ(6,"cvc-evidence-table",5),e.NdJ("initialTotalCount",function(a){return e.CHM(n),e.oxw(2).initalCountLoaded(a)}),e.qZA()}if(2&t){const n=e.oxw(2);e.xp6(6),e.Q6J("sourceId",n.to.evidenceParams.sourceId)("variantId",n.to.evidenceParams.variantId)}}const mt=function(t){return{hidden:t}};function gt(t,o){if(1&t&&(e.ynx(0),e._UZ(1,"nz-alert",1),e.ALo(2,"ngrxPush"),e.YNc(3,ut,7,2,"ng-template",null,2,e.W1O),e.BQk()),2&t){const n=e.MAs(4),r=e.oxw();e.xp6(1),e.Q6J("ngClass",e.VKq(4,mt,!e.lcZ(2,2,r.matchingEvidenceExists$)))("nzDescription",n)}}const ft={name:"duplicate-evidence-warning",component:(()=>{class t extends u.fS{constructor(){super(),this.paramsFilled=!1,this.matchingEvidenceExists$=new dt.X(!1),this.defaultOptions=Object.assign(Object.assign({},this.defaultOptions),{expressionProperties:{"templateOptions.evidenceParams":(n,r,a)=>{var c;let s=null===(c=null==a?void 0:a.parent)||void 0===c?void 0:c.model,m={};if(s&&(s.variant&&s.variant[0]&&(m.variantId=s.variant[0].id),s.source&&s.source[0]&&(m.sourceId=s.source[0].id),m.sourceId&&m.variantId))return this.paramsFilled=!0,m;this.paramsFilled=!1}},hideExpression:n=>!this.paramsFilled})}ngOnInit(){}initalCountLoaded(n){n>0&&this.matchingEvidenceExists$.next(!0)}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=e.Xpm({type:t,selectors:[["cvc-duplicate-evidence-warning"]],features:[e.qOj],decls:1,vars:1,consts:[[4,"ngIf"],["nzType","warning",3,"ngClass","nzDescription"],["evidenceTable",""],[2,"padding","10px"],["nz-typography",""],[3,"sourceId","variantId","initialTotalCount"]],template:function(n,r){1&n&&e.YNc(0,gt,5,6,"ng-container",0),2&n&&e.Q6J("ngIf",r.to.evidenceParams&&r.to.evidenceParams.sourceId&&r.to.evidenceParams.variantId)},directives:[l.O5,y.r,l.mk,z.ZU,pt.a],pipes:[v.fM],styles:[".hidden[_ngcontent-%COMP%]{display:none}"]}),t})()};let ht=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[[l.ez,d.u5,d.UX,v.WG,lt.F,u.X0.forChild({types:[ft]}),y.L,z.ZJ,st.Q]]}),t})();var vt=i(3022),_t=i(7462),yt=i(7220);let Ct=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[[l.ez,f.Bz,d.UX,E.s,x.U5,y.L,g.Jb,S.sL,N.j,u.X0,U.A,Q.B,ie.R,re.C,vt.e,ae.N,le.g,ne.a,se.W,ce.$,te.I,_t.o,ee.K,de.q,oe.q,q.U,pe.o,ue.A,me.g,ge.B,fe.S,he.E,ve.i,rt,at.r,ht,ct.E,yt.m,M.vh,h.zf,z.ZJ,f.Bz,E.s]]}),t})();var xt=i(6462),zt=i(3868);let Tt=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[[l.ez,d.u5,g.Jb,h.zf,M.vh,k.H0,Ct,xt.m,zt.aF,g.Jb,I.PV,S.sL,U.A]]}),t})();var Z=i(6738),St=i(8929),bt=i(4024),It=i(6123),w=i(7625),Mt=i(9169);function Et(t,o){1&t&&(e.TgZ(0,"nz-card")(1,"nz-typography"),e._uU(2," To add an evidence item, please complete the following form, provide a short statement supporting its inclusion into the CIViC database, then click the 'Submit Evidence for Inclusion' button. If you are having difficulty filling in all of the required fields please use the "),e.TgZ(3,"a",3),e._uU(4,"Suggest Source form"),e.qZA(),e._uU(5," to suggest a publication for curators to review. "),e._UZ(6,"br")(7,"br"),e.TgZ(8,"strong"),e._uU(9,"Please ensure that your submission contains no "),e.TgZ(10,"a",4),e._uU(11,"Protected Health Information"),e.qZA(),e._uU(12,", and is your own original work. By contributing to CIViC you agree to release your contributions to the public domain as described by the "),e.TgZ(13,"a",5),e._uU(14,"Creative Commons Public Domain Dedication (CC0 1.0 Universal)"),e.qZA(),e._uU(15,"."),e.qZA()()())}function Ot(t,o){1&t&&e.GkF(0)}function At(t,o){if(1&t){const n=e.EpF();e.TgZ(0,"formly-form",12),e.NdJ("modelChange",function(a){return e.CHM(n),e.oxw(3).formModel=a}),e.qZA()}if(2&t){const n=e.oxw(3);e.Q6J("form",n.formGroup)("fields",n.formFields)("model",n.formModel)("options",n.formOptions)}}function Zt(t,o){if(1&t){const n=e.EpF();e.TgZ(0,"form",9),e.NdJ("ngSubmit",function(){e.CHM(n);const a=e.oxw(2);return a.submitEvidence(a.formModel)}),e.YNc(1,Ot,1,0,"ng-container",10),e.YNc(2,At,1,4,"formly-form",11),e.qZA()}if(2&t){e.oxw();const n=e.MAs(3),r=e.oxw();e.Q6J("formGroup",r.formGroup),e.xp6(1),e.Q6J("ngTemplateOutlet",n),e.xp6(1),e.Q6J("ngIf",!r.success)}}function wt(t,o){if(1&t&&(e.TgZ(0,"nz-form-item"),e._UZ(1,"cvc-form-errors-alert",14),e.qZA()),2&t){const n=e.oxw(3);e.xp6(1),e.Q6J("errors",n.errorMessages)}}function Pt(t,o){if(1&t&&(e.TgZ(0,"p"),e._uU(1,"View "),e.TgZ(2,"a",18),e._uU(3,"its details"),e.qZA(),e._uU(4,"."),e.qZA()),2&t){const n=e.oxw(4);e.xp6(2),e.MGl("routerLink","/evidence/",n.newId,"/summary")}}function Lt(t,o){if(1&t&&(e.ynx(0),e._UZ(1,"nz-alert",15),e.YNc(2,Pt,5,1,"ng-template",16,17,e.W1O),e.BQk()),2&t){const n=e.MAs(3);e.xp6(1),e.Q6J("nzDescription",n)}}function Ft(t,o){if(1&t&&(e.YNc(0,wt,2,1,"nz-form-item",13),e.YNc(1,Lt,4,1,"ng-container",13)),2&t){const n=e.oxw(2);e.Q6J("ngIf",n.errorMessages.length>0),e.xp6(1),e.Q6J("ngIf",n.success)}}function Jt(t,o){if(1&t&&(e.TgZ(0,"nz-spin",6),e.YNc(1,Zt,3,3,"form",7),e.YNc(2,Ft,2,2,"ng-template",null,8,e.W1O),e.qZA()),2&t){const n=e.oxw();e.Q6J("nzSpinning",n.loading||!n.showForm),e.xp6(1),e.Q6J("ngIf",n.showForm)}}let Qt=(()=>{class t{constructor(n,r,a,c){this.submitEvidenceGQL=n,this.sourceSuggestionGQL=r,this.networkErrorService=a,this.route=c,this.destroy$=new St.xQ,this.formGroup=new d.cw({}),this.formOptions={formState:new bt._},this.success=!1,this.errorMessages=[],this.loading=!1,this.showForm=!1,this.submitEvidenceMutator=new It.U(a),this.formFields=[{key:"fields",wrappers:["form-container"],templateOptions:{label:"Add Evidence Item Form"},fieldGroup:[{key:"molecularProfile",type:"molecular-profile-input",templateOptions:{label:"Molecular Profile",helpText:"A single variant (Simple Molecular Profile) or a combination of variants (Complex Molecular Profile) relevant to the curated evidence.",required:!0,allowCreate:!0}},{key:"source",type:"multi-field",wrappers:["form-field"],templateOptions:{label:"Source",helpText:"CIViC accepts PubMed or ASCO Abstracts sources. Please provide the source of the support for your evidence here.",addText:"Specify a Source",maxCount:1,required:!0},fieldArray:{type:"source-input",templateOptions:{hideLabel:!0,required:!0}}},{key:"duplicate-evidence-warning",type:"duplicate-evidence-warning"},{key:"description",type:"cvc-textarea",templateOptions:{label:"Evidence Statement",helpText:'Your original description of evidence from published literature detailing the association or lack of association between a variant and its predictive, prognostic, diagnostic, predisposing, functional or oncogenic value. Data constituting personal or identifying information should not be entered (e.g. <a href="https://www.hipaajournal.com/what-is-protected-health-information/" target="_blank">protected health information (PHI) as defined by HIPAA</a> in the U.S. and/or comparable laws in your jurisdiction).',placeholder:"No description provided",required:!0}},{key:"variantOrigin",type:"variant-origin-select",templateOptions:{required:!0}},{key:"evidenceType",type:"evidence-type-select",templateOptions:{required:!0}},{key:"evidenceDirection",type:"evidence-direction-select",templateOptions:{required:!0}},{key:"significance",type:"significance-select",templateOptions:{required:!0}},{key:"disease",type:"disease-array",templateOptions:{maxCount:1}},{key:"evidenceLevel",type:"evidence-level-select",templateOptions:{required:!0}},{key:"therapies",type:"therapy-array"},{key:"therapyInteractionType",type:"therapy-interaction-select"},{key:"phenotypes",type:"phenotype-array"},{key:"evidenceRating",type:"rating-input",templateOptions:{required:!0,label:"Rating",helpText:"Please rate your evidence on a scale of one to five stars. Use the star rating descriptions for guidance."}},{key:"comment",type:"comment-textarea",templateOptions:{label:"Comment",helpText:"Please provide any additional comments you wish to make about this evidence item. This comment will appear as the first comment in this item's comment thread.",placeholder:"Please enter a comment describing your revision.",required:!1,minLength:10}},{key:"cancel",type:"cancel-button"},{key:"organization",type:"org-submit-button",templateOptions:{submitLabel:"Submit Evidence Item",submitSize:"large"}}]}]}ngAfterViewInit(){this.route.queryParams.subscribe(n=>{let r=!1;n.molecularProfileId&&(r=!0,this.submittedMpId=+n.molecularProfileId),n.sourceId&&(r=!0,this.submittedSourceId=+n.sourceId),n.diseaseId&&(r=!0,this.submittedDiseaseId=+n.diseaseId),r?this.sourceSuggestionGQL.fetch({molecularProfileId:this.submittedMpId,diseaseId:this.submittedDiseaseId,sourceId:this.submittedSourceId}).subscribe(({data:{sourceSuggestionValues:a},loading:c})=>{var s,m,P,L;this.loading=c;let T={fields:{}};a.molecularProfile&&(T.fields.molecularProfile=a.molecularProfile),a.disease&&(T.fields.disease=[a.disease]),a.source&&(T.fields.source=[a.source]),(null===(m=null===(s=this.formModel)||void 0===s?void 0:s.fields)||void 0===m?void 0:m.organization)&&(T.organization=null===(L=null===(P=this.formModel)||void 0===P?void 0:P.fields)||void 0===L?void 0:L.organization),this.formModel=T},a=>{console.error("Error retrieving source suggestion data."),console.error(a)},()=>{this.formOptions.updateInitialValue&&this.formOptions.updateInitialValue(),this.formGroup.markAllAsTouched(),this.showForm=!0}):this.showForm=!0})}submitEvidence(n){let r=this.toSubmitInput(n);if(r){let a=this.submitEvidenceMutator.mutate(this.submitEvidenceGQL,{input:r},{},c=>{var s;this.newId=null===(s=c.submitEvidence)||void 0===s?void 0:s.evidenceItem.id});a.submitSuccess$.pipe((0,w.R)(this.destroy$)).subscribe(c=>{c&&(this.success=!0)}),a.submitError$.pipe((0,w.R)(this.destroy$)).subscribe(c=>{c&&(this.errorMessages=c,this.success=!1)}),a.isSubmitting$.pipe((0,w.R)(this.destroy$)).subscribe(c=>{this.loading=c})}}toSubmitInput(n){var r,a;if(n){const c=n.fields;return{fields:{variantOrigin:c.variantOrigin,description:Z.xt(c.description),molecularProfileId:c.molecularProfile.id,sourceId:c.source[0].id,evidenceType:c.evidenceType,evidenceDirection:c.evidenceDirection,significance:c.significance,diseaseId:Z.uP(null===(r=c.disease[0])||void 0===r?void 0:r.id),evidenceLevel:c.evidenceLevel,phenotypeIds:c.phenotypes.map(s=>s.id),rating:+c.evidenceRating,therapyIds:c.therapies.map(s=>s.id),therapyInteractionType:Z.uP(c.therapies.length>1?c.therapyInteractionType:void 0)},comment:c.comment&&c.comment.length>0?c.comment:void 0,organizationId:null===(a=null==n?void 0:n.fields.organization)||void 0===a?void 0:a.id}}}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}}return t.\u0275fac=function(n){return new(n||t)(e.Y36(p.WFw),e.Y36(p.FId),e.Y36(Mt.Y),e.Y36(f.gz))},t.\u0275cmp=e.Xpm({type:t,selectors:[["cvc-evidence-submit-form"]],decls:3,vars:0,consts:[["nzDirection","vertical"],[4,"nzSpaceItem"],["nzTip","Loading",3,"nzSpinning",4,"nzSpaceItem"],["routerLink","/sources/add"],["href","http://www.hipaa.com/hipaa-protected-health-information-what-does-phi-include/","target","_blank"],["href","https://creativecommons.org/publicdomain/zero/1.0/","target","_blank"],["nzTip","Loading",3,"nzSpinning"],["nz-form","","nzLayout","vertical",3,"formGroup","ngSubmit",4,"ngIf"],["formMessages",""],["nz-form","","nzLayout","vertical",3,"formGroup","ngSubmit"],[4,"ngTemplateOutlet"],[3,"form","fields","model","options","modelChange",4,"ngIf"],[3,"form","fields","model","options","modelChange"],[4,"ngIf"],[3,"errors"],["nzType","success","nzMessage","Evidence Submitted","nzShowIcon","",3,"nzDescription"],["nzSize","small"],["successMessage",""],[3,"routerLink"]],template:function(n,r){1&n&&(e.TgZ(0,"nz-space",0),e.YNc(1,Et,16,0,"nz-card",1),e.YNc(2,Jt,4,2,"nz-spin",2),e.qZA())},directives:[h.NU,h.$1,M.bd,z.ZU,f.yS,N.W,l.O5,d._Y,d.JL,x.Lr,d.sg,l.tP,u.T7,g.SK,x.Nx,D.V,y.r],styles:[""]}),t})();const Ut=[{path:"",component:K,children:[{path:"",redirectTo:"submit",pathMatch:"full"},{path:"submit",component:(()=>{class t{constructor(n){this.route=n,this.routeParams$=this.route.params.subscribe(r=>{this.evidenceId=+r.evidenceId})}ngOnDestroy(){this.routeParams$.unsubscribe()}}return t.\u0275fac=function(n){return new(n||t)(e.Y36(f.gz))},t.\u0275cmp=e.Xpm({type:t,selectors:[["cvc-evidence-submit"]],decls:1,vars:0,template:function(n,r){1&n&&e._UZ(0,"cvc-evidence-submit-form")},directives:[Qt],styles:[""]}),t})(),data:{breadcrumb:"Submit New Evidence"}}]}];let Nt=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[[f.Bz.forChild(Ut),Tt],f.Bz]}),t})(),Yt=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[[l.ez,v.WG,Nt,g.Jb,I.PV,C.KJ,B.a,V.D,W.s]]}),t})()}}]);