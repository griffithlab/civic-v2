"use strict";(self.webpackChunkmain=self.webpackChunkmain||[]).push([[3575],{5565:(B,P,i)=>{i.d(P,{D:()=>vt});var a,c=i(313),u=i(7398),e=i(4223),t=i(5879),f=i(6814),L=i(2840),N=i(855),h=i(95),x=i(2962),y=i(6976),S=i(551),C=i(6928),E=i(2574),I=i(655),$=i(2024),z=i(1791),R=i(951),U=i(7473),A=i(6223),Z=i(1958),M=i(3599),O=i(2669),F=i(3903),g=i(6109),v=i(6943),o=i(5883),s=i(1446);function _(m,l){if(1&m){const n=t.EpF();t.TgZ(0,"nz-alert",6),t.NdJ("nzOnClose",function(){t.CHM(n);const p=t.oxw();return t.KtG(p.onSuccessBannerClose())}),t.qZA()}}function d(m,l){if(1&m&&(t.TgZ(0,"nz-form-item"),t._UZ(1,"cvc-form-errors-alert",7),t.qZA()),2&m){const n=t.oxw();t.xp6(1),t.Q6J("errors",n.errorMessages)}}let T=((a=class{constructor(l,n,r){this.viewerService=l,this.addCommentGql=n,this.networkErrorService=r,this.commentAddedEvent=new t.vpe,this.success=!1,this.errorMessages=[],this.loading=!1,this.viewerService.viewer$.pipe((0,z.t)(this)).subscribe(p=>{this.mostRecentOrg=p.mostRecentOrg}),this.addCommentMutator=new $.U(this.networkErrorService)}submitComment(){if(this.commentText){this.errorMessages=[];let n=this.addCommentMutator.mutate(this.addCommentGql,{input:{body:this.commentText,subject:this.subject,organizationId:void 0===this.mostRecentOrg?void 0:this.mostRecentOrg.id}});n.submitSuccess$.pipe((0,z.t)(this)).subscribe(r=>{r&&(this.resetForm(),this.success=!0)}),n.submitError$.pipe((0,z.t)(this)).subscribe(r=>{r&&(this.errorMessages=r,this.success=!1)}),n.isSubmitting$.pipe((0,z.t)(this)).subscribe(r=>{this.loading=r})}}resetForm(){this.commentText="",this.commentAddedEvent.emit()}onSuccessBannerClose(){this.resetForm()}}).\u0275fac=function(l){return new(l||a)(t.Y36(R.a),t.Y36(c.iGM),t.Y36(U.Y))},a.\u0275cmp=t.Xpm({type:a,selectors:[["cvc-comment-add-form"]],inputs:{subject:"subject"},outputs:{commentAddedEvent:"commentAddedEvent"},decls:11,vars:7,consts:[["nzBanner","","nzMessage","Comment submitted","nzType","success","nzCloseable","",3,"nzOnClose",4,"ngIf"],["nz-form","","nzLayout","vertical",3,"ngSubmit"],[4,"ngIf"],[3,"comment","commentChange"],["nzTip","Submitting",3,"nzSpinning"],["type","submit","nz-button","","cvcOrgSelectorBtn","","nzType","primary","nzSize","small","nz-tooltip","",3,"disabled","nzTooltipTrigger","nzTooltipTitle"],["nzBanner","","nzMessage","Comment submitted","nzType","success","nzCloseable","",3,"nzOnClose"],[3,"errors"]],template:function(l,n){1&l&&(t.TgZ(0,"nz-card"),t.YNc(1,_,1,0,"nz-alert",0),t.TgZ(2,"form",1),t.NdJ("ngSubmit",function(){return n.submitComment()}),t.YNc(3,d,2,1,"nz-form-item",2),t.TgZ(4,"cvc-comment-input-form",3),t.NdJ("commentChange",function(p){return n.commentText=p}),t.qZA(),t.TgZ(5,"nz-spin",4)(6,"nz-form-item")(7,"nz-form-control")(8,"cvc-form-buttons")(9,"button",5),t._uU(10," Add Comment "),t.qZA()()()()()()()),2&l&&(t.xp6(1),t.Q6J("ngIf",n.success),t.xp6(2),t.Q6J("ngIf",n.errorMessages.length>0),t.xp6(1),t.Q6J("comment",n.commentText),t.xp6(1),t.Q6J("nzSpinning",n.loading),t.xp6(4),t.Q6J("disabled",n.loading||!(void 0!==n.commentText&&n.commentText.length>=10))("nzTooltipTrigger",n.mostRecentOrg?"hover":null)("nzTooltipTitle","For "+(null==n.mostRecentOrg?null:n.mostRecentOrg.name)))},dependencies:[f.O5,A._Y,A.JL,L.ix,N.w,Z.dQ,x.bd,h.t3,h.SK,M.Lr,M.Nx,M.Fd,O.W,F.r,g.SY,A.F,v.V,o.Z,s.b],styles:[":host{display:block}nz-space{width:100%}nz-form-item:last-of-type{margin-bottom:0}\n"],encapsulation:2}),a);T=(0,I.gn)([(0,z.c)()],T);var J=i(6794),Y=i(1320),W=i(1834),K=i(5573);function G(m,l){if(1&m&&t._UZ(0,"nz-avatar",4),2&m){const n=t.oxw();t.Q6J("nzSrc",n.comment.commenter.profileImagePath)}}function j(m,l){1&m&&t._UZ(0,"nz-avatar",5)}let H=(()=>{class m{ngOnInit(){if(void 0===this.comment)throw new Error("Must pass a comment into comment display component.")}}return m.\u0275fac=function(n){return new(n||m)},m.\u0275cmp=t.Xpm({type:m,selectors:[["cvc-comment-display"]],inputs:{comment:"comment"},decls:7,vars:7,consts:[[3,"nzAuthor","nzDatetime"],["nz-comment-avatar","",3,"nzSrc",4,"ngIf","ngIfElse"],["noAvatar",""],[3,"commentBodySegments"],["nz-comment-avatar","",3,"nzSrc"],["nz-comment-avatar","","nzIcon","civic:curator"]],template:function(n,r){if(1&n&&(t.TgZ(0,"nz-comment",0),t.ALo(1,"timeAgo"),t.YNc(2,G,1,1,"nz-avatar",1),t.YNc(3,j,1,0,"ng-template",null,2,t.W1O),t.TgZ(5,"nz-comment-content"),t._UZ(6,"cvc-comment-body",3),t.qZA()()),2&n){const p=t.MAs(4);t.Q6J("nzAuthor",r.comment.commenter.displayName)("nzDatetime",t.lcZ(1,5,r.comment.createdAt)),t.xp6(2),t.Q6J("ngIf",r.comment.commenter.profileImagePath)("ngIfElse",p),t.xp6(4),t.Q6J("commentBodySegments",r.comment.parsedComment)}},dependencies:[f.O5,Y.WE,Y.DA,Y.Y4,C.Dz,W.m,K.x],encapsulation:2}),m})();var w=i(8091),b=i(6116);function V(m,l){if(1&m&&(t.TgZ(0,"nz-card",7),t._UZ(1,"cvc-comment-display",8),t.qZA()),2&m){const n=t.oxw(2);t.xp6(1),t.Q6J("comment",n.creationComment)}}function X(m,l){1&m&&(t.ynx(0),t.TgZ(1,"nz-row",3)(2,"nz-col",4)(3,"nz-space",5),t.YNc(4,V,2,1,"nz-card",6),t.qZA()()(),t.BQk()),2&m&&(t.xp6(1),t.Q6J("nzGutter",16))}function q(m,l){if(1&m){const n=t.EpF();t.TgZ(0,"div",22)(1,"button",23),t.NdJ("click",function(){t.CHM(n);const p=t.oxw().ngIf,D=t.oxw(3);return t.KtG(D.onLoadMore(p.startCursor))}),t._uU(2," Load older comments "),t.qZA()()}}function k(m,l){if(1&m&&(t.TgZ(0,"nz-list-header"),t.YNc(1,q,3,0,"div",21),t.qZA()),2&m){const n=l.ngIf;t.xp6(1),t.Q6J("ngIf",n.hasPreviousPage)}}function tt(m,l){if(1&m&&(t.TgZ(0,"nz-list-item"),t._UZ(1,"cvc-comment-display",8),t.qZA()),2&m){const n=l.$implicit;t.xp6(1),t.Q6J("comment",n)}}function nt(m,l){if(1&m&&(t.TgZ(0,"nz-card",18)(1,"nz-list",19),t.ALo(2,"ngrxPush"),t.ALo(3,"ngrxPush"),t.YNc(4,k,2,1,"nz-list-header",0),t.ALo(5,"ngrxPush"),t.YNc(6,tt,2,1,"ng-template",null,20,t.W1O),t.qZA()()),2&m){const n=t.MAs(7),r=t.oxw(2);t.xp6(1),t.Q6J("nzDataSource",t.lcZ(2,4,r.comments$))("nzLoading",t.lcZ(3,6,r.loading$))("nzRenderItem",n),t.xp6(3),t.Q6J("ngIf",t.lcZ(5,8,r.pageInfo$))}}function et(m,l){if(1&m){const n=t.EpF();t.TgZ(0,"cvc-comment-add-form",24),t.NdJ("commentAddedEvent",function(){t.CHM(n);const p=t.oxw(2);return t.KtG(p.refreshList())}),t.qZA()}if(2&m){const n=t.oxw(2);t.Q6J("subject",n.commentable)}}function ot(m,l){if(1&m&&t._UZ(0,"nz-avatar",29),2&m){const n=t.oxw().$implicit;t.Q6J("nzSrc",n.profileImagePath)}}function it(m,l){if(1&m&&(t._UZ(0,"nz-avatar",30),t.ALo(1,"uppercase")),2&m){const n=t.oxw().$implicit;t.Q6J("nzText",t.lcZ(1,1,n.displayName.charAt(0)))}}function mt(m,l){if(1&m&&(t.YNc(0,ot,1,1,"nz-avatar",27),t.YNc(1,it,2,3,"ng-template",null,28,t.W1O),t.TgZ(3,"span"),t._uU(4),t.qZA()),2&m){const n=l.$implicit,r=t.MAs(2);t.Q6J("ngIf",n.profileImagePath)("ngIfElse",r),t.xp6(4),t.Oqu(n.displayName)}}const Q=function(){return[]};function ct(m,l){if(1&m){const n=t.EpF();t.TgZ(0,"cvc-participant-list",25),t.NdJ("participantSelectedEvent",function(p){t.CHM(n);const D=t.oxw(2);return t.KtG(D.onCommenterSelected(p))}),t.ALo(1,"ngrxPush"),t.YNc(2,mt,5,3,"ng-template",null,26,t.W1O),t.qZA()}if(2&m){const n=t.oxw(2);t.Q6J("participantList",t.lcZ(1,1,n.commenters$)||t.DdM(3,Q))}}function at(m,l){if(1&m&&t._UZ(0,"nz-avatar",29),2&m){const n=t.oxw().$implicit;t.Q6J("nzSrc",n.profileImagePath)}}function st(m,l){if(1&m&&(t._UZ(0,"nz-avatar",30),t.ALo(1,"uppercase")),2&m){const n=t.oxw().$implicit;t.Q6J("nzText",t.lcZ(1,1,n.displayName.charAt(0)))}}function rt(m,l){if(1&m&&(t.YNc(0,at,1,1,"nz-avatar",27),t.YNc(1,st,2,3,"ng-template",null,28,t.W1O),t.TgZ(3,"span"),t._uU(4),t.qZA()),2&m){const n=l.$implicit,r=t.MAs(2);t.Q6J("ngIf",n.profileImagePath)("ngIfElse",r),t.xp6(4),t.Oqu(n.displayName)}}function lt(m,l){if(1&m){const n=t.EpF();t.TgZ(0,"cvc-participant-list",31),t.NdJ("participantSelectedEvent",function(p){t.CHM(n);const D=t.oxw(2);return t.KtG(D.onMentionedUserSelected(p))}),t.ALo(1,"ngrxPush"),t.YNc(2,rt,5,3,"ng-template",null,26,t.W1O),t.qZA()}if(2&m){const n=t.oxw(2);t.Q6J("participantList",t.lcZ(1,1,n.mentionedUsers$)||t.DdM(3,Q))}}function pt(m,l){if(1&m&&(t._UZ(0,"nz-avatar",33),t.TgZ(1,"span"),t._uU(2),t.qZA()),2&m){const n=l.$implicit;t.MGl("nzIcon","civic-",n.tag.displayName,""),t.xp6(2),t.hij("",n.tag.displayName,"s")}}function _t(m,l){if(1&m){const n=t.EpF();t.TgZ(0,"cvc-participant-list",32),t.NdJ("participantSelectedEvent",function(p){t.CHM(n);const D=t.oxw(2);return t.KtG(D.onMentionedRoleSelected(p))}),t.ALo(1,"ngrxPush"),t.YNc(2,pt,3,2,"ng-template",null,26,t.W1O),t.qZA()}if(2&m){const n=t.oxw(2);t.Q6J("participantList",t.lcZ(1,1,n.mentionedRoles$)||t.DdM(3,Q))}}function dt(m,l){if(1&m&&(t._UZ(0,"i",35),t.ALo(1,"iconNameForSubscribableEntity"),t.TgZ(2,"span"),t._uU(3),t.qZA()),2&m){const n=l.$implicit;t.Q6J("nzType",t.lcZ(1,2,n.tag.tagType)),t.xp6(3),t.Oqu(n.tag.displayName)}}function gt(m,l){if(1&m){const n=t.EpF();t.TgZ(0,"cvc-participant-list",34),t.NdJ("participantSelectedEvent",function(p){t.CHM(n);const D=t.oxw(2);return t.KtG(D.onMentionedEntitySelected(p))}),t.ALo(1,"ngrxPush"),t.YNc(2,dt,4,4,"ng-template",null,26,t.W1O),t.qZA()}if(2&m){const n=t.oxw(2);t.Q6J("participantList",t.lcZ(1,1,n.mentionedEntities$)||t.DdM(3,Q))}}function ut(m,l){1&m&&(t.ynx(0),t.TgZ(1,"nz-row",3)(2,"nz-col",9)(3,"nz-space",5),t.YNc(4,nt,8,10,"nz-card",10),t.YNc(5,et,1,1,"cvc-comment-add-form",11),t.qZA()(),t.TgZ(6,"nz-col",12)(7,"nz-space",13),t.YNc(8,ct,4,4,"cvc-participant-list",14),t.YNc(9,lt,4,4,"cvc-participant-list",15),t.YNc(10,_t,4,4,"cvc-participant-list",16),t.YNc(11,gt,4,4,"cvc-participant-list",17),t.qZA()()(),t.BQk()),2&m&&(t.xp6(1),t.Q6J("nzGutter",16))}function Ct(m,l){if(1&m){const n=t.EpF();t.TgZ(0,"cvc-comment-add-form",24),t.NdJ("commentAddedEvent",function(){t.CHM(n);const p=t.oxw();return t.KtG(p.refreshList())}),t.qZA()}if(2&m){const n=t.oxw();t.Q6J("subject",n.commentable)}}let vt=(()=>{class m{constructor(n){this.gql=n,this.pageSize=5}ngOnInit(){this.queryRef$=this.gql.watch({subject:this.commentable,last:this.pageSize,sortBy:{column:c.h01.Created,direction:c.SrV.Asc}});let n=this.queryRef$.valueChanges;this.pageInfo$=n.pipe((0,u.U)(({data:r})=>r.comments.pageInfo)),this.loading$=n.pipe((0,u.U)(({loading:r})=>r)),this.comments$=n.pipe((0,u.U)(({data:r})=>r.comments.edges.map(p=>p.node))),this.commenters$=n.pipe((0,u.U)(({data:r})=>r.comments.uniqueCommenters)),this.mentionedUsers$=n.pipe((0,u.U)(({data:r})=>r.comments.mentionedUsers)),this.mentionedRoles$=n.pipe((0,u.U)(({data:r})=>r.comments.mentionedRoles.map(p=>({id:`${p.entityId}-${p.tagType}`,tag:p})))),this.mentionedEntities$=n.pipe((0,u.U)(({data:r})=>r.comments.mentionedEntities.map(p=>({id:`${p.entityId}-${p.tagType}`,tag:p})))),this.unfilteredCount$=n.pipe((0,e.j)("data","comments","unfilteredCountForSubject"))}onLoadMore(n){this.queryRef$.fetchMore({variables:{last:this.pageSize,before:n}})}onCommenterSelected(n){this.queryRef$.refetch({originatingUserId:n?.id})}onMentionedUserSelected(n){this.queryRef$.refetch({mentionedUserId:n?.id})}onMentionedRoleSelected(n){if(n){let r=c.i44[n.tag.displayName[0].toUpperCase()+n.tag.displayName.slice(1)];this.queryRef$.refetch({mentionedRole:r})}else this.queryRef$.refetch({mentionedRole:void 0})}onMentionedEntitySelected(n){this.queryRef$.refetch(n?{mentionedEntity:{entityType:n.tag.tagType,id:n.tag.entityId}}:{mentionedEntity:void 0})}refreshList(){this.queryRef$.refetch()}}return m.\u0275fac=function(n){return new(n||m)(t.Y36(c.iST))},m.\u0275cmp=t.Xpm({type:m,selectors:[["cvc-comment-list"]],inputs:{commentable:"commentable",creationComment:"creationComment"},decls:5,vars:5,consts:[[4,"ngIf"],[4,"ngIf","ngIfElse"],["noComments",""],[3,"nzGutter"],["nzSpan","24"],["nzDirection","vertical",2,"width","100%"],["nzTitle","Submission Comment",4,"nzSpaceItem"],["nzTitle","Submission Comment"],[3,"comment"],["nzSpan","18"],["nzTitle","Comments",4,"nzSpaceItem"],["id","addComment",3,"subject","commentAddedEvent",4,"nzSpaceItem"],["nzSpan","6"],["nzDirection","vertical"],["listTitle","Commenters",3,"participantList","participantSelectedEvent",4,"nzSpaceItem"],["listTitle","Mentioned Users",3,"participantList","participantSelectedEvent",4,"nzSpaceItem"],["listTitle","Mentioned Roles",3,"participantList","participantSelectedEvent",4,"nzSpaceItem"],["listTitle","Mentioned Entities",3,"participantList","participantSelectedEvent",4,"nzSpaceItem"],["nzTitle","Comments"],["nzSize","small","nzItemLayout","horizontal",3,"nzDataSource","nzLoading","nzRenderItem"],["comment",""],["nz-list-load-more","",4,"ngIf"],["nz-list-load-more",""],["nz-button","","nzType","link","nzSize","small","nzBlock","",3,"click"],["id","addComment",3,"subject","commentAddedEvent"],["listTitle","Commenters",3,"participantList","participantSelectedEvent"],["itemTemplate",""],["nz-comment-avatar","",3,"nzSrc",4,"ngIf","ngIfElse"],["noAvatar",""],["nz-comment-avatar","",3,"nzSrc"],["nz-comment-avatar","",3,"nzText"],["listTitle","Mentioned Users",3,"participantList","participantSelectedEvent"],["listTitle","Mentioned Roles",3,"participantList","participantSelectedEvent"],[3,"nzIcon"],["listTitle","Mentioned Entities",3,"participantList","participantSelectedEvent"],["nz-icon","",3,"nzType"]],template:function(n,r){if(1&n&&(t.YNc(0,X,5,1,"ng-container",0),t.YNc(1,ut,12,1,"ng-container",1),t.ALo(2,"ngrxPush"),t.YNc(3,Ct,1,1,"ng-template",null,2,t.W1O)),2&n){const p=t.MAs(4);t.Q6J("ngIf",r.creationComment),t.xp6(1),t.Q6J("ngIf",t.lcZ(2,3,r.unfilteredCount$))("ngIfElse",p)}},dependencies:[f.O5,L.ix,N.w,h.t3,h.SK,x.bd,y.n_,y.t4,y.AA,S.Ls,C.Dz,E.NU,E.$1,T,J.l,H,f.gd,w.fM,b.j],styles:["[_nghost-%COMP%]{display:block}nz-list-header[_ngcontent-%COMP%]{padding:0;margin:0}nz-list-header[_ngcontent-%COMP%]   [nz-list-load-more][_ngcontent-%COMP%]{margin-top:-.5em;padding-bottom:.5em}"]}),m})()},1260:(B,P,i)=>{i.d(P,{l:()=>_});var c=i(6814),u=i(95),e=i(2962),t=i(6976),f=i(6928),L=i(2574),N=i(4139),h=i(1595),x=i(1320),y=i(4758),S=i(2524),C=i(5879);let E=(()=>{class d{}return d.\u0275fac=function(J){return new(J||d)},d.\u0275mod=C.oAB({type:d}),d.\u0275inj=C.cJS({imports:[c.ez,x.YM,f.Rt,y.m,S.s]}),d})();var I=i(6223),$=i(5545),z=i(3599),R=i(9543),U=i(6545),A=i(100),Z=i(684),M=i(3903),O=i(2840),F=i(6513),g=i(2669),v=i(9382),o=i(6109);let s=(()=>{class d{}return d.\u0275fac=function(J){return new(J||d)},d.\u0275mod=C.oAB({type:d}),d.\u0275inj=C.cJS({imports:[c.ez,I.UX,O.sL,e.vh,v.we,z.U5,g.j,F.Gl,M.L,o.cg,I.u5,$.X0,A.B,U.R,y.m,Z.K,R.w]}),d})();var a=i(551);let _=(()=>{class d{}return d.\u0275fac=function(J){return new(J||d)},d.\u0275mod=C.oAB({type:d}),d.\u0275inj=C.cJS({imports:[c.ez,O.sL,u.Jb,e.vh,t.Ph,a.PV,S.s,f.Rt,L.zf,N.H0,s,h.N,E]}),d})()},1446:(B,P,i)=>{i.d(P,{b:()=>F});var c=i(5879),u=i(8645),e=i(313),t=i(2181),f=i(9773),L=i(7398),N=i(7921),h=i(4223),x=i(5676),y=i(951),S=i(6814),C=i(6223),E=i(8091),I=i(9382),$=i(2669),z=i(6513),R=i(1834);function U(g,v){if(1&g&&(c.ynx(0),c.TgZ(1,"span"),c._uU(2),c.qZA(),c.BQk()),2&g){const o=v.$implicit;c.xp6(2),c.Oqu(o.displayName)}}function A(g,v){1&g&&(c.ynx(0),c._UZ(1,"nz-spin",8),c.BQk())}function Z(g,v){if(1&g&&(c.ynx(0),c._UZ(1,"cvc-comment-body",9),c.BQk()),2&g){const o=v.ngIf;c.xp6(1),c.Q6J("commentBodySegments",o)}}const M=function(){return["#","@","$"]};function O(g,v){if(1&g){const o=c.EpF();c.ynx(0),c.TgZ(1,"nz-tabset",1)(2,"nz-tab",2)(3,"nz-mention",3),c.NdJ("nzOnSearchChange",function(a){c.CHM(o);const _=c.oxw();return c.KtG(_.onSearchChange(a))})("nzOnSelect",function(){c.CHM(o);const a=c.oxw();return c.KtG(a.suggestions=[])}),c.TgZ(4,"textarea",4),c.NdJ("ngModelChange",function(a){c.CHM(o);const _=c.oxw();return c.KtG(_.commentText=a)})("ngModelChange",function(a){c.CHM(o);const _=c.oxw();return c.KtG(_.onCommentChanged(a))}),c.qZA(),c.YNc(5,U,3,1,"ng-container",5),c.qZA()(),c.TgZ(6,"nz-tab",6),c.NdJ("nzClick",function(){c.CHM(o);const a=c.oxw();return c.KtG(a.onPreviewButtonClicked())}),c.YNc(7,A,2,0,"ng-container",7),c.ALo(8,"ngrxPush"),c.YNc(9,Z,2,1,"ng-container",7),c.ALo(10,"ngrxPush"),c.qZA()(),c.BQk()}if(2&g){const o=v.ngrxLet,s=c.oxw();c.xp6(1),c.Q6J("nzAnimated",!1),c.xp6(2),c.Q6J("nzSuggestions",s.suggestions)("nzPrefix",c.DdM(13,M))("nzValueWith",s.autoCompleteValueFor),c.xp6(1),c.Q6J("placeholder",o&&o.canCurate?"Enter comment (minimum length 10. Use @ to mention users; # to link entities)":"Please sign in")("ngModel",s.commentText),c.uIk("disabled",!o||!o.canCurate||null),c.xp6(3),c.Q6J("ngIf",c.lcZ(8,9,s.previewLoading$)),c.xp6(2),c.Q6J("ngIf",c.lcZ(10,11,s.previewComment$))}}let F=(()=>{class g{constructor(o,s,a,_){this.previewCommentGql=o,this.userTypeaheadGql=s,this.entityTypeaheadGql=a,this.viewerService=_,this.commentChange=new c.vpe,this.destroy$=new u.x,this.suggestions=[],this.roleSuggestions=[{displayName:"admins",value:"admins"},{displayName:"editors",value:"editors"}]}ngOnInit(){this.viewer$=this.viewerService.viewer$,this.commentText=this.comment,this.userTypeaheadQueryRef$=this.userTypeaheadGql.watch({queryTerm:""}),this.userTypeaheadQueryRef$.valueChanges.pipe((0,h.j)("data","userTypeahead"),(0,t.h)(x.ep),(0,f.R)(this.destroy$)).subscribe(o=>this.suggestions=o.map(s=>({displayName:s.username,value:s.username}))),this.entityTypeaheadQueryRef$=this.entityTypeaheadGql.watch({queryTerm:""}),this.entityTypeaheadQueryRef$.valueChanges.pipe((0,h.j)("data","entityTypeahead"),(0,t.h)(x.ep),(0,f.R)(this.destroy$)).subscribe(o=>this.suggestions=o.map(s=>({displayName:s.displayName,value:this.tagForEntityTypeAndId(s.tagType,s.entityId)})))}ngOnChanges(){this.commentText=this.comment}autoCompleteValueFor(o){return o.value}tagForEntityTypeAndId(o,s){switch(o){case e.mpB.Feature:return`FID${s}`;case e.mpB.Variant:return`VID${s}`;case e.mpB.VariantGroup:return`VGID${s}`;case e.mpB.EvidenceItem:return`EID${s}`;case e.mpB.Assertion:return`AID${s}`;case e.mpB.Revision:return`RID${s}`;case e.mpB.MolecularProfile:return`MPID${s}`;case e.mpB.Role:return Object.keys(e.i44)[s]}}resetForm(){this.commentText=""}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}onPreviewButtonClicked(){this.commentText&&(this.previewComment$=this.previewCommentGql.watch({commentText:this.commentText}).valueChanges.pipe((0,h.j)("data","previewCommentText"),(0,t.h)(x.ep)),this.previewLoading$=this.previewCommentGql.watch({commentText:this.commentText}).valueChanges.pipe((0,L.U)(({loading:o})=>o),(0,N.O)(!0)))}onSearchChange({value:o,prefix:s}){"@"===s?this.userTypeaheadQueryRef$.refetch({queryTerm:o}):"$"==s?this.suggestions=this.roleSuggestions.filter(a=>a.value.startsWith(o)):this.entityTypeaheadQueryRef$.refetch({queryTerm:o})}onCommentChanged(o){this.commentChange.emit(o)}}return g.\u0275fac=function(o){return new(o||g)(c.Y36(e.mII),c.Y36(e.vMt),c.Y36(e.GYx),c.Y36(y.a))},g.\u0275cmp=c.Xpm({type:g,selectors:[["cvc-comment-input-form"]],inputs:{comment:"comment"},outputs:{commentChange:"commentChange"},features:[c.TTD],decls:1,vars:1,consts:[[4,"ngrxLet"],[3,"nzAnimated"],["nzTitle","Write"],["nzNotFoundContent","No matches...",3,"nzSuggestions","nzPrefix","nzValueWith","nzOnSearchChange","nzOnSelect"],["nzMentionTrigger","","nz-input","","rows","4",2,"width","100%",3,"placeholder","ngModel","ngModelChange"],[4,"nzMentionSuggestion"],["nzTitle","Preview",3,"nzClick"],[4,"ngIf"],["nzTip","Loading..."],[3,"commentBodySegments"]],template:function(o,s){1&o&&c.YNc(0,O,11,14,"ng-container",0),2&o&&c.Q6J("ngrxLet",s.viewer$)},dependencies:[S.O5,C.Fj,C.JJ,E.eJ,I.xH,I.xw,$.W,z.YW,z.jO,z.O3,C.On,R.m,E.fM],styles:[":host{display:block}nz-space{width:100%}nz-form-item:last-of-type{margin-bottom:0}\n"],encapsulation:2}),g})()},1320:(B,P,i)=>{i.d(P,{DA:()=>A,WE:()=>F,Y4:()=>Z,YM:()=>v});var c=i(9388),u=i(6814),e=i(5879),t=i(8324),f=i(8484),L=i(8645),N=i(9773);function h(o,s){1&o&&e.Hsn(0)}const x=["*"];function y(o,s){if(1&o&&(e.ynx(0),e._uU(1),e.BQk()),2&o){const a=e.oxw(2);e.xp6(1),e.Oqu(a.nzAuthor)}}function S(o,s){if(1&o&&(e.TgZ(0,"span",8),e.YNc(1,y,2,1,"ng-container",9),e.qZA()),2&o){const a=e.oxw();e.xp6(1),e.Q6J("nzStringTemplateOutlet",a.nzAuthor)}}function C(o,s){if(1&o&&(e.ynx(0),e._uU(1),e.BQk()),2&o){const a=e.oxw(2);e.xp6(1),e.Oqu(a.nzDatetime)}}function E(o,s){if(1&o&&(e.TgZ(0,"span",10),e.YNc(1,C,2,1,"ng-container",9),e.qZA()),2&o){const a=e.oxw();e.xp6(1),e.Q6J("nzStringTemplateOutlet",a.nzDatetime)}}function I(o,s){}function $(o,s){if(1&o&&(e.TgZ(0,"li")(1,"span"),e.YNc(2,I,0,0,"ng-template",13),e.qZA()()),2&o){const a=s.$implicit;e.xp6(2),e.Q6J("nzCommentActionHost",a.content)}}function z(o,s){if(1&o&&(e.TgZ(0,"ul",11),e.YNc(1,$,3,1,"li",12),e.qZA()),2&o){const a=e.oxw();e.xp6(1),e.Q6J("ngForOf",a.actions)}}const R=[[["nz-avatar","nz-comment-avatar",""]],[["nz-comment-content"]],"*"],U=["nz-avatar[nz-comment-avatar]","nz-comment-content","*"];let A=(()=>{class o{}return o.\u0275fac=function(a){return new(a||o)},o.\u0275dir=e.lG2({type:o,selectors:[["nz-avatar","nz-comment-avatar",""]],exportAs:["nzCommentAvatar"]}),o})(),Z=(()=>{class o{}return o.\u0275fac=function(a){return new(a||o)},o.\u0275dir=e.lG2({type:o,selectors:[["nz-comment-content"],["","nz-comment-content",""]],hostAttrs:[1,"ant-comment-content-detail"],exportAs:["nzCommentContent"]}),o})(),M=(()=>{class o extends f.Pl{constructor(a,_){super(a,_)}ngOnInit(){super.ngOnInit()}ngOnDestroy(){super.ngOnDestroy()}ngAfterViewInit(){this.attach(this.nzCommentActionHost)}}return o.\u0275fac=function(a){return new(a||o)(e.Y36(e._Vd),e.Y36(e.s_b))},o.\u0275dir=e.lG2({type:o,selectors:[["","nzCommentActionHost",""]],inputs:{nzCommentActionHost:"nzCommentActionHost"},exportAs:["nzCommentActionHost"],features:[e.qOj]}),o})(),O=(()=>{class o{get content(){return this.contentPortal}constructor(a){this.viewContainerRef=a,this.contentPortal=null}ngOnInit(){this.contentPortal=new f.UE(this.implicitContent,this.viewContainerRef)}}return o.\u0275fac=function(a){return new(a||o)(e.Y36(e.s_b))},o.\u0275cmp=e.Xpm({type:o,selectors:[["nz-comment-action"]],viewQuery:function(a,_){if(1&a&&e.Gf(e.Rgc,7),2&a){let d;e.iGM(d=e.CRH())&&(_.implicitContent=d.first)}},exportAs:["nzCommentAction"],ngContentSelectors:x,decls:1,vars:0,template:function(a,_){1&a&&(e.F$t(),e.YNc(0,h,1,0,"ng-template"))},encapsulation:2,changeDetection:0}),o})(),F=(()=>{class o{constructor(a,_){this.cdr=a,this.directionality=_,this.dir="ltr",this.destroy$=new L.x}ngOnInit(){this.directionality.change?.pipe((0,N.R)(this.destroy$)).subscribe(a=>{this.dir=a,this.cdr.detectChanges()}),this.dir=this.directionality.value}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}}return o.\u0275fac=function(a){return new(a||o)(e.Y36(e.sBO),e.Y36(c.Is,8))},o.\u0275cmp=e.Xpm({type:o,selectors:[["nz-comment"]],contentQueries:function(a,_,d){if(1&a&&e.Suo(d,O,4),2&a){let T;e.iGM(T=e.CRH())&&(_.actions=T)}},hostVars:4,hostBindings:function(a,_){2&a&&e.ekj("ant-comment",!0)("ant-comment-rtl","rtl"===_.dir)},inputs:{nzAuthor:"nzAuthor",nzDatetime:"nzDatetime"},exportAs:["nzComment"],ngContentSelectors:U,decls:11,vars:3,consts:[[1,"ant-comment-inner"],[1,"ant-comment-avatar"],[1,"ant-comment-content"],[1,"ant-comment-content-author"],["class","ant-comment-content-author-name",4,"ngIf"],["class","ant-comment-content-author-time",4,"ngIf"],["class","ant-comment-actions",4,"ngIf"],[1,"ant-comment-nested"],[1,"ant-comment-content-author-name"],[4,"nzStringTemplateOutlet"],[1,"ant-comment-content-author-time"],[1,"ant-comment-actions"],[4,"ngFor","ngForOf"],[3,"nzCommentActionHost"]],template:function(a,_){1&a&&(e.F$t(R),e.TgZ(0,"div",0)(1,"div",1),e.Hsn(2),e.qZA(),e.TgZ(3,"div",2)(4,"div",3),e.YNc(5,S,2,1,"span",4),e.YNc(6,E,2,1,"span",5),e.qZA(),e.Hsn(7,1),e.YNc(8,z,2,1,"ul",6),e.qZA()(),e.TgZ(9,"div",7),e.Hsn(10,2),e.qZA()),2&a&&(e.xp6(5),e.Q6J("ngIf",_.nzAuthor),e.xp6(1),e.Q6J("ngIf",_.nzDatetime),e.xp6(2),e.Q6J("ngIf",null==_.actions?null:_.actions.length))},dependencies:[u.sg,u.O5,t.f,M],encapsulation:2,changeDetection:0}),o})(),v=(()=>{class o{}return o.\u0275fac=function(a){return new(a||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[c.vT,u.ez,t.T]}),o})()}}]);