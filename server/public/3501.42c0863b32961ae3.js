"use strict";(self.webpackChunkmain=self.webpackChunkmain||[]).push([[3501],{3501:(ye,y,s)=>{s.r(y),s.d(y,{GenesReviseModule:()=>ze});var g=s(9808),c=s(325),b=s(5630),l=s(1945),S=s(647),p=s(373),T=s(1059),e=s(5e3),f=s(712),P=s(8992);function $(t,i){if(1&t&&(e.ynx(0),e._UZ(1,"cvc-section-navigation",1),e.TgZ(2,"nz-page-header",2),e.TgZ(3,"nz-page-header-title",3),e._uU(4," REVISE "),e._UZ(5,"i",4),e._uU(6),e.qZA(),e.TgZ(7,"nz-page-header-subtitle"),e._uU(8),e.qZA(),e.TgZ(9,"nz-page-header-content"),e.TgZ(10,"div",5),e._UZ(11,"router-outlet"),e.qZA(),e.qZA(),e.qZA(),e.BQk()),2&t){const n=i.ngIf;e.xp6(1),e.Q6J("displayName",n.name),e.xp6(5),e.hij(" ",n.name," "),e.xp6(2),e.hij(" ",n.officialName," ")}}let C=(()=>{class t{constructor(n,o){this.gql=n,this.route=o,this.routeSub=this.route.params.subscribe(r=>{let a=this.gql.watch({geneId:+r.geneId}).valueChanges;this.loading$=a.pipe((0,p.j)("loading"),(0,T.O)(!0)),this.gene$=a.pipe((0,p.j)("data","gene")),this.commentsTotal$=this.gene$.pipe((0,p.j)("comments","totalCount")),this.flagsTotal$=this.gene$.pipe((0,p.j)("flags","totalCount")),this.revisionsTotal$=this.gene$.pipe((0,p.j)("revisions","totalCount"))})}ngOnDestroy(){this.routeSub.unsubscribe()}}return t.\u0275fac=function(n){return new(n||t)(e.Y36(f.TNk),e.Y36(c.gz))},t.\u0275cmp=e.Xpm({type:t,selectors:[["genes-revise"]],decls:2,vars:3,consts:[[4,"ngIf"],[3,"displayName"],[1,"site-page-header"],["cvcFlaggableOptions",""],["nz-icon","","nzType","civic:gene"],[1,"content"]],template:function(n,o){1&n&&(e.YNc(0,$,12,3,"ng-container",0),e.ALo(1,"async")),2&n&&e.Q6J("ngIf",e.lcZ(1,1,o.gene$))},directives:[g.O5,P.I,l.$O,l.u9,S.Ls,l.yG,l.u5,c.lC],pipes:[g.Ov],styles:["[_nghost-%COMP%]{display:block}[_nghost-%COMP%]     nz-page-header:first-of-type{background-color:#fff;border-radius:8px}[_nghost-%COMP%]     nz-page-header:first-of-type .card-list nz-card{width:100%}[_nghost-%COMP%]     nz-page-header:first-of-type .card-list nz-card .card-grid-cell{width:50%}[_nghost-%COMP%]     nz-page-header:first-of-type nz-page-header-title.flagged{padding-left:.75em}[_nghost-%COMP%]     nz-page-header:first-of-type .ant-page-header-content{padding-top:0}[_nghost-%COMP%]     nz-page-header:first-of-type .ant-page-header-heading-extra nz-space-item:last-child{margin-right:0!important}[_nghost-%COMP%]     nz-page-header:first-of-type #section-tabs{margin:0 -16px 12px}[_nghost-%COMP%]     nz-page-header:first-of-type #section-tabs .ant-tabs-nav-wrap{padding-left:16px;padding-right:16px;line-height:24px}[_nghost-%COMP%]     nz-page-header:first-of-type #section-tabs .ant-tabs-nav-wrap .ant-tabs-tab{padding:1px 8px}[_nghost-%COMP%]     nz-page-header:first-of-type #section-tabs .ant-tabs-nav-wrap .ant-tabs-tab .anticon{margin-right:0}[_nghost-%COMP%]     nz-page-header:first-of-type #section-tabs .ant-tabs-extra-content{margin-right:16px}"]}),t})();var d=s(1894),h=s(8144),x=s(6559),m=s(3075),u=s(4546),O=s(2359),G=s(8776),I=s(6904),F=s(2752),A=s(8269),M=s(6042),Q=s(4038),J=s(1317),_=s(5109);let E=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[[g.ez,c.Bz,m.UX,_.s,u.U5,O.L,d.Jb,M.sL,G.X0.forChild(),I.A,F.B,A.R,Q.v,J.$]]}),t})();var R=s(7484),U=s(6949);let L=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[[g.ez,U.WG,R.vh,d.Jb,h.zf,x.H0,l.KJ,E,b.D]]}),t})();var Z=s(8929),v=s(7625),w=s(5517),N=s(9350),z=s(591),Y=s(5284),j=s(537),D=s(9169);let B=(()=>{class t{constructor(n,o){this.suggestGeneRevisionGQL=n,this.networkErrorService=o,this.destroy$=new Z.xQ,this.isSubmitting$=new z.X(!1),this.submitSuccess$=new z.X(!1),this.submitError$=new z.X([])}suggest(n){this.storeObj={id:n.id,__typename:(0,Y.e)("Gene")},this.isSubmitting$.next(!0),this.suggestGeneRevisionGQL.mutate({input:n},{update:(o,{data:{suggestGeneRevision:r}})=>{o.modify({id:o.identify(this.storeObj),fields:{revisions:(a=[])=>r.gene.revisions}})}}).pipe((0,v.R)(this.destroy$),(0,j.x)(()=>{this.isSubmitting$.next(!1)})).subscribe({error:o=>{o.graphQLErrors.length>0?this.submitError$.next(o.graphQLErrors.map(r=>r.message)):o.networkError&&this.networkErrorService.networkError$.next(o.networkError)},complete:()=>{this.submitError$.next([]),this.submitSuccess$.next(!0),this.networkErrorService.networkError$.next(void 0)}})}cleanup(){this.submitError$.next([]),this.submitSuccess$.next(!1),this.isSubmitting$.next(!1),this.networkErrorService.networkError$.next(void 0)}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}}return t.\u0275fac=function(n){return new(n||t)(e.LFG(f.D9L),e.LFG(D.Y))},t.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var V=s(2993),X=s(1014),W=s(7815),k=s(2643),K=s(6874),H=s(2683);function q(t,i){if(1&t&&(e.TgZ(0,"nz-form-item"),e._UZ(1,"cvc-form-errors-alert",3),e.qZA()),2&t){const n=e.oxw().ngIf;e.xp6(1),e.Q6J("errors",n)}}function ee(t,i){if(1&t&&(e.ynx(0),e.YNc(1,q,2,1,"nz-form-item",1),e.BQk()),2&t){const n=i.ngIf;e.xp6(1),e.Q6J("ngIf",n.length>0)}}function te(t,i){1&t&&(e.TgZ(0,"p"),e._uU(1,"View it on the "),e.TgZ(2,"a",7),e._uU(3,"Revisions Page"),e.qZA(),e._uU(4," or suggest another revision below."),e.qZA())}function ne(t,i){if(1&t&&(e.ynx(0),e._UZ(1,"nz-alert",4),e.YNc(2,te,5,0,"ng-template",5,6,e.W1O),e.BQk()),2&t){const n=e.MAs(3);e.xp6(1),e.Q6J("nzDescription",n)}}function se(t,i){if(1&t){const n=e.EpF();e.TgZ(0,"nz-form-item"),e.TgZ(1,"nz-form-control"),e.TgZ(2,"cvc-form-buttons"),e.TgZ(3,"cvc-org-selector-btn-group",8),e.NdJ("selectedOrgChange",function(r){return e.CHM(n),e.oxw().mostRecentOrg=r}),e.TgZ(4,"button",9),e._uU(5," Suggest Revision "),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA()}if(2&t){const n=e.oxw();e.xp6(3),e.Q6J("selectedOrg",n.mostRecentOrg),e.xp6(1),e.Q6J("disabled",!n.formGroup.valid)}}let oe=(()=>{class t{constructor(n,o,r){this.viewerService=n,this.revisionService=o,this.revisableFieldsGQL=r,this.destroy$=new Z.xQ,this.formGroup=new m.cw({}),this.formOptions={},this.viewerService.viewer$.pipe((0,v.R)(this.destroy$)).subscribe(a=>{this.organizations=a.organizations,this.mostRecentOrg=a.mostRecentOrg}),this.submitError$=this.revisionService.submitError$,this.isSubmitting$=this.revisionService.isSubmitting$,this.submitSuccess$=this.revisionService.submitSuccess$,this.formFields=[{key:"id",type:"input",hide:!0},{key:"fields.description",type:"textarea",templateOptions:{label:"Description",placeholder:"Enter a description for this gene.",required:!1}},{key:"fields.sources",type:"multi-field",templateOptions:{label:"Sources",addText:"Add another Source"},fieldArray:{type:"source-input",templateOptions:{required:!0}}},{key:"comment",type:"comment-textarea",templateOptions:{label:"Comment",placeholder:"Please enter a comment describing your revision.",required:!0,minLength:10}}],this.submitSuccess$.pipe((0,v.R)(this.destroy$)).subscribe(a=>{a&&this.formOptions.resetModel&&this.formOptions.resetModel()})}ngOnInit(){this.revisableFieldsGQL.fetch({geneId:this.geneId}).subscribe(({data:{gene:n}})=>{n?this.formModel=this.toFormModel(n):console.error("Could not retrieve gene."),this.formOptions.updateInitialValue&&this.formOptions.updateInitialValue()})}toFormModel(n){return{id:n.id,fields:Object.assign({},n),comment:""}}selectOrg(n){this.mostRecentOrg=n}submitRevision(n){this.revisionService.suggest(this.toRevisionInput(n))}toRevisionInput(n){return Object.assign(Object.assign({},n),{fields:{description:(0,w.xt)(n.fields.description),sourceIds:n.fields.sources.map(o=>+o.id)},organizationId:void 0===this.mostRecentOrg?void 0:this.mostRecentOrg.id})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete(),this.revisionService.cleanup()}}return t.\u0275fac=function(n){return new(n||t)(e.Y36(N.a),e.Y36(B),e.Y36(f.FOU))},t.\u0275cmp=e.Xpm({type:t,selectors:[["cvc-gene-revise-form"]],inputs:{geneId:"geneId"},decls:8,vars:14,consts:[["nz-form","","nzLayout","vertical",3,"formGroup","ngSubmit"],[4,"ngIf"],[3,"form","fields","model","options","modelChange"],[3,"errors"],["nzType","success","nzMessage","Suggested Revision Submitted","nzShowIcon","",3,"nzDescription"],["nzSize","small"],["successMessage",""],["routerLink","../../revisions"],[3,"selectedOrg","selectedOrgChange"],["type","submit","nz-button","","cvcOrgSelectorBtn","","nzType","primary","nzSize","small",3,"disabled"]],template:function(n,o){1&n&&(e.TgZ(0,"form",0),e.NdJ("ngSubmit",function(){return o.submitRevision(o.formModel)}),e.YNc(1,ee,2,1,"ng-container",1),e.ALo(2,"async"),e.YNc(3,ne,4,1,"ng-container",1),e.ALo(4,"async"),e.TgZ(5,"formly-form",2),e.NdJ("modelChange",function(a){return o.formModel=a}),e.qZA(),e.YNc(6,se,6,2,"nz-form-item",1),e.ALo(7,"async"),e.qZA()),2&n&&(e.Q6J("formGroup",o.formGroup),e.xp6(1),e.Q6J("ngIf",e.lcZ(2,8,o.submitError$)),e.xp6(2),e.Q6J("ngIf",e.lcZ(4,10,o.submitSuccess$)),e.xp6(2),e.Q6J("form",o.formGroup)("fields",o.formFields)("model",o.formModel)("options",o.formOptions),e.xp6(1),e.Q6J("ngIf",!e.lcZ(7,12,o.submitSuccess$)))},directives:[m._Y,m.JL,u.Lr,m.sg,g.O5,d.SK,u.Nx,V.V,O.r,c.yS,G.T7,d.t3,u.Fd,X.Z,W.q,M.ix,k.dQ,K.m,H.w],pipes:[g.Ov],styles:["[_nghost-%COMP%]{display:block}"]}),t})();function ie(t,i){if(1&t&&(e.ynx(0),e._UZ(1,"cvc-gene-revise-form",8),e.BQk()),2&t){const n=e.oxw();e.xp6(1),e.Q6J("geneId",n.geneId)}}function re(t,i){1&t&&e._uU(0,"Loading Gene...")}const ae=function(){return{rows:1}};function ge(t,i){1&t&&e._UZ(0,"nz-skeleton",9),2&t&&e.Q6J("nzParagraph",e.DdM(1,ae))}const ce=function(){return{rows:3}};function le(t,i){1&t&&e._UZ(0,"nz-skeleton",9),2&t&&e.Q6J("nzParagraph",e.DdM(1,ce))}const de=function(){return{rows:4}};function pe(t,i){1&t&&e._UZ(0,"nz-skeleton",9),2&t&&e.Q6J("nzParagraph",e.DdM(1,de))}const me=function(){return{rows:5}};function ue(t,i){1&t&&e._UZ(0,"nz-skeleton",9),2&t&&e.Q6J("nzParagraph",e.DdM(1,me))}function fe(t,i){1&t&&e._uU(0,"Loading gene...")}const he=[{path:"",component:C,data:{breadcrumb:"Revise"},children:[{path:"",redirectTo:"suggest",pathMatch:"full"},{path:"suggest",component:(()=>{class t{constructor(n){this.route=n,this.routeParams$=this.route.params.subscribe(o=>{this.geneId=+o.geneId})}ngOnDestroy(){this.routeParams$.unsubscribe()}}return t.\u0275fac=function(n){return new(n||t)(e.Y36(c.gz))},t.\u0275cmp=e.Xpm({type:t,selectors:[["cvc-genes-suggest"]],decls:14,vars:3,consts:[[3,"nzGutter"],["nzSpan","16"],[4,"ngIf","ngIfElse"],["loadingGene",""],["nzSpan","8"],["nzTitle","Instructions","nz-type","inner"],["nzDirection","vertical",2,"width","100%"],[3,"nzParagraph",4,"nzSpaceItem"],[3,"geneId"],[3,"nzParagraph"]],template:function(n,o){if(1&n&&(e.TgZ(0,"nz-row",0),e.TgZ(1,"nz-col",1),e.YNc(2,ie,2,1,"ng-container",2),e.YNc(3,re,1,0,"ng-template",null,3,e.W1O),e.qZA(),e.TgZ(5,"nz-col",4),e.TgZ(6,"nz-card",5),e.TgZ(7,"nz-space",6),e.YNc(8,ge,1,2,"nz-skeleton",7),e.YNc(9,le,1,2,"nz-skeleton",7),e.YNc(10,pe,1,2,"nz-skeleton",7),e.YNc(11,ue,1,2,"nz-skeleton",7),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.YNc(12,fe,1,0,"ng-template",null,3,e.W1O)),2&n){const r=e.MAs(4);e.Q6J("nzGutter",16),e.xp6(2),e.Q6J("ngIf",o.geneId)("ngIfElse",r)}},directives:[d.SK,d.t3,g.O5,oe,R.bd,h.NU,h.$1,x.ng],styles:["[_nghost-%COMP%]{display:block}[_nghost-%COMP%]     nz-page-header:first-of-type{background-color:#fff;border-radius:8px}[_nghost-%COMP%]     nz-page-header:first-of-type .card-list nz-card{width:100%}[_nghost-%COMP%]     nz-page-header:first-of-type .card-list nz-card .card-grid-cell{width:50%}[_nghost-%COMP%]     nz-page-header:first-of-type nz-page-header-title.flagged{padding-left:.75em}[_nghost-%COMP%]     nz-page-header:first-of-type .ant-page-header-content{padding-top:0}[_nghost-%COMP%]     nz-page-header:first-of-type .ant-page-header-heading-extra nz-space-item:last-child{margin-right:0!important}[_nghost-%COMP%]     nz-page-header:first-of-type #section-tabs{margin:0 -16px 12px}[_nghost-%COMP%]     nz-page-header:first-of-type #section-tabs .ant-tabs-nav-wrap{padding-left:16px;padding-right:16px;line-height:24px}[_nghost-%COMP%]     nz-page-header:first-of-type #section-tabs .ant-tabs-nav-wrap .ant-tabs-tab{padding:1px 8px}[_nghost-%COMP%]     nz-page-header:first-of-type #section-tabs .ant-tabs-nav-wrap .ant-tabs-tab .anticon{margin-right:0}[_nghost-%COMP%]     nz-page-header:first-of-type #section-tabs .ant-tabs-extra-content{margin-right:16px}"]}),t})(),data:{breadcrumb:"Suggest Revision"}}]}];let ve=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[[c.Bz.forChild(he),L]]}),t})(),ze=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[[g.ez,ve,c.Bz,b.D,l.KJ,S.PV]]}),t})()}}]);