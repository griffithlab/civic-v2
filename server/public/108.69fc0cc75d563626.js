"use strict";(self.webpackChunkmain=self.webpackChunkmain||[]).push([[108],{108:(_e,O,i)=>{i.r(O),i.d(O,{EvidenceReviseModule:()=>Je});var c=i(9808),l=i(325),u=i(373),F=i(1059),e=i(5e3),d=i(712),Q=i(8992),g=i(8144),S=i(3618),J=i(3193),_=i(8664),h=i(1945),T=i(647);function C(t,o){if(1&t&&(e.TgZ(0,"span",10),e.TgZ(1,"strong"),e._uU(2),e.qZA(),e._uU(3," Parents:"),e.qZA()),2&t){const n=e.oxw(2).ngIf;e.xp6(2),e.Oqu(n.name)}}function L(t,o){if(1&t&&(e.TgZ(0,"span",11),e.TgZ(1,"a",12),e._UZ(2,"cvc-gene-tag",13),e.qZA(),e.TgZ(3,"a",12),e._UZ(4,"cvc-variant-tag",14),e.qZA(),e.qZA()),2&t){const n=e.oxw(2).ngIf;e.xp6(1),e.MGl("routerLink","/genes/",n.gene.id,""),e.xp6(1),e.Q6J("gene",n.gene),e.xp6(1),e.MGl("routerLink","/variants/",n.variant.id,""),e.xp6(1),e.Q6J("variant",n.variant)}}function U(t,o){1&t&&(e.TgZ(0,"nz-space",7),e.YNc(1,C,4,1,"span",8),e.YNc(2,L,5,4,"span",9),e.qZA())}function Y(t,o){if(1&t&&(e.ynx(0),e._UZ(1,"cvc-section-navigation",1),e.YNc(2,U,3,0,"ng-template",null,2,e.W1O),e.TgZ(4,"nz-page-header",3),e.TgZ(5,"nz-page-header-title",4),e._uU(6," REVISE "),e._UZ(7,"i",5),e._uU(8),e.qZA(),e.TgZ(9,"nz-page-header-content"),e.TgZ(10,"div",6),e._UZ(11,"router-outlet"),e.qZA(),e.qZA(),e.qZA(),e.BQk()),2&t){const n=o.ngIf,s=e.MAs(3);e.xp6(1),e.Q6J("displayName",n.name)("relationsTpl",s),e.xp6(7),e.hij(" ",n.name," ")}}let N=(()=>{class t{constructor(n,s){this.gql=n,this.route=s,this.routeSub=this.route.params.subscribe(a=>{let r=this.gql.watch({evidenceId:+a.evidenceId}).valueChanges;this.loading$=r.pipe((0,u.j)("loading"),(0,F.O)(!0)),this.evidence$=r.pipe((0,u.j)("data","evidenceItem")),this.commentsTotal$=this.evidence$.pipe((0,u.j)("comments","totalCount")),this.flagsTotal$=this.evidence$.pipe((0,u.j)("flags","totalCount")),this.revisionsTotal$=this.evidence$.pipe((0,u.j)("revisions","totalCount"))})}ngOnDestroy(){this.routeSub.unsubscribe()}}return t.\u0275fac=function(n){return new(n||t)(e.Y36(d.pHu),e.Y36(l.gz))},t.\u0275cmp=e.Xpm({type:t,selectors:[["cvc-evidence-revise"]],decls:2,vars:3,consts:[[4,"ngIf"],[3,"displayName","relationsTpl"],["evidenceRelations",""],[1,"site-page-header"],["cvcFlaggableOptions",""],["nz-icon","","nzType","civic:evidence"],[1,"content"],["nzDirection","horizontal"],["nz-typography","","class","label",4,"nzSpaceItem"],["class","tags",4,"nzSpaceItem"],["nz-typography","",1,"label"],[1,"tags"],[3,"routerLink"],[3,"gene"],[3,"variant"]],template:function(n,s){1&n&&(e.YNc(0,Y,12,3,"ng-container",0),e.ALo(1,"async")),2&n&&e.Q6J("ngIf",e.lcZ(1,1,s.evidence$))},directives:[c.O5,Q.I,g.NU,g.$1,S.ZU,l.yS,J.H,_.I,h.$O,h.u9,T.Ls,h.u5,l.lC],pipes:[c.Ov],styles:["[_nghost-%COMP%]{display:block}[_nghost-%COMP%]     nz-page-header:first-of-type{background-color:#fff;border-radius:8px}[_nghost-%COMP%]     nz-page-header:first-of-type .card-list nz-card{width:100%}[_nghost-%COMP%]     nz-page-header:first-of-type .card-list nz-card .card-grid-cell{width:50%}[_nghost-%COMP%]     nz-page-header:first-of-type nz-page-header-title.flagged{padding-left:.75em}[_nghost-%COMP%]     nz-page-header:first-of-type .ant-page-header-content{padding-top:0}[_nghost-%COMP%]     nz-page-header:first-of-type .ant-page-header-heading-extra nz-space-item:last-child{margin-right:0!important}[_nghost-%COMP%]     nz-page-header:first-of-type #section-tabs{margin:0 -16px 12px}[_nghost-%COMP%]     nz-page-header:first-of-type #section-tabs .ant-tabs-nav-wrap{padding-left:16px;padding-right:16px;line-height:24px}[_nghost-%COMP%]     nz-page-header:first-of-type #section-tabs .ant-tabs-nav-wrap .ant-tabs-tab{padding:1px 8px}[_nghost-%COMP%]     nz-page-header:first-of-type #section-tabs .ant-tabs-nav-wrap .ant-tabs-tab .anticon{margin-right:0}[_nghost-%COMP%]     nz-page-header:first-of-type #section-tabs .ant-tabs-extra-content{margin-right:16px}"]}),t})();var D=i(6949),v=i(1894),Z=i(7484),b=i(6559),j=i(1317),G=i(4038),V=i(8269),B=i(2752),w=i(6904),R=i(8776),I=i(6042),A=i(2359),y=i(4546),k=i(5109),f=i(3075),M=i(8929),E=i(591),X=i(5284),$=i(7625),W=i(537),H=i(9169);let P=(()=>{class t{constructor(n,s){this.suggestEvidenceItemRevisionGQL=n,this.networkErrorService=s,this.destroy$=new M.xQ,this.isSubmitting$=new E.X(!1),this.submitSuccess$=new E.X(!1),this.submitError$=new E.X([])}suggest(n){this.storeObj={id:n.id,__typename:(0,X.e)("EvidenceItem")},this.isSubmitting$.next(!0),this.suggestEvidenceItemRevisionGQL.mutate({input:n},{update:(s,{data:{suggestEvidenceItemRevision:a}})=>{s.modify({id:s.identify(this.storeObj),fields:{revisions:(r=[])=>a.evidenceItem.revisions}})}}).pipe((0,$.R)(this.destroy$),(0,W.x)(()=>{this.isSubmitting$.next(!1)})).subscribe({error:s=>{s.graphQLErrors.length>0?this.submitError$.next(s.graphQLErrors.map(a=>a.message)):s.networkError&&this.networkErrorService.networkError$.next(s.networkError)},complete:()=>{this.submitError$.next([]),this.submitSuccess$.next(!0),this.networkErrorService.networkError$.next(void 0)}})}cleanup(){this.submitError$.next([]),this.submitSuccess$.next(!1),this.isSubmitting$.next(!1),this.networkErrorService.networkError$.next(void 0)}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}}return t.\u0275fac=function(n){return new(n||t)(e.LFG(d.Vj7),e.LFG(H.Y))},t.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac}),t})();var K=i(8102),q=i(408),ee=i(7189),te=i(7622);let ne=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({providers:[P],imports:[[c.ez,l.Bz,f.UX,k.s,y.U5,A.L,v.Jb,I.sL,R.X0.forChild(),w.A,B.B,V.R,G.v,j.$,q.e,K.X,ee.V,te.F]]}),t})(),ie=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[[c.ez,D.WG,v.Jb,Z.vh,b.H0,g.zf,ne]]}),t})();var z=i(915),x=i(5517),m=i(444),se=i(9350),oe=i(1014),re=i(7815),ae=i(2643),ce=i(6874),de=i(2683),le=i(2993);function ge(t,o){1&t&&e.GkF(0)}function pe(t,o){if(1&t){const n=e.EpF();e.TgZ(0,"nz-form-item"),e.TgZ(1,"nz-form-control"),e.TgZ(2,"cvc-form-buttons"),e.TgZ(3,"cvc-org-selector-btn-group",5),e.NdJ("selectedOrgChange",function(a){return e.CHM(n),e.oxw().mostRecentOrg=a}),e.TgZ(4,"button",6),e._uU(5," Suggest Revision "),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA()}if(2&t){const n=e.oxw();e.xp6(3),e.Q6J("selectedOrg",n.mostRecentOrg),e.xp6(1),e.Q6J("disabled",!n.formGroup.valid)}}function ve(t,o){1&t&&e.GkF(0)}function me(t,o){if(1&t&&(e.TgZ(0,"nz-form-item"),e._UZ(1,"cvc-form-errors-alert",7),e.qZA()),2&t){const n=e.oxw().ngIf;e.xp6(1),e.Q6J("errors",n)}}function ue(t,o){if(1&t&&(e.ynx(0),e.YNc(1,me,2,1,"nz-form-item",3),e.BQk()),2&t){const n=o.ngIf;e.xp6(1),e.Q6J("ngIf",n.length>0)}}function fe(t,o){1&t&&(e.TgZ(0,"p"),e._uU(1,"View it on the "),e.TgZ(2,"a",11),e._uU(3,"Revisions Page"),e.qZA(),e._uU(4," or suggest another revision below."),e.qZA())}function he(t,o){if(1&t&&(e.ynx(0),e._UZ(1,"nz-alert",8),e.YNc(2,fe,5,0,"ng-template",9,10,e.W1O),e.BQk()),2&t){const n=e.MAs(3);e.xp6(1),e.Q6J("nzDescription",n)}}function ye(t,o){if(1&t&&(e.YNc(0,ue,2,1,"ng-container",3),e.ALo(1,"async"),e.YNc(2,he,4,1,"ng-container",3),e.ALo(3,"async")),2&t){const n=e.oxw();e.Q6J("ngIf",e.lcZ(1,2,n.submitError$)),e.xp6(2),e.Q6J("ngIf",e.lcZ(3,4,n.submitSuccess$))}}let ze=(()=>{class t{constructor(n,s,a){this.revisionService=n,this.viewerService=s,this.revisableFieldsGQL=a,this.destroy$=new M.xQ,this.formGroup=new f.cw({}),this.formOptions={},this.viewerService.viewer$.pipe((0,$.R)(this.destroy$)).subscribe(r=>{this.organizations=r.organizations,this.mostRecentOrg=r.mostRecentOrg}),this.submitError$=this.revisionService.submitError$,this.isSubmitting$=this.revisionService.isSubmitting$,this.submitSuccess$=this.revisionService.submitSuccess$,this.formFields=[{key:"id",type:"input",hide:!0},{key:"fields.variantOrigin",type:"select",templateOptions:{label:"Variant Origin",required:!0,options:(0,m.o6)(d.huM).map((r,p)=>({value:r,label:(0,z.E)(r)}))}},{key:"fields.description",type:"textarea",templateOptions:{label:"Description",placeholder:"Enter a description for this evidence item.",required:!1}},{key:"fields.source",type:"multi-field",templateOptions:{label:"Source",addText:"Add another Source",maxCount:1},fieldArray:{type:"source-input",templateOptions:{required:!0}}},{key:"fields.evidenceType",type:"select",templateOptions:{label:"Evidence Type",required:!0,options:(0,m.o6)(d.kqt).map((r,p)=>({value:r,label:(0,z.E)(r)}))}},{key:"fields.clinicalSignificance",type:"select",templateOptions:{label:"Clinical Signficance",required:!0,options:(0,m.o6)(d._Aq).map((r,p)=>({value:r,label:(0,z.E)(r)}))}},{key:"fields.disease",type:"multi-field",templateOptions:{label:"Disease",addText:"Add a Disease",minLength:1,maxCount:1},fieldArray:{type:"disease-input",templateOptions:{}}},{key:"fields.description",type:"textarea",templateOptions:{label:"Evidence Statement",placeholder:"Please enter statement describing this evidence item.",required:!1}},{key:"fields.evidenceLevel",type:"select",templateOptions:{label:"Evidence Level",required:!0,options:(0,m.o6)(d.Sx0).map((r,p)=>({value:r,label:p}))}},{key:"fields.evidenceDirection",type:"select",templateOptions:{label:"Evidence Direction",placeholder:"Please select an Evidence Direction",required:!0,options:(0,m.o6)(d.tI1).map((r,p)=>({value:r,label:(0,z.E)(r)}))}},{key:"fields.drugs",type:"multi-field",templateOptions:{label:"Drug(s)",addText:"Add a Drug"},fieldArray:{type:"drug-input",templateOptions:{}}},{key:"fields.drugInteractionType",type:"select",templateOptions:{label:"Drug InteractionType",required:!1,placeholder:"Please select a Drug Interaction Type",options:(0,m.o6)(d.Zyn).map((r,p)=>({value:r,label:p}))}},{key:"fields.phenotypes",type:"multi-field",templateOptions:{label:"Associated Phenotypes",addText:"Add a Phenoype"},fieldArray:{type:"phenotype-input",templateOptions:{}}},{key:"fields.evidenceRating",type:"rating-input",templateOptions:{label:"Rating"}},{key:"comment",type:"comment-textarea",templateOptions:{label:"Comment",placeholder:"Please enter a comment describing your revision.",required:!0,minLength:10}}]}ngOnInit(){this.revisableFieldsGQL.fetch({evidenceId:this.evidenceId}).subscribe(({data:{evidenceItem:n}})=>{n?this.formModel=this.toFormModel(n):console.error("Evidence Revise form could not retrieve evidence item."),this.formOptions.updateInitialValue&&this.formOptions.updateInitialValue()})}toFormModel(n){return{id:n.id,organizationId:void 0,fields:Object.assign(Object.assign({},n),{source:[n.source],drugs:n.drugs.length>0?n.drugs:[],disease:[n.disease]})}}selectOrg(n){this.mostRecentOrg=n}submitRevision(n){this.revisionService.suggest(this.toRevisionInput(n))}toRevisionInput(n){const s=n.fields;return Object.assign(Object.assign({},n),{fields:{variantOrigin:s.variantOrigin,description:x.xt(s.description),variantId:s.variant.id,sourceId:s.source[0].id,evidenceType:s.evidenceType,evidenceDirection:s.evidenceDirection,clinicalSignificance:s.clinicalSignificance,diseaseId:x.uP(s.disease[0].id),evidenceLevel:s.evidenceLevel,phenotypeIds:s.phenotypes.map(a=>a.id),rating:+s.evidenceRating,drugIds:s.drugs.map(a=>a.id),drugInteractionType:x.uP(s.drugInteractionType)},organizationId:void 0===this.mostRecentOrg?void 0:this.mostRecentOrg.id})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete(),this.revisionService.cleanup()}}return t.\u0275fac=function(n){return new(n||t)(e.Y36(P),e.Y36(se.a),e.Y36(d.Q_P))},t.\u0275cmp=e.Xpm({type:t,selectors:[["cvc-evidence-revise-form"]],inputs:{evidenceId:"evidenceId"},decls:8,vars:10,consts:[["nz-form","","nzLayout","vertical",3,"formGroup","ngSubmit"],[4,"ngTemplateOutlet"],[3,"form","fields","model","options","modelChange"],[4,"ngIf"],["formMessages",""],[3,"selectedOrg","selectedOrgChange"],["type","submit","nz-button","","cvcOrgSelectorBtn","","nzType","primary","nzSize","small",3,"disabled"],[3,"errors"],["nzType","success","nzMessage","Suggested Revision Submitted","nzShowIcon","",3,"nzDescription"],["nzSize","small"],["successMessage",""],["routerLink","../../revisions"]],template:function(n,s){if(1&n&&(e.TgZ(0,"form",0),e.NdJ("ngSubmit",function(){return s.submitRevision(s.formModel)}),e.YNc(1,ge,1,0,"ng-container",1),e.TgZ(2,"formly-form",2),e.NdJ("modelChange",function(r){return s.formModel=r}),e.qZA(),e.YNc(3,pe,6,2,"nz-form-item",3),e.ALo(4,"async"),e.YNc(5,ve,1,0,"ng-container",1),e.qZA(),e.YNc(6,ye,4,6,"ng-template",null,4,e.W1O)),2&n){const a=e.MAs(7);e.Q6J("formGroup",s.formGroup),e.xp6(1),e.Q6J("ngTemplateOutlet",a),e.xp6(1),e.Q6J("form",s.formGroup)("fields",s.formFields)("model",s.formModel)("options",s.formOptions),e.xp6(1),e.Q6J("ngIf",!e.lcZ(4,8,s.submitSuccess$)),e.xp6(2),e.Q6J("ngTemplateOutlet",a)}},directives:[f._Y,f.JL,y.Lr,f.sg,c.tP,R.T7,c.O5,v.SK,y.Nx,v.t3,y.Fd,oe.Z,re.q,I.ix,ae.dQ,ce.m,de.w,le.V,A.r,l.yS],pipes:[c.Ov],styles:[""]}),t})();function Ee(t,o){if(1&t&&(e.ynx(0),e._UZ(1,"cvc-evidence-revise-form",8),e.BQk()),2&t){const n=e.oxw();e.xp6(1),e.Q6J("evidenceId",n.evidenceId)}}function xe(t,o){1&t&&e._uU(0,"Loading Evidence...")}const Oe=function(){return{rows:1}};function Se(t,o){1&t&&e._UZ(0,"nz-skeleton",9),2&t&&e.Q6J("nzParagraph",e.DdM(1,Oe))}const Te=function(){return{rows:3}};function Ze(t,o){1&t&&e._UZ(0,"nz-skeleton",9),2&t&&e.Q6J("nzParagraph",e.DdM(1,Te))}const be=function(){return{rows:4}};function Re(t,o){1&t&&e._UZ(0,"nz-skeleton",9),2&t&&e.Q6J("nzParagraph",e.DdM(1,be))}const Ie=function(){return{rows:5}};function Ae(t,o){1&t&&e._UZ(0,"nz-skeleton",9),2&t&&e.Q6J("nzParagraph",e.DdM(1,Ie))}const Me=[{path:"",component:N,data:{breadcrumb:"Revise"},children:[{path:"",redirectTo:"suggest",pathMatch:"full"},{path:"suggest",component:(()=>{class t{constructor(n){this.route=n,this.routeParams$=this.route.params.subscribe(s=>{this.evidenceId=+s.evidenceId})}ngOnDestroy(){this.routeParams$.unsubscribe()}}return t.\u0275fac=function(n){return new(n||t)(e.Y36(l.gz))},t.\u0275cmp=e.Xpm({type:t,selectors:[["cvc-evidence-suggest"]],decls:12,vars:3,consts:[[3,"nzGutter"],["nzSpan","16"],[4,"ngIf","ngIfElse"],["loadingEvidence",""],["nzSpan","8"],["nzTitle","Instructions","nz-type","inner"],["nzDirection","vertical",2,"width","100%"],[3,"nzParagraph",4,"nzSpaceItem"],[3,"evidenceId"],[3,"nzParagraph"]],template:function(n,s){if(1&n&&(e.TgZ(0,"nz-row",0),e.TgZ(1,"nz-col",1),e.YNc(2,Ee,2,1,"ng-container",2),e.YNc(3,xe,1,0,"ng-template",null,3,e.W1O),e.qZA(),e.TgZ(5,"nz-col",4),e.TgZ(6,"nz-card",5),e.TgZ(7,"nz-space",6),e.YNc(8,Se,1,2,"nz-skeleton",7),e.YNc(9,Ze,1,2,"nz-skeleton",7),e.YNc(10,Re,1,2,"nz-skeleton",7),e.YNc(11,Ae,1,2,"nz-skeleton",7),e.qZA(),e.qZA(),e.qZA(),e.qZA()),2&n){const a=e.MAs(4);e.Q6J("nzGutter",16),e.xp6(2),e.Q6J("ngIf",s.evidenceId)("ngIfElse",a)}},directives:[v.SK,v.t3,c.O5,ze,Z.bd,g.NU,g.$1,b.ng],styles:[""]}),t})(),data:{breadcrumb:"Suggest Revision"}}]}];let $e=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[[l.Bz.forChild(Me),ie],l.Bz]}),t})();var Pe=i(5630),Fe=i(3309),Qe=i(4867);let Je=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[[c.ez,$e,h.KJ,g.zf,T.PV,S.ZJ,g.zf,Fe.U,Qe.Q,Pe.D]]}),t})()}}]);