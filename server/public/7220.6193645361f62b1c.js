"use strict";(self.webpackChunkmain=self.webpackChunkmain||[]).push([[7220],{7220:(x,f,l)=>{l.d(f,{m:()=>Ve});var g=l(9808),p=l(8776),s=l(6761),a=l(3075),e=l(5e3),_=l(7484),M=l(868),T=l(3434),y=l(8929),I=l(373),F=l(2198),S=l(4850),v=l(7625),G=l(13),h=l(7630);const W=/\(/g,D=/\)/g,N=/AND|OR/i,X=/^(?<not>NOT\s)?\s*#VID(?<variantId>\d+)$/i,L=/\s+/,b="EXPR";function O(n){return w(n.replace(W," ( ").replace(D," ) "))}function w(n){let t,i=n.split(L),o=0,r=[],c=[],d=[];for(let u of i)if("("==u)0!=o&&r.push(u),o+=1;else if(")"==u)if(o-=1,0==o){let m=w(r.join(" "));if("errorMessage"in m)return m;d.push(m),c.push(b),r=[]}else r.push(u);else o>0?r.push(u):c.push(u);let P=0;for(let u of c){let m=N.test(u);if(m&&P==i.length-1)return{errorMessage:"Trailing boolean operator found. You cannot end your profile with an operator."};if(m&&0==P)return{errorMessage:"The expression cannot start with AND/OR"};if(m&&!t)t=Z(u);else if(m&&t&&Z(u)!==t)return{errorMessage:"You cannot mix and match AND/OR in a single segment. Use parenthesis to logically group your variants."};P++}let H=[],Qe=c.join(" ").split(N);for(let u of Qe.map(m=>m.trim())){let m=X.exec(u);if(null===m){if(u!==b)return{errorMessage:`Variant ${u} does not match the expected format. The token should be a #VID prepended with an optional NOT.`}}else H.push({not:!!m[1],variantId:parseInt(m[2])})}return{booleanOperator:t,variantComponents:H,complexComponents:d}}function Z(n){return"AND"==n.toUpperCase()?h._Wm.And:h._Wm.Or}var V=l(3240),K=l(6123),Q=l(2288),k=l(9169),q=l(8511),A=l(8481),ee=l(2683),J=l(5017),U=l(7525),te=l(1894),Y=l(4546),ne=l(822),C=l(8144),E=l(6042),oe=l(2643),re=l(7230),$=l(3618),z=l(4921),j=l(3610),B=l(6949);const le=["mpInputField"];function ie(n,i){if(1&n){const t=e.EpF();e.ynx(0),e._UZ(1,"cvc-molecular-profile-tag",2),e.TgZ(2,"nz-tag",3)(3,"i",4),e.NdJ("click",function(){return e.CHM(t),e.oxw().resetForm()}),e.qZA()(),e.BQk()}if(2&n){const t=e.oxw();e.xp6(1),e.Q6J("molecularProfile",t.selectedMp)}}function ae(n,i){if(1&n&&(e.TgZ(0,"nz-form-item"),e._UZ(1,"cvc-form-errors-alert",14),e.qZA()),2&n){const t=e.oxw(2);e.xp6(1),e.Q6J("errors",t.errorMessages)}}function ce(n,i){if(1&n){const t=e.EpF();e.ynx(0),e._UZ(1,"cvc-molecular-profile-tag",2),e.TgZ(2,"button",16),e.NdJ("click",function(){return e.CHM(t),e.oxw(5).submitNewMp()}),e._uU(3," Select this Molecular Profile "),e.qZA(),e.BQk()}if(2&n){const t=i.ngIf;e.xp6(1),e.Q6J("molecularProfile",t)}}function se(n,i){if(1&n){const t=e.EpF();e._UZ(0,"cvc-mp-tag-name",17),e.TgZ(1,"button",16),e.NdJ("click",function(){return e.CHM(t),e.oxw(5).submitNewMp()}),e._uU(2," Create Molecular Profile "),e.qZA()}if(2&n){const t=e.oxw(2).ngIf;e.Q6J("nameSegments",t)}}function pe(n,i){if(1&n&&(e.ynx(0),e.YNc(1,ce,4,1,"ng-container",0),e.ALo(2,"ngrxPush"),e.YNc(3,se,3,1,"ng-template",null,15,e.W1O),e.BQk()),2&n){const t=e.MAs(4),o=e.oxw(4);e.xp6(1),e.Q6J("ngIf",e.lcZ(2,2,o.previewMpAlreadyExists$))("ngIfElse",t)}}function ue(n,i){if(1&n&&(e.ynx(0),e.YNc(1,pe,5,4,"ng-container",0),e.BQk()),2&n){e.oxw(2);const t=e.MAs(5),o=e.oxw();e.xp6(1),e.Q6J("ngIf",o.displayPreview)("ngIfElse",t)}}function me(n,i){if(1&n&&(e.ynx(0),e.YNc(1,ue,2,2,"ng-container",6),e.ALo(2,"ngrxPush"),e.BQk()),2&n){const t=e.oxw(2);e.xp6(1),e.Q6J("ngIf",e.lcZ(2,1,t.previewMpName$))}}function fe(n,i){if(1&n&&(e.ynx(0),e._uU(1),e.BQk()),2&n){const t=e.oxw(3);e.xp6(1),e.hij(" ",t.parseError," ")}}function _e(n,i){1&n&&(e.ynx(0),e.TgZ(1,"span",18),e._uU(2," Start constructing a complex molecular profile to preview it here "),e.qZA(),e.BQk())}function ge(n,i){if(1&n&&(e.YNc(0,fe,2,1,"ng-container",6),e.YNc(1,_e,3,0,"ng-container",6)),2&n){const t=e.oxw(2);e.Q6J("ngIf",t.parseError),e.xp6(1),e.Q6J("ngIf",!t.parseError)}}function de(n,i){if(1&n&&(e.ynx(0),e.TgZ(1,"span"),e._uU(2),e.qZA(),e.BQk()),2&n){const t=i.$implicit;e.xp6(2),e.Oqu(t.displayName)}}function ve(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"nz-mention",19),e.NdJ("nzOnSearchChange",function(r){return e.CHM(t),e.oxw(2).onSearchChange(r)})("nzOnSelect",function(){return e.CHM(t),e.oxw(2).suggestions=[]}),e.TgZ(1,"textarea",20,21),e.NdJ("ngModelChange",function(r){return e.CHM(t),e.oxw(2).mpName=r})("ngModelChange",function(r){return e.CHM(t),e.oxw(2).onMpNameChanged(r)}),e.qZA(),e.YNc(3,de,3,1,"ng-container",22),e.qZA()}if(2&n){const t=e.oxw(2);e.Q6J("nzStatus",t.parseError?"warning":"")("nzSuggestions",t.suggestions)("nzValueWith",t.autoCompleteValueFor),e.xp6(1),e.Q6J("ngModel",t.mpName)}}function he(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"button",23),e.NdJ("nzPopoverVisibleChange",function(r){return e.CHM(t),e.oxw(2).variantFinderVisible=r})("click",function(){e.CHM(t);const r=e.oxw(2);return r.variantFinderVisible=!r.variantFinderVisible}),e._uU(1," Find a Variant "),e._UZ(2,"i",24),e.qZA()}if(2&n){e.oxw();const t=e.MAs(9),o=e.MAs(11),r=e.oxw();e.Q6J("nzPopoverTitle",t)("nzPopoverVisible",r.variantFinderVisible)("nzPopoverContent",o)("nzPopoverTrigger",void 0)}}const xe=function(){return{float:"right"}};function Me(n,i){if(1&n){const t=e.EpF();e._uU(0," Find a Variant "),e.TgZ(1,"span",25)(2,"i",26),e.NdJ("click",function(){return e.CHM(t),e.oxw(2).variantFinderVisible=!1}),e.qZA()()}2&n&&(e.xp6(1),e.Q6J("ngStyle",e.DdM(1,xe)))}function Ce(n,i){if(1&n){const t=e.EpF();e.TgZ(0,"cvc-variant-submit-form",27),e.NdJ("onVariantSelected",function(r){return e.CHM(t),e.oxw(2).onVariantSelected(r)}),e.qZA()}}function ze(n,i){if(1&n&&(e.TgZ(0,"nz-spin",5),e.YNc(1,ae,2,1,"nz-form-item",6),e.TgZ(2,"nz-space",7),e.YNc(3,me,3,3,"ng-container",8),e.YNc(4,ge,2,2,"ng-template",null,9,e.W1O),e.YNc(6,ve,4,4,"nz-mention",10),e.YNc(7,he,3,4,"button",11),e.qZA(),e.YNc(8,Me,3,2,"ng-template",null,12,e.W1O),e.YNc(10,Ce,1,0,"ng-template",null,13,e.W1O),e.qZA()),2&n){const t=e.oxw();e.Q6J("nzSpinning",t.loading),e.xp6(1),e.Q6J("ngIf",t.errorMessages.length>0)}}let Pe=(()=>{class n{constructor(t,o,r,c,d){this.previewMpGql=t,this.quicksearchGql=o,this.createMolecularProfileGql=r,this.networkErrorService=c,this.cdr=d,this.onMolecularProfileSelected=new e.vpe,this.destroy$=new y.xQ,this.debouncedPreview=new y.xQ,this.suggestions=[],this.loading=!1,this.errorMessages=[],this.displayPreview=!1,this.variantFinderVisible=!1,this.createMolecularProfileMutator=new K.U(c)}ngOnInit(){var t,o,r,c;this.previewQueryRef=this.previewMpGql.watch({}),this.previewMpName$=this.previewQueryRef.valueChanges.pipe((0,I.j)("data","previewMolecularProfileName"),(0,F.h)(V.ep),(0,S.U)(d=>d.segments),(0,Q.tag)("preview segment"),(0,v.R)(this.destroy$)),this.previewMpAlreadyExists$=this.previewQueryRef.valueChanges.pipe((0,I.j)("data","previewMolecularProfileName"),(0,F.h)(V.ep),(0,S.U)(d=>d.existingMolecularProfile),(0,Q.tag)("exists"),(0,v.R)(this.destroy$)),(null===(o=null===(t=this.formConfig)||void 0===t?void 0:t.formControl)||void 0===o?void 0:o.value)&&(this.selectedMp=null===(c=null===(r=this.formConfig)||void 0===r?void 0:r.formControl)||void 0===c?void 0:c.value,this.displayPreview=!0,this.cdr.detectChanges()),this.debouncedPreview.pipe((0,v.R)(this.destroy$),(0,G.b)(300)).subscribe(d=>this.refresh())}autoCompleteValueFor(t){return t.value}resetForm(){this.mpName="",this.selectedMp=void 0,this.onMolecularProfileSelected.emit(void 0),this.refresh(),this.cdr.detectChanges()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}onSearchChange({}){}onMpNameChanged(t){this.debouncedPreview.next()}refresh(){var t;if(this.mpName&&""!=this.mpName.trim()){let o=O(this.mpName);"errorMessage"in o?(this.parseError=o.errorMessage,this.displayPreview=!1):(this.parseError=void 0,null===(t=this.previewQueryRef)||void 0===t||t.refetch({mpStructure:o}).then(()=>this.displayPreview=!0))}else this.parseError=void 0,this.displayPreview=!1}onVariantSelected(t){var o;this.variantFinderVisible=!1,this.mpName?this.mpName+=` #VID${t.variantId} `:this.mpName=`#VID${t.variantId} `,null===(o=this.mpInputField)||void 0===o||o.nativeElement.focus(),this.refresh()}submitNewMp(){if(this.mpName&&""!=this.mpName.trim()){let t=O(this.mpName);if(!("errorMessage"in t)){let o=this.createMolecularProfileMutator.mutate(this.createMolecularProfileGql,{mpStructure:t},{},r=>{this.onMolecularProfileSelected.emit(r.createMolecularProfile.molecularProfile.id),this.selectedMp=r.createMolecularProfile.molecularProfile,this.cdr.detectChanges()});o.submitError$.pipe((0,v.R)(this.destroy$)).subscribe(r=>{r&&(this.errorMessages=r,this.loading=!1)}),o.submitSuccess$.pipe((0,v.R)(this.destroy$)).subscribe(()=>{this.loading=!1}),o.isSubmitting$.pipe((0,v.R)(this.destroy$)).subscribe(r=>{this.loading=r})}}}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(h.GSh),e.Y36(h.ghc),e.Y36(h.Ws),e.Y36(k.Y),e.Y36(e.sBO))},n.\u0275cmp=e.Xpm({type:n,selectors:[["cvc-complex-molecular-profile-input-form"]],viewQuery:function(t,o){if(1&t&&e.Gf(le,5),2&t){let r;e.iGM(r=e.CRH())&&(o.mpInputField=r.first)}},inputs:{formConfig:"formConfig"},outputs:{onMolecularProfileSelected:"onMolecularProfileSelected"},decls:4,vars:2,consts:[[4,"ngIf","ngIfElse"],["createMp",""],[3,"molecularProfile"],[1,"close-tag"],["nz-icon","","nzType","close",3,"click"],["nzTip","Submitting",3,"nzSpinning"],[4,"ngIf"],["nzDirection","vertical","nzSize","large"],[4,"nzSpaceItem"],["noPreview",""],["nzPrefix","#","nzNotFoundContent","No matches...",3,"nzStatus","nzSuggestions","nzValueWith","nzOnSearchChange","nzOnSelect",4,"nzSpaceItem"],["nz-button","","nz-popover","","nzSize","small","nzPopoverPlacement","bottom",3,"nzPopoverTitle","nzPopoverVisible","nzPopoverContent","nzPopoverTrigger","nzPopoverVisibleChange","click",4,"nzSpaceItem"],["variantFinderTitle",""],["variantFinder",""],[3,"errors"],["newMp",""],["nz-button","","nzSize","small",2,"float","right",3,"click"],[3,"nameSegments"],["nz-typography","","nzType","secondary"],["nzPrefix","#","nzNotFoundContent","No matches...",3,"nzStatus","nzSuggestions","nzValueWith","nzOnSearchChange","nzOnSelect"],["nz-input","","rows","1",2,"width","100%",3,"ngModel","ngModelChange"],["mpInputField",""],[4,"nzMentionSuggestion"],["nz-button","","nz-popover","","nzSize","small","nzPopoverPlacement","bottom",3,"nzPopoverTitle","nzPopoverVisible","nzPopoverContent","nzPopoverTrigger","nzPopoverVisibleChange","click"],["nz-icon","","nzType","caret-down","nzTheme","outline"],[3,"ngStyle"],["nz-icon","","nzType","close","nzTheme","outline",3,"click"],[3,"onVariantSelected"]],template:function(t,o){if(1&t&&(e.TgZ(0,"nz-card"),e.YNc(1,ie,4,1,"ng-container",0),e.qZA(),e.YNc(2,ze,12,2,"ng-template",null,1,e.W1O)),2&t){const r=e.MAs(3);e.xp6(1),e.Q6J("ngIf",o.selectedMp)("ngIfElse",r)}},directives:[_.bd,g.O5,q.p,A.j,ee.w,J.Ls,U.W,te.SK,Y.Nx,ne.V,C.NU,C.$1,E.ix,oe.dQ,re.C,$.ZU,z.YW,a.Fj,a.JJ,a.On,z.O3,j.lU,g.PC,T.G],pipes:[B.fM],styles:[":host{display:block}nz-space{width:100%}nz-form-item:last-of-type{margin-bottom:0}.close-tag{margin-left:-9px;cursor:pointer}\n"],encapsulation:2}),n})();const Te=["complexMolecularProfileInputForm"],ye={name:"molecular-profile-input",component:(()=>{class n extends p.fS{constructor(){super()}onVariantSelected(t){this.field.formControl.setValue(t.molecularProfile)}onMpSelected(t){this.field.formControl.setValue(t)}clear(){var t;this.field.formControl.setValue(void 0),null===(t=this.complexMpForm)||void 0===t||t.resetForm()}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=e.Xpm({type:n,selectors:[["cvc-molecular-profile-input-type"]],viewQuery:function(t,o){if(1&t&&e.Gf(Te,5),2&t){let r;e.iGM(r=e.CRH())&&(o.complexMpForm=r.first)}},features:[e.qOj],decls:8,vars:5,consts:[[3,"nzAnimated","nzSelectedIndex","nzSelectChange"],["nzTitle","Simple Molecular Profile"],[3,"onVariantSelected"],["nzTitle","Complex Molecular Profile"],[3,"formConfig","onMolecularProfileSelected"],["complexMolecularProfileInputForm",""],["type","hidden",3,"formControl","formlyAttributes"]],template:function(t,o){1&t&&(e.TgZ(0,"nz-card")(1,"nz-tabset",0),e.NdJ("nzSelectChange",function(){return o.clear()}),e.TgZ(2,"nz-tab",1)(3,"cvc-variant-submit-form",2),e.NdJ("onVariantSelected",function(c){return o.onVariantSelected(c)}),e.qZA()(),e.TgZ(4,"nz-tab",3)(5,"cvc-complex-molecular-profile-input-form",4,5),e.NdJ("onMolecularProfileSelected",function(c){return o.onMpSelected(c)}),e.qZA()()(),e._UZ(7,"input",6),e.qZA()),2&t&&(e.xp6(1),e.Q6J("nzAnimated",!1)("nzSelectedIndex",null==(null==o.field.templateOptions?null:o.field.templateOptions.nzSelectedIndex)?0:null==o.field.templateOptions?null:o.field.templateOptions.nzSelectedIndex),e.xp6(4),e.Q6J("formConfig",o.field),e.xp6(2),e.Q6J("formControl",o.formControl)("formlyAttributes",o.field))},directives:[_.bd,M.xH,M.xw,T.G,Pe,a.Fj,a.JJ,a.oH,p.VQ],styles:[""]}),n})(),wrappers:["form-field"]};var Ie=l(7008),Fe=l(1825),Se=l(4375),Ne=l(1017),be=l(2190),Oe=l(2359),R=l(7058),we=l(2467);let Ze=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[g.ez,a.UX,B.WG,E.sL,_.vh,Y.U5,J.PV,j.$6,C.zf,z.Gl,Oe.L,U.j,$.ZJ,A.X,a.u5,Ie.B,Fe.A,Se.R,be.r,we.u,R.e,Ne.s]]}),n})(),Ve=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[g.ez,a.UX,a.u5,p.X0.forChild({types:[ye]}),s.Ju,M.we,_.vh,R.e,Ze]]}),n})()},4966:(x,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.hide=void 0,f.hide=function l(){return function(s){return s.lift(new g)}};var g=function(){function p(){this.hide=!0}return p.prototype.call=function(s,a){return a.subscribe(s)},p}()},2288:function(x,f,l){var g=this&&this.__createBinding||(Object.create?function(s,a,e,_){void 0===_&&(_=e),Object.defineProperty(s,_,{enumerable:!0,get:function(){return a[e]}})}:function(s,a,e,_){void 0===_&&(_=e),s[_]=a[e]}),p=this&&this.__exportStar||function(s,a){for(var e in s)"default"!==e&&!a.hasOwnProperty(e)&&g(a,s,e)};Object.defineProperty(f,"__esModule",{value:!0}),p(l(4966),f),p(l(5303),f)},5303:(x,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.tag=void 0,f.tag=function l(p){return function(a){return a.lift(new g(p))}};var g=function(){function p(s){this.tag=s}return p.prototype.call=function(s,a){return a.subscribe(s)},p}()}}]);