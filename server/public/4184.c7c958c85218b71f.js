"use strict";(self.webpackChunkmain=self.webpackChunkmain||[]).push([[4184],{8227:(N,L,r)=>{r.d(L,{q:()=>w});var o=r(5e3),m=r(8929),e=r(4850),g=r(373),S=r(2994),l=r(7625),x=r(1793),B=r(9350),C=r(9808),O=r(6042),E=r(2683),p=r(2643),z=r(3677),y=r(8144),M=r(6699),I=r(4219),Q=r(6949);function P(u,h){1&u&&o.Hsn(0)}function d(u,h){1&u&&o.GkF(0)}function b(u,h){if(1&u&&(o.ynx(0),o.YNc(1,d,1,0,"ng-container",5),o.BQk()),2&u){o.oxw(2);const s=o.MAs(1);o.xp6(1),o.Q6J("ngTemplateOutlet",s)}}function f(u,h){1&u&&o.GkF(0)}function v(u,h){if(1&u&&(o.ynx(0),o.TgZ(1,"nz-button-group",6),o.YNc(2,f,1,0,"ng-container",5),o.TgZ(3,"button",7),o.ALo(4,"ngrxPush"),o.TgZ(5,"nz-space",8)(6,"span"),o._uU(7,"for"),o.qZA(),o._UZ(8,"nz-avatar",9)(9,"i",10),o.qZA()()(),o.BQk()),2&u){o.oxw();const s=o.MAs(4),_=o.oxw(),Z=o.MAs(1);o.xp6(1),o.Q6J("nzSize",_.nzSize),o.xp6(1),o.Q6J("ngTemplateOutlet",Z),o.xp6(1),o.Q6J("nzType",_.buttonType)("nzDanger",_.nzDanger)("disabled",o.lcZ(4,10,_.isDisabled$))("nzDropdownMenu",s),o.xp6(2),o.Q6J("nzSize",4),o.xp6(3),o.Q6J("nzSrc",null==_.selectedOrg?null:_.selectedOrg.profileImagePath)("nzSize",10)("nzShape","square")}}function F(u,h){if(1&u){const s=o.EpF();o.TgZ(0,"li",11),o.NdJ("click",function(){const J=o.CHM(s).$implicit;return o.oxw(2).selectOrg(J)}),o._UZ(1,"nz-avatar",12),o._uU(2),o.qZA()}if(2&u){const s=h.$implicit,_=o.oxw(2);o.Q6J("nzSelected",(null==_.selectedOrg?null:_.selectedOrg.id)===s.id),o.xp6(1),o.Q6J("nzSrc",null==s?null:s.profileImagePath)("nzSize",10)("nzShape","square"),o.xp6(1),o.hij(" ",s.name," ")}}function U(u,h){if(1&u&&(o.ynx(0),o.YNc(1,b,2,1,"ng-container",1),o.YNc(2,v,10,12,"ng-container",1),o.TgZ(3,"nz-dropdown-menu",null,2)(5,"ul",3),o.YNc(6,F,3,5,"li",4),o.qZA()(),o.BQk()),2&u){const s=h.ngIf;o.xp6(1),o.Q6J("ngIf",s.length<=1),o.xp6(1),o.Q6J("ngIf",s.length>1),o.xp6(4),o.Q6J("ngForOf",s)}}const A=["*"];let w=(()=>{class u{constructor(s){this.viewerService=s,this.selectedOrgChange=new o.vpe,this.buttonType="primary",this.nzDanger=!1,this.nzSize="small",this.destroy$=new m.xQ,this.isDisabled$=new m.xQ}selectOrg(s){this.selectedOrg=s,this.selectedOrgChange.emit(s)}refreshViewer(){setTimeout(()=>{this.viewerService.refetch()},2500)}ngOnInit(){this.organizations$=this.viewerService.viewer$.pipe((0,e.U)(s=>s.organizations)),this.mostRecentOrg$=this.viewerService.viewer$.pipe((0,g.j)("mostRecentOrg"),(0,S.b)(s=>{s&&(this.selectedOrg=s,this.selectedOrgChange.emit(s))})),this.mostRecentOrg$.pipe((0,l.R)(this.destroy$)).subscribe()}ngAfterViewInit(){this.button&&this.button.domChange&&this.button.domChange.pipe((0,l.R)(this.destroy$)).subscribe(s=>{"disabled"===s.type&&"boolean"==typeof s.change&&this.isDisabled$.next(s.change)})}ngOnDestroy(){this.destroy$.next(),this.destroy$.unsubscribe()}}return u.\u0275fac=function(s){return new(s||u)(o.Y36(B.a))},u.\u0275cmp=o.Xpm({type:u,selectors:[["cvc-org-selector-btn-group"]],contentQueries:function(s,_,Z){if(1&s&&o.Suo(Z,x.m,5),2&s){let J;o.iGM(J=o.CRH())&&(_.button=J.first)}},inputs:{selectedOrg:"selectedOrg",buttonType:"buttonType",nzDanger:"nzDanger",nzSize:"nzSize"},outputs:{selectedOrgChange:"selectedOrgChange"},ngContentSelectors:A,decls:4,vars:3,consts:[["submitButton",""],[4,"ngIf"],["orgMenu","nzDropdownMenu"],["nz-menu",""],["nz-menu-item","",3,"nzSelected","click",4,"ngFor","ngForOf"],[4,"ngTemplateOutlet"],[3,"nzSize"],["type","button","nz-button","","nz-dropdown","",1,"org-dropdown-btn",3,"nzType","nzDanger","disabled","nzDropdownMenu"],["nzDirection","horizontal",3,"nzSize"],[3,"nzSrc","nzSize","nzShape"],["nz-icon","","nzType","down"],["nz-menu-item","",3,"nzSelected","click"],[2,"background-color","#f0f5ff",3,"nzSrc","nzSize","nzShape"]],template:function(s,_){1&s&&(o.F$t(),o.YNc(0,P,1,0,"ng-template",null,0,o.W1O),o.YNc(2,U,7,3,"ng-container",1),o.ALo(3,"async")),2&s&&(o.xp6(2),o.Q6J("ngIf",o.lcZ(3,1,_.organizations$)))},directives:[C.O5,C.tP,O.fY,E.w,O.ix,p.dQ,z.wA,z.cm,y.NU,M.Dz,z.RR,I.wO,C.sg,I.r9],pipes:[C.Ov,Q.fM],styles:["[_nghost-%COMP%]{display:inline-block}.org-dropdown-btn[_ngcontent-%COMP%]   nz-avatar[_ngcontent-%COMP%]{margin:0 6px}"]}),u})()},8979:(N,L,r)=>{r.d(L,{N:()=>E});var o=r(9808),m=r(8776),e=r(5e3),g=r(6042),S=r(2643),l=r(2683);const B={name:"cvc-multi-field-add-btn",component:(()=>{class p extends m.fS{constructor(){super()}}return p.\u0275fac=function(y){return new(y||p)},p.\u0275cmp=e.Xpm({type:p,selectors:[["cvc-multi-field-add-btn-type"]],features:[e.qOj],decls:2,vars:2,consts:[["type","submit","nz-button","","nzType","primary","nzSize","small","nzBlock","",3,"disabled"]],template:function(y,M){1&y&&(e.TgZ(0,"button",0),e._uU(1),e.qZA()),2&y&&(e.Q6J("disabled",M.to.disabled),e.xp6(1),e.Oqu(M.to.label))},directives:[g.ix,S.dQ,l.w],styles:[""],encapsulation:2,changeDetection:0}),p})()};var C=r(9139),O=r(4546);let E=(()=>{class p{}return p.\u0275fac=function(y){return new(y||p)},p.\u0275mod=e.oAB({type:p}),p.\u0275inj=e.cJS({imports:[[o.ez,C.u,m.X0.forChild({types:[B]}),O.U5,g.sL]]}),p})()},3022:(N,L,r)=>{r.d(L,{e:()=>P});var o=r(9808),m=r(8776),e=r(8929),g=r(5778),S=r(7625),l=r(5e3),x=r(9180),B=r(8227),C=r(6042),O=r(2643),E=r(1793),p=r(2683);const y={name:"org-submit-button",component:(()=>{class d extends m.fS{constructor(f){super(),this.cdr=f,this._selectedOrg=void 0,this.destroy$=new e.xQ,this.defaultOptions={templateOptions:{submitLabel:"Submit",submitSize:"small"}}}get selectedOrg(){return this._selectedOrg}set selectedOrg(f){this._selectedOrg=f,this.formControl.setValue(f)}ngAfterViewInit(){this.form.statusChanges.pipe((0,g.x)(),(0,S.R)(this.destroy$)).subscribe(()=>this.cdr.detectChanges())}ngOnDestroy(){this.destroy$.next(),this.destroy$.unsubscribe()}}return d.\u0275fac=function(f){return new(f||d)(l.Y36(l.sBO))},d.\u0275cmp=l.Xpm({type:d,selectors:[["cvc-org-submit-button-type"]],features:[l.qOj],decls:5,vars:4,consts:[[3,"selectedOrg","nzSize","selectedOrgChange"],["orgButton",""],["type","submit","nz-button","","cvcOrgSelectorBtn","","nzType","primary",3,"disabled","click"]],template:function(f,v){if(1&f){const F=l.EpF();l.TgZ(0,"cvc-form-buttons")(1,"cvc-org-selector-btn-group",0,1),l.NdJ("selectedOrgChange",function(A){return v.selectedOrg=A}),l.TgZ(3,"button",2),l.NdJ("click",function(){return l.CHM(F),l.MAs(2).refreshViewer()}),l._uU(4),l.qZA()()()}2&f&&(l.xp6(1),l.Q6J("selectedOrg",v.selectedOrg)("nzSize",v.to.submitSize),l.xp6(2),l.Q6J("disabled",!v.form.valid),l.xp6(1),l.hij(" ",v.to.submitLabel," "))},directives:[x.Z,B.q,C.ix,O.dQ,E.m,p.w],styles:[""],changeDetection:0}),d})()};var M=r(4375),I=r(1825),Q=r(3075);let P=(()=>{class d{}return d.\u0275fac=function(f){return new(f||d)},d.\u0275mod=l.oAB({type:d}),d.\u0275inj=l.cJS({imports:[[o.ez,Q.UX,m.X0.forChild({types:[y]}),C.sL,M.R,I.A]]}),d})()},3773:(N,L,r)=>{r.d(L,{g:()=>Te});var o=r(9808),m=r(8776),e=r(5e3),g=r(3075),S=r(7630),l=r(6530),x=r(444);const B={sourceType:void 0,citationId:void 0};let C=(()=>{class n{constructor(){this.sourceSelected=new e.vpe,this.model=B,this.form=new g.cw({}),this.options={},this.fields=[{key:"id"},{key:"citation",defaultValue:""},{key:"sourceType",type:"select",className:"source-type-field",defaultValue:S.yic.Pubmed,templateOptions:{required:!0,placeholder:"Select Type",options:(0,x.o6)(S.yic).map((t,i)=>({value:t,label:(0,l.c)(t)}))}},{key:"citationId",className:"citation-id-field",type:"source-selector-typeahead",templateOptions:{maxLength:10,required:!0,triggerParentSubmit:()=>{this.onSubmit()}},expressionProperties:{"templateOptions.disabled":"!model.sourceType","templateOptions.placeholder":'!model.sourceType ? "Select source type before searching" : "Search " + model.sourceType + " sources"',"templateOptions.sourceType":"model.sourceType","templateOptions.sourceTypeKey":t=>{if(t.sourceType)return(0,x.o6)(S.yic).getKeyOrThrow(t.sourceType)}}},{type:"cvc-multi-field-add-btn",className:"add-button",templateOptions:{label:"Add Source"},expressionProperties:{"templateOptions.disabled":"!model.citationId"}}]}ngOnInit(){}onSubmit(){console.log("source-select form submitted."),this.sourceSelected.emit(this.model)}ngOnDestroy(){console.log("source-selector onDestroy called.")}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=e.Xpm({type:n,selectors:[["cvc-source-selector"]],outputs:{sourceSelected:"sourceSelected"},decls:2,vars:5,consts:[["nz-form","","nzLayout","horizontal",3,"formGroup","ngSubmit"],[1,"formly-form",3,"model","fields","options","form","modelChange"]],template:function(t,i){1&t&&(e.TgZ(0,"form",0),e.NdJ("ngSubmit",function(){return i.onSubmit()}),e.TgZ(1,"formly-form",1),e.NdJ("modelChange",function(T){return i.model=T}),e.qZA()()),2&t&&(e.Q6J("formGroup",i.form),e.xp6(1),e.Q6J("model",i.model)("fields",i.fields)("options",i.options)("form",i.form))},directives:[g._Y,g.JL,g.sg,m.T7],styles:[":host{display:block}cvc-source-input .formly-form{width:100%}cvc-source-input .source-type-field{display:inline-block;width:10em}cvc-source-input .citation-id-field{display:inline-block;margin-left:.5em;width:calc(100% - 19em)}cvc-source-input .add-button{display:inline-block;margin-left:.5em;width:8em}\n"],encapsulation:2}),n})();var O=r(6906);function E(n,c){if(1&n){const t=e.EpF();e.ynx(0),e.TgZ(1,"cvc-source-selector",2),e.NdJ("sourceSelected",function(a){return e.CHM(t),e.oxw().onSourceSelected(a)}),e.qZA(),e.BQk()}}function p(n,c){if(1&n&&e._UZ(0,"cvc-source-tag",3),2&n){const t=e.oxw();e.Q6J("source",t.formControl.value)}}const y={name:"source-input",component:(()=>{class n extends m.fS{constructor(){super()}onSourceSelected(t){console.log(t),this.formControl.setValue(t)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=e.Xpm({type:n,selectors:[["cvc-source-input-type"]],features:[e.qOj],decls:3,vars:2,consts:[[4,"ngIf","ngIfElse"],["sourceListItem",""],[3,"sourceSelected"],[3,"source"]],template:function(t,i){if(1&t&&(e.YNc(0,E,2,0,"ng-container",0),e.YNc(1,p,1,1,"ng-template",null,1,e.W1O)),2&t){const a=e.MAs(2);e.Q6J("ngIf",!(null!=i.formControl.value&&i.formControl.value.id))("ngIfElse",a)}},directives:[o.O5,C,O.T],styles:[""],changeDetection:0}),n})()};var M=r(9139),I=r(6042),Q=r(8054),P=r(655),d=r(4987),b=r(3240),f=r(4850),v=r(2198),F=r(9397),U=r(537),A=r(8144),w=r(2359),u=r(1894),h=r(4546),s=r(822),_=r(2643),Z=r(2683);function J(n,c){if(1&n&&e._UZ(0,"nz-alert",6),2&n){e.oxw();const t=e.MAs(3);e.Q6J("nzMessage",t)}}function Y(n,c){if(1&n&&(e._uU(0," Found citation: "),e.TgZ(1,"em"),e._uU(2),e.qZA()),2&n){const t=e.oxw(3);e.xp6(2),e.Oqu(t.foundCitation)}}function V(n,c){1&n&&(e.ynx(0),e.YNc(1,J,1,1,"nz-alert",4),e.YNc(2,Y,3,1,"ng-template",null,5,e.W1O),e.BQk())}function K(n,c){if(1&n&&e._UZ(0,"nz-alert",9),2&n){e.oxw();const t=e.MAs(3);e.Q6J("nzMessage",t)}}function j(n,c){if(1&n&&(e._uU(0," '"),e.TgZ(1,"em"),e._uU(2),e.qZA(),e._uU(3,"' created. ")),2&n){const t=e.oxw(3);e.xp6(2),e.Oqu(t.foundCitation)}}function W(n,c){1&n&&(e.ynx(0),e.YNc(1,K,1,1,"nz-alert",7),e.YNc(2,j,4,1,"ng-template",null,8,e.W1O),e.BQk())}function $(n,c){if(1&n&&(e.TgZ(0,"nz-form-item"),e._UZ(1,"cvc-form-errors-alert",10),e.qZA()),2&n){const t=e.oxw(2);e.xp6(1),e.Q6J("errors",t.createErrors)}}function G(n,c){if(1&n){const t=e.EpF();e.TgZ(0,"button",12),e.NdJ("click",function(a){return e.CHM(t),e.oxw(3).onCreateSourceStub(a)}),e._uU(1," Create\xa0'"),e.TgZ(2,"em"),e._uU(3),e.qZA(),e._uU(4,"'\xa0 CIViC Source "),e.qZA()}if(2&n){const t=e.oxw(3);e.Q6J("nzLoading",t.isCreating),e.xp6(3),e.Oqu(t.foundCitation)}}function X(n,c){1&n&&(e.ynx(0),e.YNc(1,G,5,2,"button",11),e.BQk())}function H(n,c){if(1&n){const t=e.EpF();e.TgZ(0,"button",14),e.NdJ("click",function(a){return e.CHM(t),e.oxw(3).onAcceptSource(a)}),e._uU(1," Add Source to List "),e.qZA()}}function k(n,c){1&n&&(e.ynx(0),e.YNc(1,H,2,0,"button",13),e.BQk())}function q(n,c){if(1&n&&(e.ynx(0),e.TgZ(1,"nz-space",2),e.YNc(2,V,4,0,"ng-container",3),e.YNc(3,W,4,0,"ng-container",3),e.YNc(4,$,2,1,"nz-form-item",3),e.YNc(5,X,2,0,"ng-container",3),e.YNc(6,k,2,0,"ng-container",3),e.qZA(),e.BQk()),2&n){const t=e.oxw();e.xp6(2),e.Q6J("ngIf",!1===t.createSuccess&&0===t.createErrors.length),e.xp6(1),e.Q6J("ngIf",!0===t.createSuccess),e.xp6(1),e.Q6J("ngIf",t.createErrors.length>0),e.xp6(1),e.Q6J("ngIf",!1===t.createSuccess),e.xp6(1),e.Q6J("ngIf",!0===t.createSuccess)}}function ee(n,c){if(1&n&&(e.TgZ(0,"span",16),e._UZ(1,"i",17),e._uU(2),e.qZA()),2&n){const t=e.oxw(3);e.xp6(2),e.hij(" Source not known to CIViC, fetch citation from ",t.sourceTypeKey,"? ")}}function te(n,c){1&n&&(e.ynx(0),e.YNc(1,ee,3,1,"span",15),e.BQk())}function ne(n,c){if(1&n&&e._uU(0),2&n){const t=e.oxw(4);e.AsE(" Citation not found for ",t.sourceTypeKey,": ",t.citationId,". ")}}function oe(n,c){if(1&n&&(e.TgZ(0,"span"),e._UZ(1,"nz-alert",19),e.YNc(2,ne,1,2,"ng-template",null,20,e.W1O),e.qZA()),2&n){const t=e.MAs(3);e.xp6(1),e.Q6J("nzMessage",t)}}function re(n,c){1&n&&(e.ynx(0),e.YNc(1,oe,4,1,"span",18),e.BQk())}function ce(n,c){if(1&n){const t=e.EpF();e.TgZ(0,"button",12),e.NdJ("click",function(a){return e.CHM(t),e.oxw(2).onExistenceQuery(a)}),e._uU(1," Fetch Citation for\xa0"),e.TgZ(2,"strong"),e._uU(3),e.qZA()()}if(2&n){const t=e.oxw(2);e.Q6J("nzLoading",t.isChecking),e.xp6(3),e.AsE("",t.sourceTypeKey," ",t.citationId,"")}}function ie(n,c){if(1&n&&(e.TgZ(0,"nz-space",2),e.YNc(1,te,2,0,"ng-container",3),e.YNc(2,re,2,0,"ng-container",3),e.YNc(3,ce,4,3,"button",11),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.showPrompt),e.xp6(1),e.Q6J("ngIf",t.existenceFail)}}let se=(()=>{class n{constructor(t,i,a){this.existenceCheckQuery=t,this.createSourceStubQuery=i,this.changeDetectorRef=a,this.modelUpdate=new e.vpe,this.citationIdChange=new e.vpe,this.sourceTypeChange=new e.vpe,this.showPrompt=!0,this.isChecking=!1,this.existenceFail=!1,this.existenceError=[],this.foundCitation=void 0,this.isCreating=!1,this.createSuccess=!1,this.createErrors=[]}set sourceType(t){this._sourceType=t,this.sourceTypeKey=(0,x.o6)(S.yic).getKeyOrThrow(t)}get sourceType(){return this._sourceType}onExistenceQuery(t){t&&t.preventDefault(),this.isChecking=!0,this.foundCitation=void 0,this.existenceCheckQuery.fetch({sourceType:this.sourceType,citationId:+this.citationId}).pipe((0,U.x)(()=>{this.isChecking=!1,this.changeDetectorRef.detectChanges()})).subscribe({next:({data:{remoteCitation:i}})=>{null!==i?this.foundCitation=i:(this.showPrompt=!1,this.existenceFail=!0)},error:i=>{this.showPrompt=!1,this.existenceError=i.graphQLErrors.map(a=>a.message)},complete:()=>{this.existenceError=[]}})}onCreateSourceStub(t){t&&t.preventDefault(),this.isCreating=!0,this.createSuccess=!1,this.createSourceStubQuery.mutate({input:{citationId:+this.citationId,sourceType:this.sourceType}}).pipe((0,U.x)(()=>{this.isCreating=!1,this.changeDetectorRef.detectChanges()})).subscribe({next:({data:i})=>{var a;console.log(i);const T=null===(a=null==i?void 0:i.addRemoteCitation)||void 0===a?void 0:a.newSource;this.sourceStub=T,this.createSuccess=!0},error:i=>{this.showPrompt=!1,this.createSuccess=!1,this.createErrors=i.graphQLErrors.map(a=>a.message)},complete:()=>{this.createErrors=[]}})}onAcceptSource(t){t&&t.preventDefault(),console.log("source accepted");const i=Object.assign(Object.assign({},this.model),{id:this.sourceStub.id,citation:this.foundCitation,citationId:this.citationId});this.modelUpdate.emit(i)}ngAfterContentInit(){console.log("model")}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(S.fpJ),e.Y36(S.JQ3),e.Y36(e.sBO))},n.\u0275cmp=e.Xpm({type:n,selectors:[["cvc-source-loader"]],inputs:{model:"model",citationId:"citationId",sourceType:"sourceType"},outputs:{modelUpdate:"modelUpdate",citationIdChange:"citationIdChange",sourceTypeChange:"sourceTypeChange"},decls:3,vars:2,consts:[[4,"ngIf","ngIfElse"],["fetchCitation",""],["nzDirection","vertical"],[4,"ngIf"],["nzType","info","nzShowIcon","",3,"nzMessage",4,"nzSpaceItem"],["foundCitationMsg",""],["nzType","info","nzShowIcon","",3,"nzMessage"],["nzType","success","nzShowIcon","",3,"nzMessage",4,"nzSpaceItem"],["createdMsg",""],["nzType","success","nzShowIcon","",3,"nzMessage"],[3,"errors"],["type","submit","nz-button","","nzBlock","","nzType","primary","nzSize","default",3,"nzLoading","click",4,"nzSpaceItem"],["type","submit","nz-button","","nzBlock","","nzType","primary","nzSize","default",3,"nzLoading","click"],["type","submit","nz-button","","nzBlock","","nzType","primary","nzSize","default",3,"click",4,"nzSpaceItem"],["type","submit","nz-button","","nzBlock","","nzType","primary","nzSize","default",3,"click"],["nz-typography","",4,"nzSpaceItem"],["nz-typography",""],["nz-icon","","nzType","info-circle","nzTheme","twotone"],[4,"nzSpaceItem"],["nzType","warning","nzShowIcon","",3,"nzMessage"],["existenceFail",""]],template:function(t,i){if(1&t&&(e.YNc(0,q,7,5,"ng-container",0),e.YNc(1,ie,4,2,"ng-template",null,1,e.W1O)),2&t){const a=e.MAs(2);e.Q6J("ngIf",i.foundCitation)("ngIfElse",a)}},directives:[o.O5,A.NU,A.$1,w.r,u.SK,h.Nx,s.V,I.ix,_.dQ,Z.w],styles:["[_nghost-%COMP%]{display:block}nz-space[_ngcontent-%COMP%]{width:100%}nz-space-item[_ngcontent-%COMP%]:last-child{margin-bottom:0}"]}),n})();function ae(n,c){if(1&n&&(e.TgZ(0,"nz-option",4),e._uU(1),e.qZA()),2&n){const t=c.$implicit;e.Q6J("nzLabel",t.label)("nzValue",t.value),e.xp6(1),e.AsE(" ",t.source.citation?t.source.citation:t.source.name," (",t.source.citationId,") ")}}function le(n,c){if(1&n&&(e.TgZ(0,"div",5),e._uU(1," Citation: "),e.TgZ(2,"span",6),e._uU(3),e.qZA()()),2&n){const t=e.oxw();e.xp6(3),e.hij(" ",t.model.citation," ")}}function ue(n,c){if(1&n&&(e.TgZ(0,"div",5),e._uU(1),e.qZA()),2&n){const t=e.oxw(2);e.xp6(1),e.hij(" Enter a ",t.to.sourceTypeKey," citation ID to search CIViC sources ")}}function pe(n,c){if(1&n){const t=e.EpF();e.TgZ(0,"cvc-source-loader",10),e.NdJ("modelUpdate",function(a){return e.CHM(t),e.oxw(2).onModelUpdated(a)})("sourceTypeChange",function(a){return e.CHM(t),e.oxw(2).model.sourceType=a})("citationIdChange",function(a){return e.CHM(t),e.oxw(2).to.fieldValue=a}),e.qZA()}if(2&n){const t=e.oxw(2);e.Q6J("model",t.model)("sourceType",t.model.sourceType)("citationId",t.to.fieldValue)}}function de(n,c){if(1&n&&(e.ynx(0,7),e.YNc(1,ue,2,1,"div",8),e.YNc(2,pe,1,3,"cvc-source-loader",9),e.BQk()),2&n){const t=e.oxw();e.Q6J("ngSwitch",t.to.fieldLength>0&&t.to.fieldLength>=t.to.minLengthSearch),e.xp6(1),e.Q6J("ngSwitchCase",!1),e.xp6(1),e.Q6J("ngSwitchCase",!0)}}let D=class extends m.fS{constructor(c,t){super(),this.sourceTypeaheadQuery=c,this.changeDetectorRef=t,this.selectedValue=null,this.nzFilterOption=()=>!0,this.defaultOptions={templateOptions:{placeholder:"Search",sourceType:void 0,showArrow:!1,onSearch:()=>{},filterOption:()=>{},modelChange:()=>{},triggerParentSubmit:()=>{},minLengthSearch:1,fieldLength:0,fieldValue:"",optionList:[]}}}ngAfterViewInit(){this.to.filterOption=()=>!0,this.to.modelChange=c=>{if(this.to.optionList.length>0){const{source:t}=this.to.optionList.find(i=>i.value===+c);t?this.form.patchValue({citation:t.citation?t.citation:t.name,id:t.id}):console.error("Could not find selected citation in list?")}},this.to.onSearch=c=>{this.to.fieldValue=c,this.to.fieldLength=c.length,!(c.length<this.to.minLengthSearch||c.length>this.to.maxLength)&&this.sourceTypeaheadQuery.fetch({sourceType:this.to.sourceType,partialCitationId:+c},{fetchPolicy:"network-only"}).pipe((0,f.U)(t=>t.data),(0,v.h)(b.ep),(0,d.t)(this)).subscribe(({sourceTypeahead:t})=>{this.to.optionList=t.map(i=>({value:i.citationId,label:i.citationId,source:i})),this.changeDetectorRef.detectChanges()})}}onModelUpdated(c){this.form.patchValue(c),this.changeDetectorRef.detectChanges(),this.to.triggerParentSubmit()}};D.\u0275fac=function(c){return new(c||D)(e.Y36(S.k2T),e.Y36(e.sBO))},D.\u0275cmp=e.Xpm({type:D,selectors:[["cvc-source-selector-typeahead-type"]],features:[e.qOj],decls:5,vars:8,consts:[["nzShowSearch","","nzServerSearch","","autofocus","click",3,"formControl","formlyAttributes","nzPlaceHolder","nzNotFoundContent","nzShowArrow","nzFilterOption","ngModelChange","nzOnSearch"],["nzCustomContent","",3,"nzLabel","nzValue",4,"ngFor","ngForOf"],["class","ant-form-item-explain",4,"ngIf"],["sourceLoader",""],["nzCustomContent","",3,"nzLabel","nzValue"],[1,"ant-form-item-explain"],[1,"source-citation"],[3,"ngSwitch"],["class","ant-form-item-explain",4,"ngSwitchCase"],[3,"model","sourceType","citationId","modelUpdate","sourceTypeChange","citationIdChange",4,"ngSwitchCase"],[3,"model","sourceType","citationId","modelUpdate","sourceTypeChange","citationIdChange"]],template:function(c,t){if(1&c&&(e.TgZ(0,"nz-select",0),e.NdJ("ngModelChange",function(a){return t.to.modelChange(a)})("nzOnSearch",function(a){return t.to.onSearch(a)}),e.YNc(1,ae,2,4,"nz-option",1),e.qZA(),e.YNc(2,le,4,1,"div",2),e.YNc(3,de,3,3,"ng-template",null,3,e.W1O)),2&c){const i=e.MAs(4);e.Q6J("formControl",t.formControl)("formlyAttributes",t.field)("nzPlaceHolder",t.to.placeholder?t.to.placeholder:null)("nzNotFoundContent",i)("nzShowArrow",t.to.showArrow)("nzFilterOption",t.to.filterOption),e.xp6(1),e.Q6J("ngForOf",t.to.optionList),e.xp6(1),e.Q6J("ngIf",t.model.citation.length>0)}},directives:[Q.Vq,F.l,g.JJ,g.oH,m.VQ,o.sg,Q.Ip,o.O5,o.RF,o.n9,se],styles:["[_nghost-%COMP%]{display:block}.loading-icon[_ngcontent-%COMP%]{margin-right:8px}.source-citation[_ngcontent-%COMP%]{font-style:oblique}"],changeDetection:0}),D=(0,P.gn)([(0,d.c)()],D);const me={name:"source-selector-typeahead",component:D,wrappers:["form-field"]};var _e=r(7008);let R=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[o.ez,A.zf,w.L,h.U5,_e.B,I.sL]]}),n})();var ge=r(8616);let fe=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[o.ez,g.UX,m.X0.forChild({types:[me]}),Q.LV,R,ge.Y]]}),n})();var he=r(8979);let Se=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[o.ez,g.UX,m.X0,M.u,I.sL,R,fe,he.N]]}),n})();var ye=r(9779);let Te=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[o.ez,m.X0.forChild({types:[y]}),Se,ye.s]]}),n})()}}]);