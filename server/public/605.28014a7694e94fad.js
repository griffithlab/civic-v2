"use strict";(self.webpackChunkmain=self.webpackChunkmain||[]).push([[605],{5639:(V,f,o)=>{o.d(f,{u:()=>y});var r=o(5e3),z=o(685),_=o(1912),G=o(3618),v=o(5017);function c(p,d){1&p&&(r.TgZ(0,"span"),r._uU(1," You must be logged in to view this page. "),r.qZA())}function h(p,d){1&p&&r._UZ(0,"cvc-login-button")}function l(p,d){1&p&&(r.TgZ(0,"nz-typography",4),r._UZ(1,"i",5),r.qZA())}let y=(()=>{class p{}return p.\u0275fac=function(m){return new(m||p)},p.\u0275cmp=r.Xpm({type:p,selectors:[["cvc-login-prompt"]],decls:7,vars:3,consts:[[3,"nzNotFoundImage","nzNotFoundContent","nzNotFoundFooter"],["contentTpl",""],["footerTpl",""],["emptyImage",""],["nzType","secondary"],["nz-icon","","nzType","login","nzTheme","outline",2,"font-size","50pt"]],template:function(m,I){if(1&m&&(r.TgZ(0,"nz-empty",0),r.YNc(1,c,2,0,"ng-template",null,1,r.W1O),r.YNc(3,h,1,0,"ng-template",null,2,r.W1O),r.qZA(),r.YNc(5,l,2,0,"ng-template",null,3,r.W1O)),2&m){const O=r.MAs(2),t=r.MAs(4),g=r.MAs(6);r.Q6J("nzNotFoundImage",g)("nzNotFoundContent",O)("nzNotFoundFooter",t)}},directives:[z.p9,_.s,G.ZU,v.Ls],styles:["[_nghost-%COMP%]{display:inline-block}"]}),p})()},9386:(V,f,o)=>{o.d(f,{a:()=>h});var r=o(9808),z=o(1844),_=o(685),G=o(5017),v=o(3618),c=o(5e3);let h=(()=>{class l{}return l.\u0275fac=function(p){return new(p||l)},l.\u0275mod=c.oAB({type:l}),l.\u0275inj=c.cJS({imports:[[r.ez,z.B,_.Xo,G.PV,v.ZJ]]}),l})()},605:(V,f,o)=>{o.r(f),o.d(f,{VariantGroupsReviseModule:()=>ht});var r=o(9808),z=o(9386),_=o(5630),G=o(6905),v=o(6949),c=o(1894),h=o(5017),l=o(1945),y=o(8144),p=o(3618),d=o(325),m=o(373),I=o(1059),O=o(4850),t=o(5e3),g=o(7630),L=o(9350),S=o(8992),E=o(5639),F=o(160);function Z(e,a){1&e&&(t.TgZ(0,"div"),t._UZ(1,"router-outlet"),t.qZA())}function U(e,a){1&e&&(t.TgZ(0,"nz-row",8)(1,"div",9),t._UZ(2,"cvc-login-prompt"),t.qZA()())}function D(e,a){if(1&e&&(t.ynx(0),t._UZ(1,"cvc-section-navigation",1),t.TgZ(2,"nz-page-header",2)(3,"nz-page-header-title",3),t._uU(4," REVISE "),t._UZ(5,"i",4),t.ALo(6,"entityColor"),t._uU(7),t.qZA(),t.TgZ(8,"nz-page-header-content")(9,"div",5),t.YNc(10,Z,2,0,"div",6),t.ALo(11,"ngrxPush"),t.YNc(12,U,3,0,"ng-template",null,7,t.W1O),t.qZA()()(),t.BQk()),2&e){const n=a.ngIf,i=t.MAs(13),s=t.oxw();t.xp6(1),t.Q6J("displayName",n.name),t.xp6(4),t.Q6J("nzTwotoneColor",t.lcZ(6,5,"VariantGroup")),t.xp6(2),t.hij(" ",n.name," "),t.xp6(3),t.Q6J("ngIf",t.lcZ(11,7,s.isSignedIn$))("ngIfElse",i)}}let J=(()=>{class e{constructor(n,i,s){this.gql=n,this.route=i,this.viewerService=s,this.routeSub=this.route.params.subscribe(u=>{let x=this.gql.watch({variantGroupId:+u.variantGroupId}).valueChanges;this.loading$=x.pipe((0,m.j)("loading"),(0,I.O)(!0)),this.variantGroup$=x.pipe((0,m.j)("data","variantGroup"))})}ngOnInit(){this.isSignedIn$=this.viewerService.viewer$.pipe((0,O.U)(n=>n.signedIn))}ngOnDestroy(){this.routeSub.unsubscribe()}}return e.\u0275fac=function(n){return new(n||e)(t.Y36(g.Qtd),t.Y36(d.gz),t.Y36(L.a))},e.\u0275cmp=t.Xpm({type:e,selectors:[["cvc-variant-groups-revise-view"]],decls:2,vars:3,consts:[[4,"ngIf"],[3,"displayName"],[1,"site-page-header"],["cvcFlaggableOptions",""],["nz-icon","","nzTheme","twotone","nzType","civic-variantgroup",3,"nzTwotoneColor"],[1,"content"],[4,"ngIf","ngIfElse"],["notSignedIn",""],["nzSpan","24","nzJustify","center"],["nz-col","","nzSpan","6"]],template:function(n,i){1&n&&(t.YNc(0,D,14,9,"ng-container",0),t.ALo(1,"async")),2&n&&t.Q6J("ngIf",t.lcZ(1,1,i.variantGroup$))},directives:[r.O5,S.I,l.$O,l.u9,h.Ls,l.u5,d.lC,c.SK,c.t3,E.u],pipes:[r.Ov,F.a,v.fM],styles:["[_nghost-%COMP%]{display:block}[_nghost-%COMP%]     nz-page-header:first-of-type{background-color:#fff;border-radius:8px}[_nghost-%COMP%]     nz-page-header:first-of-type .header-content{background-color:#f0f0f0;border-top-left-radius:8px;border-top-right-radius:8px;margin:-12px -16px 16px;border-bottom:1px solid #bfbfbf}[_nghost-%COMP%]     nz-page-header:first-of-type .header-content .header-icon{padding:12px 0 12px 12px}[_nghost-%COMP%]     nz-page-header:first-of-type .header-content .header-icon i{width:100%}[_nghost-%COMP%]     nz-page-header:first-of-type .header-content .header-icon i   svg{width:100%;height:100%}[_nghost-%COMP%]     nz-page-header:first-of-type .header-content .header-description{padding:12px}[_nghost-%COMP%]     nz-page-header:first-of-type .header-content .header-description h2{color:#262626;margin:-8px 0 0;font-weight:500}[_nghost-%COMP%]     nz-page-header:first-of-type .header-content .header-description p{color:#262626;margin:-2px 0 0;padding:0;font-size:95%;line-height:1.5em}[_nghost-%COMP%]     nz-page-header:first-of-type .header-content .header-links{text-align:right;padding:12px}[_nghost-%COMP%]     nz-page-header:first-of-type .card-list nz-card{width:100%}[_nghost-%COMP%]     nz-page-header:first-of-type .card-list nz-card .card-grid-cell{width:50%}[_nghost-%COMP%]     nz-page-header:first-of-type nz-page-header-title.flagged{padding-left:.75em}[_nghost-%COMP%]     nz-page-header:first-of-type .ant-page-header-content{padding-top:0;padding-bottom:12px}[_nghost-%COMP%]     nz-page-header:first-of-type .ant-page-header-heading-extra nz-space-item:last-child{margin-right:0!important}[_nghost-%COMP%]     nz-page-header:first-of-type #section-tabs{margin:0 -16px 12px}[_nghost-%COMP%]     nz-page-header:first-of-type #section-tabs .ant-tabs-nav-wrap{padding-left:16px;padding-right:16px;line-height:24px}[_nghost-%COMP%]     nz-page-header:first-of-type #section-tabs .ant-tabs-nav-wrap .ant-tabs-tab{padding:1px 8px}[_nghost-%COMP%]     nz-page-header:first-of-type #section-tabs .ant-tabs-nav-wrap .ant-tabs-tab .anticon{margin-right:0}[_nghost-%COMP%]     nz-page-header:first-of-type #section-tabs .ant-tabs-extra-content{margin-right:16px}"]}),e})();var M=o(3075),P=o(8776),R=o(2359),N=o(6042),C=o(4546),Q=o(7525),Y=o(1017),B=o(7008),W=o(4623),$=o(8979),j=o(7055),K=o(3773),w=o(3022),X=o(7462),b=o(4181),H=o(5472),k=o(4889);let q=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[[r.ez,M.UX,d.Bz,P.X0,C.U5,R.L,c.Jb,N.sL,Q.j,P.X0,X.o,b.O,j.N,$.N,W.K,B.B,H.r,K.g,b.O,w.e,k.E,Y.s]]}),e})(),tt=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[[r.ez,q]]}),e})();var A=o(3077),et=o(6123),nt=o(8929),T=o(7625),ot=o(9169),rt=o(822);function at(e,a){1&e&&t.GkF(0)}function it(e,a){if(1&e){const n=t.EpF();t.TgZ(0,"formly-form",5),t.NdJ("modelChange",function(s){return t.CHM(n),t.oxw(2).formModel=s}),t.qZA()}if(2&e){const n=t.oxw(2);t.Q6J("form",n.formGroup)("fields",n.formFields)("model",n.formModel)}}function st(e,a){if(1&e){const n=t.EpF();t.TgZ(0,"form",2),t.NdJ("ngSubmit",function(){t.CHM(n);const s=t.oxw();return s.submitVariantGroup(s.formModel)}),t.YNc(1,at,1,0,"ng-container",3),t.YNc(2,it,1,3,"formly-form",4),t.qZA()}if(2&e){const n=t.oxw(),i=t.MAs(2);t.Q6J("formGroup",n.formGroup),t.xp6(1),t.Q6J("ngTemplateOutlet",i),t.xp6(1),t.Q6J("ngIf",!n.success)}}function pt(e,a){if(1&e&&(t.TgZ(0,"nz-form-item"),t._UZ(1,"cvc-form-errors-alert",7),t.qZA()),2&e){const n=t.oxw(2);t.xp6(1),t.Q6J("errors",n.errorMessages)}}function lt(e,a){1&e&&(t.TgZ(0,"p"),t._uU(1,"View it on the "),t.TgZ(2,"a",11),t._uU(3,"Revisions Page"),t.qZA(),t._uU(4,"."),t.qZA())}function dt(e,a){if(1&e&&(t.ynx(0),t._UZ(1,"nz-alert",8),t.YNc(2,lt,5,0,"ng-template",9,10,t.W1O),t.BQk()),2&e){const n=t.MAs(3);t.xp6(1),t.Q6J("nzDescription",n)}}function ut(e,a){if(1&e&&(t.YNc(0,pt,2,1,"nz-form-item",6),t.YNc(1,dt,4,1,"ng-container",6)),2&e){const n=t.oxw();t.Q6J("ngIf",n.errorMessages.length>0),t.xp6(1),t.Q6J("ngIf",n.success)}}let ct=(()=>{class e{constructor(n,i,s,u,x){this.suggestRevisionGQL=n,this.revisableFieldsGQL=i,this.networkErrorService=s,this.variantGroupDetailGQL=u,this.revisionsGQL=x,this.destroy$=new nt.xQ,this.formGroup=new M.cw({}),this.formOptions={},this.success=!1,this.errorMessages=[],this.loading=!1,this.suggestRevisionMutator=new et.U(s),this.formFields=[{key:"fields",wrappers:["form-container"],templateOptions:{label:"Add Variant Group Form"},fieldGroup:[{key:"name",type:"input",wrappers:["form-field"],templateOptions:{label:"Variant Group Name",required:!0}},{key:"description",type:"cvc-textarea",templateOptions:{label:"Description",helpText:"A brief description of this new variant group.",placeholder:"No description provided",required:!0}},{key:"sources",type:"multi-field",wrappers:["form-field"],templateOptions:{label:"Source",helpText:"Add any sources upon which your description depends.",addText:"Add a Source"},fieldArray:{type:"source-input",templateOptions:{hideLabel:!0,required:!0}}},{key:"variants",type:"multi-field",wrappers:["form-field"],templateOptions:{label:"Variants",helpText:"Specify the variants that comprise this Variant Group.",addText:"Add a Variant "},fieldArray:{type:"variant-input",templateOptions:{hideLabel:!0,required:!0,allowCreate:!1}}},{key:"comment",type:"comment-textarea",templateOptions:{label:"Comment",helpText:"Please provide any additional comments you wish to make about this evidence item. This comment will appear as the first comment in this item's comment thread.",placeholder:"Please enter a comment describing your revision.",required:!0,minLength:10}},{key:"cancel",type:"cancel-button",templateOptions:{redirectPath:"../.."}},{key:"organization",type:"org-submit-button",templateOptions:{submitLabel:"Submit Variant Group Revision",submitSize:"large"}}]}]}ngAfterViewInit(){this.revisableFieldsGQL.fetch({variantGroupId:this.variantGroupId}).subscribe(({data:{variantGroup:n}})=>{n&&(this.formModel=this.toFormModel(n))},n=>{console.error("Error retrieving evidenceItem."),console.error(n)},()=>{this.formOptions.updateInitialValue&&this.formOptions.updateInitialValue(),this.formGroup.markAllAsTouched();const n=this.formGroup.get("fields.comment");n&&n.markAsUntouched()})}toFormModel(n){var i;return{fields:Object.assign(Object.assign({},n),{variants:n.variants.nodes,organization:null===(i=this.formModel)||void 0===i?void 0:i.fields.organization})}}submitVariantGroup(n){let i=this.toSubmitInput(n);if(i){let s=this.suggestRevisionMutator.mutate(this.suggestRevisionGQL,{input:i},{refetchQueries:[{query:this.variantGroupDetailGQL.document,variables:{variantGroupId:this.variantGroupId}},{query:this.revisionsGQL.document,variables:{subject:{id:this.variantGroupId,entityType:g.oRL.VariantGroup},status:g.FJi.New}}]});s.submitSuccess$.pipe((0,T.R)(this.destroy$)).subscribe(u=>{u&&(this.success=!0)}),s.submitError$.pipe((0,T.R)(this.destroy$)).subscribe(u=>{u&&(this.errorMessages=u,this.success=!1)}),s.isSubmitting$.pipe((0,T.R)(this.destroy$)).subscribe(u=>{this.loading=u})}}toSubmitInput(n){var i;if(n)return{id:this.variantGroupId,organizationId:null===(i=n.fields.organization)||void 0===i?void 0:i.id,comment:n.fields.comment,fields:{description:n.fields.description,name:n.fields.name,sourceIds:n.fields.sources.map(s=>s.id).filter(A.$),variantIds:n.fields.variants.map(s=>s.id).filter(A.$)}}}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}}return e.\u0275fac=function(n){return new(n||e)(t.Y36(g.aw3),t.Y36(g.ROj),t.Y36(ot.Y),t.Y36(g.Qtd),t.Y36(g.L5n))},e.\u0275cmp=t.Xpm({type:e,selectors:[["cvc-variant-group-revise-form"]],inputs:{variantGroupId:"variantGroupId"},decls:3,vars:1,consts:[["nz-form","","nzLayout","vertical",3,"formGroup","ngSubmit",4,"ngIf"],["formMessages",""],["nz-form","","nzLayout","vertical",3,"formGroup","ngSubmit"],[4,"ngTemplateOutlet"],[3,"form","fields","model","modelChange",4,"ngIf"],[3,"form","fields","model","modelChange"],[4,"ngIf"],[3,"errors"],["nzType","success","nzMessage","Revision(s) Submitted","nzShowIcon","",3,"nzDescription"],["nzSize","small"],["successMessage",""],["routerLink","../../revisions"]],template:function(n,i){1&n&&(t.YNc(0,st,3,3,"form",0),t.YNc(1,ut,2,2,"ng-template",null,1,t.W1O)),2&n&&t.Q6J("ngIf",i.formModel)},directives:[r.O5,M._Y,M.JL,C.Lr,M.sg,r.tP,P.T7,c.SK,C.Nx,rt.V,R.r,d.yS],styles:[""]}),e})();function gt(e,a){if(1&e&&(t.ynx(0),t._UZ(1,"cvc-variant-group-revise-form",2),t.BQk()),2&e){const n=t.oxw();t.xp6(1),t.Q6J("variantGroupId",n.variantGroupId)}}function mt(e,a){1&e&&t._uU(0,"Loading Variant Group...")}const ft=[{path:"",component:J,data:{breadcrumb:"Revise"},children:[{path:"",redirectTo:"suggest",pathMatch:"full"},{path:"suggest",component:(()=>{class e{constructor(n){this.route=n,this.routeParams$=this.route.params.subscribe(i=>{this.variantGroupId=+i.variantGroupId})}ngOnDestroy(){this.routeParams$.unsubscribe()}}return e.\u0275fac=function(n){return new(n||e)(t.Y36(d.gz))},e.\u0275cmp=t.Xpm({type:e,selectors:[["cvc-variant-groups-suggest-page"]],decls:3,vars:2,consts:[[4,"ngIf","ngIfElse"],["loadingVariantGroup",""],[3,"variantGroupId"]],template:function(n,i){if(1&n&&(t.YNc(0,gt,2,1,"ng-container",0),t.YNc(1,mt,1,0,"ng-template",null,1,t.W1O)),2&n){const s=t.MAs(2);t.Q6J("ngIf",i.variantGroupId)("ngIfElse",s)}},directives:[r.O5,ct],styles:[""]}),e})(),data:{breadcrumb:"Suggest Revision"}}]}];let vt=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[[d.Bz.forChild(ft),tt],d.Bz]}),e})(),ht=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[[r.ez,vt,l.KJ,y.zf,h.PV,p.ZJ,y.zf,G.s,_.D,z.a,v.WG,c.Jb]]}),e})()}}]);