<nz-card
  [nzTitle]="cardTitle"
  nzSize="small">
  <nz-table
    #virtualTable
    #rowSelectionTable
    cvcTableScroller
    (cvcTableScrollerOnScroll)="scrollEvent$.next($event)"
    [cvcTableScrollerQueryRef]="queryRef"
    [cvcTableScrollerPageInfo]="pageInfo$ | ngrxPush"
    [cvcTableScrollerToIndex]="(scrollIndex$ | ngrxPush)!"
    *ngrxLet="tableData$ as data"
    [nzData]="data.rows"
    [nzScroll]="{ x: '800px', y: '200px' }"
    [nzVirtualForTrackBy]="trackByIndex"
    [nzVirtualItemSize]="28"
    [nzFrontPagination]="false"
    [nzShowPagination]="false"
    [nzLoading]="loading$ | ngrxPush"
    nzSize="small"
    (nzQueryParams)="onParamsChange$.next($event)">
    <thead>
      <tr class="col-header-row">
        <ng-container *ngFor="let col of data.cols">
          <ng-container
            *ngIf="!col.hide"
            [ngSwitch]="col.type">
            <th
              *ngSwitchCase="'select'"
              [nzWidth]="col.width || null"
              [nzLeft]="col.fixed?.left || false"
              [nzRight]="col.fixed?.right || false"
              [nzShowCheckbox]="false"
              [nzChecked]="allSelected"
              [nzIndeterminate]="allIndeterminate"
              (nzCheckedChange)="onAllSelected$.next($event)"></th>
            <th
              *ngSwitchDefault
              nzColumnKey="col.key">
              {{ col.name }}
            </th>
          </ng-container>
        </ng-container>
      </tr>
    </thead>
    <tbody>
      <ng-template
        nz-virtual-scroll
        let-row>
        <tr class="data-row">
          <ng-container *ngFor="let col of data.cols">
            <ng-container
              *ngIf="!col.hide"
              [ngSwitch]="col.type">
              <td
                *ngSwitchCase="'select'"
                [nzLeft]="col.fixed?.left || false"
                [nzRight]="col.fixed?.right || false"
                [nzChecked]="row.selected"
                (nzCheckedChange)="
                  onRowSelected$.next({ id: row.id, selected: $event })
                "
                [nzLeft]="col.fixed?.left || false"
                [nzRight]="col.fixed?.right || false"></td>

              <td
                *ngSwitchCase="'tag'"
                [nzLeft]="col.fixed?.left || false"
                [nzRight]="col.fixed?.right || false">
                <cvc-entity-tag
                  *ngrxLet="row[col.key] as entity"
                  [cvcCacheId]="
                    entity.__typename + ':' + entity.id
                  "></cvc-entity-tag>
              </td>

              <td
                *ngSwitchCase="'tags'"
                [nzLeft]="col.fixed?.left || false"
                [nzRight]="col.fixed?.right || false">
                <cvc-entity-tag
                  *ngFor="let entity of row[col.key]"
                  [cvcCacheId]="
                    entity.__typename + ':' + entity.id
                  "></cvc-entity-tag>
              </td>

              <td
                *ngSwitchCase="'enum'"
                [nzLeft]="col.fixed?.left || false"
                [nzRight]="col.fixed?.right || false">
                {{ row[col.key] }}
              </td>

              <td
                *ngSwitchCase="'string'"
                [nzLeft]="col.fixed?.left || false"
                [nzRight]="col.fixed?.right || false">
                {{ row[col.key] }}
              </td>

              <td
                *ngSwitchCase="'number'"
                [nzLeft]="col.fixed?.left || false"
                [nzRight]="col.fixed?.right || false">
                {{ row[col.key] }}
              </td>

              <td *ngSwitchDefault>?{{ row[col.key] }}?</td>
            </ng-container>
          </ng-container>
        </tr>
      </ng-template>
    </tbody>
  </nz-table>
</nz-card>
<ng-template #emptyCell
  ><span
    nz-typeography
    nzType="secondary"
    >--</span
  ></ng-template
>
<ng-template #cardTitle>Use checkboxes to select or deselect EIDs</ng-template>
