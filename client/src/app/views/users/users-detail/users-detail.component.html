<ng-container *ngIf="user$ | ngrxPush as user">
  <cvc-section-navigation [displayName]="user.displayName">
  </cvc-section-navigation>

  <nz-page-header class="site-page-header">
    <nz-page-header-content>
      <nz-row
        [nzGutter]="[8, 8]"
        class="profile-content">
        <nz-col nzSpan="128px">
          <nz-space nzDirection="vertical">
            <cvc-user-avatar
              [user]="user"
              shape="square"
              [size]="128"
              *nzSpaceItem></cvc-user-avatar>
            <div
              class="user-pseudo-tag"
              *nzSpaceItem>
              <i
                nz-icon
                [nzType]="'civic-' + (user.role | lowercase)"
                nzTheme="twotone"
                [nzTwotoneColor]="user.role | titlecase | entityColor"></i>
              <span nz-typography>
                <strong> {{ user.username }}</strong>
              </span>
            </div>
            <div *nzSpaceItem>
              <nz-descriptions
                nzLayout="vertical"
                nzSize="small"
                [nzBordered]="true"
                [nzColumn]="1">
                <!-- username -->
                <nz-descriptions-item
                  *ngIf="user.name"
                  nzTitle="Name">
                  {{ user.name }}
                </nz-descriptions-item>

                <!-- role -->
                <nz-descriptions-item nzTitle="Role">
                  {{ user.role | enumToTitle }}
                </nz-descriptions-item>
              </nz-descriptions>
            </div>
            <ng-container *ngIf="this.ownProfile$ | ngrxPush">
              <button
                *nzSpaceItem
                nz-button
                nzSize="small"
                nzType="primary"
                nzBlock
                (click)="updateProfileModalVisible = true">
                Edit Profile
              </button>
              <cvc-avatar-uploader
                *nzSpaceItem
                (uploadComplete)="profileUploadComplete($event)">
              </cvc-avatar-uploader>
            </ng-container>
          </nz-space>
        </nz-col>
        <nz-col nzFlex="auto">
          <nz-descriptions
            nzLayout="vertical"
            nzSize="small"
            nzBordered="true"
            [nzColumn]="4">
            <nz-descriptions-item
              nzTitle="Biography"
              nzSpan="4">
              <ng-container *ngIf="user.bio">
                {{ user.bio }}
              </ng-container>
              <ng-container *ngIf="!user.bio">
                <span
                  nz-typography
                  nzType="secondary">
                  <i>User has not provided a bio.</i>
                </span>
              </ng-container>
            </nz-descriptions-item>

            <nz-descriptions-item
              [nzSpan]="1"
              nzTitle="Area of Expertise">
              <ng-container *ngIf="user.areaOfExpertise">
                {{ user.areaOfExpertise | enumToTitle }}
              </ng-container>
              <ng-container *ngIf="!user.areaOfExpertise">
                <span
                  nz-typography
                  nzType="secondary">
                  <i>Unspecified</i>
                </span>
              </ng-container>
            </nz-descriptions-item>

            <nz-descriptions-item
              [nzSpan]="1"
              nzTitle="Country">
              <ng-container *ngIf="user.country">
                {{ user.country.name }}
              </ng-container>
              <ng-container *ngIf="!user.country">
                <span
                  nz-typography
                  nzType="secondary">
                  <i>Unspecified</i>
                </span>
              </ng-container>
            </nz-descriptions-item>

            <nz-descriptions-item
              [nzSpan]="2"
              [nzTitle]="
                'Organization' + (user.organizations.length > 1 ? 's' : '')
              ">
              <ng-container *ngIf="user.organizations.length > 0">
                <cvc-tag-overflow
                  tagType="organization"
                  [maxDisplayCount]="2"
                  [tags]="organization$ | ngrxPush">
                </cvc-tag-overflow>
              </ng-container>
              <ng-container *ngIf="user.organizations.length === 0">
                <span
                  nz-typography
                  nzType="secondary">
                  <i>User is not a member of any Organizations.</i>
                </span>
              </ng-container>
            </nz-descriptions-item>
          </nz-descriptions>
        </nz-col>
      </nz-row>
      <nz-row style="margin-top: 16px">
        <nz-col nzSpan="24">
          <cvc-tab-navigation [tabs]="tabs$ | ngrxPush"> </cvc-tab-navigation>
          <div class="content">
            <router-outlet></router-outlet>
          </div>
        </nz-col>
      </nz-row>
    </nz-page-header-content>
  </nz-page-header>

  <nz-modal
    [(nzVisible)]="this.updateProfileModalVisible"
    [nzContent]="profileModalContent"
    [nzTitle]="profileModalTitle"
    [nzFooter]="null"
    (nzOnCancel)="this.handleProfileModalCancel()">
    <ng-template #profileModalTitle><span>Edit Profile</span></ng-template>
    <ng-template #profileModalContent>
      <cvc-user-profile-form
        [user]="user"
        (profileUpdatedEvent)="this.profileUpdated()"></cvc-user-profile-form>
    </ng-template>
  </nz-modal>
</ng-container>

<nz-modal
  [(nzVisible)]="this.updateCoiModalVisible"
  [nzContent]="coiModalContent"
  [nzTitle]="coiModalTitle"
  [nzFooter]="null"
  (nzOnCancel)="this.handleCoiModalCancel()">
  <ng-template #coiModalTitle
    ><span>Update your Conflict of Interest Statement</span></ng-template
  >
  <ng-template #coiModalContent>
    <cvc-user-coi-form
      (coiUpdatedEvent)="this.coiUpdated()"></cvc-user-coi-form>
  </ng-template>
</nz-modal>
