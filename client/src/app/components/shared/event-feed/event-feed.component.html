<ng-container *ngIf="events$ | ngrxPush as events">
  <nz-card [nzTitle]="cardTitle" [nzExtra]="cardExtra"
    id="card-content">
    <ng-template #cardTitle>
      <i nz-icon
        [nzType]="iconNameForSubscribableEntity(subscribable.entityType)"
        *ngIf="subscribable"></i> {{ subscribableName }} Events
    </ng-template>
    <ng-template #cardExtra>
      <form nz-form
        nzLayout="inline"
        id="event-filters">
        <nz-form-item>
          <nz-form-label>Show</nz-form-label>
          <nz-form-control>
            <nz-select (ngModelChange)="onParticipantSelected($event)"
              nzSize="small"
              id="participant-filter"
              name="selectedParticipant"
              [(ngModel)]="participantFilter"
              [nzDropdownMatchSelectWidth]="false">
              <nz-option nzLabel="All Participants" nzValue="ALL"></nz-option>
              <nz-option *ngFor="let p of participants$ | ngrxPush"
                [nzLabel]="p.displayName" [nzValue]="p.id">
              </nz-option>
            </nz-select>
          </nz-form-control>
        </nz-form-item>
        <nz-form-item>
          <nz-form-control>
            <nz-select (ngModelChange)="onOrganizationSelected($event)"
              nzSize="small"
              id="organization-filter"
              name="selectedOrganization"
              [(ngModel)]="organizationFilter"
              [nzDropdownMatchSelectWidth]="false">
              <nz-option nzLabel="All Organizations" nzValue="ALL"></nz-option>
              <nz-option *ngFor="let o of organizations$ | ngrxPush"
                [nzLabel]="o.name" [nzValue]="o.id">
              </nz-option>
            </nz-select>
          </nz-form-control>
        </nz-form-item>
      </form>
    </ng-template>

    <nz-row [nzGutter]="16">
      <nz-col nzSpan="20"
        class="timeline">
        <ng-container *ngIf="events.length">
          <cvc-event-timeline [events]="events"></cvc-event-timeline>
        </ng-container>
        <nz-timeline *ngIf="events.length">
        </nz-timeline>
        <ng-container *ngIf="pageInfo$ | ngrxPush as pageInfo">
          <div nz-list-load-more
            *ngIf="pageInfo.hasNextPage">
            <button nz-button
              nzType="link"
              nzSize="small"
              nzBlock
              (click)="fetchMore(pageInfo.endCursor)">Load More
            </button>
          </div>
        </ng-container>
      </nz-col>
      <nz-col nzSpan="4"
        class="sidebar">
        <cvc-participant-list listTitle="Participants"
          [participantList]="participants$ | ngrxPush"
          (participantSelectedEvent)="onParticipantSelected($event)">
          <ng-template #itemTemplate
            let-user>
            <cvc-user-pill [user]="user"></cvc-user-pill>
          </ng-template>
        </cvc-participant-list>
        <nz-divider></nz-divider>
        <cvc-participant-list listTitle="Organizations"
          [participantList]="organizations$ | ngrxPush"
          (participantSelectedEvent)="onOrganizationSelected($event)">
          <ng-template #itemTemplate
            let-org>
            <cvc-org-pill [org]="org"></cvc-org-pill>
          </ng-template>
        </cvc-participant-list>
      </nz-col>
    </nz-row>
    <!-- <nz-row>
         <nz-col nzSpan="24">
         <ngx-json-viewer *ngIf="organizations$ | ngrxPush" [json]="organizations$ | ngrxPush"></ngx-json-viewer>
         </nz-col>
         </nz-row> -->
  </nz-card>
</ng-container>
