<ng-container *ngIf="events$ | ngrxPush as events">
  <nz-card [nzTitle]="cardTitle"
    [nzExtra]="cardExtra"
    id="card-content">
    <ng-template #cardTitle>
      <i nz-icon
        [nzType]="iconNameForSubscribableEntity(subscribable.entityType)"
        *ngIf="subscribable"></i> {{ subscribableName }} Events
    </ng-template>
    <ng-template #cardExtra>
      <form nz-form
        nzLayout="inline"
        id="event-filters">
        <nz-form-item>
          <nz-form-label>Show</nz-form-label>
          <nz-form-control>
            <nz-select (ngModelChange)="onParticipantSelected($event)"
              nzSize="small"
              id="participant-filter"
              name="selectedParticipant"
              [(ngModel)]="participantFilter"
              [nzDropdownMatchSelectWidth]="false">
              <nz-option nzLabel="All Curators"
                nzValue="ALL"></nz-option>
              <nz-option *ngFor="let p of participants$ | ngrxPush"
                [nzLabel]="p.displayName"
                [nzValue]="p.id">
              </nz-option>
            </nz-select>
          </nz-form-control>
        </nz-form-item>
        <nz-form-item>
          <nz-form-control>
            <nz-select (ngModelChange)="onOrganizationSelected($event)"
              nzSize="small"
              id="organization-filter"
              name="selectedOrganization"
              [(ngModel)]="organizationFilter"
              [nzDropdownMatchSelectWidth]="false">
              <nz-option nzLabel="All Organizations"
                nzValue="ALL"></nz-option>
              <nz-option *ngFor="let o of organizations$ | ngrxPush"
                [nzLabel]="o.name"
                [nzValue]="o.id">
              </nz-option>
            </nz-select>
          </nz-form-control>
        </nz-form-item>
      </form>
    </ng-template>

    <nz-row [nzGutter]="16">
      <nz-col nzSpan="20"
        class="timeline">
        <ng-container *ngIf="events.length">
          <cvc-event-timeline [events]="events"></cvc-event-timeline>
        </ng-container>
        <nz-timeline *ngIf="events.length">
        </nz-timeline>
        <ng-container *ngIf="pageInfo$ | ngrxPush as pageInfo">
          <div nz-list-load-more
            *ngIf="pageInfo.hasNextPage">
            <button nz-button
              nzType="default"
              nzSize="small"
              nzBlock
              (click)="fetchMore(pageInfo.endCursor)">Load More
            </button>
          </div>
        </ng-container>
      </nz-col>
      <nz-col nzSpan="4"
        class="sidebar">
        <nz-card nzTitle="Curators" >
          <h4>Users</h4>
          <cvc-user-avatar *ngFor="let u of participants$ | ngrxPush"
            [user]="u"></cvc-user-avatar>
          <br/>
          <br/>
          <h4>Organizations</h4>
          <cvc-user-avatar *ngFor="let o of organizations$ | ngrxPush"
            [user]="{ displayName: o.name, profileImagePath: o.profileImagePath }"></cvc-user-avatar>
        </nz-card>
      </nz-col>
    </nz-row>
  </nz-card>
</ng-container>
