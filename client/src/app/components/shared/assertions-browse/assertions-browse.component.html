<nz-page-header class="site-page-header">
  <nz-page-header-title>
    <i nz-icon nzType="civic:assertion"></i>
    Assertions
    <span nz-typography nzType="secondary"  *ngIf="(isLoading$ | ngrxPush)">Loading...</span>
  </nz-page-header-title>
  <nz-page-header-extra>
    Card View <nz-switch [(ngModel)]="tableView" (ngModelChange)="refresh()"></nz-switch> Table View
  </nz-page-header-extra>

  <nz-page-header-content>
    <div *ngIf="tableView" nz-row>
      <div nz-col [nzSpan]="24">
        <div class="content">
          <nz-table #assertionsTable
            [nzData]="(assertions$ | ngrxPush)"
            [nzLoading]="(isLoading$ | ngrxPush)"
            [nzFrontPagination]="false"
            [nzShowPagination]="false">

            <thead (nzSortOrderChange)="onSortChanged($event)">
              <tr>
                <th nzWidth="5%" [nzColumnKey]="sortColumns.Id" [nzSortFn]="true">
                  AID
                </th>
                <th nzWidth="5%" [nzColumnKey]="sortColumns.GeneName" [nzSortFn]="true">
                  Gene
                </th>
                <th nzWidth="10%" [nzColumnKey]="sortColumns.VariantName" [nzSortFn]="true">
                  Variant
                </th>
                <th nzWidth="15%" [nzColumnKey]="sortColumns.DiseaseName" [nzSortFn]="true">
                  Disease
                </th>
                <th nzWidth="15%" [nzColumnKey]="sortColumns.DrugName" [nzSortFn]="true">
                  Drugs
                </th>
                <th nzWidth="5%" [nzColumnKey]="sortColumns.Summary" [nzSortFn]="true">
                  Summary
                </th>
                <th nzWidth="10%" [nzColumnKey]="sortColumns.AssertionType" [nzSortFn]="true">
                  Assertion Type
                </th>
                <th nzWidth="10%" [nzColumnKey]="sortColumns.AssertionDirection" [nzSortFn]="true">
                  Assertion Direction
                </th>
                <th nzWidth="10%" [nzColumnKey]="sortColumns.ClinicalSignificance" [nzSortFn]="true">
                  Clinical Significance
                </th>
                <th nzWidth="5%" [nzColumnKey]="sortColumns.AmpLevel" [nzSortFn]="true">
                  AMP/ASCO/CAP Category
                </th>
              </tr>
              <tr>
                <th>
                  <cvc-clearable-text-filter [(inputModel)]="aidInput" placeholderText="Search AID" [onInputChanged]="textInputCallback"></cvc-clearable-text-filter>
                </th>
                <th>
                  <cvc-clearable-text-filter [(inputModel)]="geneNameInput" placeholderText="Search Gene" [onInputChanged]="textInputCallback"></cvc-clearable-text-filter>
                </th>
                <th>
                  <cvc-clearable-text-filter [(inputModel)]="variantNameInput" placeholderText="Search Variant" [onInputChanged]="textInputCallback"></cvc-clearable-text-filter>
                </th>
                <th>
                  <cvc-clearable-text-filter [(inputModel)]="diseaseNameInput" placeholderText="Search Disease" [onInputChanged]="textInputCallback"></cvc-clearable-text-filter>
                </th>
                <th>
                  <cvc-clearable-text-filter [(inputModel)]="drugNameInput" placeholderText="Search Drugs" [onInputChanged]="textInputCallback"></cvc-clearable-text-filter>
                </th>
                <th>
                  <cvc-clearable-text-filter [(inputModel)]="summaryInput" placeholderText="Search Summary" [onInputChanged]="textInputCallback"></cvc-clearable-text-filter>
                </th>
                <th>
                  <nz-select nzAllowClear nzPlaceHolder="Choose" (ngModelChange)="onModelChanged()" [(ngModel)]="assertionTypeInput">
                    <nz-option nzValue="PREDICTIVE" nzLabel="Predictive"></nz-option>
                    <nz-option nzValue="PROGNOSTIC" nzLabel="Prognostic"></nz-option>
                    <nz-option nzValue="DIAGNOSTIC" nzLabel="Diagnostic"></nz-option>
                    <nz-option nzValue="PREDISPOSING" nzLabel="Predisposing"></nz-option>
                  </nz-select>
                </th>
                <th>
                  <nz-select nzAllowClear nzPlaceHolder="Choose" (ngModelChange)="onModelChanged()" [(ngModel)]="assertionDirectionInput">
                    <nz-option nzValue="SUPPORTS" nzLabel="Supports"></nz-option>
                    <nz-option nzValue="DOES_NOT_SUPPORT" nzLabel="Does not Support"></nz-option>
                    <nz-option nzValue="NA" nzLabel="N/A"></nz-option>
                  </nz-select>
                </th>
                <th nzWidth="5%">
                  <nz-select nzAllowClear nzPlaceHolder="Choose" (ngModelChange)="onModelChanged()" [(ngModel)]="clinicalSignificanceInput">
                    <nz-option-group nzLabel="Predictive">
                      <nz-option nzValue="SENSITIVITYRESPONSE" nzLabel="Sensitivity/Response"></nz-option>
                      <nz-option nzValue="RESISTANCE" nzLabel="Resistance"></nz-option>
                      <nz-option nzValue="ADVERSE_RESPONSE" nzLabel="Adverse Response"></nz-option>
                      <nz-option nzValue="REDUCED SENSITIVITY" nzLabel="Reduced Sensitivity"></nz-option>
                      <nz-option nzValue="NA" nzLabel="N/A"></nz-option>
                    </nz-option-group>
                    <nz-option-group nzLabel="Prognostic">
                      <nz-option nzValue="BETTER_OUTCOME" nzLabel="Better Outcome"></nz-option>
                      <nz-option nzValue="POOR_OUTCOME" nzLabel="Poor Outcome"></nz-option>
                      <nz-option nzValue="NA" nzLabel="N/A"></nz-option>
                    </nz-option-group>
                    <nz-option-group nzLabel="Diagnostic">
                      <nz-option nzValue="POSITIVE" nzLabel="Positive"></nz-option>
                      <nz-option nzValue="NEGATIVE" nzLabel="Negative"></nz-option>
                    </nz-option-group>
                    <nz-option-group nzLabel="Predisposing">
                      <nz-option nzValue="PATHOGENIC" nzLabel="Pathogenic"></nz-option>
                      <nz-option nzValue="LIKELY_PATHOGENIC" nzLabel="Likely Pathogenic"></nz-option>
                      <nz-option nzValue="BENIGN" nzLabel="Benign"></nz-option>
                      <nz-option nzValue="LIKELY_BENIGN" nzLabel="Likely Benign"></nz-option>
                      <nz-option nzValue="UNCERTAIN_SIGNIFICANCE" nzLabel="Uncertain Significance"></nz-option>
                    </nz-option-group>
                  </nz-select>
                </th>
                <th>
                  <nz-select nzAllowClear nzPlaceHolder="Choose" (ngModelChange)="onModelChanged()" [(ngModel)]="ampLevelInput">
                    <nz-option nzValue="TIER_I_LEVEL_A" nzLabel="Tier I Level A"></nz-option>
                    <nz-option nzValue="TIER_I_LEVEL_B" nzLabel="Tier I Level B"></nz-option>
                    <nz-option nzValue="TIER_II_LEVEL_C" nzLabel="Tier II Level C"></nz-option>
                    <nz-option nzValue="TIER_II_LEVEL_D" nzLabel="Tier II Level D"></nz-option>
                    <nz-option nzValue="TIER_III" nzLabel="Tier III"></nz-option>
                  </nz-select>
                </th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let aid of assertionsTable.data">
                <td>
                  <a routerLink="/assertions/{{aid.id}}">{{aid.name}}</a>
                </td>
                <td>
                  {{ aid.gene.name }}
                </td>
                <td>
                  {{ aid.variant.name }}
                </td>
                <td>
                  <ng-container *ngIf="aid.disease.displayName; else diseaseElse">
                    {{ aid.disease.displayName }}
                  </ng-container>
                  <ng-template #diseaseElse>
                    <i>N/A</i>
                  </ng-template>
                </td>
                <td>
                  <p *ngIf="aid.drugs.length > 0; else drugsElse" nz-typography nzEllipsis nzExpandable [nzEllipsisRows]="1">
                    <span *ngFor="let drug of aid.drugs; last as isLast" >
                      {{ drug.name }}{{ isLast ? '' : ', ' }}{{isLast && aid.drugs.length > 1 ?  ' (' + aid.drugInteractionType + ')' : '' }}
                    </span>
                  </p>
                  <ng-template #drugsElse>
                    <i>N/A</i>
                  </ng-template>
                </td>
                <td>
                  <i nz-icon nzType="align-left" nz-tooltip nzTooltipPlacement="top" [nzTooltipTitle]="aid.summary"></i>
                </td>
                <td>
                  {{ aid.assertionType }}
                </td>
                <td>
                  {{ aid.assertionDirection }}
                </td>
                <td>
                  {{ aid.clinicalSignificance }}
                </td>
                <td>
                  {{ aid.ampLevel}}
                </td>
              </tr>
            </tbody>
          </nz-table>
        </div>
      </div>
    </div>
    <div *ngIf="!tableView" nz-row>
      <div nz-col [nzSpan]="24">
        <ng-container *ngFor="let assertion of assertions$ | ngrxPush">
          <cvc-assertion-card [assertion]="assertion"></cvc-assertion-card>
        </ng-container>
      </div>
    </div>
  </nz-page-header-content>
</nz-page-header>