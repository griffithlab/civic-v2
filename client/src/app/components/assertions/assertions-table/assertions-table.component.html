<!-- adjust nz-card's cvcAutoHeightCard to equalize padding around this table's container e.g. entity-home's nz-page-header components -->
<nz-card [nzTitle]="titleTemplate"
  [nzExtra]="extraTemplate"
  nzSize="small"
  cvcAutoHeightCard="35">
  <!-- adjust nz-table's cvcAutoHeightTable to ensure that table's column header rows are not clipped when table is scrolled to bottom -->
  <nz-table #virtualTable
    nzSize="small"
    [cvcAutoHeightTable]="25"
    [nzVirtualItemSize]="29"
    [nzData]="assertions$| ngrxPush"
    [nzLoading]="isLoading"
    [nzVirtualForTrackBy]="trackByIndex"
    [nzScroll]="{ x: '400px', y: '800px' }"
    [nzFrontPagination]="false"
    [nzShowPagination]="false">
    <thead (nzSortOrderChange)="onSortChanged($event)">
      <tr class="col-header-row">
        <th nzWidth="100px"
          nzLeft
          [nzColumnKey]="sortColumns.Id"
          [nzSortFn]="true">
          AID
        </th>
        <th nzWidth="120px"
          nzLeft
          [nzColumnKey]="sortColumns.GeneName"
          [nzSortFn]="true">
          Gene
        </th>
        <th nzWidth="200px"
          nzLeft
          [nzColumnKey]="sortColumns.VariantName"
          [nzSortFn]="true">
          Variant
        </th>
        <th nzWidth="250px"
          [nzColumnKey]="sortColumns.DiseaseName"
          [nzSortFn]="true">
          Disease
        </th>
        <th nzWidth="400px"
          [nzColumnKey]="sortColumns.DrugName"
          [nzSortFn]="true">
          Drugs
        </th>
        <th nzWidth="60px"
          nzRight
          [nzColumnKey]="sortColumns.Summary"
          [nzSortFn]="true"
          nz-tooltip
          nzTooltipTitle="Summary">
          SUM
        </th>
        <th nzWidth="60px"
          nzRight
          [nzColumnKey]="sortColumns.AssertionType"
          [nzSortFn]="true"
          nzAlign="center"
          nz-tooltip
          nzTooltipTitle="Assertion Type">
          AT
        </th>
        <th nzWidth="60px"
          nzRight
          [nzColumnKey]="sortColumns.AssertionDirection"
          [nzSortFn]="true"
          nzAlign="center"
          nz-tooltip
          nzTooltipTitle="Assertion Direction">
          AD
        </th>
        <th nzWidth="60px"
          nzRight
          [nzColumnKey]="sortColumns.ClinicalSignificance"
          [nzSortFn]="true"
          nzAlign="center"
          nz-tooltip
          nzTooltipTitle="Clinical Significance">
          CS
        </th>
        <th nzWidth="60px"
          nzRight
          [nzColumnKey]="sortColumns.AmpLevel"
          [nzSortFn]="true"
          nzAlign="center"
          nz-tooltip
          nzTooltipTitle="AMP/ASCO/CAP Category">
          CAT
        </th>
        <th nzWidth="75px"
          nzRight
          nzAlign="right"
          [nzColumnKey]="sortColumns.EvidenceItemsCount"
          [nzSortFn]="true"
          [nzSortDirections]="['descend', 'ascend', null]"
          nz-tooltip
          nzTooltipTitle="Evidence Count"><i nz-icon
            nzType="civic:evidence"></i> Count
        </th>
      </tr>
      <tr class="filter-row">
        <th nzLeft>
          <cvc-clearable-input-filter [(inputModel)]="aidInput"
            [onInputChanged]="textInputCallback"></cvc-clearable-input-filter>
        </th>
        <th nzLeft>
          <cvc-clearable-input-filter [(inputModel)]="geneNameInput"
            [onInputChanged]="textInputCallback"></cvc-clearable-input-filter>
        </th>
        <th nzLeft>
          <cvc-clearable-input-filter [(inputModel)]="variantNameInput"
            [onInputChanged]="textInputCallback"></cvc-clearable-input-filter>
        </th>
        <th>
          <cvc-clearable-input-filter [(inputModel)]="diseaseNameInput"
            [onInputChanged]="textInputCallback"></cvc-clearable-input-filter>
        </th>
        <th>
          <cvc-clearable-input-filter [(inputModel)]="drugNameInput"
            [onInputChanged]="textInputCallback"></cvc-clearable-input-filter>
        </th>
        <th nzRight>
          <cvc-clearable-input-filter [(inputModel)]="summaryInput"
            [onInputChanged]="textInputCallback"></cvc-clearable-input-filter>
        </th>
        <th nzRight
          nzAlign="center">
          <nz-select nzAllowClear
            nzSize="small"
            [nzDropdownMatchSelectWidth]="false"
            nzPlaceHolder="All"
            (ngModelChange)="onModelChanged()"
            [(ngModel)]="assertionTypeInput">
            <nz-option nzValue="PREDICTIVE"
              nzLabel="Predictive"></nz-option>
            <nz-option nzValue="PROGNOSTIC"
              nzLabel="Prognostic"></nz-option>
            <nz-option nzValue="DIAGNOSTIC"
              nzLabel="Diagnostic"></nz-option>
            <nz-option nzValue="PREDISPOSING"
              nzLabel="Predisposing"></nz-option>
          </nz-select>
        </th>
        <th nzRight
          nzAlign="center">
          <nz-select nzAllowClear
            nzSize="small"
            [nzDropdownMatchSelectWidth]="false"
            nzPlaceHolder="All"
            (ngModelChange)="onModelChanged()"
            [(ngModel)]="assertionDirectionInput">
            <nz-option nzValue="SUPPORTS"
              nzLabel="Supports"></nz-option>
            <nz-option nzValue="DOES_NOT_SUPPORT"
              nzLabel="Does not Support"></nz-option>
            <nz-option nzValue="NA"
              nzLabel="N/A"></nz-option>
          </nz-select>
        </th>
        <th nzRight
          nzAlign="center">
          <nz-select nzAllowClear
            nzSize="small"
            [nzDropdownMatchSelectWidth]="false"
            nzPlaceHolder="All"
            (ngModelChange)="onModelChanged()"
            [(ngModel)]="clinicalSignificanceInput">
            <nz-option-group nzLabel="Predictive">
              <nz-option nzValue="SENSITIVITYRESPONSE"
                nzLabel="Sensitivity/Response"></nz-option>
              <nz-option nzValue="RESISTANCE"
                nzLabel="Resistance"></nz-option>
              <nz-option nzValue="ADVERSE_RESPONSE"
                nzLabel="Adverse Response"></nz-option>
              <nz-option nzValue="REDUCED SENSITIVITY"
                nzLabel="Reduced Sensitivity"></nz-option>
              <nz-option nzValue="NA"
                nzLabel="N/A"></nz-option>
            </nz-option-group>
            <nz-option-group nzLabel="Prognostic">
              <nz-option nzValue="BETTER_OUTCOME"
                nzLabel="Better Outcome"></nz-option>
              <nz-option nzValue="POOR_OUTCOME"
                nzLabel="Poor Outcome"></nz-option>
              <nz-option nzValue="NA"
                nzLabel="N/A"></nz-option>
            </nz-option-group>
            <nz-option-group nzLabel="Diagnostic">
              <nz-option nzValue="POSITIVE"
                nzLabel="Positive"></nz-option>
              <nz-option nzValue="NEGATIVE"
                nzLabel="Negative"></nz-option>
            </nz-option-group>
            <nz-option-group nzLabel="Predisposing">
              <nz-option nzValue="PATHOGENIC"
                nzLabel="Pathogenic"></nz-option>
              <nz-option nzValue="LIKELY_PATHOGENIC"
                nzLabel="Likely Pathogenic"></nz-option>
              <nz-option nzValue="BENIGN"
                nzLabel="Benign"></nz-option>
              <nz-option nzValue="LIKELY_BENIGN"
                nzLabel="Likely Benign"></nz-option>
              <nz-option nzValue="UNCERTAIN_SIGNIFICANCE"
                nzLabel="Uncertain Significance"></nz-option>
            </nz-option-group>
          </nz-select>
        </th>
        <th nzRight
          nzAlign="center">
          <nz-select nzAllowClear
            nzSize="small"
            [nzDropdownMatchSelectWidth]="false"
            nzPlaceHolder="All"
            (ngModelChange)="onModelChanged()"
            [(ngModel)]="ampLevelInput">
            <nz-option nzValue="TIER_I_LEVEL_A"
              nzLabel="Tier I Level A"></nz-option>
            <nz-option nzValue="TIER_I_LEVEL_B"
              nzLabel="Tier I Level B"></nz-option>
            <nz-option nzValue="TIER_II_LEVEL_C"
              nzLabel="Tier II Level C"></nz-option>
            <nz-option nzValue="TIER_II_LEVEL_D"
              nzLabel="Tier II Level D"></nz-option>
            <nz-option nzValue="TIER_III"
              nzLabel="Tier III"></nz-option>
          </nz-select>
        </th>
        <th nzRight></th>
      </tr>
    </thead>
    <tbody>
      <ng-template nz-virtual-scroll
        let-aid
        let-index="index">
        <tr class="data-row">
          <td nzLeft>
            <cvc-assertion-tag [assertion]="aid"></cvc-assertion-tag>
          </td>
          <td nzLeft>
            <cvc-gene-tag [gene]="aid.gene"></cvc-gene-tag>
          </td>
          <td nzLeft>
            <cvc-variant-tag [variant]="aid.variant"></cvc-variant-tag>
          </td>
          <td>
            <ng-container *ngIf="aid.disease.name; else diseaseElse">
              <cvc-disease-tag [disease]="aid.disease"
                [truncateLongName]="true"></cvc-disease-tag>
            </ng-container>
            <ng-template #diseaseElse>
              <i>N/A</i>
            </ng-template>
          </td>
          <td>
            <div *ngIf="aid.drugs.length > 0; else drugsElse">
              <cvc-tag-list>
                <ng-container *ngIf="aid.drugs.length > 1">
                  <nz-tag>{{ aid.drugInteractionType.substring(0,3) }}</nz-tag>
                </ng-container>
                <ng-container *ngFor="let drug of aid.drugs">
                  <cvc-drug-tag [drug]="drug"
                    [truncateLongName]="true"></cvc-drug-tag>
                </ng-container>
              </cvc-tag-list>
            </div>
            <ng-template #drugsElse>
              <i nz-typography
                nzType="secondary">N/A</i>
            </ng-template>
          </td>
          <td nzAlign="center"
            nzRight>
            <nz-tag nz-tooltip
              nzTooltipPlacement="top"
              [nzTooltipTitle]="showTooltips ? aid.summary : ''">
              <i nz-icon
                nzType="align-left"></i>
            </nz-tag>
          </td>
          <td nzAlign="center"
            nzRight>
            <nz-tag nz-tooltip
              nzTooltipPlacement="top"
              [nzTooltipTitle]="showTooltips ? (aid.assertionType | evidenceEnumDisplay) : ''">
              <i nz-icon
                [nzType]="aid.assertionType | evidenceEnumDisplay: 'icon-name'"
                class="attribute-icon"></i>
            </nz-tag>
          </td>
          <td nzAlign="center"
            nzRight>
            <nz-tag nz-tooltip
              nzTooltipPlacement="top"
              [nzTooltipTitle]="showTooltips ? (aid.assertionDirection | evidenceEnumDisplay) : ''">
              <i nz-icon
                [nzType]="aid.assertionDirection | evidenceEnumDisplay: 'icon-name'"
                class="attribute-icon"></i>
            </nz-tag>
          </td>
          <td nzAlign="center"
            nzRight>
            <nz-tag nz-tooltip
              nzTooltipPlacement="top"
              [nzTooltipTitle]="aid.clinicalSignificance | evidenceEnumDisplay">
              <i nz-icon
                [nzType]="aid.clinicalSignificance| evidenceEnumDisplay: 'icon-name'"
                class="attribute-icon"></i>
            </nz-tag>
          </td>
          <td nzRight
            nzAlign="center">
            <nz-tag *ngIf="aid.ampLevel"
              nz-tooltip
              nzTooltipPlacement="top"
              [nzTooltipTitle]="aid.ampLevel | formatAmp: 'verbose'">
              {{ aid.ampLevel | formatAmp: 'compact' }}
            </nz-tag>
          </td>
          <td nzRight
            nzAlign="right">
            {{aid.evidenceItemsCount}}
          </td>
        </tr>
      </ng-template>
    </tbody>
  </nz-table>
</nz-card>

<ng-template #titleTemplate>
  <i nz-icon
    nzType="civic:assertion"></i>
  <ng-container *ngIf="this.cvcTitleTemplate">
    <ng-template [ngTemplateOutlet]="cvcTitleTemplate"></ng-template>
  </ng-container>
  <ng-container *ngIf="this.cvcTitle">
    {{ this.cvcTitle }}
  </ng-container>
  <span *ngIf="(filteredCount$ | ngrxPush) as filteredCount; else noData"
    nz-typography
    nzType="secondary">
    ({{totalCount}} total, showing {{visibleCount}}<span *ngIf="totalCount && filteredCount < totalCount"> of {{filteredCount}} filtered</span>)
  </span>
  <ng-template #noData>
    <span nz-typography
      nzType="secondary">
      (0 total)
    </span>
  </ng-template>
</ng-template>

<ng-template #extraTemplate>
  <nz-tag nzColor="warning"
    *ngIf="noMoreRows$ | ngrxPush">
    <i nz-icon
      nzType="exclamation-circle"></i>
    <span>End of results reached</span>
  </nz-tag>
</ng-template>
